
(function(){var b=(typeof OpenLayers=="object"&&OpenLayers.singleFile);window.OpenLayers={_scriptName:(!b)?"lib/OpenLayers.js":"OpenLayers.js",_getScriptLocation:function(){var j="";var l=new RegExp("(^|(.*?\\/))("+OpenLayers._scriptName+")(\\?|$)");var d=document.getElementsByTagName("script");for(var g=0,c=d.length;g<c;g++){var k=d[g].getAttribute("src");if(k){var f=k.match(l);if(f){j=f[1];break}}}return j}}})();OpenLayers.VERSION_NUMBER="$Revision: 1.1 $";OpenLayers.LIB_VERSION="3.6.5-IDEZar_visorPortada";OpenLayers.Class=function(){var b=arguments.length;var f=arguments[0];var d=arguments[b-1];var g=typeof d.initialize=="function"?d.initialize:function(){f.prototype.initialize.apply(this,arguments)};if(b>1){var c=[g,f].concat(Array.prototype.slice.call(arguments).slice(1,b-1),d);OpenLayers.inherit.apply(null,c)}else{g.prototype=d}return g};OpenLayers.Class.isPrototype=function(){};OpenLayers.Class.create=function(){return function(){if(arguments&&arguments[0]!=OpenLayers.Class.isPrototype){this.initialize.apply(this,arguments)}}};OpenLayers.Class.inherit=function(c){var d=function(){c.call(this)};var b=[d].concat(Array.prototype.slice.call(arguments));OpenLayers.inherit.apply(null,b);return d.prototype};OpenLayers.inherit=function(j,f){var d=function(){};d.prototype=f.prototype;j.prototype=new d;var c,b,g;for(c=2,b=arguments.length;c<b;c++){g=arguments[c];if(typeof g==="function"){g=g.prototype}OpenLayers.Util.extend(j.prototype,g)}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(b,g){b=b||{};if(g){for(var f in g){var d=g[f];if(d!==undefined){b[f]=d}}var c=typeof window.Event=="function"&&g instanceof window.Event;if(!c&&g.hasOwnProperty&&g.hasOwnProperty("toString")){b.toString=g.toString}}return b};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){var f=[];for(var d=0,b=arguments.length;d<b;d++){var c=arguments[d];if(typeof c=="string"){c=document.getElementById(c)}if(arguments.length==1){return c}f.push(c)}return f};OpenLayers.Util.isElement=function(b){return !!(b&&b.nodeType===1)};OpenLayers.Util.isArray=function(b){return(Object.prototype.toString.call(b)==="[object Array]")};if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement}OpenLayers.Util.removeItem=function(d,c){for(var b=d.length-1;b>=0;b--){if(d[b]==c){d.splice(b,1)}}return d};OpenLayers.Util.clearArray=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"}));b.length=0};OpenLayers.Util.indexOf=function(f,d){if(typeof f.indexOf=="function"){return f.indexOf(d)}else{for(var c=0,b=f.length;c<b;c++){if(f[c]==d){return c}}return -1}};OpenLayers.Util.modifyDOMElement=function(g,l,f,j,b,d,k,c){if(l){g.id=l}if(f){g.style.left=f.x+"px";g.style.top=f.y+"px"}if(j){g.style.width=j.w+"px";g.style.height=j.h+"px"}if(b){g.style.position=b}if(d){g.style.border=d}if(k){g.style.overflow=k}if(parseFloat(c)>=0&&parseFloat(c)<1){g.style.filter="alpha(opacity="+(c*100)+")";g.style.opacity=c}else{if(parseFloat(c)==1){g.style.filter="";g.style.opacity=""}}};OpenLayers.Util.createDiv=function(b,m,l,j,g,d,c,k){var f=document.createElement("div");if(j){f.style.backgroundImage="url("+j+")"}if(!b){b=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!g){g="absolute"}OpenLayers.Util.modifyDOMElement(f,b,m,l,g,d,c,k);return f};OpenLayers.Util.createImage=function(b,l,k,g,f,d,j,m){var c=document.createElement("img");if(!b){b=OpenLayers.Util.createUniqueID("OpenLayersDiv")}if(!f){f="relative"}OpenLayers.Util.modifyDOMElement(c,b,l,k,f,d,null,j);if(m){c.style.display="none";OpenLayers.Event.observe(c,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,c));OpenLayers.Event.observe(c,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,c))}c.style.alt=b;c.galleryImg="no";if(g){c.src=g}return c};OpenLayers.Util.setOpacity=function(c,b){OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,b)};OpenLayers.Util.onImageLoad=function(){if(!this.viewRequestID||(this.map&&this.viewRequestID==this.map.viewRequestID)){this.style.display=""}OpenLayers.Element.removeClass(this,"olImageLoadError")};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var f=this.urls;if(f&&OpenLayers.Util.isArray(f)&&f.length>1){var g=this.src.toString();var d,b;for(b=0;d=f[b];b++){if(g.indexOf(d)!=-1){break}}var j=Math.floor(f.length*Math.random());var c=f[j];b=0;while(c==d&&b++<4){j=Math.floor(f.length*Math.random());c=f[j]}this.src=g.replace(d,c)}else{this.src=this.src}}else{OpenLayers.Element.addClass(this,"olImageLoadError")}this.style.display=""};OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var f=navigator.appVersion.split("MSIE");var b=parseFloat(f[1]);var c=false;try{c=!!(document.body.filters)}catch(d){}OpenLayers.Util.alphaHackNeeded=(c&&(b>=5.5)&&(b<7))}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(b,c,n,m,k,j,d,f,l){OpenLayers.Util.modifyDOMElement(b,c,n,m,j,null,null,l);var g=b.childNodes[0];if(k){g.src=k}OpenLayers.Util.modifyDOMElement(g,b.id+"_innerImage",null,m,"relative",d);if(OpenLayers.Util.alphaHack()){if(b.style.display!="none"){b.style.display="inline-block"}if(f==null){f="scale"}b.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+g.src+"', sizingMethod='"+f+"')";if(parseFloat(b.style.opacity)>=0&&parseFloat(b.style.opacity)<1){b.style.filter+=" alpha(opacity="+b.style.opacity*100+")"}g.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(c,n,m,k,j,d,f,l,o){var b=OpenLayers.Util.createDiv();var g=OpenLayers.Util.createImage(null,null,null,null,null,null,null,false);b.appendChild(g);if(o){g.style.display="none";OpenLayers.Event.observe(g,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,b));OpenLayers.Event.observe(g,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,b))}OpenLayers.Util.modifyAlphaImageDiv(b,c,n,m,k,j,d,f,l);return b};OpenLayers.Util.upperCaseObject=function(c){var b={};for(var d in c){b[d.toUpperCase()]=c[d]}return b};OpenLayers.Util.applyDefaults=function(f,d){f=f||{};var c=typeof window.Event=="function"&&d instanceof window.Event;for(var b in d){if(f[b]===undefined||(!c&&d.hasOwnProperty&&d.hasOwnProperty(b)&&!f.hasOwnProperty(b))){f[b]=d[b]}}if(!c&&d&&d.hasOwnProperty&&d.hasOwnProperty("toString")&&!f.hasOwnProperty("toString")){f.toString=d.toString}return f};OpenLayers.Util.getParameterString=function(d){var c=[];for(var l in d){var k=d[l];if((k!=null)&&(typeof k!="function")){var f;if(typeof k=="object"&&k.constructor==Array){var g=[];var m;for(var b=0,j=k.length;b<j;b++){m=k[b];g.push(encodeURIComponent((m===null||m===undefined)?"":m))}f=g.join(",")}else{f=encodeURIComponent(k)}c.push(encodeURIComponent(l)+"="+f)}}return c.join("&")};OpenLayers.Util.urlAppend=function(b,c){var f=b;if(c){var d=(b+" ").split(/[?&]/);f+=(d.pop()===" "?c:d.length?"&"+c:"?"+c)}return f};OpenLayers.ImgPath="";OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/")};OpenLayers.Util.Try=function(){var f=null;for(var d=0,b=arguments.length;d<b;d++){var c=arguments[d];try{f=c();break}catch(g){}}return f};OpenLayers.Util.getXmlNodeValue=function(b){var c=null;OpenLayers.Util.Try(function(){c=b.text;if(!c){c=b.textContent}if(!c){c=b.firstChild.nodeValue}},function(){c=b.textContent});return c};OpenLayers.Util.mouseLeft=function(b,d){var c=(b.relatedTarget)?b.relatedTarget:b.toElement;while(c!=d&&c!=null){c=c.parentNode}return(c!=d)};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(c,b){if(b==null){b=OpenLayers.Util.DEFAULT_PRECISION}if(typeof c!=="number"){c=parseFloat(c)}return b===0?c:parseFloat(c.toPrecision(b))};OpenLayers.Util.rad=function(b){return b*Math.PI/180};OpenLayers.Util.deg=function(b){return b*180/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(j,g){var n=OpenLayers.Util.VincentyConstants;var V=n.a,U=n.b,Q=n.f;var q=OpenLayers.Util.rad(g.lon-j.lon);var T=Math.atan((1-Q)*Math.tan(OpenLayers.Util.rad(j.lat)));var S=Math.atan((1-Q)*Math.tan(OpenLayers.Util.rad(g.lat)));var p=Math.sin(T),l=Math.cos(T);var o=Math.sin(S),k=Math.cos(S);var D=q,r=2*Math.PI;var v=20;while(Math.abs(D-r)>1e-12&&--v>0){var K=Math.sin(D),c=Math.cos(D);var X=Math.sqrt((k*K)*(k*K)+(l*o-p*k*c)*(l*o-p*k*c));if(X==0){return 0}var N=p*o+l*k*c;var J=Math.atan2(X,N);var m=Math.asin(l*k*K/X);var O=Math.cos(m)*Math.cos(m);var u=N-2*p*o/O;var G=Q/16*O*(4+Q*(4-3*O));r=D;D=q+(1-G)*Q*Math.sin(m)*(J+G*X*(u+G*N*(-1+2*u*u)))}if(v==0){return NaN}var F=O*(V*V-U*U)/(U*U);var I=1+F/16384*(4096+F*(-768+F*(320-175*F)));var H=F/1024*(256+F*(-128+F*(74-47*F)));var M=H*X*(u+H/4*(N*(-1+2*u*u)-H/6*u*(-3+4*X*X)*(-3+4*u*u)));var E=U*I*(J-M);var R=E.toFixed(3)/1000;return R};OpenLayers.Util.destinationVincenty=function(o,Z,N){var r=OpenLayers.Util;var l=r.VincentyConstants;var aa=l.a,Y=l.b,T=l.f;var X=o.lon;var j=o.lat;var D=N;var M=r.rad(Z);var Q=Math.sin(M);var k=Math.cos(M);var O=(1-T)*Math.tan(r.rad(j));var c=1/Math.sqrt((1+O*O)),m=O*c;var v=Math.atan2(O,k);var J=c*Q;var S=1-J*J;var F=S*(aa*aa-Y*Y)/(Y*Y);var I=1+F/16384*(4096+F*(-768+F*(320-175*F)));var G=F/1024*(256+F*(-128+F*(74-47*F)));var H=D/(Y*I),U=2*Math.PI;while(Math.abs(H-U)>1e-12){var p=Math.cos(2*v+H);var ab=Math.sin(H);var R=Math.cos(H);var K=G*ab*(p+G/4*(R*(-1+2*p*p)-G/6*p*(-3+4*ab*ab)*(-3+4*p*p)));U=H;H=D/(Y*I)+K}var V=m*ab-c*R*k;var d=Math.atan2(m*R+c*ab*k,(1-T)*Math.sqrt(J*J+V*V));var q=Math.atan2(ab*Q,c*R-m*ab*k);var E=T/16*S*(4+T*(4-3*S));var n=q-(1-E)*T*J*(H+E*ab*(p+E*R*(-1+2*p*p)));var g=Math.atan2(J,-V);return new OpenLayers.LonLat(X+r.deg(n),r.deg(d))};OpenLayers.Util.getParameters=function(c){c=(c===null||c===undefined)?window.location.href:c;var b="";if(OpenLayers.String.contains(c,"?")){var d=c.indexOf("?")+1;var j=OpenLayers.String.contains(c,"#")?c.indexOf("#"):c.length;b=c.substring(d,j)}var p={};var f=b.split(/[&;]/);for(var l=0,m=f.length;l<m;++l){var k=f[l].split("=");if(k[0]){var o=k[0];try{o=decodeURIComponent(o)}catch(g){o=unescape(o)}var n=(k[1]||"").replace(/\+/g," ");try{n=decodeURIComponent(n)}catch(g){n=unescape(n)}n=n.split(",");if(n.length==1){n=n[0]}p[o]=n}}return p};OpenLayers.Util.getArgs=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"}));return OpenLayers.Util.getParameters(b)};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(b){if(b==null){b="id_"}OpenLayers.Util.lastSeqID+=1;return b+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=0.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1000,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(c){var b=(c>1)?(1/c):c;return b};OpenLayers.Util.getResolutionFromScale=function(f,b){var c;if(f){if(b==null){b="degrees"}var d=OpenLayers.Util.normalizeScale(f);c=1/(d*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH)}return c};OpenLayers.Util.getScaleFromResolution=function(c,b){if(b==null){b="degrees"}var d=c*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH;return d};OpenLayers.Util.safeStopPropagation=function(b){OpenLayers.Event.stop(b,true)};OpenLayers.Util.pagePosition=function(f){var m=[0,0];var l=OpenLayers.Util.getViewportElement();if(!f||f==window||f==l){return m}var j=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&OpenLayers.Element.getStyle(f,"position")=="absolute"&&(f.style.top==""||f.style.left=="");var n=null;var k;if(f.getBoundingClientRect){k=f.getBoundingClientRect();var c=l.scrollTop;var d=l.scrollLeft;m[0]=k.left+d;m[1]=k.top+c}else{if(document.getBoxObjectFor&&!j){k=document.getBoxObjectFor(f);var b=document.getBoxObjectFor(l);m[0]=k.screenX-b.screenX;m[1]=k.screenY-b.screenY}else{m[0]=f.offsetLeft;m[1]=f.offsetTop;n=f.offsetParent;if(n!=f){while(n){m[0]+=n.offsetLeft;m[1]+=n.offsetTop;n=n.offsetParent}}var g=OpenLayers.BROWSER_NAME;if(g=="opera"||(g=="safari"&&OpenLayers.Element.getStyle(f,"position")=="absolute")){m[1]-=document.body.offsetTop}n=f.offsetParent;while(n&&n!=document.body){m[0]-=n.scrollLeft;if(g!="opera"||n.tagName!="TR"){m[1]-=n.scrollTop}n=n.offsetParent}}}return m};OpenLayers.Util.getViewportElement=function(){var b=arguments.callee.viewportElement;if(b==undefined){b=(OpenLayers.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat")?document.body:document.documentElement;arguments.callee.viewportElement=b}return b};OpenLayers.Util.isEquivalentUrl=function(j,g,d){d=d||{};OpenLayers.Util.applyDefaults(d,{ignoreCase:true,ignorePort80:true,ignoreHash:true});var c=OpenLayers.Util.createUrlObject(j,d);var b=OpenLayers.Util.createUrlObject(g,d);for(var f in c){if(f!=="args"){if(c[f]!=b[f]){return false}}}for(var f in c.args){if(c.args[f]!=b.args[f]){return false}delete b.args[f]}for(var f in b.args){return false}return true};OpenLayers.Util.createUrlObject=function(c,n){n=n||{};if(!(/^\w+:\/\//).test(c)){var j=window.location;var f=j.port?":"+j.port:"";var k=j.protocol+"//"+j.host.split(":").shift()+f;if(c.indexOf("/")===0){c=k+c}else{var g=j.pathname.split("/");g.pop();c=k+g.join("/")+"/"+c}}if(n.ignoreCase){c=c.toLowerCase()}var l=document.createElement("a");l.href=c;var d={};d.host=l.host.split(":").shift();d.protocol=l.protocol;if(n.ignorePort80){d.port=(l.port=="80"||l.port=="0")?"":l.port}else{d.port=(l.port==""||l.port=="0")?"80":l.port}d.hash=(n.ignoreHash||l.hash==="#")?"":l.hash;var b=l.search;if(!b){var m=c.indexOf("?");b=(m!=-1)?c.substr(m):""}d.args=OpenLayers.Util.getParameters(b);d.pathname=(l.pathname.charAt(0)=="/")?l.pathname:"/"+l.pathname;return d};OpenLayers.Util.removeTail=function(c){var d=null;var b=c.indexOf("?");var f=c.indexOf("#");if(b==-1){d=(f!=-1)?c.substr(0,f):c}else{d=(f!=-1)?c.substr(0,Math.min(b,f)):c.substr(0,b)}return d};OpenLayers.IS_GECKO=(function(){var b=navigator.userAgent.toLowerCase();return b.indexOf("webkit")==-1&&b.indexOf("gecko")!=-1})();OpenLayers.BROWSER_NAME=(function(){var b="";var c=navigator.userAgent.toLowerCase();if(c.indexOf("opera")!=-1){b="opera"}else{if(c.indexOf("msie")!=-1){b="msie"}else{if(c.indexOf("safari")!=-1){b="safari"}else{if(c.indexOf("mozilla")!=-1){if(c.indexOf("firefox")!=-1){b="firefox"}else{b="mozilla"}}}}}return b})();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(c,q,r){var n,g;var b=document.createElement("div");b.style.visibility="hidden";var p=(r&&r.containerElement)?r.containerElement:document.body;if(q){if(q.w){n=q.w;b.style.width=n+"px"}else{if(q.h){g=q.h;b.style.height=g+"px"}}}if(r&&r.displayClass){b.className=r.displayClass}var j=document.createElement("div");j.innerHTML=c;j.style.overflow="visible";if(j.childNodes){for(var f=0,d=j.childNodes.length;f<d;f++){if(!j.childNodes[f].style){continue}j.childNodes[f].style.overflow="visible"}}b.appendChild(j);p.appendChild(b);var o=false;var m=b.parentNode;while(m&&m.tagName.toLowerCase()!="body"){var k=OpenLayers.Element.getStyle(m,"position");if(k=="absolute"){o=true;break}else{if(k&&k!="static"){break}}m=m.parentNode}if(!o){b.style.position="absolute"}if(!n){n=parseInt(j.scrollWidth);b.style.width=n+"px"}if(!g){g=parseInt(j.scrollHeight)}b.removeChild(j);p.removeChild(b);return new OpenLayers.Size(n,g)};OpenLayers.Util.getScrollbarWidth=function(){var d=OpenLayers.Util._scrollbarWidth;if(d==null){var g=null;var f=null;var b=0;var c=0;g=document.createElement("div");g.style.position="absolute";g.style.top="-1000px";g.style.left="-1000px";g.style.width="100px";g.style.height="50px";g.style.overflow="hidden";f=document.createElement("div");f.style.width="100%";f.style.height="200px";g.appendChild(f);document.body.appendChild(g);b=f.offsetWidth;g.style.overflow="scroll";c=f.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=(b-c);d=OpenLayers.Util._scrollbarWidth}return d};OpenLayers.Util.getFormattedLonLat=function(l,c,g){if(!g){g="dms"}l=(l+540)%360-180;var f=Math.abs(l);var m=Math.floor(f);var b=(f-m)/(1/60);var d=b;b=Math.floor(b);var k=(d-b)/(1/60);k=Math.round(k*10);k/=10;if(k>=60){k-=60;b+=1;if(b>=60){b-=60;m+=1}}if(m<10){m="0"+m}var j=m+"\u00B0";if(g.indexOf("dm")>=0){if(b<10){b="0"+b}j+=b+"'";if(g.indexOf("dms")>=0){if(k<10){k="0"+k}j+=k+'"'}}if(c=="lon"){j+=l<0?OpenLayers.i18n("W"):OpenLayers.i18n("E")}else{j+=l<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")}return j};OpenLayers.String={startsWith:function(c,b){return(c.indexOf(b)==0)},contains:function(c,b){return(c.indexOf(b)!=-1)},trim:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(j){var f=j.split("-");var c=f[0];for(var d=1,b=f.length;d<b;d++){var g=f[d];c+=g.charAt(0).toUpperCase()+g.substring(1)}return c},format:function(f,d,b){if(!d){d=window}var c=function(m,g){var l;var k=g.split(/\.+/);for(var j=0;j<k.length;j++){if(j==0){l=d}l=l[k[j]]}if(typeof l=="function"){l=b?l.apply(null,b):l()}if(typeof l=="undefined"){return"undefined"}else{return l}};return f.replace(OpenLayers.String.tokenRegEx,c)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(b){return OpenLayers.String.numberRegEx.test(b)},numericIf:function(b){return OpenLayers.String.isNumeric(b)?parseFloat(b):b}};if(!String.prototype.startsWith){String.prototype.startsWith=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"}));return OpenLayers.String.startsWith(this,b)}}if(!String.prototype.contains){String.prototype.contains=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"}));return OpenLayers.String.contains(this,b)}}if(!String.prototype.trim){String.prototype.trim=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"}));return OpenLayers.String.trim(this)}}if(!String.prototype.camelize){String.prototype.camelize=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"}));return OpenLayers.String.camelize(this)}}OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(b,d){var c=0;if(d>0){c=parseFloat(b.toPrecision(d))}return c},format:function(d,b,k,m){b=(typeof b!="undefined")?b:0;k=(typeof k!="undefined")?k:OpenLayers.Number.thousandsSeparator;m=(typeof m!="undefined")?m:OpenLayers.Number.decimalSeparator;if(b!=null){d=parseFloat(d.toFixed(b))}var c=d.toString().split(".");if(c.length==1&&b==null){b=0}var f=c[0];if(k){var g=/(-?[0-9]+)([0-9]{3})/;while(g.test(f)){f=f.replace(g,"$1"+k+"$2")}}var j;if(b==0){j=f}else{var l=c.length>1?c[1]:"0";if(b!=null){l=l+new Array(b-l.length+1).join("0")}j=f+m+l}return j}};if(!Number.prototype.limitSigDigs){Number.prototype.limitSigDigs=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"}));return OpenLayers.Number.limitSigDigs(this,b)}}OpenLayers.Function={bind:function(d,c){var b=Array.prototype.slice.apply(arguments,[2]);return function(){var f=b.concat(Array.prototype.slice.apply(arguments,[0]));return d.apply(c,f)}},bindAsEventListener:function(c,b){return function(d){return c.call(b,d||window.event)}},False:function(){return false},True:function(){return true},Void:function(){}};if(!Function.prototype.bind){Function.prototype.bind=function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"}));Array.prototype.unshift.apply(arguments,[this]);return OpenLayers.Function.bind.apply(null,arguments)}}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(b){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"}));return OpenLayers.Function.bindAsEventListener(this,b)}}OpenLayers.Array={filter:function(k,j,c){var f=[];if(Array.prototype.filter){f=k.filter(j,c)}else{var b=k.length;if(typeof j!="function"){throw new TypeError()}for(var d=0;d<b;d++){if(d in k){var g=k[d];if(j.call(c,g,d,k)){f.push(g)}}}}return f}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(f,b,c,d){if(f!=null){this.left=OpenLayers.Util.toFloat(f)}if(b!=null){this.bottom=OpenLayers.Util.toFloat(b)}if(c!=null){this.right=OpenLayers.Util.toFloat(c)}if(d!=null){this.top=OpenLayers.Util.toFloat(d)}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(c){var b=false;if(c!=null){b=((this.left==c.left)&&(this.right==c.right)&&(this.top==c.top)&&(this.bottom==c.bottom))}return b},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(b){if(b===true){return[this.bottom,this.left,this.top,this.right]}else{return[this.left,this.bottom,this.right,this.top]}},toBBOX:function(c,g){if(c==null){c=6}var k=Math.pow(10,c);var j=Math.round(this.left*k)/k;var f=Math.round(this.bottom*k)/k;var d=Math.round(this.right*k)/k;var b=Math.round(this.top*k)/k;if(g===true){return f+","+j+","+b+","+d}else{return j+","+f+","+d+","+b}},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return(this.right-this.left)},getHeight:function(){return(this.top-this.bottom)},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)}return this.centerLonLat},scale:function(g,d){if(d==null){d=this.getCenterLonLat()}var b,l;if(d.CLASS_NAME=="OpenLayers.LonLat"){b=d.lon;l=d.lat}else{b=d.x;l=d.y}var k=(this.left-b)*g+b;var c=(this.bottom-l)*g+l;var f=(this.right-b)*g+b;var j=(this.top-l)*g+l;return new OpenLayers.Bounds(k,c,f,j)},add:function(b,d){if((b==null)||(d==null)){var c=OpenLayers.i18n("boundsAddError");OpenLayers.Console.error(c);return null}return new OpenLayers.Bounds(this.left+b,this.bottom+d,this.right+b,this.top+d)},extend:function(b){var c=null;if(b){switch(b.CLASS_NAME){case"OpenLayers.LonLat":c=new OpenLayers.Bounds(b.lon,b.lat,b.lon,b.lat);break;case"OpenLayers.Geometry.Point":c=new OpenLayers.Bounds(b.x,b.y,b.x,b.y);break;case"OpenLayers.Bounds":c=b;break}if(c){this.centerLonLat=null;if((this.left==null)||(c.left<this.left)){this.left=c.left}if((this.bottom==null)||(c.bottom<this.bottom)){this.bottom=c.bottom}if((this.right==null)||(c.right>this.right)){this.right=c.right}if((this.top==null)||(c.top>this.top)){this.top=c.top}}}},containsLonLat:function(c,b){return this.contains(c.lon,c.lat,b)},containsPixel:function(c,b){return this.contains(c.x,c.y,b)},contains:function(c,f,b){if(b==null){b=true}if(c==null||f==null){return false}c=OpenLayers.Util.toFloat(c);f=OpenLayers.Util.toFloat(f);var d=false;if(b){d=((c>=this.left)&&(c<=this.right)&&(f>=this.bottom)&&(f<=this.top))}else{d=((c>this.left)&&(c<this.right)&&(f>this.bottom)&&(f<this.top))}return d},intersectsBounds:function(g,c){if(c==null){c=true}var f=false;var l=(this.left==g.right||this.right==g.left||this.top==g.bottom||this.bottom==g.top);if(c||!l){var k=(((g.bottom>=this.bottom)&&(g.bottom<=this.top))||((this.bottom>=g.bottom)&&(this.bottom<=g.top)));var j=(((g.top>=this.bottom)&&(g.top<=this.top))||((this.top>g.bottom)&&(this.top<g.top)));var d=(((g.left>=this.left)&&(g.left<=this.right))||((this.left>=g.left)&&(this.left<=g.right)));var b=(((g.right>=this.left)&&(g.right<=this.right))||((this.right>=g.left)&&(this.right<=g.right)));f=((k||j)&&(d||b))}return f},containsBounds:function(k,c,b){if(c==null){c=false}if(b==null){b=true}var d=this.contains(k.left,k.bottom,b);var f=this.contains(k.right,k.bottom,b);var j=this.contains(k.left,k.top,b);var g=this.contains(k.right,k.top,b);return(c)?(d||f||j||g):(d&&f&&j&&g)},determineQuadrant:function(d){var c="";var b=this.getCenterLonLat();c+=(d.lat<b.lat)?"b":"t";c+=(d.lon<b.lon)?"l":"r";return c},transform:function(f,c){this.centerLonLat=null;var g=OpenLayers.Projection.transform({x:this.left,y:this.bottom},f,c);var b=OpenLayers.Projection.transform({x:this.right,y:this.bottom},f,c);var d=OpenLayers.Projection.transform({x:this.left,y:this.top},f,c);var j=OpenLayers.Projection.transform({x:this.right,y:this.top},f,c);this.left=Math.min(g.x,d.x);this.bottom=Math.min(g.y,b.y);this.right=Math.max(b.x,j.x);this.top=Math.max(d.y,j.y);return this},wrapDateLine:function(b,d){d=d||{};var f=d.leftTolerance||0;var c=d.rightTolerance||0;var g=this.clone();if(b){while(g.left<b.left&&(g.right-c)<=b.left){g=g.add(b.getWidth(),0)}while((g.left+f)>=b.right&&g.right>b.right){g=g.add(-b.getWidth(),0)}}return g},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(d,c){var b=d.split(",");return OpenLayers.Bounds.fromArray(b,c)};OpenLayers.Bounds.fromArray=function(c,b){return b===true?new OpenLayers.Bounds(parseFloat(c[1]),parseFloat(c[0]),parseFloat(c[3]),parseFloat(c[2])):new OpenLayers.Bounds(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]))};OpenLayers.Bounds.fromSize=function(b){return new OpenLayers.Bounds(0,b.h,b.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(b){var c="";c+=(b.charAt(0)=="t")?"b":"t";c+=(b.charAt(1)=="l")?"r":"l";return c};OpenLayers.Element={visible:function(b){return OpenLayers.Util.getElement(b).style.display!="none"},toggle:function(){for(var d=0,b=arguments.length;d<b;d++){var c=OpenLayers.Util.getElement(arguments[d]);var f=OpenLayers.Element.visible(c)?"hide":"show";OpenLayers.Element[f](c)}},hide:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = 'none';"}));for(var d=0,b=arguments.length;d<b;d++){var c=OpenLayers.Util.getElement(arguments[d]);if(c){c.style.display="none"}}},show:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = '';"}));for(var d=0,b=arguments.length;d<b;d++){var c=OpenLayers.Util.getElement(arguments[d]);if(c){c.style.display=""}}},remove:function(b){b=OpenLayers.Util.getElement(b);b.parentNode.removeChild(b)},getHeight:function(b){b=OpenLayers.Util.getElement(b);return b.offsetHeight},getDimensions:function(d){d=OpenLayers.Util.getElement(d);if(OpenLayers.Element.getStyle(d,"display")!="none"){return{width:d.offsetWidth,height:d.offsetHeight}}var c=d.style;var j=c.visibility;var f=c.position;var b=c.display;c.visibility="hidden";c.position="absolute";c.display="";var k=d.clientWidth;var g=d.clientHeight;c.display=b;c.position=f;c.visibility=j;return{width:k,height:g}},hasClass:function(c,b){var d=c.className;return(!!d&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(d))},addClass:function(c,b){if(!OpenLayers.Element.hasClass(c,b)){c.className+=(c.className?" ":"")+b}return c},removeClass:function(c,b){var d=c.className;if(d){c.className=OpenLayers.String.trim(d.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))}return c},toggleClass:function(c,b){if(OpenLayers.Element.hasClass(c,b)){OpenLayers.Element.removeClass(c,b)}else{OpenLayers.Element.addClass(c,b)}return c},getStyle:function(d,f){d=OpenLayers.Util.getElement(d);var g=null;if(d&&d.style){g=d.style[OpenLayers.String.camelize(f)];if(!g){if(document.defaultView&&document.defaultView.getComputedStyle){var c=document.defaultView.getComputedStyle(d,null);g=c?c.getPropertyValue(f):null}else{if(d.currentStyle){g=d.currentStyle[OpenLayers.String.camelize(f)]}}}var b=["left","top","right","bottom"];if(window.opera&&(OpenLayers.Util.indexOf(b,f)!=-1)&&(OpenLayers.Element.getStyle(d,"position")=="static")){g="auto"}}return g=="auto"?null:g}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(c,b){this.lon=OpenLayers.Util.toFloat(c);this.lat=OpenLayers.Util.toFloat(b)},toString:function(){return("lon="+this.lon+",lat="+this.lat)},toShortString:function(){return(this.lon+", "+this.lat)},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(d,b){if((d==null)||(b==null)){var c=OpenLayers.i18n("lonlatAddError");OpenLayers.Console.error(c);return null}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(d),this.lat+OpenLayers.Util.toFloat(b))},equals:function(c){var b=false;if(c!=null){b=((this.lon==c.lon&&this.lat==c.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(c.lon)&&isNaN(c.lat)))}return b},transform:function(d,c){var b=OpenLayers.Projection.transform({x:this.lon,y:this.lat},d,c);this.lon=b.x;this.lat=b.y;return this},wrapDateLine:function(b){var c=this.clone();if(b){while(c.lon<b.left){c.lon+=b.getWidth()}while(c.lon>b.right){c.lon-=b.getWidth()}}return c},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(c){var b=c.split(",");return new OpenLayers.LonLat(b[0],b[1])};OpenLayers.LonLat.fromArray=function(b){var c=OpenLayers.Util.isArray(b),f=c&&b[0],d=c&&b[1];return new OpenLayers.LonLat(f,d)};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(b,c){this.x=parseFloat(b);this.y=parseFloat(c)},toString:function(){return("x="+this.x+",y="+this.y)},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(b){var c=false;if(b!=null){c=((this.x==b.x&&this.y==b.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(b.x)&&isNaN(b.y)))}return c},distanceTo:function(b){return Math.sqrt(Math.pow(this.x-b.x,2)+Math.pow(this.y-b.y,2))},add:function(b,d){if((b==null)||(d==null)){var c=OpenLayers.i18n("pixelAddError");OpenLayers.Console.error(c);return null}return new OpenLayers.Pixel(this.x+b,this.y+d)},offset:function(b){var c=this.clone();if(b){c=this.add(b.x,b.y)}return c},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(b,c){this.w=parseFloat(b);this.h=parseFloat(c)},toString:function(){return("w="+this.w+",h="+this.h)},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(c){var b=false;if(c!=null){b=((this.w==c.w&&this.h==c.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(c.w)&&isNaN(c.h)))}return b},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(b){alert(b)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};(function(){var c=document.getElementsByTagName("script");for(var d=0,b=c.length;d<b;++d){if(c[d].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}}})();OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:false,initialize:function(b){this.easing=(b)?b:OpenLayers.Easing.Expo.easeOut},start:function(d,c,f,b){this.playing=true;this.begin=d;this.finish=c;this.duration=f;this.callbacks=b.callbacks;this.time=0;if(this.interval){window.clearInterval(this.interval);this.interval=null}if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)}this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL)},stop:function(){if(!this.playing){return}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)}window.clearInterval(this.interval);this.interval=null;this.playing=false},play:function(){var k={};for(var g in this.begin){var d=this.begin[g];var j=this.finish[g];if(d==null||j==null||isNaN(d)||isNaN(j)){OpenLayers.Console.error("invalid value for Tween")}var l=j-d;k[g]=this.easing.apply(this,[this.time,d,l,this.duration])}this.time++;if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,k)}if(this.time>this.duration){this.stop()}},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(g,f,k,j){return k*g/j+f},easeOut:function(g,f,k,j){return k*g/j+f},easeInOut:function(g,f,k,j){return k*g/j+f},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(g,f,k,j){return(g==0)?f:k*Math.pow(2,10*(g/j-1))+f},easeOut:function(g,f,k,j){return(g==j)?f+k:k*(-Math.pow(2,-10*g/j)+1)+f},easeInOut:function(g,f,k,j){if(g==0){return f}if(g==j){return f+k}if((g/=j/2)<1){return k/2*Math.pow(2,10*(g-1))+f}return k/2*(-Math.pow(2,-10*--g)+2)+f},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(g,f,k,j){return k*(g/=j)*g+f},easeOut:function(g,f,k,j){return -k*(g/=j)*(g-2)+f},easeInOut:function(g,f,k,j){if((g/=j/2)<1){return k/2*g*g+f}return -k/2*((--g)*(g-2)-1)+f},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Kinetic=OpenLayers.Class({threshold:0,interval:10,deceleration:0.0035,nbPoints:100,delay:200,points:undefined,timerId:undefined,initialize:function(b){OpenLayers.Util.extend(this,b)},begin:function(){clearInterval(this.timerId);this.timerId=undefined;this.points=[]},update:function(b){this.points.unshift({xy:b,tick:new Date().getTime()});if(this.points.length>this.nbPoints){this.points.pop()}},end:function(o){var n,b=new Date().getTime();for(var j=0,g=this.points.length,m;j<g;j++){m=this.points[j];if(b-m.tick>this.delay){break}n=m}if(!n){return}var f=new Date().getTime()-n.tick;var k=Math.sqrt(Math.pow(o.x-n.xy.x,2)+Math.pow(o.y-n.xy.y,2));var d=k/f;if(d==0||d<this.threshold){return}var c=Math.asin((o.y-n.xy.y)/k);if(n.xy.x<=o.x){c=Math.PI-c}return{speed:d,theta:c}},move:function(d,n){var m=d.speed;var k=Math.cos(d.theta);var j=-Math.sin(d.theta);var g=0;var f=new Date().getTime();var c=0;var b=0;var l=function(){if(this.timerId==null){return}g+=this.interval;var A=new Date().getTime()-f;var s=(g+A)/2;var u=(-this.deceleration*Math.pow(s,2))/2+m*s;var o=u*k;var B=u*j;var r={};r.end=false;var q=-this.deceleration*s+m;if(q<=0){clearInterval(this.timerId);this.timerId=null;r.end=true}r.x=o-c;r.y=B-b;c=o;b=B;n(r.x,r.y,r.end)};this.timerId=window.setInterval(OpenLayers.Function.bind(l,this),this.interval)},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.ProxyHost="";OpenLayers.nullHandler=function(b){OpenLayers.Console.userError(OpenLayers.i18n("unhandledRequest",{statusText:b.statusText}))};OpenLayers.loadURL=function(f,k,c,g,d){if(typeof k=="string"){k=OpenLayers.Util.getParameters(k)}var j=(g)?g:OpenLayers.nullHandler;var b=(d)?d:OpenLayers.nullHandler;return OpenLayers.Request.GET({url:f,params:k,success:j,failure:b,scope:c})};OpenLayers.parseXMLString=function(d){var b=d.indexOf("<");if(b>0){d=d.substring(b)}var c=OpenLayers.Util.Try(function(){var f=new ActiveXObject("Microsoft.XMLDOM");f.loadXML(d);return f},function(){return new DOMParser().parseFromString(d,"text/xml")},function(){var f=new XMLHttpRequest();f.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(d),false);if(f.overrideMimeType){f.overrideMimeType("text/xml")}f.send(null);return f.responseXML});return c};OpenLayers.Ajax={emptyFunction:function(){},getTransport:function(){return OpenLayers.Util.Try(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};OpenLayers.Ajax.Responders={responders:[],register:function(c){for(var b=0;b<this.responders.length;b++){if(c==this.responders[b]){return}}this.responders.push(c)},unregister:function(b){OpenLayers.Util.removeItem(this.reponders,b)},dispatch:function(j,d,g){var b;for(var c=0;c<this.responders.length;c++){b=this.responders[c];if(b[j]&&typeof b[j]=="function"){try{b[j].apply(b,[d,g])}catch(f){}}}}};OpenLayers.Ajax.Responders.register({onCreate:function(){OpenLayers.Ajax.activeRequestCount++},onComplete:function(){OpenLayers.Ajax.activeRequestCount--}});OpenLayers.Ajax.Base=OpenLayers.Class({initialize:function(b){this.options={method:"post",asynchronous:true,contentType:"application/xml",parameters:""};OpenLayers.Util.extend(this.options,b||{});this.options.method=this.options.method.toLowerCase();if(typeof this.options.parameters=="string"){this.options.parameters=OpenLayers.Util.getParameters(this.options.parameters)}}});OpenLayers.Ajax.Request=OpenLayers.Class(OpenLayers.Ajax.Base,{_complete:false,initialize:function(c,b){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[b]);if(OpenLayers.ProxyHost&&OpenLayers.String.startsWith(c,"http")){c=OpenLayers.ProxyHost+encodeURIComponent(c)}this.transport=OpenLayers.Ajax.getTransport();this.request(c)},request:function(c){this.url=c;this.method=this.options.method;var f=OpenLayers.Util.extend({},this.options.parameters);if(this.method!="get"&&this.method!="post"){f._method=this.method;this.method="post"}this.parameters=f;if(f=OpenLayers.Util.getParameterString(f)){if(this.method=="get"){this.url+=((this.url.indexOf("?")>-1)?"&":"?")+f}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){f+="&_="}}}try{var b=new OpenLayers.Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(b)}OpenLayers.Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){window.setTimeout(OpenLayers.Function.bind(this.respondToReadyState,this,1),10)}this.transport.onreadystatechange=OpenLayers.Function.bind(this.onStateChange,this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||f):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(d){this.dispatchException(d)}},onStateChange:function(){var b=this.transport.readyState;if(b>1&&!((b==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var g={"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*",OpenLayers:true};if(this.method=="post"){g["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){g.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var d=this.options.requestHeaders;if(typeof d.push=="function"){for(var c=0,f=d.length;c<f;c+=2){g[d[c]]=d[c+1]}}else{for(var c in d){g[c]=d[c]}}}for(var b in g){this.transport.setRequestHeader(b,g[b])}},success:function(){var b=this.getStatus();return !b||(b>=200&&b<300)},getStatus:function(){try{return this.transport.status||0}catch(b){return 0}},respondToReadyState:function(b){var d=OpenLayers.Ajax.Request.Events[b];var c=new OpenLayers.Ajax.Response(this);if(d=="Complete"){try{this._complete=true;(this.options["on"+c.status]||this.options["on"+(this.success()?"Success":"Failure")]||OpenLayers.Ajax.emptyFunction)(c)}catch(f){this.dispatchException(f)}var g=c.getHeader("Content-type")}try{(this.options["on"+d]||OpenLayers.Ajax.emptyFunction)(c);OpenLayers.Ajax.Responders.dispatch("on"+d,this,c)}catch(f){this.dispatchException(f)}if(d=="Complete"){this.transport.onreadystatechange=OpenLayers.Ajax.emptyFunction}},getHeader:function(b){try{return this.transport.getResponseHeader(b)}catch(c){return null}},dispatchException:function(d){var f=this.options.onException;if(f){f(this,d);OpenLayers.Ajax.Responders.dispatch("onException",this,d)}else{var g=false;var b=OpenLayers.Ajax.Responders.responders;for(var c=0;c<b.length;c++){if(b[c].onException){g=true;break}}if(g){OpenLayers.Ajax.Responders.dispatch("onException",this,d)}else{throw d}}}});OpenLayers.Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];OpenLayers.Ajax.Response=OpenLayers.Class({status:0,statusText:"",initialize:function(d){this.request=d;var f=this.transport=d.transport,b=this.readyState=f.readyState;if((b>2&&!(!!(window.attachEvent&&!window.opera)))||b==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=f.responseText==null?"":String(f.responseText)}if(b==4){var c=f.responseXML;this.responseXML=c===undefined?null:c}},getStatus:OpenLayers.Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(b){return""}},getHeader:OpenLayers.Ajax.Request.prototype.getHeader,getResponseHeader:function(b){return this.transport.getResponseHeader(b)}});OpenLayers.Ajax.getElementsByTagNameNS=function(c,b,d,g){var f=null;if(c.getElementsByTagNameNS){f=c.getElementsByTagNameNS(b,g)}else{f=c.getElementsByTagName(d+":"+g)}return f};OpenLayers.Ajax.serializeXMLToString=function(b){var c=new XMLSerializer();var d=c.serializeToString(b);return d};OpenLayers.Event={observers:false,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(b){return b.target||b.srcElement},isSingleTouch:function(b){return b.touches&&b.touches.length==1},isMultiTouch:function(b){return b.touches&&b.touches.length>1},isLeftClick:function(b){return(((b.which)&&(b.which==1))||((b.button)&&(b.button==1)))},isRightClick:function(b){return(((b.which)&&(b.which==3))||((b.button)&&(b.button==2)))},stop:function(c,b){if(!b){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}}if(c.stopPropagation){c.stopPropagation()}else{c.cancelBubble=true}},findElement:function(d,c){var b=OpenLayers.Event.element(d);while(b.parentNode&&(!b.tagName||(b.tagName.toUpperCase()!=c.toUpperCase()))){b=b.parentNode}return b},observe:function(c,f,d,b){var g=OpenLayers.Util.getElement(c);b=b||false;if(f=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||g.attachEvent)){f="keydown"}if(!this.observers){this.observers={}}if(!g._eventCacheID){var j="eventCacheID_";if(g.id){j=g.id+"_"+j}g._eventCacheID=OpenLayers.Util.createUniqueID(j)}var k=g._eventCacheID;if(!this.observers[k]){this.observers[k]=[]}this.observers[k].push({element:g,name:f,observer:d,useCapture:b});if(g.addEventListener){g.addEventListener(f,d,b)}else{if(g.attachEvent){g.attachEvent("on"+f,d)}}},stopObservingElement:function(b){var c=OpenLayers.Util.getElement(b);var d=c._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[d])},_removeElementObservers:function(g){if(g){for(var c=g.length-1;c>=0;c--){var d=g[c];var b=new Array(d.element,d.name,d.observer,d.useCapture);var f=OpenLayers.Event.stopObserving.apply(this,b)}}},stopObserving:function(l,b,k,c){c=c||false;var j=OpenLayers.Util.getElement(l);var f=j._eventCacheID;if(b=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||j.detachEvent){b="keydown"}}var n=false;var d=OpenLayers.Event.observers[f];if(d){var g=0;while(!n&&g<d.length){var m=d[g];if((m.name==b)&&(m.observer==k)&&(m.useCapture==c)){d.splice(g,1);if(d.length==0){delete OpenLayers.Event.observers[f]}n=true;break}g++}}if(n){if(j.removeEventListener){j.removeEventListener(b,k,c)}else{if(j&&j.detachEvent){j.detachEvent("on"+b,k)}}}return n},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var b in OpenLayers.Event.observers){var c=OpenLayers.Event.observers[b];OpenLayers.Event._removeElementObservers.apply(this,[c])}OpenLayers.Event.observers=false}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);if(window.Event){OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event)}else{var Event=OpenLayers.Event}OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:false,clearMouseListener:null,initialize:function(d,g,k,j,c){OpenLayers.Util.extend(this,c);this.object=d;this.fallThrough=j;this.listeners={};this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this);this.eventTypes=[];if(k!=null){for(var f=0,b=k.length;f<b;f++){this.addEventType(k[f])}}if(g!=null){this.attachToElement(g)}},destroy:function(){if(this.element){OpenLayers.Event.stopObservingElement(this.element);if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}}this.element=null;this.listeners=null;this.object=null;this.eventTypes=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(b){if(!this.listeners[b]){this.eventTypes.push(b);this.listeners[b]=[]}},attachToElement:function(f){if(this.element){OpenLayers.Event.stopObservingElement(this.element)}this.element=f;for(var d=0,b=this.BROWSER_EVENTS.length;d<b;d++){var c=this.BROWSER_EVENTS[d];this.addEventType(c);OpenLayers.Event.observe(f,c,this.eventHandler)}OpenLayers.Event.observe(f,"dragstart",OpenLayers.Event.stop)},on:function(b){for(var c in b){if(c!="scope"){this.register(c,b.scope,b[c])}}},register:function(c,f,d){if((d!=null)&&(OpenLayers.Util.indexOf(this.eventTypes,c)!=-1)){if(f==null){f=this.object}var b=this.listeners[c];b.push({obj:f,func:d})}},registerPriority:function(c,f,d){if(d!=null){if(f==null){f=this.object}var b=this.listeners[c];if(b!=null){b.unshift({obj:f,func:d})}}},un:function(b){for(var c in b){if(c!="scope"){this.unregister(c,b.scope,b[c])}}},unregister:function(f,j,g){if(j==null){j=this.object}var d=this.listeners[f];if(d!=null){for(var c=0,b=d.length;c<b;c++){if(d[c].obj==j&&d[c].func==g){d.splice(c,1);break}}}},remove:function(b){if(this.listeners[b]!=null){this.listeners[b]=[]}},triggerEvent:function(g,c){var f=this.listeners[g];if(!f||f.length==0){return undefined}if(c==null){c={}}c.object=this.object;c.element=this.element;if(!c.type){c.type=g}f=f.slice();var j;for(var d=0,b=f.length;d<b;d++){var k=f[d];j=k.func.apply(k.obj,[c]);if((j!=undefined)&&(j==false)){break}}if(!this.fallThrough){OpenLayers.Event.stop(c,true)}return j},handleBrowserEvent:function(m){var g=m.type,j=this.listeners[g];if(!j||j.length==0){return}var d=m.touches;if(d&&d[0]){var l=0;var k=0;var f=d.length;var c;for(var b=0;b<f;++b){c=d[b];l+=c.clientX;k+=c.clientY}m.clientX=l/f;m.clientY=k/f}if(this.includeXY){m.xy=this.getMousePosition(m)}this.triggerEvent(g,m)},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;var b=document.body;if(b&&!((b.scrollTop!=0||b.scrollLeft!=0)&&navigator.userAgent.match(/iPhone/i))){this.element.offsets=null}},getMousePosition:function(b){if(!this.includeXY){this.clearMouseCache()}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=true}}if(!this.element.scrolls){var c=OpenLayers.Util.getViewportElement();this.element.scrolls=[c.scrollLeft,c.scrollTop]}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)]}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element)}return new OpenLayers.Pixel((b.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(b.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this,null,["complete","success","failure"]),issue:function(f){var k=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});f=OpenLayers.Util.applyDefaults(f,k);var j=new OpenLayers.Request.XMLHttpRequest();var b=OpenLayers.Util.urlAppend(f.url,OpenLayers.Util.getParameterString(f.params||{}));var m=!(b.indexOf("http")==0);var c=!m&&b.match(this.URL_SPLIT_REGEX);if(c){var n=window.location;m=c[1]==n.protocol&&c[3]==n.hostname;var g=c[4],d=n.port;if(g!=80&&g!=""||d!="80"&&d!=""){m=m&&g==d}}if(!m){if(f.proxy){if(typeof f.proxy=="function"){b=f.proxy(b)}else{b=f.proxy+encodeURIComponent(b)}}else{OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:b})}}j.open(f.method,b,f.async,f.user,f.password);for(var l in f.headers){j.setRequestHeader(l,f.headers[l])}var p=this.events;var o=this;j.onreadystatechange=function(){if(j.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var q=p.triggerEvent("complete",{request:j,config:f,requestUrl:b});if(q!==false){o.runCallbacks({request:j,config:f,requestUrl:b})}}};if(f.async===false){j.send(f.data)}else{window.setTimeout(function(){if(j.readyState!==0){j.send(f.data)}},0)}return j},runCallbacks:function(f){var g=f.request;var d=f.config;var b=(d.scope)?OpenLayers.Function.bind(d.callback,d.scope):d.callback;var j;if(d.success){j=(d.scope)?OpenLayers.Function.bind(d.success,d.scope):d.success}var c;if(d.failure){c=(d.scope)?OpenLayers.Function.bind(d.failure,d.scope):d.failure}if(OpenLayers.Util.createUrlObject(d.url).protocol=="file:"&&g.responseText){g.status=200}b(g);if(!g.status||(g.status>=200&&g.status<300)){this.events.triggerEvent("success",f);if(j){j(g)}}if(g.status&&(g.status<200||g.status>=300)){this.events.triggerEvent("failure",f);if(c){c(g)}}},GET:function(b){b=OpenLayers.Util.extend(b,{method:"GET"});return OpenLayers.Request.issue(b)},POST:function(b){b=OpenLayers.Util.extend(b,{method:"POST"});b.headers=b.headers?b.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers))){b.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(b)},PUT:function(b){b=OpenLayers.Util.extend(b,{method:"PUT"});b.headers=b.headers?b.headers:{};if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(b.headers))){b.headers["Content-Type"]="application/xml"}return OpenLayers.Request.issue(b)},DELETE:function(b){b=OpenLayers.Util.extend(b,{method:"DELETE"});return OpenLayers.Request.issue(b)},HEAD:function(b){b=OpenLayers.Util.extend(b,{method:"HEAD"});return OpenLayers.Request.issue(b)},OPTIONS:function(b){b=OpenLayers.Util.extend(b,{method:"OPTIONS"});return OpenLayers.Request.issue(b)}};(function(){var k=window.XMLHttpRequest;var b=!!window.controllers,n=window.document.all&&!window.opera,o=n&&window.navigator.userAgent.match(/MSIE 7.0/);function f(){this._object=k&&!o?new k:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function d(){return new f}d.prototype=f.prototype;if(b&&k.wrapped){d.wrapped=k.wrapped}d.UNSENT=0;d.OPENED=1;d.HEADERS_RECEIVED=2;d.LOADING=3;d.DONE=4;d.prototype.readyState=d.UNSENT;d.prototype.responseText="";d.prototype.responseXML=null;d.prototype.status=0;d.prototype.statusText="";d.prototype.priority="NORMAL";d.prototype.onreadystatechange=null;d.onreadystatechange=null;d.onopen=null;d.onsend=null;d.onabort=null;d.prototype.open=function(s,A,r,B,q){delete this._headers;if(arguments.length<3){r=true}this._async=r;var v=this,u=this.readyState,p;if(n&&r){p=function(){if(u!=d.DONE){g(v);v.abort()}};window.attachEvent("onunload",p)}if(d.onopen){d.onopen.apply(this,arguments)}if(arguments.length>4){this._object.open(s,A,r,B,q)}else{if(arguments.length>3){this._object.open(s,A,r,B)}else{this._object.open(s,A,r)}}this.readyState=d.OPENED;c(this);this._object.onreadystatechange=function(){if(b&&!r){return}v.readyState=v._object.readyState;l(v);if(v._aborted){v.readyState=d.UNSENT;return}if(v.readyState==d.DONE){delete v._data;g(v);if(n&&r){window.detachEvent("onunload",p)}}if(u!=v.readyState){c(v)}u=v.readyState}};function j(p){p._object.send(p._data);if(b&&!p._async){p.readyState=d.OPENED;l(p);while(p.readyState<d.DONE){p.readyState++;c(p);if(p._aborted){return}}}}d.prototype.send=function(p){if(d.onsend){d.onsend.apply(this,arguments)}if(!arguments.length){p=null}if(p&&p.nodeType){p=window.XMLSerializer?new window.XMLSerializer().serializeToString(p):p.xml;if(!oRequest._headers["Content-Type"]){oRequest._object.setRequestHeader("Content-Type","application/xml")}}this._data=p;j(this)};d.prototype.abort=function(){if(d.onabort){d.onabort.apply(this,arguments)}if(this.readyState>d.UNSENT){this._aborted=true}this._object.abort();g(this);this.readyState=d.UNSENT;delete this._data};d.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};d.prototype.getResponseHeader=function(p){return this._object.getResponseHeader(p)};d.prototype.setRequestHeader=function(p,q){if(!this._headers){this._headers={}}this._headers[p]=q;return this._object.setRequestHeader(p,q)};d.prototype.addEventListener=function(s,r,q){for(var p=0,u;u=this._listeners[p];p++){if(u[0]==s&&u[1]==r&&u[2]==q){return}}this._listeners.push([s,r,q])};d.prototype.removeEventListener=function(s,r,q){for(var p=0,u;u=this._listeners[p];p++){if(u[0]==s&&u[1]==r&&u[2]==q){break}}if(u){this._listeners.splice(p,1)}};d.prototype.dispatchEvent=function(q){var r={type:q.type,target:this,currentTarget:this,eventPhase:2,bubbles:q.bubbles,cancelable:q.cancelable,timeStamp:q.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};if(r.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[r])}for(var p=0,s;s=this._listeners[p];p++){if(s[0]==r.type&&!s[2]){(s[1].handleEvent||s[1]).apply(this,[r])}}};d.prototype.toString=function(){return"[object XMLHttpRequest]"};d.toString=function(){return"[XMLHttpRequest]"};function c(p){if(d.onreadystatechange){d.onreadystatechange.apply(p)}p.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0})}function m(r){var q=r.responseXML,p=r.responseText;if(n&&p&&q&&!q.documentElement&&r.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){q=new window.ActiveXObject("Microsoft.XMLDOM");q.async=false;q.validateOnParse=false;q.loadXML(p)}if(q){if((n&&q.parseError!=0)||!q.documentElement||(q.documentElement&&q.documentElement.tagName=="parsererror")){return null}}return q}function l(p){try{p.responseText=p._object.responseText}catch(q){}try{p.responseXML=m(p._object)}catch(q){}try{p.status=p._object.status}catch(q){}try{p.statusText=p._object.statusText}catch(q){}}function g(p){p._object.onreadystatechange=new window.Function}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(p,q){if(!q){q=[]}p.__func=this;p.__func(q[0],q[1],q[2],q[3],q[4]);delete p.__func}}OpenLayers.Request.XMLHttpRequest=d})();OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(c,b){OpenLayers.Util.extend(this,b);this.projCode=c;if(window.Proj4js){this.proj=new Proj4js.Proj(c)}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(b){var g=b,c=false;if(g){if(window.Proj4js&&this.proj.defData&&g.proj.defData){c=this.proj.defData.replace(this.titleRegEx,"")==g.proj.defData.replace(this.titleRegEx,"")}else{if(g.getCode){var d=this.getCode(),f=g.getCode();c=d==f||!!OpenLayers.Projection.transforms[d]&&OpenLayers.Projection.transforms[d][f]===OpenLayers.Projection.nullTransform}}}return c},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.addTransform=function(d,c,b){if(!OpenLayers.Projection.transforms[d]){OpenLayers.Projection.transforms[d]={}}OpenLayers.Projection.transforms[d][c]=b};OpenLayers.Projection.transform=function(b,d,c){if(d.proj&&c.proj){b=Proj4js.transform(d.proj,c.proj,b)}else{if(d&&c&&OpenLayers.Projection.transforms[d.getCode()]&&OpenLayers.Projection.transforms[d.getCode()][c.getCode()]){OpenLayers.Projection.transforms[d.getCode()][c.getCode()](b)}}return b};OpenLayers.Projection.nullTransform=function(b){return b};OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},EVENT_TYPES:["preaddlayer","addlayer","preremovelayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(b,m){if(arguments.length===1&&typeof b==="object"){m=b;b=m&&m.div}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,m);this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(b);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var d=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(d,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);var g=document.createElement("div");g.id=this.id+"_events";g.style.position="absolute";g.style.width="100%";g.style.height="100%";g.style.zIndex=this.Z_INDEX_BASE.Control-1;this.viewPortDiv.appendChild(g);this.eventsDiv=g;this.events=new OpenLayers.Events(this,this.eventsDiv,this.EVENT_TYPES,this.fallThrough,{includeXY:true});d=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(d);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.eventsDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize)}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var f=true;var c=document.getElementsByTagName("link");for(var j=0,k=c.length;j<k;++j){if(OpenLayers.Util.isEquivalentUrl(c.item(j).href,this.theme)){f=false;break}}if(f){var l=document.createElement("link");l.setAttribute("rel","stylesheet");l.setAttribute("type","text/css");l.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(l)}}if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()]}else{this.controls=[]}}for(var j=0,k=this.controls.length;j<k;j++){this.addControlToMap(this.controls[j])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(m&&m.layers){delete this.center;this.addLayers(m.layers);if(m.center){this.setCenter(m.center,m.zoom)}}},render:function(b){this.div=OpenLayers.Util.getElement(b);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false}if(this.panTween){this.panTween.stop();this.panTween=null}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)}else{this.events.unregister("resize",this,this.updateSize)}this.paddingForPopups=null;if(this.controls!=null){for(var b=this.controls.length-1;b>=0;--b){this.controls[b].destroy()}this.controls=null}if(this.layers!=null){for(var b=this.layers.length-1;b>=0;--b){this.layers[b].destroy(false)}this.layers=null}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null},setOptions:function(b){var c=this.minPx&&b.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,b);c&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:true})},getTileSize:function(){return this.tileSize},getBy:function(g,d,b){var f=(typeof b.test=="function");var c=OpenLayers.Array.filter(this[g],function(j){return j[d]==b||(f&&b.test(j[d]))});return c},getLayersBy:function(c,b){return this.getBy("layers",c,b)},getLayersByName:function(b){return this.getLayersBy("name",b)},getLayersByClass:function(b){return this.getLayersBy("CLASS_NAME",b)},getControlsBy:function(c,b){return this.getBy("controls",c,b)},getControlsByClass:function(b){return this.getControlsBy("CLASS_NAME",b)},getLayer:function(g){var c=null;for(var f=0,b=this.layers.length;f<b;f++){var d=this.layers[f];if(d.id==g){c=d;break}}return c},setLayerZIndex:function(c,b){c.setZIndex(this.Z_INDEX_BASE[c.isBaseLayer?"BaseLayer":"Overlay"]+b*5)},resetLayersZIndex:function(){for(var d=0,b=this.layers.length;d<b;d++){var c=this.layers[d];this.setLayerZIndex(c,d)}},addLayer:function(d){for(var c=0,b=this.layers.length;c<b;c++){if(this.layers[c]==d){var f=OpenLayers.i18n("layerAlreadyAdded",{layerName:d.name});OpenLayers.Console.warn(f);return false}}if(this.events.triggerEvent("preaddlayer",{layer:d})===false){return}if(this.allOverlays){d.isBaseLayer=false}d.div.className="olLayerDiv";d.div.style.overflow="";this.setLayerZIndex(d,this.layers.length);if(d.isFixed){this.viewPortDiv.appendChild(d.div)}else{this.layerContainerDiv.appendChild(d.div)}this.layers.push(d);d.setMap(this);if(d.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(d)}else{d.setVisibility(false)}}else{d.redraw()}this.events.triggerEvent("addlayer",{layer:d});d.events.triggerEvent("added",{map:this,layer:d});d.afterAdd()},addLayers:function(d){for(var c=0,b=d.length;c<b;c++){this.addLayer(d[c])}},removeLayer:function(d,g){if(this.events.triggerEvent("preremovelayer",{layer:d})===false){return}if(g==null){g=true}if(d.isFixed){this.viewPortDiv.removeChild(d.div)}else{this.layerContainerDiv.removeChild(d.div)}OpenLayers.Util.removeItem(this.layers,d);d.removeMap(this);d.map=null;if(this.baseLayer==d){this.baseLayer=null;if(g){for(var c=0,b=this.layers.length;c<b;c++){var f=this.layers[c];if(f.isBaseLayer||this.allOverlays){this.setBaseLayer(f);break}}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:d});d.events.triggerEvent("removed",{map:this,layer:d})},getNumLayers:function(){return this.layers.length},getLayerIndex:function(b){return OpenLayers.Util.indexOf(this.layers,b)},setLayerIndex:function(f,c){var g=this.getLayerIndex(f);if(c<0){c=0}else{if(c>this.layers.length){c=this.layers.length}}if(g!=c){this.layers.splice(g,1);this.layers.splice(c,0,f);for(var d=0,b=this.layers.length;d<b;d++){this.setLayerZIndex(this.layers[d],d)}this.events.triggerEvent("changelayer",{layer:f,property:"order"});if(this.allOverlays){if(c===0){this.setBaseLayer(f)}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])}}}}},raiseLayer:function(c,d){var b=this.getLayerIndex(c)+d;this.setLayerIndex(c,b)},setBaseLayer:function(d){if(d!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,d)!=-1){var b=this.getCachedCenter();var f=OpenLayers.Util.getResolutionFromScale(this.getScale(),d.units);if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)}this.baseLayer=d;this.viewRequestID++;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true)}if(b!=null){var c=this.getZoomForResolution(f||this.resolution,true);this.setCenter(b,c,false,true)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}},addControl:function(c,b){this.controls.push(c);this.addControlToMap(c,b)},addControls:function(c,k){var g=(arguments.length===1)?[]:k;for(var f=0,b=c.length;f<b;f++){var j=c[f];var d=(g[f])?g[f]:null;this.addControl(j,d)}},addControlToMap:function(c,b){c.outsideViewport=(c.div!=null);if(this.displayProjection&&!c.displayProjection){c.displayProjection=this.displayProjection}c.setMap(this);var d=c.draw(b);if(d){if(!c.outsideViewport){d.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(d)}}if(c.autoActivate){c.activate()}},getControl:function(g){var c=null;for(var d=0,b=this.controls.length;d<b;d++){var f=this.controls[d];if(f.id==g){c=f;break}}return c},removeControl:function(b){if((b)&&(b==this.getControl(b.id))){if(b.div&&(b.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(b.div)}OpenLayers.Util.removeItem(this.controls,b)}},addPopup:function(b,f){if(f){for(var c=this.popups.length-1;c>=0;--c){this.removePopup(this.popups[c])}}b.map=this;this.popups.push(b);var d=b.draw();if(d){d.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(d)}},removePopup:function(b){OpenLayers.Util.removeItem(this.popups,b);if(b.div){try{this.layerContainerDiv.removeChild(b.div)}catch(c){}}b.map=null},getSize:function(){var b=null;if(this.size!=null){b=this.size.clone()}return b},updateSize:function(){var d=this.getCurrentSize();if(d&&!isNaN(d.h)&&!isNaN(d.w)){this.events.clearMouseCache();var j=this.getSize();if(j==null){this.size=j=d}if(!d.equals(j)){this.size=d;for(var f=0,c=this.layers.length;f<c;f++){this.layers[f].onMapResize()}var b=this.getCachedCenter();if(this.baseLayer!=null&&b!=null){var g=this.getZoom();this.zoom=null;this.setCenter(b,g)}}}},getCurrentSize:function(){var b=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(b.w==0&&b.h==0||isNaN(b.w)&&isNaN(b.h)){b.w=this.div.offsetWidth;b.h=this.div.offsetHeight}if(b.w==0&&b.h==0||isNaN(b.w)&&isNaN(b.h)){b.w=parseInt(this.div.style.width);b.h=parseInt(this.div.style.height)}return b},calculateBounds:function(b,c){var g=null;if(b==null){b=this.getCachedCenter()}if(c==null){c=this.getResolution()}if((b!=null)&&(c!=null)){var f=this.getSize();var j=f.w*c;var d=f.h*c;g=new OpenLayers.Bounds(b.lon-j/2,b.lat-d/2,b.lon+j/2,b.lat+d/2)}return g},getCenter:function(){var b=null;var c=this.getCachedCenter();if(c){b=c.clone()}return b},getCachedCenter:function(){if(!this.center&&this.size){this.center=this.getLonLatFromViewPortPx(new OpenLayers.Pixel(this.size.w/2,this.size.h/2))}return this.center},getZoom:function(){return this.zoom},pan:function(f,d,g){g=OpenLayers.Util.applyDefaults(g,{animate:true,dragging:false});if(g.dragging){if(f!=0||d!=0){this.moveByPx(f,d)}}else{var j=this.getViewPortPxFromLonLat(this.getCachedCenter());var c=j.add(f,d);if(this.dragging||!c.equals(j)){var b=this.getLonLatFromViewPortPx(c);if(g.animate){this.panTo(b)}else{this.moveTo(b);this.dragging=false;this.events.triggerEvent("moveend")}}}},panTo:function(f){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(f)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod)}var b=this.getCachedCenter();if(f.equals(b)){return}var j=this.getPixelFromLonLat(b);var g=this.getPixelFromLonLat(f);var c={x:g.x-j.x,y:g.y-j.y};var d={x:0,y:0};this.panTween.start({x:0,y:0},c,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(l){var k=l.x-d.x,m=l.y-d.y;this.moveByPx(k,m);d.x=Math.round(l.x);d.y=Math.round(l.y)},this),done:OpenLayers.Function.bind(function(k){this.moveTo(f);this.dragging=false;this.events.triggerEvent("moveend")},this)}})}else{this.setCenter(f)}},setCenter:function(d,b,c,f){this.panTween&&this.panTween.stop();this.moveTo(d,b,{dragging:c,forceZoomChange:f})},moveByPx:function(r,q){var l=this.size.w/2;var d=this.size.h/2;var o=l+r;var n=d+q;var f=this.baseLayer.wrapDateLine;var p=0;var m=0;if(this.restrictedExtent){p=l;m=d;f=false}r=f||o<=this.maxPx.x-p&&o>=this.minPx.x+p?Math.round(r):0;q=n<=this.maxPx.y-m&&n>=this.minPx.y+m?Math.round(q):0;var c=this.minPx.x,b=this.maxPx.x;if(r||q){if(!this.dragging){this.dragging=true;this.events.triggerEvent("movestart")}this.center=null;if(r){this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-r+"px";this.minPx.x-=r;this.maxPx.x-=r;if(f){if(this.maxPx.x>b){this.maxPx.x-=(b-c)}if(this.minPx.x<c){this.minPx.x+=(b-c)}}}if(q){this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-q+"px";this.minPx.y-=q;this.maxPx.y-=q}var j,g,k;for(g=0,k=this.layers.length;g<k;++g){j=this.layers[g];if(j.visibility&&(j===this.baseLayer||j.inRange)){j.moveByPx(r,q);j.events.triggerEvent("move")}}this.events.triggerEvent("move")}},moveTo:function(m,c,g){if(!g){g={}}if(c!=null){c=parseFloat(c);if(!this.fractionalZoom){c=Math.round(c)}}var u=g.dragging||this.dragging;var o=g.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(m)){m=this.maxExtent.getCenterLonLat();this.center=m.clone()}if(this.restrictedExtent!=null){if(m==null){m=this.center}if(c==null){c=this.getZoom()}var v=this.getResolutionForZoom(c);var q=this.calculateBounds(m,v);if(!this.restrictedExtent.containsBounds(q)){var F=this.restrictedExtent.getCenterLonLat();if(q.getWidth()>this.restrictedExtent.getWidth()){m=new OpenLayers.LonLat(F.lon,m.lat)}else{if(q.left<this.restrictedExtent.left){m=m.add(this.restrictedExtent.left-q.left,0)}else{if(q.right>this.restrictedExtent.right){m=m.add(this.restrictedExtent.right-q.right,0)}}}if(q.getHeight()>this.restrictedExtent.getHeight()){m=new OpenLayers.LonLat(m.lon,F.lat)}else{if(q.bottom<this.restrictedExtent.bottom){m=m.add(0,this.restrictedExtent.bottom-q.bottom)}else{if(q.top>this.restrictedExtent.top){m=m.add(0,this.restrictedExtent.top-q.top)}}}}}var p=o||((this.isValidZoomLevel(c))&&(c!=this.getZoom()));var l=(this.isValidLonLat(m))&&(!m.equals(this.center));if(p||l||u){u||this.events.triggerEvent("movestart");if(l){if(!p&&this.center){this.centerLayerContainer(m)}this.center=m.clone()}var G=p?this.getResolutionForZoom(c):this.getResolution();if(p||this.layerContainerOrigin==null){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";var s=this.getMaxExtent({restricted:true});var f=s.getCenterLonLat();var n=this.center.lon-f.lon;var d=f.lat-this.center.lat;var D=Math.round(s.getWidth()/G);var C=Math.round(s.getHeight()/G);var j=(this.size.w-D)/2-n/G;var r=(this.size.h-C)/2-d/G;this.minPx=new OpenLayers.Pixel(j,r);this.maxPx=new OpenLayers.Pixel(j+D,r+C)}if(p){this.zoom=c;this.resolution=G;this.viewRequestID++}var k=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(k,p,g.dragging);g.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:p})}k=this.baseLayer.getExtent();for(var A=this.layers.length-1;A>=0;--A){var E=this.layers[A];if(E!==this.baseLayer&&!E.isBaseLayer){var b=E.calculateInRange();if(E.inRange!=b){E.inRange=b;if(!b){E.display(false)}this.events.triggerEvent("changelayer",{layer:E,property:"visibility"})}if(b&&E.visibility){E.moveTo(k,p,g.dragging);g.dragging||E.events.triggerEvent("moveend",{zoomChanged:p})}}}this.events.triggerEvent("move");u||this.events.triggerEvent("moveend");if(p){for(var A=0,B=this.popups.length;A<B;A++){this.popups[A].updatePosition()}this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(d){var f=this.getViewPortPxFromLonLat(this.layerContainerOrigin);var k=this.getViewPortPxFromLonLat(d);if((f!=null)&&(k!=null)){var b=parseInt(this.layerContainerDiv.style.left);var c=parseInt(this.layerContainerDiv.style.top);var j=Math.round(f.x-k.x);var g=Math.round(f.y-k.y);this.layerContainerDiv.style.left=j+"px";this.layerContainerDiv.style.top=g+"px";var m=b-j;var l=c-g;this.minPx.x-=m;this.maxPx.x-=m;this.minPx.y-=l;this.maxPx.y-=l}},isValidZoomLevel:function(b){return((b!=null)&&(b>=0)&&(b<this.getNumZoomLevels()))},isValidLonLat:function(d){var c=false;if(d!=null){var b=this.getMaxExtent();c=b.containsLonLat(d)}return c},getProjection:function(){var b=this.getProjectionObject();return b?b.getCode():null},getProjectionObject:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.projection}return b},getMaxResolution:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.maxResolution}return b},getMaxExtent:function(c){var b=null;if(c&&c.restricted&&this.restrictedExtent){b=this.restrictedExtent}else{if(this.baseLayer!=null){b=this.baseLayer.maxExtent}}return b},getNumZoomLevels:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.numZoomLevels}return b},getExtent:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getExtent()}return b},getResolution:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getResolution()}else{if(this.allOverlays===true&&this.layers.length>0){b=this.layers[0].getResolution()}}return b},getUnits:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.units}return b},getScale:function(){var d=null;if(this.baseLayer!=null){var c=this.getResolution();var b=this.baseLayer.units;d=OpenLayers.Util.getScaleFromResolution(c,b)}return d},getZoomForExtent:function(d,c){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getZoomForExtent(d,c)}return b},getResolutionForZoom:function(c){var b=null;if(this.baseLayer){b=this.baseLayer.getResolutionForZoom(c)}return b},getZoomForResolution:function(b,d){var c=null;if(this.baseLayer!=null){c=this.baseLayer.getZoomForResolution(b,d)}return c},zoomTo:function(b){if(this.isValidZoomLevel(b)){this.setCenter(null,b)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(f,d){var c=f.getCenterLonLat();if(this.baseLayer.wrapDateLine){var b=this.getMaxExtent();f=f.clone();while(f.right<f.left){f.right+=b.getWidth()}c=f.getCenterLonLat().wrapDateLine(b)}this.setCenter(c,this.getZoomForExtent(f,d))},zoomToMaxExtent:function(d){var c=(d)?d.restricted:true;var b=this.getMaxExtent({restricted:c});this.zoomToExtent(b)},zoomToScale:function(l,k){var f=OpenLayers.Util.getResolutionFromScale(l,this.baseLayer.units);var d=this.getSize();var j=d.w*f;var c=d.h*f;var b=this.getCachedCenter();var g=new OpenLayers.Bounds(b.lon-j/2,b.lat-c/2,b.lon+j/2,b.lat+c/2);this.zoomToExtent(g,k)},getLonLatFromViewPortPx:function(b){var c=null;if(this.baseLayer!=null){c=this.baseLayer.getLonLatFromViewPortPx(b)}return c},getViewPortPxFromLonLat:function(c){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getViewPortPxFromLonLat(c)}return b},getLonLatFromPixel:function(b){return this.getLonLatFromViewPortPx(b)},getPixelFromLonLat:function(c){var b=this.getViewPortPxFromLonLat(c);b.x=Math.round(b.x);b.y=Math.round(b.y);return b},getGeodesicPixelSize:function(k){var f=k?this.getLonLatFromPixel(k):(this.getCachedCenter()||new OpenLayers.LonLat(0,0));var g=this.getResolution();var d=f.add(-g/2,0);var m=f.add(g/2,0);var c=f.add(0,-g/2);var j=f.add(0,g/2);var l=new OpenLayers.Projection("EPSG:4326");var b=this.getProjectionObject()||l;if(!b.equals(l)){d.transform(b,l);m.transform(b,l);c.transform(b,l);j.transform(b,l)}return new OpenLayers.Size(OpenLayers.Util.distVincenty(d,m),OpenLayers.Util.distVincenty(c,j))},getViewPortPxFromLayerPx:function(f){var d=null;if(f!=null){var c=parseInt(this.layerContainerDiv.style.left);var b=parseInt(this.layerContainerDiv.style.top);d=f.add(c,b)}return d},getLayerPxFromViewPortPx:function(d){var f=null;if(d!=null){var c=-parseInt(this.layerContainerDiv.style.left);var b=-parseInt(this.layerContainerDiv.style.top);f=d.add(c,b);if(isNaN(f.x)||isNaN(f.y)){f=null}}return f},getLonLatFromLayerPx:function(b){b=this.getViewPortPxFromLayerPx(b);return this.getLonLatFromViewPortPx(b)},getLayerPxFromLonLat:function(c){var b=this.getPixelFromLonLat(c);return this.getLayerPxFromViewPortPx(b)},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend","added","removed"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(c,b){this.addOptions(b);this.name=c;if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}if(this.wrapDateLine){this.displayOutsideMaxExtent=true}},destroy:function(b){if(b==null){b=true}if(this.map!=null){this.map.removeLayer(this,b)}this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(b){if(b==null){b=new OpenLayers.Layer(this.name,this.getOptions())}OpenLayers.Util.applyDefaults(b,this);b.map=null;return b},getOptions:function(){var b={};for(var c in this.options){b[c]=this[c]}return b},setName:function(b){if(b!=this.name){this.name=b;if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}}},addOptions:function(g,b){if(this.options==null){this.options={}}OpenLayers.Util.extend(this.options,g);OpenLayers.Util.extend(this,g);if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits()}if(this.map){var c=this.map.getResolution();var d=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var f in g){if(g.hasOwnProperty(f)&&OpenLayers.Util.indexOf(d,f)>=0){this.initResolutions();if(b&&this.map.baseLayer===this){this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(c),false,true);this.map.events.triggerEvent("changebaselayer",{layer:this})}break}}}},onMapResize:function(){},redraw:function(){var c=false;if(this.map){this.inRange=this.calculateInRange();var d=this.getExtent();if(d&&this.inRange&&this.visibility){var b=true;this.moveTo(d,b,false);this.events.triggerEvent("moveend",{zoomChanged:b});c=true}}return c},moveTo:function(c,b,d){var f=this.visibility;if(!this.isBaseLayer){f=f&&this.inRange}this.display(f)},moveByPx:function(c,b){},setMap:function(c){if(this.map==null){this.map=c;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var b=((this.visibility)&&(this.inRange));this.div.style.display=b?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(b){},getImageSize:function(b){return(this.imageSize||this.tileSize)},setTileSize:function(b){var c=(b)?b:((this.tileSize)?this.tileSize:this.map.getTileSize());this.tileSize=c;if(this.gutter){this.imageOffset=new OpenLayers.Pixel(-this.gutter,-this.gutter);this.imageSize=new OpenLayers.Size(c.w+(2*this.gutter),c.h+(2*this.gutter))}},getVisibility:function(){return this.visibility},setVisibility:function(b){if(b!=this.visibility){this.visibility=b;this.display(b);this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})}this.events.triggerEvent("visibilitychanged")}},display:function(b){if(b!=(this.div.style.display!="none")){this.div.style.display=(b&&this.calculateInRange())?"block":"none"}},calculateInRange:function(){var c=false;if(this.alwaysInRange){c=true}else{if(this.map){var b=this.map.getResolution();c=((b>=this.minResolution)&&(b<=this.maxResolution))}}return c},setIsBaseLayer:function(b){if(b!=this.isBaseLayer){this.isBaseLayer=b;if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})}}},initResolutions:function(){var g,b,l;var j={},f=true;for(g=0,b=this.RESOLUTION_PROPERTIES.length;g<b;g++){l=this.RESOLUTION_PROPERTIES[g];j[l]=this.options[l];if(f&&this.options[l]){f=false}}if(this.alwaysInRange==null){this.alwaysInRange=f}if(j.resolutions==null){j.resolutions=this.resolutionsFromScales(j.scales)}if(j.resolutions==null){j.resolutions=this.calculateResolutions(j)}if(j.resolutions==null){for(g=0,b=this.RESOLUTION_PROPERTIES.length;g<b;g++){l=this.RESOLUTION_PROPERTIES[g];j[l]=this.options[l]!=null?this.options[l]:this.map[l]}if(j.resolutions==null){j.resolutions=this.resolutionsFromScales(j.scales)}if(j.resolutions==null){j.resolutions=this.calculateResolutions(j)}}var d;if(this.options.maxResolution&&this.options.maxResolution!=="auto"){d=this.options.maxResolution}if(this.options.minScale){d=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units)}var c;if(this.options.minResolution&&this.options.minResolution!=="auto"){c=this.options.minResolution}if(this.options.maxScale){c=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)}if(j.resolutions){j.resolutions.sort(function(n,m){return(m-n)});if(!d){d=j.resolutions[0]}if(!c){var k=j.resolutions.length-1;c=j.resolutions[k]}}this.resolutions=j.resolutions;if(this.resolutions){b=this.resolutions.length;this.scales=new Array(b);for(g=0;g<b;g++){this.scales[g]=OpenLayers.Util.getScaleFromResolution(this.resolutions[g],this.units)}this.numZoomLevels=b}this.minResolution=c;if(c){this.maxScale=OpenLayers.Util.getScaleFromResolution(c,this.units)}this.maxResolution=d;if(d){this.minScale=OpenLayers.Util.getScaleFromResolution(d,this.units)}},resolutionsFromScales:function(f){if(f==null){return}var c,d,b;b=f.length;c=new Array(b);for(d=0;d<b;d++){c[d]=OpenLayers.Util.getResolutionFromScale(f[d],this.units)}return c},calculateResolutions:function(n){var o,m,k;var p=n.maxResolution;if(n.minScale!=null){p=OpenLayers.Util.getResolutionFromScale(n.minScale,this.units)}else{if(p=="auto"&&this.maxExtent!=null){o=this.map.getSize();m=this.maxExtent.getWidth()/o.w;k=this.maxExtent.getHeight()/o.h;p=Math.max(m,k)}}var j=n.minResolution;if(n.maxScale!=null){j=OpenLayers.Util.getResolutionFromScale(n.maxScale,this.units)}else{if(n.minResolution=="auto"&&this.minExtent!=null){o=this.map.getSize();m=this.minExtent.getWidth()/o.w;k=this.minExtent.getHeight()/o.h;j=Math.max(m,k)}}var b=n.maxZoomLevel;var c=n.numZoomLevels;if(typeof j==="number"&&typeof p==="number"&&c===undefined){var l=p/j;c=Math.floor(Math.log(l)/Math.log(2))+1}else{if(c===undefined&&b!=null){c=b+1}}if(typeof c!=="number"||c<=0||(typeof p!=="number"&&typeof j!=="number")){return}var f=new Array(c);var d=2;if(typeof j=="number"&&typeof p=="number"){d=Math.pow((p/j),(1/(c-1)))}var g;if(typeof p==="number"){for(g=0;g<c;g++){f[g]=p/Math.pow(d,g)}}else{for(g=0;g<c;g++){f[c-1-g]=j*Math.pow(d,g)}}return f},getResolution:function(){var b=this.map.getZoom();return this.getResolutionForZoom(b)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(c,d){var f=this.map.getSize();var b=Math.max(c.getWidth()/f.w,c.getHeight()/f.h);return this.getZoomForResolution(b,d)},getDataExtent:function(){},getResolutionForZoom:function(d){d=Math.max(0,Math.min(d,this.resolutions.length-1));var c;if(this.map.fractionalZoom){var b=Math.floor(d);var f=Math.ceil(d);c=this.resolutions[b]-((d-b)*(this.resolutions[b]-this.resolutions[f]))}else{c=this.resolutions[Math.round(d)]}return c},getZoomForResolution:function(g,c){var q,j,k;if(this.map.fractionalZoom){var n=0;var d=this.resolutions.length-1;var f=this.resolutions[n];var b=this.resolutions[d];var m;for(j=0,k=this.resolutions.length;j<k;++j){m=this.resolutions[j];if(m>=g){f=m;n=j}if(m<=g){b=m;d=j;break}}var l=f-b;if(l>0){q=n+((f-g)/l)}else{q=n}}else{var o;var p=Number.POSITIVE_INFINITY;for(j=0,k=this.resolutions.length;j<k;j++){if(c){o=Math.abs(this.resolutions[j]-g);if(o>p){break}p=o}else{if(this.resolutions[j]<g){break}}}q=Math.max(0,j-1)}return q},getLonLatFromViewPortPx:function(c){var f=null;var j=this.map;if(c!=null&&j.minPx){var d=j.getResolution();var b=j.getMaxExtent({restricted:true});var k=(c.x-j.minPx.x)*d+b.left;var g=(j.minPx.y-c.y)*d+b.top;f=new OpenLayers.LonLat(k,g);if(this.wrapDateLine){f=f.wrapDateLine(this.maxExtent)}}return f},getViewPortPxFromLonLat:function(f){var c=null;if(f!=null){var b=this.map.getResolution();var d=this.map.getExtent();c=new OpenLayers.Pixel((1/b*(f.lon-d.left)),(1/b*(d.top-f.lat)))}return c},setOpacity:function(c){if(c!=this.opacity){this.opacity=c;for(var f=0,b=this.div.childNodes.length;f<b;++f){var d=this.div.childNodes[f].firstChild;OpenLayers.Util.modifyDOMElement(d,null,null,null,null,null,null,c)}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(b){this.div.style.zIndex=b},adjustBounds:function(c){if(this.gutter){var b=this.gutter*this.map.getResolution();c=new OpenLayers.Bounds(c.left-b,c.bottom-b,c.right+b,c.top+b)}if(this.wrapDateLine){var d={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};c=c.wrapDateLine(this.maxExtent,d)}return c},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(b,c,f,d){this.url=b;this.size=(c)?c:new OpenLayers.Size(20,20);this.offset=f?f:new OpenLayers.Pixel(-(this.size.w/2),-(this.size.h/2));this.calculateOffset=d;var g=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(g)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(b){if(b!=null){this.size=b}this.draw()},setUrl:function(b){if(b!=null){this.url=b}this.draw()},draw:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(b);return this.imageDiv},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv)}},setOpacity:function(b){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,b)},moveTo:function(b){if(b!=null){this.px=b}if(this.imageDiv!=null){if(this.px==null){this.display(false)}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)}var c=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,c)}}},display:function(b){this.imageDiv.style.display=(b)?"":"none"},isDrawn:function(){var b=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));return b},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(d,c){this.lonlat=d;var b=(c)?c:OpenLayers.Marker.defaultIcon();if(this.icon==null){this.icon=b}else{this.icon.url=b.url;this.icon.size=b.size;this.icon.offset=b.offset;this.icon.calculateOffset=b.calculateOffset}this.events=new OpenLayers.Events(this,this.icon.imageDiv,null)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(this.icon!=null){this.icon.destroy();this.icon=null}},draw:function(b){return this.icon.draw(b)},erase:function(){if(this.icon!=null){this.icon.erase()}},moveTo:function(b){if((b!=null)&&(this.icon!=null)){this.icon.moveTo(b)}this.lonlat=this.map.getLonLatFromLayerPx(b)},isDrawn:function(){var b=(this.icon&&this.icon.isDrawn());return b},onScreen:function(){var c=false;if(this.map){var b=this.map.getExtent();c=b.containsLonLat(this.lonlat)}return c},inflate:function(c){if(this.icon){var b=new OpenLayers.Size(this.icon.size.w*c,this.icon.size.h*c);this.icon.setSize(b)}},setOpacity:function(b){this.icon.setOpacity(b)},setUrl:function(b){this.icon.setUrl(b)},display:function(b){this.icon.display(b)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){var b=OpenLayers.Util.getImagesLocation()+"marker.png";var c=new OpenLayers.Size(21,25);var d=function(f){return new OpenLayers.Pixel(-(f.w/2),-f.h)};return new OpenLayers.Icon(b,c,null,d)};OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding)}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(k,d,j,c,g,f){if(k==null){k=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}this.id=k;this.lonlat=d;this.contentSize=(j!=null)?j:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);if(c!=null){this.contentHTML=c}this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var b=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(b,null,null,null,"relative",null,"hidden");var k=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(k,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);if(g){this.addCloseBox(f)}this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide)}this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;if(this.map!=null){this.map.removePopup(this)}this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(b){if(b==null){if((this.lonlat!=null)&&(this.map!=null)){b=this.map.getLayerPxFromLonLat(this.lonlat)}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide)}if(!this.disableFirefoxOverflowHack&&OpenLayers.BROWSER_NAME=="firefox"){this.map.events.register("movestart",this,function(){var c=document.defaultView.getComputedStyle(this.contentDiv,null);var d=c.getPropertyValue("overflow");if(d!="hidden"){this.contentDiv._oldOverflow=d;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var c=this.contentDiv._oldOverflow;if(c){this.contentDiv.style.overflow=c;this.contentDiv._oldOverflow=null}})}this.moveTo(b);if(!this.autoSize&&!this.size){this.setSize(this.contentSize)}this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();if(this.panMapIfOutOfView){this.panIntoView()}return this.div},updatePosition:function(){if((this.lonlat)&&(this.map)){var b=this.map.getLayerPxFromLonLat(this.lonlat);if(b){this.moveTo(b)}}},moveTo:function(b){if((b!=null)&&(this.div!=null)){this.div.style.left=b.x+"px";this.div.style.top=b.y+"px"}},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){if(this.visible()){this.hide()}else{this.show()}},show:function(){this.div.style.display="";if(this.panMapIfOutOfView){this.panIntoView()}},hide:function(){this.div.style.display="none"},setSize:function(d){this.size=d.clone();var c=this.getContentDivPadding();var b=c.left+c.right;var g=c.top+c.bottom;this.fixPadding();b+=this.padding.left+this.padding.right;g+=this.padding.top+this.padding.bottom;if(this.closeDiv){var f=parseInt(this.closeDiv.style.width);b+=f+c.right}this.size.w+=b;this.size.h+=g;if(OpenLayers.BROWSER_NAME=="msie"){this.contentSize.w+=c.left+c.right;this.contentSize.h+=c.bottom+c.top}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(this.contentDiv!=null){this.contentDiv.style.width=d.w+"px";this.contentDiv.style.height=d.h+"px"}},updateSize:function(){var g="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var l=(this.map)?this.map.layerContainerDiv:document.body;var m=OpenLayers.Util.getRenderedDimensions(g,null,{displayClass:this.displayClass,containerElement:l});var k=this.getSafeContentSize(m);var j=null;if(k.equals(m)){j=m}else{var c=new OpenLayers.Size();c.w=(k.w<m.w)?k.w:null;c.h=(k.h<m.h)?k.h:null;if(c.w&&c.h){j=k}else{var f=OpenLayers.Util.getRenderedDimensions(g,c,{displayClass:this.contentDisplayClass,containerElement:l});var d=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if((d!="hidden")&&(f.equals(k))){var b=OpenLayers.Util.getScrollbarWidth();if(c.w){f.h+=b}else{f.w+=b}}j=this.getSafeContentSize(f)}}this.setSize(j)},setBackgroundColor:function(b){if(b!=undefined){this.backgroundColor=b}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor}},setOpacity:function(b){if(b!=undefined){this.opacity=b}if(this.div!=null){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+this.opacity*100+")"}},setBorder:function(b){if(b!=undefined){this.border=b}if(this.div!=null){this.div.style.border=this.border}},setContentHTML:function(b){if(b!=null){this.contentHTML=b}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){var j=function(){this.popup.updateSize();if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)};var c=this.contentDiv.getElementsByTagName("img");for(var g=0,b=c.length;g<b;g++){var d=c[g];if(d.width==0||d.height==0){var f={popup:this,img:d};d._onImgLoad=OpenLayers.Function.bind(j,f);OpenLayers.Event.observe(d,"load",d._onImgLoad)}}},getSafeContentSize:function(o){var f=o.clone();var m=this.getContentDivPadding();var n=m.left+m.right;var k=m.top+m.bottom;this.fixPadding();n+=this.padding.left+this.padding.right;k+=this.padding.top+this.padding.bottom;if(this.closeDiv){var d=parseInt(this.closeDiv.style.width);n+=d+m.right}if(this.minSize){f.w=Math.max(f.w,(this.minSize.w-n));f.h=Math.max(f.h,(this.minSize.h-k))}if(this.maxSize){f.w=Math.min(f.w,(this.maxSize.w-n));f.h=Math.min(f.h,(this.maxSize.h-k))}if(this.map&&this.map.size){var j=0,g=0;if(this.keepInMap&&!this.panMapIfOutOfView){var l=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":j=l.x;g=this.map.size.h-l.y;break;case"tl":j=this.map.size.w-l.x;g=this.map.size.h-l.y;break;case"bl":j=this.map.size.w-l.x;g=l.y;break;case"br":j=l.x;g=l.y;break;default:j=l.x;g=this.map.size.h-l.y;break}}var b=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-k-g;var c=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-n-j;f.w=Math.min(f.w,c);f.h=Math.min(f.h,b)}return f},getContentDivPadding:function(){var b=this._contentDivPadding;if(!b){if(this.div.parentNode==null){this.div.style.display="none";document.body.appendChild(this.div)}b=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=b;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return b},addCloseBox:function(d){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,new OpenLayers.Size(17,17));this.closeDiv.className="olPopupCloseBox";var c=this.getContentDivPadding();this.closeDiv.style.right=c.right+"px";this.closeDiv.style.top=c.top+"px";this.groupDiv.appendChild(this.closeDiv);var b=d||function(f){this.hide();OpenLayers.Event.stop(f)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(b,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(b,this))},panIntoView:function(){var g=this.map.getSize();var f=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var d=f.clone();if(f.x<this.map.paddingForPopups.left){d.x=this.map.paddingForPopups.left}else{if((f.x+this.size.w)>(g.w-this.map.paddingForPopups.right)){d.x=g.w-this.map.paddingForPopups.right-this.size.w}}if(f.y<this.map.paddingForPopups.top){d.y=this.map.paddingForPopups.top}else{if((f.y+this.size.h)>(g.h-this.map.paddingForPopups.bottom)){d.y=g.h-this.map.paddingForPopups.bottom-this.size.h}}var c=f.x-d.x;var b=f.y-d.y;this.map.pan(c,b)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);function b(c){OpenLayers.Event.stop(c,true)}this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:b,scope:this})},onmousedown:function(b){this.mousedown=true;OpenLayers.Event.stop(b,true)},onmousemove:function(b){if(this.mousedown){OpenLayers.Event.stop(b,true)}},onmouseup:function(b){if(this.mousedown){this.mousedown=false;OpenLayers.Event.stop(b,true)}},onclick:function(b){OpenLayers.Event.stop(b,true)},onmouseout:function(b){this.mousedown=false},ondblclick:function(b){OpenLayers.Event.stop(b,true)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(g,b,j,d,f,c){this.layer=g;this.position=b.clone();this.bounds=j.clone();this.url=d;if(f){this.size=f.clone()}this.id=OpenLayers.Util.createUniqueID("Tile_");this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);OpenLayers.Util.extend(this,c)},unload:function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.events.destroy();this.events=null},clone:function(b){if(b==null){b=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size)}OpenLayers.Util.applyDefaults(b,this);return b},draw:function(){var b=this.layer.maxExtent;var c=(b&&this.bounds.intersectsBounds(b,false));this.shouldDraw=(c||this.layer.displayOutsideMaxExtent);this.clear();return this.shouldDraw},moveTo:function(c,b,d){if(d==null){d=true}this.bounds=c.clone();this.position=b.clone();if(d){this.draw()}},clear:function(){},getBoundsFromBaseLayer:function(b){var j=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(j);var f=this.layer.map.getLonLatFromLayerPx(b);var d=b.clone();d.x+=this.size.w;d.y+=this.size.h;var c=this.layer.map.getLonLatFromLayerPx(d);if(f.lon>c.lon){if(f.lon<0){f.lon=-180-(f.lon+180)}else{c.lon=180+c.lon+180}}var g=new OpenLayers.Bounds(f.lon,c.lat,c.lon,f.lat);return g},showTile:function(){if(this.shouldDraw){this.show()}},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:false,isFirstDraw:true,backBufferTile:null,maxGetUrlLength:null,initialize:function(g,b,j,d,f,c){OpenLayers.Tile.prototype.initialize.apply(this,arguments);if(this.maxGetUrlLength!=null){OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)}this.url=d;this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack()},destroy:function(){if(this.imgDiv!=null){this.removeImgDiv()}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame)}this.frame=null;if(this.backBufferTile){this.backBufferTile.destroy();this.backBufferTile=null}this.layer.events.unregister("loadend",this,this.resetBackBuffer);OpenLayers.Tile.prototype.destroy.apply(this,arguments)},clone:function(b){if(b==null){b=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size)}b=OpenLayers.Tile.prototype.clone.apply(this,[b]);b.imgDiv=null;return b},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}var b=OpenLayers.Tile.prototype.draw.apply(this,arguments);if((OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1)||this.layer.singleTile){if(b){if(!this.backBufferTile){this.backBufferTile=this.clone();this.backBufferTile.hide();this.backBufferTile.isBackBuffer=true;this.events.register("loadend",this,this.resetBackBuffer);this.layer.events.register("loadend",this,this.resetBackBuffer)}this.startTransition()}else{if(this.backBufferTile){this.backBufferTile.clear()}}}else{if(b&&this.isFirstDraw){this.events.register("loadend",this,this.showTile);this.isFirstDraw=false}}if(!b){return false}if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}return this.renderTile()},resetBackBuffer:function(){this.showTile();if(this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=false;var b=this.layer.maxExtent;var c=(b&&this.bounds.intersectsBounds(b,false));if(c){this.backBufferTile.position=this.position;this.backBufferTile.bounds=this.bounds;this.backBufferTile.size=this.size;this.backBufferTile.imageSize=this.layer.getImageSize(this.bounds)||this.size;this.backBufferTile.imageOffset=this.layer.imageOffset;this.backBufferTile.resolution=this.layer.getResolution();this.backBufferTile.renderTile()}this.backBufferTile.hide()}},renderTile:function(){if(this.layer.async){this.initImgDiv();this.layer.getURLasync(this.bounds,this,"url",this.positionImage)}else{this.url=this.layer.getURL(this.bounds);this.initImgDiv();this.positionImage()}return true},positionImage:function(){if(this.layer===null){return}OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);var b=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,b,this.url)}else{OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,b);this.imgDiv.src=this.url}},clear:function(){if(this.imgDiv){this.hide();if(OpenLayers.Tile.Image.useBlankTile){this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}}},initImgDiv:function(){if(this.imgDiv==null){var f=this.layer.imageOffset;var c=this.layer.getImageSize(this.bounds);if(this.layerAlphaHack){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,f,c,null,"relative",null,null,null,true)}else{this.imgDiv=OpenLayers.Util.createImage(null,f,c,null,"relative",null,null,true)}if(OpenLayers.Util.isArray(this.layer.url)){this.imgDiv.urls=this.layer.url.slice()}this.imgDiv.className="olTileImage";this.frame.style.zIndex=this.isBackBuffer?0:1;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map;var d=function(){if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};if(this.layerAlphaHack){OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(d,this))}else{OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(d,this))}var b=function(){if(this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS){d.call(this)}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(b,this))}this.imgDiv.viewRequestID=this.layer.map.viewRequestID},removeImgDiv:function(){OpenLayers.Event.stopObservingElement(this.imgDiv);if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null}this.imgDiv.urls=null;var b=this.imgDiv.firstChild;if(b){OpenLayers.Event.stopObservingElement(b);this.imgDiv.removeChild(b);delete b}else{this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"}},checkImgURL:function(){if(this.layer){var b=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;if(!OpenLayers.Util.isEquivalentUrl(b,this.url)){this.hide()}}},startTransition:function(){if(!this.backBufferTile||!this.backBufferTile.imgDiv){return}var f=1;if(this.backBufferTile.resolution){f=this.backBufferTile.resolution/this.layer.getResolution()}if(f!=1){if(this.layer.transitionEffect=="resize"){var d=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top);var c=new OpenLayers.Size(this.backBufferTile.size.w*f,this.backBufferTile.size.h*f);var b=this.layer.map.getLayerPxFromLonLat(d);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,b,c);var g=this.backBufferTile.imageSize;g=new OpenLayers.Size(g.w*f,g.h*f);var j=this.backBufferTile.imageOffset;if(j){j=new OpenLayers.Pixel(j.x*f,j.y*f)}OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,j,g);this.backBufferTile.show()}}else{if(this.layer.singleTile){this.backBufferTile.show()}else{this.backBufferTile.hide()}}},show:function(){this.frame.style.display="";if(OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1){if(OpenLayers.IS_GECKO===true){this.frame.scrollLeft=this.frame.scrollLeft}}},hide:function(){this.frame.style.display="none"},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.useBlankTile=(OpenLayers.BROWSER_NAME=="safari"||OpenLayers.BROWSER_NAME=="opera");OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(c,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(this.pane==null){this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane")}},destroy:function(){this.mapObject=null;this.pane=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(b){OpenLayers.Layer.prototype.setMap.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;this.pane.style.display=this.div.style.display;this.pane.style.width="100%";this.pane.style.height="100%";if(OpenLayers.BROWSER_NAME=="msie"){this.pane.style.background="url("+OpenLayers.Util.getImagesLocation()+"blank.gif)"}if(this.isFixed){this.map.eventsDiv.appendChild(this.pane)}else{this.map.layerContainerDiv.appendChild(this.pane)}this.loadMapObject();if(this.mapObject==null){this.loadWarningMessage()}},removeMap:function(b){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane)}OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var k=this.map.getSize();var b=Math.min(k.w,300);var g=Math.min(k.h,200);var c=new OpenLayers.Size(b,g);var f=new OpenLayers.Pixel(k.w/2,k.h/2);var d=f.add(-c.w/2,-c.h/2);var j=OpenLayers.Util.createDiv(this.name+"_warning",d,c,null,null,null,"auto");j.style.padding="7px";j.style.backgroundColor="yellow";j.innerHTML=this.getWarningHTML();this.div.appendChild(j)},getWarningHTML:function(){return""},display:function(b){OpenLayers.Layer.prototype.display.apply(this,arguments);this.pane.style.display=this.div.style.display},setZIndex:function(b){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(c,b){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);if(this.dragPanMapObject){this.dragPanMapObject(c,-b)}else{this.moveTo(this.map.getCachedCenter())}},moveTo:function(d,f,n){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(this.mapObject!=null){var g=this.map.getCenter();var k=this.map.getZoom();if(g!=null){var j=this.getMapObjectCenter();var c=this.getOLLonLatFromMapObjectLonLat(j);var l=this.getMapObjectZoom();var q=this.getOLZoomFromMapObjectZoom(l);if(!(g.equals(c))||!(k==q)){if(!f&&c&&this.dragPanMapObject&&this.smoothDragPan){var m=this.map.getViewPortPxFromLonLat(c);var o=this.map.getViewPortPxFromLonLat(g);this.dragPanMapObject(o.x-m.x,m.y-o.y)}else{var b=this.getMapObjectLonLatFromOLLonLat(g);var p=this.getMapObjectZoomFromOLZoom(k);this.setMapObjectCenter(b,p,n)}}}}},getLonLatFromViewPortPx:function(b){var c=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var f=this.getMapObjectPixelFromOLPixel(b);var d=this.getMapObjectLonLatFromMapObjectPixel(f);c=this.getOLLonLatFromMapObjectLonLat(d)}return c},getViewPortPxFromLonLat:function(c){var b=null;if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var f=this.getMapObjectLonLatFromOLLonLat(c);var d=this.getMapObjectPixelFromMapObjectLonLat(f);b=this.getOLPixelFromMapObjectPixel(d)}return b},getOLLonLatFromMapObjectLonLat:function(f){var b=null;if(f!=null){var d=this.getLongitudeFromMapObjectLonLat(f);var c=this.getLatitudeFromMapObjectLonLat(f);b=new OpenLayers.LonLat(d,c)}return b},getMapObjectLonLatFromOLLonLat:function(b){var c=null;if(b!=null){c=this.getMapObjectLonLatFromLonLat(b.lon,b.lat)}return c},getOLPixelFromMapObjectPixel:function(f){var c=null;if(f!=null){var b=this.getXFromMapObjectPixel(f);var d=this.getYFromMapObjectPixel(f);c=new OpenLayers.Pixel(b,d)}return c},getMapObjectPixelFromOLPixel:function(b){var c=null;if(b!=null){c=this.getMapObjectPixelFromXY(b.x,b.y)}return c},CLASS_NAME:"OpenLayers.Layer.EventPane"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(d,c,f,b){OpenLayers.Layer.prototype.initialize.apply(this,[d,b]);this.url=c;this.params=OpenLayers.Util.extend({},f)},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(b){if(b==null){b=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())}b=OpenLayers.Layer.prototype.clone.apply(this,[b]);return b},setUrl:function(b){this.url=b},mergeNewParams:function(c){this.params=OpenLayers.Util.extend(this.params,c);var b=this.redraw();if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"})}return b},redraw:function(b){if(b){return this.mergeNewParams({_olSalt:Math.random()})}else{return OpenLayers.Layer.prototype.redraw.apply(this,[])}},selectUrl:function(g,f){var d=1;for(var c=0,b=g.length;c<b;c++){d*=g.charCodeAt(c)*this.URL_HASH_FACTOR;d-=Math.floor(d)}return f[Math.floor(d*f.length)]},getFullRequestString:function(k,f){var c=f||this.url;var j=OpenLayers.Util.extend({},this.params);j=OpenLayers.Util.extend(j,k);var g=OpenLayers.Util.getParameterString(j);if(OpenLayers.Util.isArray(c)){c=this.selectUrl(g,c)}var b=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var d in j){if(d.toUpperCase() in b){delete j[d]}}g=OpenLayers.Util.getParameterString(j);return OpenLayers.Util.urlAppend(c,g)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,grid:null,singleTile:false,ratio:1.5,buffer:0,numLoadingTiles:0,tileLoadingDelay:100,timerId:null,initialize:function(d,c,f,b){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.events.addEventType("tileloaded");this.grid=[];this._moveGriddedTiles=OpenLayers.Function.bind(this.moveGriddedTiles,this)},removeMap:function(b){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}},destroy:function(){this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var j=0,c=this.grid.length;j<c;j++){var g=this.grid[j];for(var d=0,b=g.length;d<b;d++){var f=g[d];this.removeTileMonitoringHooks(f);f.destroy()}}this.grid=[]}},clone:function(b){if(b==null){b=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())}b=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[b]);if(this.tileSize!=null){b.tileSize=this.tileSize.clone()}b.grid=[];return b},moveTo:function(f,b,g){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);f=f||this.map.getExtent();if(f!=null){var d=!this.grid.length||b;var c=this.getTilesBounds();if(this.singleTile){if(d||(!g&&!c.containsBounds(f))){this.initSingleTile(f)}}else{if(d||!c.containsBounds(f,true)){this.initGriddedTiles(f)}else{this.scheduleMoveGriddedTiles()}}}},moveByPx:function(c,b){if(!this.singleTile){this.scheduleMoveGriddedTiles()}},scheduleMoveGriddedTiles:function(){if(this.timerId!=null){window.clearTimeout(this.timerId)}this.timerId=window.setTimeout(this._moveGriddedTiles,this.tileLoadingDelay)},setTileSize:function(b){if(this.singleTile){b=this.map.getSize();b.h=parseInt(b.h*this.ratio);b.w=parseInt(b.w*this.ratio)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[b])},getGridBounds:function(){var b="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";OpenLayers.Console.warn(b);return this.getTilesBounds()},getTilesBounds:function(){var g=null;if(this.grid.length){var b=this.grid.length-1;var f=this.grid[b][0];var c=this.grid[0].length-1;var d=this.grid[0][c];g=new OpenLayers.Bounds(f.bounds.left,f.bounds.bottom,d.bounds.right,d.bounds.top)}return g},initSingleTile:function(j){var b=j.getCenterLonLat();var l=j.getWidth()*this.ratio;var c=j.getHeight()*this.ratio;var k=new OpenLayers.Bounds(b.lon-(l/2),b.lat-(c/2),b.lon+(l/2),b.lat+(c/2));var f=new OpenLayers.LonLat(k.left,k.top);var d=this.map.getLayerPxFromLonLat(f);if(!this.grid.length){this.grid[0]=[]}var g=this.grid[0][0];if(!g){g=this.addTile(k,d);this.addTileMonitoringHooks(g);g.draw();this.grid[0][0]=g}else{g.moveTo(k,d)}this.removeExcessTiles(1,1)},calculateGridLayout:function(b,r,g){var o=g*this.tileSize.w;var d=g*this.tileSize.h;var m=b.left-r.lon;var p=Math.floor(m/o)-this.buffer;var n=m/o-p;var j=-n*this.tileSize.w;var q=r.lon+p*o;var c=b.top-(r.lat+d);var l=Math.ceil(c/d)+this.buffer;var s=l-c/d;var f=-s*this.tileSize.h;var k=r.lat+l*d;return{tilelon:o,tilelat:d,tileoffsetlon:q,tileoffsetlat:k,tileoffsetx:j,tileoffsety:f}},getTileOrigin:function(){var c=this.tileOrigin;if(!c){var d=this.getMaxExtent();var b=({tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]})[this.tileOriginCorner];c=new OpenLayers.LonLat(d[b[0]],d[b[1]])}return c},initGriddedTiles:function(m){var k=this.map.getSize();var D=Math.ceil(k.h/this.tileSize.h)+Math.max(1,2*this.buffer);var F=Math.ceil(k.w/this.tileSize.w)+Math.max(1,2*this.buffer);var H=this.getTileOrigin();var v=this.map.getResolution();var u=this.calculateGridLayout(m,H,v);var j=Math.round(u.tileoffsetx);var d=Math.round(u.tileoffsety);var o=u.tileoffsetlon;var r=u.tileoffsetlat;var g=u.tilelon;var n=u.tilelat;this.origin=new OpenLayers.Pixel(j,d);var C=j;var E=o;var B=0;var b=parseInt(this.map.layerContainerDiv.style.left);var A=parseInt(this.map.layerContainerDiv.style.top);do{var l=this.grid[B++];if(!l){l=[];this.grid.push(l)}o=E;j=C;var f=0;do{var c=new OpenLayers.Bounds(o,r,o+g,r+n);var q=j;q-=b;var p=d;p-=A;var s=new OpenLayers.Pixel(q,p);var G=l[f++];if(!G){G=this.addTile(c,s);this.addTileMonitoringHooks(G);l.push(G)}else{G.moveTo(c,s,false)}o+=g;j+=this.tileSize.w}while((o<=m.right+g*this.buffer)||f<F);r-=n;d+=this.tileSize.h}while((r>=m.bottom-n*this.buffer)||B<D);this.removeExcessTiles(B,f);this.spiralTileLoad()},getMaxExtent:function(){return this.maxExtent},spiralTileLoad:function(){var c=[];var l=["right","down","left","up"];var k=0;var b=-1;var n=OpenLayers.Util.indexOf(l,"right");var o=0;while(o<l.length){var m=k;var d=b;switch(l[n]){case"right":d++;break;case"down":m++;break;case"left":d--;break;case"up":m--;break}var j=null;if((m<this.grid.length)&&(m>=0)&&(d<this.grid[0].length)&&(d>=0)){j=this.grid[m][d]}if((j!=null)&&(!j.queued)){c.unshift(j);j.queued=true;o=0;k=m;b=d}else{n=(n+1)%4;o++}}for(var f=0,g=c.length;f<g;f++){var j=c[f];j.draw();j.queued=false}},addTile:function(c,b){return new OpenLayers.Tile.Image(this,b,c,null,this.tileSize,this.tileOptions)},addTileMonitoringHooks:function(b){b.onLoadStart=function(){if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")}this.numLoadingTiles++};b.events.register("loadstart",this,b.onLoadStart);b.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};b.events.register("loadend",this,b.onLoadEnd);b.events.register("unload",this,b.onLoadEnd)},removeTileMonitoringHooks:function(b){b.unload();b.events.un({loadstart:b.onLoadStart,loadend:b.onLoadEnd,unload:b.onLoadEnd,scope:this})},moveGriddedTiles:function(){var f=true;var d=this.buffer||1;var c=this.grid[0][0].position;var b=parseInt(this.map.layerContainerDiv.style.left);var j=parseInt(this.map.layerContainerDiv.style.top);var g=c.add(b,j);if(g.x>-this.tileSize.w*(d-1)){this.shiftColumn(true)}else{if(g.x<-this.tileSize.w*d){this.shiftColumn(false)}else{if(g.y>-this.tileSize.h*(d-1)){this.shiftRow(true)}else{if(g.y<-this.tileSize.h*d){this.shiftRow(false)}else{f=false}}}}if(f){this.timerId=window.setTimeout(this._moveGriddedTiles,0)}},shiftRow:function(q){var d=(q)?0:(this.grid.length-1);var c=this.grid;var j=c[d];var g=this.map.getResolution();var l=(q)?-this.tileSize.h:this.tileSize.h;var k=g*-l;var p=(q)?c.pop():c.shift();for(var m=0,o=j.length;m<o;m++){var f=j[m];var b=f.bounds.clone();var n=f.position.clone();b.bottom=b.bottom+k;b.top=b.top+k;n.y=n.y+l;p[m].moveTo(b,n)}if(q){c.unshift(p)}else{c.push(p)}},shiftColumn:function(p){var f=(p)?-this.tileSize.w:this.tileSize.w;var d=this.map.getResolution();var n=d*f;for(var g=0,k=this.grid.length;g<k;g++){var o=this.grid[g];var m=(p)?0:(o.length-1);var c=o[m];var b=c.bounds.clone();var j=c.position.clone();b.left=b.left+n;b.right=b.right+n;j.x=j.x+f;var l=p?this.grid[g].pop():this.grid[g].shift();l.moveTo(b,j);if(p){o.unshift(l)}else{o.push(l)}}},removeExcessTiles:function(g,d){while(this.grid.length>g){var j=this.grid.pop();for(var c=0,b=j.length;c<b;c++){var f=j[c];this.removeTileMonitoringHooks(f);f.destroy()}}while(this.grid[0].length>d){for(var c=0,b=this.grid.length;c<b;c++){var j=this.grid[c];var f=j.pop();this.removeTileMonitoringHooks(f);f.destroy()}}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(f){var d=this.maxExtent;var j=this.getResolution();var g=j*this.tileSize.w;var c=j*this.tileSize.h;var l=this.getLonLatFromViewPortPx(f);var b=d.left+(g*Math.floor((l.lon-d.left)/g));var k=d.bottom+(c*Math.floor((l.lat-d.bottom)/c));return new OpenLayers.Bounds(b,k,b+g,k+c)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(c,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(c){if(c!=this.opacity){this.opacity=c;for(var d=0,b=this.markers.length;d<b;d++){this.markers[d].setOpacity(this.opacity)}}},moveTo:function(f,c,g){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(c||!this.drawn){for(var d=0,b=this.markers.length;d<b;d++){this.drawMarker(this.markers[d])}this.drawn=true}},addMarker:function(b){this.markers.push(b);if(this.opacity!=null){b.setOpacity(this.opacity)}if(this.map&&this.map.getExtent()){b.map=this.map;this.drawMarker(b)}},removeMarker:function(b){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,b);b.erase()}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])}}},drawMarker:function(b){var c=this.map.getLayerPxFromLonLat(b.lonlat);if(c==null){b.display(false)}else{if(!b.isDrawn()){var d=b.draw(c);this.div.appendChild(d)}else{if(b.icon){b.icon.moveTo(c)}}}},getDataExtent:function(){var c=null;if(this.markers&&(this.markers.length>0)){var c=new OpenLayers.Bounds();for(var f=0,b=this.markers.length;f<b;f++){var d=this.markers[f];c.extend(d.lonlat)}}return c},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},reproject:false,isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{"EPSG:4326":true},initialize:function(f,d,g,c){var b=[];g=OpenLayers.Util.upperCaseObject(g);if(parseFloat(g.VERSION)>=1.3&&!g.EXCEPTIONS){g.EXCEPTIONS="INIMAGE"}b.push(f,d,g,c);OpenLayers.Layer.Grid.prototype.initialize.apply(this,b);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((c==null)||(!c.isBaseLayer)){this.isBaseLayer=false}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"}}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments)},clone:function(b){if(b==null){b=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())}b=OpenLayers.Layer.Grid.prototype.clone.apply(this,[b]);return b},reverseAxisOrder:function(){return(parseFloat(this.params.VERSION)>=1.3&&!!this.yx[this.map.getProjectionObject().getCode()])},getURL:function(d){d=this.adjustBounds(d);var f=this.getImageSize();var g={};var c=this.reverseAxisOrder();g.BBOX=this.encodeBBOX?d.toBBOX(null,c):d.toArray(c);g.WIDTH=f.w;g.HEIGHT=f.h;var b=this.getFullRequestString(g);return b},mergeNewParams:function(d){var c=OpenLayers.Util.upperCaseObject(d);var b=[c];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,b)},getFullRequestString:function(g,d){var c=this.map.getProjectionObject();var b=this.projection&&this.projection.equals(c)?this.projection.getCode():c.getCode();var f=(b=="none")?null:b;if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=f}else{this.params.SRS=f}if(typeof this.params.TRANSPARENT=="boolean"){g.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(l,f,k,d,c,j,g){var b=[l,f,k,d,j,g];OpenLayers.Popup.prototype.initialize.apply(this,b);this.anchor=(c!=null)?c:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(d){var c=this.relativePosition;this.relativePosition=this.calculateRelativePosition(d);var f=this.calculateNewPx(d);var b=new Array(f);OpenLayers.Popup.prototype.moveTo.apply(this,b);if(this.relativePosition!=c){this.updateRelativePosition()}},setSize:function(c){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if((this.lonlat)&&(this.map)){var b=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(b)}},calculateRelativePosition:function(c){var f=this.map.getLonLatFromLayerPx(c);var d=this.map.getExtent();var b=d.determineQuadrant(f);return OpenLayers.Bounds.oppositeQuadrant(b)},updateRelativePosition:function(){},calculateNewPx:function(c){var g=c.offset(this.anchor.offset);var b=this.size||this.contentSize;var f=(this.relativePosition.charAt(0)=="t");g.y+=(f)?-b.h:this.anchor.size.h;var d=(this.relativePosition.charAt(1)=="l");g.x+=(d)?-b.w:this.anchor.size.w;return g},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:false,positionBlocks:null,blocks:null,fixedRelativePosition:false,initialize:function(k,d,j,c,b,g,f){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(l){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;if(g){this.closeDiv.style.zIndex=1}this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=false;this.positionBlocks=null;for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];if(c.image){c.div.removeChild(c.image)}c.image=null;if(c.div){this.groupDiv.removeChild(c.div)}c.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(b){},setBorder:function(){},setOpacity:function(b){},setSize:function(b){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+this.padding.right+"px";this.closeDiv.style.top=b.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(b){var c=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);c=c.offset(this.positionBlocks[this.relativePosition].offset);return c},createBlocks:function(){this.blocks=[];var j=null;for(var g in this.positionBlocks){j=g;break}var b=this.positionBlocks[j];for(var f=0;f<b.blocks.length;f++){var l={};this.blocks.push(l);var c=this.id+"_FrameDecorationDiv_"+f;l.div=OpenLayers.Util.createDiv(c,null,null,null,"absolute",null,"hidden",null);var d=this.id+"_FrameDecorationImg_"+f;var k=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;l.image=k(d,null,this.imageSize,this.imageSrc,"absolute",null,null,null);l.div.appendChild(l.image);this.groupDiv.appendChild(l.div)}},updateBlocks:function(){if(!this.blocks){this.createBlocks()}if(this.size&&this.relativePosition){var m=this.positionBlocks[this.relativePosition];for(var j=0;j<m.blocks.length;j++){var d=m.blocks[j];var g=this.blocks[j];var f=d.anchor.left;var n=d.anchor.bottom;var c=d.anchor.right;var p=d.anchor.top;var o=(isNaN(d.size.w))?this.size.w-(c+f):d.size.w;var k=(isNaN(d.size.h))?this.size.h-(n+p):d.size.h;g.div.style.width=(o<0?0:o)+"px";g.div.style.height=(k<0?0:k)+"px";g.div.style.left=(f!=null)?f+"px":"";g.div.style.bottom=(n!=null)?n+"px":"";g.div.style.right=(c!=null)?c+"px":"";g.div.style.top=(p!=null)?p+"px":"";g.image.style.left=d.position.x+"px";g.image.style.top=d.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:true,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:false,fixedRelativePosition:false,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(k,d,j,c,b,g,f){this.imageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-relative.png";OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},destroy:function(){OpenLayers.Popup.Framed.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(b,d,c){this.layer=b;this.lonlat=d;this.data=(c!=null)?c:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup)}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker)}this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(this.marker!=null){this.destroyMarker(this.marker);this.marker=null}if(this.popup!=null){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var c=false;if((this.layer!=null)&&(this.layer.map!=null)){var b=this.layer.map.getExtent();c=b.containsLonLat(this.lonlat)}return c},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)}return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(c){if(this.lonlat!=null){if(!this.popup){var b=(this.marker)?this.marker.icon:null;var d=this.popupClass?this.popupClass:OpenLayers.Popup.AnchoredBubble;this.popup=new d(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,b,c)}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow}this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(d,b,c){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]);this.lonlat=null;this.geometry=d?d:null;this.state=null;this.attributes={};if(b){this.attributes=OpenLayers.Util.extend(this.attributes,b)}this.style=c?c:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;this.modified=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(f){var d=false;if(this.layer&&this.layer.map){var b=this.layer.map.getExtent();if(f){var c=this.geometry.getBounds();d=b.intersectsBounds(c)}else{var g=b.toGeometry();d=g.intersects(this.geometry)}}return d},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(c,f,d){var b=false;if(this.geometry){b=this.geometry.atPoint(c,f,d)}return b},destroyPopup:function(){},move:function(b){if(!this.layer||!this.geometry.move){return undefined}var c;if(b.CLASS_NAME=="OpenLayers.LonLat"){c=this.layer.getViewPortPxFromLonLat(b)}else{c=b}var f=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());var d=this.layer.map.getResolution();this.geometry.move(d*(c.x-f.x),d*(f.y-c.y));this.layer.drawFeature(this);return f},toState:function(b){if(b==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=b;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break}}else{if(b==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=b;break}}else{if(b==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=b;break}}else{if(b==OpenLayers.State.UNKNOWN){this.state=b}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}};OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(f,c,b){OpenLayers.Util.extend(this,b);this.control=f;this.callbacks=c;var d=this.map||f.map;if(d){this.setMap(d)}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(b){this.map=b},checkModifiers:function(b){if(this.keyMask==null){return true}var c=(b.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(b.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(b.altKey?OpenLayers.Handler.MOD_ALT:0);return(c==this.keyMask)},activate:function(){if(this.active){return false}var d=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var c=0,b=d.length;c<b;c++){if(this[d[c]]){this.register(d[c],this[d[c]])}}this.active=true;return true},deactivate:function(){if(!this.active){return false}var d=OpenLayers.Events.prototype.BROWSER_EVENTS;for(var c=0,b=d.length;c<b;c++){if(this[d[c]]){this.unregister(d[c],this[d[c]])}}this.active=false;return true},callback:function(c,b){if(c&&this.callbacks[c]){this.callbacks[c].apply(this.control,b)}},register:function(b,c){this.map.events.registerPriority(b,this,c);this.map.events.registerPriority(b,this,this.setEvent)},unregister:function(b,c){this.map.events.unregister(b,this,c);this.map.events.unregister(b,this,this.setEvent)},setEvent:function(b){this.evt=b;return true},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,dblclickTolerance:13,stopSingle:false,stopDouble:false,timerId:null,touch:false,down:null,last:null,first:null,rightclickTimerId:null,initialize:function(d,c,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},touchstart:function(b){if(!this.touch){this.unregisterMouseListeners();this.touch=true}this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return true},touchmove:function(b){this.last=this.getEventInfo(b);return true},touchend:function(b){if(this.down){b.xy=this.last.xy;b.lastTouches=this.last.touches;this.handleSingle(b);this.down=null}return true},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(b){this.down=this.getEventInfo(b);this.last=this.getEventInfo(b);return true},mouseup:function(c){var b=true;if(this.checkModifiers(c)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(c)){b=this.rightclick(c)}return b},rightclick:function(c){if(this.passesTolerance(c)){if(this.rightclickTimerId!=null){this.clearTimer();this.callback("dblrightclick",[c]);return !this.stopDouble}else{var b=this["double"]?OpenLayers.Util.extend({},c):this.callback("rightclick",[c]);var d=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(d,this.delay)}}return !this.stopSingle},delayedRightCall:function(b){this.rightclickTimerId=null;if(b){this.callback("rightclick",[b])}},click:function(b){if(!this.last){this.last=this.getEventInfo(b)}this.handleSingle(b);return !this.stopSingle},dblclick:function(b){this.handleDouble(b);return !this.stopDouble},handleDouble:function(b){if(this["double"]&&this.passesDblclickTolerance(b)){this.callback("dblclick",[b])}},handleSingle:function(c){if(this.passesTolerance(c)){if(this.timerId!=null){if(this.last.touches&&this.last.touches.length===1){if(this["double"]){OpenLayers.Event.stop(c)}this.handleDouble(c)}if(!this.last.touches||this.last.touches.length!==2){this.clearTimer()}}else{this.first=this.getEventInfo(c);var b=this.single?OpenLayers.Util.extend({},c):null;this.queuePotentialClick(b)}}},queuePotentialClick:function(b){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,b),this.delay)},passesTolerance:function(b){var f=true;if(this.pixelTolerance!=null&&this.down&&this.down.xy){f=this.pixelTolerance>=this.down.xy.distanceTo(b.xy);if(f&&this.touch&&this.down.touches.length===this.last.touches.length){for(var c=0,d=this.down.touches.length;c<d;++c){if(this.getTouchDistance(this.down.touches[c],this.last.touches[c])>this.pixelTolerance){f=false;break}}}}return f},getTouchDistance:function(c,b){return Math.sqrt(Math.pow(c.clientX-b.clientX,2)+Math.pow(c.clientY-b.clientY,2))},passesDblclickTolerance:function(b){var c=true;if(this.down&&this.first){c=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance}return c},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);this.timerId=null}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(b){this.timerId=null;if(b){this.callback("click",[b])}},getEventInfo:function(c){var f;if(c.touches){var b=c.touches.length;f=new Array(b);var g;for(var d=0;d<b;d++){g=c.touches[d];f[d]={clientX:g.clientX,clientY:g.clientY}}}return{xy:c.xy,touches:f}},deactivate:function(){var b=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;this.first=null;this.last=null;this.touch=false;b=true}return b},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,mouseDown:false,stoppedDown:null,lastDown:null,lastUp:null,persist:false,stopDown:false,stopUp:false,layerOptions:null,pixelTolerance:5,touch:false,lastTouchPx:null,initialize:function(d,c,b){if(!(b&&b.layerOptions&&b.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})}OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false}var b=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b);this.map.addLayer(this.layer);return true},createFeature:function(b){var c=this.map.getLonLatFromPixel(b);var d=new OpenLayers.Geometry.Point(c.lon,c.lat);this.point=new OpenLayers.Feature.Vector(d);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:true})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false}this.cancel();if(this.layer.map!=null){this.destroyFeature(true);this.layer.destroy(false)}this.layer=null;this.touch=false;return true},destroyFeature:function(b){if(this.layer&&(b||!this.persist)){this.layer.destroyFeatures()}this.point=null},destroyPersistedFeature:function(){var b=this.layer;if(b&&b.features.length>1){this.layer.features[0].destroy()}},finalize:function(c){var b=c?"cancel":"done";this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(b,[this.geometryClone()]);this.destroyFeature(c)},cancel:function(){this.finalize(true)},click:function(b){OpenLayers.Event.stop(b);return false},dblclick:function(b){OpenLayers.Event.stop(b);return false},modifyFeature:function(b){if(!this.point){this.createFeature(b)}var c=this.map.getLonLatFromPixel(b);this.point.geometry.x=c.lon;this.point.geometry.y=c.lat;this.callback("modify",[this.point.geometry,this.point,false]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var b=this.point&&this.point.geometry;if(b&&this.multi){b=new OpenLayers.Geometry.MultiPoint([b])}return b},geometryClone:function(){var b=this.getGeometry();return b&&b.clone()},mousedown:function(b){return this.down(b)},touchstart:function(b){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})}this.lastTouchPx=b.xy;return this.down(b)},mousemove:function(b){return this.move(b)},touchmove:function(b){this.lastTouchPx=b.xy;return this.move(b)},mouseup:function(b){return this.up(b)},touchend:function(b){b.xy=this.lastTouchPx;return this.up(b)},down:function(b){this.mouseDown=true;this.lastDown=b.xy;if(!this.touch){this.modifyFeature(b.xy)}this.stoppedDown=this.stopDown;return !this.stopDown},move:function(b){if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(b.xy)}return true},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(!this.checkModifiers(b)){return true}if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.finalize();return !this.stopUp}else{return true}},mouseout:function(b){if(OpenLayers.Util.mouseLeft(b,this.map.eventsDiv)){this.stoppedDown=this.stopDown;this.mouseDown=false}},passesTolerance:function(g,f,b){var c=true;if(b!=null&&g&&f){var d=g.distanceTo(f);if(d>b){c=false}}return c},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:false,freehandToggle:"shiftKey",timerId:null,redoStack:null,initialize:function(d,c,b){OpenLayers.Handler.Point.prototype.initialize.apply(this,arguments)},createFeature:function(b){var c=this.map.getLonLatFromPixel(b);var d=new OpenLayers.Geometry.Point(c.lon,c.lat);this.point=new OpenLayers.Feature.Vector(d);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:true})},destroyFeature:function(b){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,b);this.line=null},destroyPersistedFeature:function(){var b=this.layer;if(b&&b.features.length>2){this.layer.features[0].destroy()}},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])}},addPoint:function(b){this.layer.removeFeatures([this.point]);var c=this.control.map.getLonLatFromPixel(b);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(b,c){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(b,c),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(c,b){var d=this.getCurrentPointIndex()-1;var f=this.line.geometry.components[d];if(f&&!isNaN(f.x)&&!isNaN(f.y)){this.insertXY(f.x+c,f.y+b)}},insertDirectionLength:function(f,d){f*=Math.PI/180;var c=d*Math.cos(f);var b=d*Math.sin(f);this.insertDeltaXY(c,b)},insertDeflectionLength:function(d,c){var f=this.getCurrentPointIndex()-1;if(f>0){var g=this.line.geometry.components[f];var j=this.line.geometry.components[f-1];var b=Math.atan2(g.y-j.y,g.x-j.x);this.insertDirectionLength((b*180/Math.PI)+d,c)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var g=this.line.geometry;var c=g.components;var b=this.getCurrentPointIndex()-1;var f=c[b];var d=g.removeComponent(f);if(d){if(!this.redoStack){this.redoStack=[]}this.redoStack.push(f);this.drawFeature()}return d},redo:function(){var b=this.redoStack&&this.redoStack.pop();if(b){this.line.geometry.addComponent(b,this.getCurrentPointIndex());this.drawFeature()}return !!b},freehandMode:function(b){return(this.freehandToggle&&b[this.freehandToggle])?!this.freehand:this.freehand},modifyFeature:function(c,b){if(!this.line){this.createFeature(c)}var d=this.control.map.getLonLatFromPixel(c);this.point.geometry.x=d.lon;this.point.geometry.y=d.lat;this.callback("modify",[this.point.geometry,this.getSketch(),b]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var b=this.line&&this.line.geometry;if(b&&this.multi){b=new OpenLayers.Geometry.MultiLineString([b])}return b},touchstart:function(b){if(this.timerId&&this.passesTolerance(this.lastTouchPx,b.xy,this.doubleTouchTolerance)){this.finishGeometry();window.clearTimeout(this.timerId);this.timerId=null;return false}else{if(this.timerId){window.clearTimeout(this.timerId);this.timerId=null}this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,b)}},down:function(b){var c=this.stopDown;if(this.freehandMode(b)){c=true}if(!this.touch&&(!this.lastDown||!this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance))){this.modifyFeature(b.xy,!!this.lastUp)}this.mouseDown=true;this.lastDown=b.xy;this.stoppedDown=c;return !c},move:function(b){if(this.stoppedDown&&this.freehandMode(b)){if(this.persist){this.destroyPersistedFeature()}this.addPoint(b.xy);return false}if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(b.xy,!!this.lastUp)}return true},up:function(b){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(b.xy))){if(this.stoppedDown&&this.freehandMode(b)){if(this.persist){this.destroyPersistedFeature()}this.removePoint();this.finalize()}else{if(this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.lastUp==null&&this.persist){this.destroyPersistedFeature()}this.addPoint(b.xy);this.lastUp=b.xy;if(this.line.geometry.components.length===this.maxVertices+1){this.finishGeometry()}}}}this.stoppedDown=this.stopDown;this.mouseDown=false;return !this.stopUp},finishGeometry:function(){var b=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[b]);this.removePoint();this.finalize()},dblclick:function(b){if(!this.freehandMode(b)){this.finishGeometry()}return false},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:false,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(f,c,d,b){OpenLayers.Handler.prototype.initialize.apply(this,[f,d,b]);this.layer=c},touchstart:function(b){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})}return OpenLayers.Event.isMultiTouch(b)?true:this.mousedown(b)},touchmove:function(b){OpenLayers.Event.stop(b)},mousedown:function(b){this.down=b.xy;return this.handle(b)?!this.stopDown:true},mouseup:function(b){this.up=b.xy;return this.handle(b)?!this.stopUp:true},click:function(b){return this.handle(b)?!this.stopClick:true},mousemove:function(b){if(!this.callbacks.over&&!this.callbacks.out){return true}this.handle(b);return true},dblclick:function(b){return !this.handle(b)},geometryTypeMatches:function(b){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,b.geometry.CLASS_NAME)>-1},handle:function(b){if(this.feature&&!this.feature.layer){this.feature=null}var d=b.type;var j=false;var g=!!(this.feature);var f=(d=="click"||d=="dblclick"||d=="touchstart");this.feature=this.layer.getFeatureFromEvent(b);if(this.feature&&!this.feature.layer){this.feature=null}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null}if(this.feature){if(d==="touchstart"){OpenLayers.Event.stop(b)}var c=(this.feature!=this.lastFeature);if(this.geometryTypeMatches(this.feature)){if(g&&c){if(this.lastFeature){this.triggerCallback(d,"out",[this.lastFeature])}this.triggerCallback(d,"in",[this.feature])}else{if(!g||f){this.triggerCallback(d,"in",[this.feature])}}this.lastFeature=this.feature;j=true}else{if(this.lastFeature&&(g&&c||f)){this.triggerCallback(d,"out",[this.lastFeature])}this.feature=null}}else{if(this.lastFeature&&(g||f)){this.triggerCallback(d,"out",[this.lastFeature])}}return j},triggerCallback:function(f,g,c){var d=this.EVENTMAP[f][g];if(d){if(f=="click"&&this.up&&this.down){var b=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));if(b<=this.clickTolerance){this.callback(d,c)}}else{this.callback(d,c)}}},activate:function(){var b=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});b=true}return b},deactivate:function(){var b=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.touch=false;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});b=true}return b},handleMapEvents:function(b){if(b.type=="removelayer"||b.property=="order"){this.moveLayerToTop()}},moveLayerToTop:function(){var b=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(b)},moveLayerBack:function(){var b=this.layer.getZIndex()-1;if(b>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(b)}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))}},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,touch:false,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(f,d,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.documentDrag===true){var c=this;this._docMove=function(g){c.mousemove({xy:{x:g.clientX,y:g.clientY},element:document})};this._docUp=function(g){c.mouseup({xy:{x:g.clientX,y:g.clientY}})}}},dragstart:function(c){var b=true;this.dragging=false;if(this.checkModifiers(c)&&(OpenLayers.Event.isLeftClick(c)||OpenLayers.Event.isSingleTouch(c))){this.started=true;this.start=c.xy;this.last=c.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(c);this.callback("down",[c.xy]);OpenLayers.Event.stop(c);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True}document.onselectstart=OpenLayers.Function.False;b=!this.stopDown}else{this.started=false;this.start=null;this.last=null}return b},dragmove:function(b){this.lastMoveEvt=b;if(this.started&&!this.timeoutId&&(b.xy.x!=this.last.x||b.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(b.element===document){this.adjustXY(b);this.setEvent(b)}else{this.removeDocumentEvents()}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)}this.dragging=true;this.move(b);this.callback("move",[b.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False}this.last=b.xy}return true},dragend:function(c){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(c);this.removeDocumentEvents()}var b=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(c);this.callback("up",[c.xy]);if(b){this.callback("done",[c.xy])}document.onselectstart=this.oldOnselectstart}return true},down:function(b){},move:function(b){},up:function(b){},out:function(b){},mousedown:function(b){return this.dragstart(b)},touchstart:function(b){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})}return this.dragstart(b)},mousemove:function(b){return this.dragmove(b)},touchmove:function(b){return this.dragmove(b)},removeTimeout:function(){this.timeoutId=null;if(this.dragging){this.mousemove(this.lastMoveEvt)}},mouseup:function(b){return this.dragend(b)},touchend:function(b){b.xy=this.last;return this.dragend(b)},mouseout:function(c){if(this.started&&OpenLayers.Util.mouseLeft(c,this.map.eventsDiv)){if(this.documentDrag===true){this.addDocumentEvents()}else{var b=(this.start!=this.last);this.started=false;this.dragging=false;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(c);this.callback("out",[]);if(b){this.callback("done",[c.xy])}if(document.onselectstart){document.onselectstart=this.oldOnselectstart}}}return true},click:function(b){return(this.start==this.last)},activate:function(){var b=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;b=true}return b},deactivate:function(){var b=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.touch=false;this.started=false;this.dragging=false;this.start=null;this.last=null;b=true;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return b},adjustXY:function(b){var c=OpenLayers.Util.pagePosition(this.map.viewPortDiv);b.xy.x-=c[0];b.xy.y-=c[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=true;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=false;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:false,pinching:false,last:null,start:null,initialize:function(d,c,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments)},touchstart:function(c){var b=true;this.pinching=false;if(OpenLayers.Event.isMultiTouch(c)){this.started=true;this.last=this.start={distance:this.getDistance(c.touches),delta:0,scale:1};this.callback("start",[c,this.start]);b=!this.stopDown}else{this.started=false;this.start=null;this.last=null}OpenLayers.Event.stop(c);return b},touchmove:function(b){if(this.started&&OpenLayers.Event.isMultiTouch(b)){this.pinching=true;var c=this.getPinchData(b);this.callback("move",[b,c]);this.last=c;OpenLayers.Event.stop(b)}return true},touchend:function(b){if(this.started){this.started=false;this.pinching=false;this.callback("done",[b,this.start,this.last]);this.start=null;this.last=null}return true},activate:function(){var b=false;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.pinching=false;b=true}return b},deactivate:function(){var b=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;this.pinching=false;this.start=null;this.last=null;b=true}return b},getDistance:function(d){var c=d[0];var b=d[1];return Math.sqrt(Math.pow(c.clientX-b.clientX,2)+Math.pow(c.clientY-b.clientY,2))},getPinchData:function(b){var d=this.getDistance(b.touches);var c=d/this.start.distance;return{distance:d,delta:this.last.distance-d,scale:c}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(d,c,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null}},setMap:function(b){OpenLayers.Handler.prototype.setMap.apply(this,arguments);if(this.dragHandler){this.dragHandler.setMap(b)}},startBox:function(b){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",new OpenLayers.Pixel(-9999,-9999));this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.eventsDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.eventsDiv,"olDrawBox")},moveBox:function(g){var f=this.dragHandler.start.x;var c=this.dragHandler.start.y;var d=Math.abs(f-g.x);var b=Math.abs(c-g.y);var j=this.getBoxOffsets();this.zoomBox.style.width=(d+j.width+1)+"px";this.zoomBox.style.height=(b+j.height+1)+"px";this.zoomBox.style.left=(g.x<f?f-d-j.left:f-j.left)+"px";this.zoomBox.style.top=(g.y<c?c-b-j.top:c-j.top)+"px"},endBox:function(c){var b;if(Math.abs(this.dragHandler.start.x-c.x)>5||Math.abs(this.dragHandler.start.y-c.y)>5){var k=this.dragHandler.start;var j=Math.min(k.y,c.y);var d=Math.max(k.y,c.y);var g=Math.min(k.x,c.x);var f=Math.max(k.x,c.x);b=new OpenLayers.Bounds(g,d,f,j)}else{b=this.dragHandler.start.clone()}this.removeBox();this.callback("done",[b])},removeBox:function(){this.map.eventsDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxOffsets=null;OpenLayers.Element.removeClass(this.map.eventsDiv,"olDrawBox")},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return true}else{return false}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){if(this.dragHandler.deactivate()){if(this.zoomBox){this.removeBox()}}return true}else{return false}},getBoxOffsets:function(){if(!this.boxOffsets){var f=document.createElement("div");f.style.position="absolute";f.style.border="1px solid black";f.style.width="3px";document.body.appendChild(f);var b=f.clientWidth==3;document.body.removeChild(f);var j=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"));var d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"));var g=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"));var c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:j,right:d,top:g,bottom:c,width:b===false?j+d:0,height:b===false?g+c:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,initialize:function(d,c,b){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate();this.eventListener=null;OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){for(var c=0,b=this.KEY_EVENTS.length;c<b;c++){OpenLayers.Event.observe(document,this.KEY_EVENTS[c],this.eventListener)}return true}else{return false}},deactivate:function(){var d=false;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var c=0,b=this.KEY_EVENTS.length;c<b;c++){OpenLayers.Event.stopObserving(document,this.KEY_EVENTS[c],this.eventListener)}d=true}return d},handleKeyEvent:function(b){if(this.checkModifiers(b)){this.callback(b.type,[b])}},CLASS_NAME:"OpenLayers.Handler.Keyboard"});OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],initialize:function(b){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,b);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)}this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var b in this.handlers){if(this.handlers.hasOwnProperty(b)&&typeof this.handlers[b].destroy=="function"){this.handlers[b].destroy()}}this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}this.div=null},setMap:function(b){this.map=b;if(this.handler){this.handler.setMap(b)}},draw:function(b){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False}if(this.title!=""){this.div.title=this.title}}if(b!=null){this.position=b.clone()}this.moveTo(this.position);return this.div},moveTo:function(b){if((b!=null)&&(this.div!=null)){this.div.style.left=b.x+"px";this.div.style.top=b.y+"px"}},activate:function(){if(this.active){return false}if(this.handler){this.handler.activate()}this.active=true;if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("activate");return true},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()}this.active=false;if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")}this.events.triggerEvent("deactivate");return true}return false},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});this.updateAttribution();return this.div},updateAttribution:function(){var f=[];if(this.map&&this.map.layers){for(var d=0,b=this.map.layers.length;d<b;d++){var c=this.map.layers[d];if(c.attribution&&c.getVisibility()){if(OpenLayers.Util.indexOf(f,c.attribution)===-1){f.push(c.attribution)}}}this.div.innerHTML=f.join(this.separator)}},CLASS_NAME:"OpenLayers.Control.Attribution"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:1,documentDrag:false,kinetic:null,enableKinetic:false,kineticInterval:10,draw:function(){if(this.enableKinetic){var b={interval:this.kineticInterval};if(typeof this.enableKinetic==="object"){b=OpenLayers.Util.extend(b,this.enableKinetic)}this.kinetic=new OpenLayers.Kinetic(b)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){if(this.kinetic){this.kinetic.begin()}},panMap:function(b){if(this.kinetic){this.kinetic.update(b)}this.panned=true;this.map.pan(this.handler.last.x-b.x,this.handler.last.y-b.y,{dragging:true,animate:false})},panMapDone:function(d){if(this.panned){var c=null;if(this.kinetic){c=this.kinetic.end(d)}this.map.pan(this.handler.last.x-d.x,this.handler.last.y-d.y,{dragging:!!c,animate:false});if(c){var b=this;this.kinetic.move(c,function(f,j,g){b.map.pan(f,j,{dragging:!g,animate:false})})}this.panned=false}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerOrigin:null,pinchOrigin:null,currentCenter:null,autoActivate:true,initialize:function(b){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},activate:function(){var b=OpenLayers.Control.prototype.activate.apply(this,arguments);if(b){this.map.events.on({moveend:this.updateContainerOrigin,scope:this});this.updateContainerOrigin()}return b},deactivate:function(){var b=OpenLayers.Control.prototype.deactivate.apply(this,arguments);if(this.map&&this.map.events){this.map.events.un({moveend:this.updateContainerOrigin,scope:this})}return b},updateContainerOrigin:function(){var b=this.map.layerContainerDiv;this.containerOrigin={x:parseInt(b.style.left,10),y:parseInt(b.style.top,10)}},pinchStart:function(b,c){this.pinchOrigin=b.xy;this.currentCenter=b.xy},pinchMove:function(c,l){var k=l.scale;var j=this.containerOrigin;var f=this.pinchOrigin;var g=c.xy;var d=Math.round((g.x-f.x)+(k-1)*(j.x-f.x));var b=Math.round((g.y-f.y)+(k-1)*(j.y-f.y));this.applyTransform("translate("+d+"px, "+b+"px) scale("+k+")");this.currentCenter=g},applyTransform:function(b){var c=this.map.layerContainerDiv.style;c["-webkit-transform"]=b;c["-moz-transform"]=b},pinchDone:function(c,l,k){this.applyTransform("");var j=this.map.getZoomForResolution(this.map.getResolution()/k.scale,true);if(j!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var f=this.map.getResolutionForZoom(j);var b=this.map.getLonLatFromPixel(this.pinchOrigin);var d=this.currentCenter;var g=this.map.getSize();b.lon+=f*((g.w/2)-d.x);b.lat-=f*((g.h/2)-d.y);this.map.setCenter(b,j)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:false,autoActivate:true,initialize:function(b){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();if(this.dragPan){this.dragPan.destroy()}this.dragPan=null;if(this.pinchZoom){this.pinchZoom.destroy();delete this.pinchZoom}OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.dragPan.activate();this.handlers.click.activate();this.pinchZoom.activate();return true}return false},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.dragPan.deactivate();this.handlers.click.deactivate();this.pinchZoom.deactivate();return true}return false},draw:function(){var b={click:this.defaultClick,dblclick:this.defaultDblClick};var c=OpenLayers.Util.extend({"double":true,stopDouble:true,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,b,c);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.dragPan.draw();this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(b){if(b.lastTouches&&b.lastTouches.length==2){this.map.zoomOut()}},defaultDblClick:function(c){var b=this.map.getLonLatFromViewPortPx(c.xy);this.map.setCenter(b,this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.events.register("mousemove",this,this.redraw);this.map.events.register("mouseout",this,this.reset);this.redraw();return true}else{return false}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("mousemove",this,this.redraw);this.map.events.unregister("mouseout",this,this.reset);this.element.innerHTML="";return true}else{return false}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.element){this.div.left="";this.div.top="";this.element=this.div}return this.div},redraw:function(b){var d;if(b==null){this.reset();return}else{if(this.lastXy==null||Math.abs(b.xy.x-this.lastXy.x)>this.granularity||Math.abs(b.xy.y-this.lastXy.y)>this.granularity){this.lastXy=b.xy;return}d=this.map.getLonLatFromPixel(b.xy);if(!d){return}if(this.displayProjection){d.transform(this.map.getProjectionObject(),this.displayProjection)}this.lastXy=b.xy}var c=this.formatOutput(d);if(c!=this.element.innerHTML){this.element.innerHTML=c}},reset:function(b){if(this.emptyString!=null){this.element.innerHTML=this.emptyString}},formatOutput:function(c){var d=parseInt(this.numDigits);var b=this.prefix+c.lon.toFixed(d)+this.separator+c.lat.toFixed(d)+this.suffix;return b},CLASS_NAME:"OpenLayers.Control.MousePosition"});OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(c){c=c||window.location.href;var d=OpenLayers.Util.getParameters(c);var b=c.indexOf("#");if(b>0){c="?"+c.substring(b+1,c.length);OpenLayers.Util.extend(d,OpenLayers.Util.getParameters(c))}return d},setMap:function(g){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var d=0,b=this.map.controls.length;d<b;d++){var f=this.map.controls[d];if((f!=this)&&(f.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(f.displayProjection!=this.displayProjection){this.displayProjection=f.displayProjection}break}}if(d==this.map.controls.length){var c=this.getParameters();if(c.layers){this.layers=c.layers;this.map.events.register("addlayer",this,this.configureLayers);this.configureLayers()}if(c.lat&&c.lon){this.center=new OpenLayers.LonLat(parseFloat(c.lon),parseFloat(c.lat));if(c.zoom){this.zoom=parseInt(c.zoom)}this.map.events.register("changebaselayer",this,this.setCenter);this.setCenter()}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject())}this.map.setCenter(this.center,this.zoom)}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var f=0,b=this.layers.length;f<b;f++){var d=this.map.layers[f];var g=this.layers.charAt(f);if(g=="B"){this.map.setBaseLayer(d)}else{if((g=="T")||(g=="F")){d.setVisibility(g=="T")}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(c,b){},onDrag:function(c,b){},onComplete:function(c,b){},onEnter:function(b){},onLeave:function(b){},documentDrag:false,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(c,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer=c;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(b){if(this.handlers.feature.touch&&!this.over&&this.overFeature(b)){this.handlers.drag.dragstart(this.handlers.feature.evt);this.handlers.drag.stopDown=false}},clickoutFeature:function(b){if(this.handlers.feature.touch&&this.over){this.outFeature(b);this.handlers.drag.stopDown=true}},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=false;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(c){var b=false;if(!this.handlers.drag.dragging){this.feature=c;this.handlers.drag.activate();b=true;this.over=true;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over");this.onEnter(c)}else{if(this.feature.id==c.id){this.over=true}else{this.over=false}}return b},downFeature:function(b){this.lastPixel=b;this.onStart(this.feature,b)},moveFeature:function(b){var c=this.map.getResolution();this.feature.geometry.move(c*(b.x-this.lastPixel.x),c*(this.lastPixel.y-b.y));this.layer.drawFeature(this.feature);this.lastPixel=b;this.onDrag(this.feature,b)},upFeature:function(b){if(!this.over){this.handlers.drag.deactivate()}},doneDragging:function(b){this.onComplete(this.feature,b)},outFeature:function(b){if(!this.handlers.drag.dragging){this.over=false;this.handlers.drag.deactivate();OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.onLeave(b);this.feature=null}else{if(this.feature.id==b.id){this.over=false}}},cancel:function(){this.handlers.drag.deactivate();this.over=false},setMap:function(b){this.handlers.drag.setMap(b);this.handlers.feature.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:true,toggle:true,standalone:false,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,modified:false,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(f,d){d=d||{};this.layer=f;this.vertices=[];this.virtualVertices=[];this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,d.vertexRenderIntent));this.virtualStyle.fillOpacity=0.3;this.virtualStyle.strokeOpacity=0.3;this.deleteCodes=[46,68];this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;OpenLayers.Control.prototype.initialize.apply(this,[d]);if(!(OpenLayers.Util.isArray(this.deleteCodes))){this.deleteCodes=[this.deleteCodes]}var j=this;var b={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};if(this.standalone===false){this.selectControl=new OpenLayers.Control.SelectFeature(f,b)}var c={geometryTypes:["OpenLayers.Geometry.Point"],snappingOptions:this.snappingOptions,onStart:function(l,k){j.dragStart.apply(j,[l,k])},onDrag:function(l,k){j.dragVertex.apply(j,[l,k])},onComplete:function(k){j.dragComplete.apply(j,[k])},featureCallbacks:{over:function(k){if(j.standalone!==true||k._sketch||j.feature===k){j.dragControl.overFeature.apply(j.dragControl,[k])}}}};this.dragControl=new OpenLayers.Control.DragFeature(f,c);var g={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,g)}},destroy:function(){this.layer=null;this.standalone||this.selectControl.destroy();this.dragControl.destroy();OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return((this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))},deactivate:function(){var d=false;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:true});this.layer.removeFeatures(this.virtualVertices,{silent:true});this.vertices=[];this.dragControl.deactivate();var b=this.feature;var c=b&&b.geometry&&b.layer;if(this.standalone===false){if(c){this.selectControl.unselect.apply(this.selectControl,[b])}this.selectControl.deactivate()}else{if(c){this.unselectFeature(b)}}this.handlers.keyboard.deactivate();d=true}return d},beforeSelectFeature:function(b){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:b})},selectFeature:function(c){if(!this.standalone||this.beforeSelectFeature(c)!==false){this.feature=c;this.modified=false;this.resetVertices();this.dragControl.activate();this.onModificationStart(this.feature)}var b=c.modified;if(c.geometry&&!(b&&b.geometry)){this._originalGeometry=c.geometry.clone()}},unselectFeature:function(b){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[];if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});delete this.dragHandle}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});delete this.radiusHandle}this.feature=null;this.dragControl.deactivate();this.onModificationEnd(b);this.layer.events.triggerEvent("afterfeaturemodified",{feature:b,modified:this.modified});this.modified=false},dragStart:function(c,b){if(c!=this.feature&&!c.geometry.parent&&c!=this.dragHandle&&c!=this.radiusHandle){if(this.standalone===false&&this.feature){this.selectControl.clickFeature.apply(this.selectControl,[this.feature])}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,c.geometry.CLASS_NAME)!=-1){this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[c]);this.dragControl.overFeature.apply(this.dragControl,[c]);this.dragControl.lastPixel=b;this.dragControl.handlers.drag.started=true;this.dragControl.handlers.drag.start=b;this.dragControl.handlers.drag.last=b}}},dragVertex:function(c,b){this.modified=true;if(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.feature!=c){this.feature=c}this.layer.events.triggerEvent("vertexmodified",{vertex:c.geometry,feature:this.feature,pixel:b})}else{if(c._index){c.geometry.parent.addComponent(c.geometry,c._index);delete c._index;OpenLayers.Util.removeItem(this.virtualVertices,c);this.vertices.push(c)}else{if(c==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[];if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}}else{if(c!==this.radiusHandle){this.layer.events.triggerEvent("vertexmodified",{vertex:c.geometry,feature:this.feature,pixel:b})}}}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent)}this.layer.drawFeature(c)},dragComplete:function(b){this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE){this.feature.state=OpenLayers.State.UPDATE;if(this.modified&&this._originalGeometry){var b=this.feature;b.modified=OpenLayers.Util.extend(b.modified,{geometry:this._originalGeometry});delete this._originalGeometry}}},resetVertices:function(){if(this.dragControl.feature){this.dragControl.outFeature(this.dragControl.feature)}if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});this.vertices=[]}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});this.virtualVertices=[]}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});this.dragHandle=null}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});this.radiusHandle=null}if(this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"){if((this.mode&OpenLayers.Control.ModifyFeature.DRAG)){this.collectDragHandle()}if((this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE))){this.collectRadiusHandle()}if(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE){if(!(this.mode&OpenLayers.Control.ModifyFeature.RESIZE)){this.collectVertices()}}}},handleKeypress:function(b){var c=b.keyCode;if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,c)!=-1){var d=this.dragControl.feature;if(d&&OpenLayers.Util.indexOf(this.vertices,d)!=-1&&!this.dragControl.handlers.drag.dragging&&d.geometry.parent){d.geometry.parent.removeComponent(d.geometry);this.layer.events.triggerEvent("vertexremoved",{vertex:d.geometry,feature:this.feature,pixel:b.xy});this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent);this.modified=true;this.resetVertices();this.setFeatureState();this.onModification(this.feature);this.layer.events.triggerEvent("featuremodified",{feature:this.feature})}}},collectVertices:function(){this.vertices=[];this.virtualVertices=[];var b=this;function c(l){var f,g,m,j;if(l.CLASS_NAME=="OpenLayers.Geometry.Point"){g=new OpenLayers.Feature.Vector(l);g._sketch=true;g.renderIntent=b.vertexRenderIntent;b.vertices.push(g)}else{var d=l.components.length;if(l.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){d-=1}for(f=0;f<d;++f){m=l.components[f];if(m.CLASS_NAME=="OpenLayers.Geometry.Point"){g=new OpenLayers.Feature.Vector(m);g._sketch=true;g.renderIntent=b.vertexRenderIntent;b.vertices.push(g)}else{c(m)}}if(l.CLASS_NAME!="OpenLayers.Geometry.MultiPoint"){for(f=0,j=l.components.length;f<j-1;++f){var p=l.components[f];var q=l.components[f+1];if(p.CLASS_NAME=="OpenLayers.Geometry.Point"&&q.CLASS_NAME=="OpenLayers.Geometry.Point"){var n=(p.x+q.x)/2;var k=(p.y+q.y)/2;var o=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(n,k),null,b.virtualStyle);o.geometry.parent=l;o._index=f+1;o._sketch=true;b.virtualVertices.push(o)}}}}}c.call(this,this.feature.geometry);this.layer.addFeatures(this.virtualVertices,{silent:true});this.layer.addFeatures(this.vertices,{silent:true})},collectDragHandle:function(){var f=this.feature.geometry;var b=f.getBounds().getCenterLonLat();var d=new OpenLayers.Geometry.Point(b.lon,b.lat);var c=new OpenLayers.Feature.Vector(d);d.move=function(g,j){OpenLayers.Geometry.Point.prototype.move.call(this,g,j);f.move(g,j)};c._sketch=true;this.dragHandle=c;this.layer.addFeatures([this.dragHandle],{silent:true})},collectRadiusHandle:function(){var l=this.feature.geometry;var b=l.getBounds();var c=b.getCenterLonLat();var m=new OpenLayers.Geometry.Point(c.lon,c.lat);var k=new OpenLayers.Geometry.Point(b.right,b.bottom);var j=new OpenLayers.Feature.Vector(k);var d=(this.mode&OpenLayers.Control.ModifyFeature.RESIZE);var g=(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE);var f=(this.mode&OpenLayers.Control.ModifyFeature.ROTATE);k.move=function(C,B){OpenLayers.Geometry.Point.prototype.move.call(this,C,B);var D=this.x-m.x;var u=this.y-m.y;var E=D-C;var v=u-B;if(f){var o=Math.atan2(v,E);var n=Math.atan2(u,D);var r=n-o;r*=180/Math.PI;l.rotate(r,m)}if(d){var q,A;if(g){q=u/v;A=(D/E)/q}else{var s=Math.sqrt((E*E)+(v*v));var p=Math.sqrt((D*D)+(u*u));q=p/s}l.resize(q,m,A)}};j._sketch=true;this.radiusHandle=j;this.layer.addFeatures([this.radiusHandle],{silent:true})},setMap:function(b){this.standalone||this.selectControl.setMap(b);this.dragControl.setMap(b);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});OpenLayers.Control.ModifyFeature.RESHAPE=1;OpenLayers.Control.ModifyFeature.RESIZE=2;OpenLayers.Control.ModifyFeature.ROTATE=4;OpenLayers.Control.ModifyFeature.DRAG=8;OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(d,b){this.EVENT_TYPES=OpenLayers.Control.SelectFeature.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);OpenLayers.Control.prototype.initialize.apply(this,[b]);if(this.scope===null){this.scope=this}this.initLayer(d);var c={click:this.clickFeature,clickout:this.clickoutFeature};if(this.hover){c.over=this.overFeature;c.out=this.outFeature}this.callbacks=OpenLayers.Util.extend(c,this.callbacks);this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})}},initLayer:function(b){if(OpenLayers.Util.isArray(b)){this.layers=b;this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:b})}else{this.layer=b}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer)}OpenLayers.Control.prototype.destroy.apply(this,arguments);if(this.layers){this.layer.destroy()}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)}this.handlers.feature.activate();if(this.box&&this.handlers.box){this.handlers.box.activate()}}return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active){this.handlers.feature.deactivate();if(this.handlers.box){this.handlers.box.deactivate()}if(this.layers){this.map.removeLayer(this.layer)}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(c){var j=this.layers||[this.layer];var g,f;for(var b=0;b<j.length;++b){g=j[b];for(var d=g.selectedFeatures.length-1;d>=0;--d){f=g.selectedFeatures[d];if(!c||c.except!=f){this.unselect(f)}}}},clickFeature:function(b){if(!this.hover){var c=(OpenLayers.Util.indexOf(b.layer.selectedFeatures,b)>-1);if(c){if(this.toggleSelect()){this.unselect(b)}else{if(!this.multipleSelect()){this.unselectAll({except:b})}}}else{if(!this.multipleSelect()){this.unselectAll({except:b})}this.select(b)}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey])},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey])},clickoutFeature:function(b){if(!this.hover&&this.clickout){this.unselectAll()}},overFeature:function(c){var b=c.layer;if(this.hover){if(this.highlightOnly){this.highlight(c)}else{if(OpenLayers.Util.indexOf(b.selectedFeatures,c)==-1){this.select(c)}}}},outFeature:function(b){if(this.hover){if(this.highlightOnly){if(b._lastHighlighter==this.id){if(b._prevHighlighter&&b._prevHighlighter!=this.id){delete b._lastHighlighter;var c=this.map.getControl(b._prevHighlighter);if(c){c.highlight(b)}}else{this.unhighlight(b)}}}else{this.unselect(b)}}},highlight:function(d){var c=d.layer;var b=this.events.triggerEvent("beforefeaturehighlighted",{feature:d});if(b!==false){d._prevHighlighter=d._lastHighlighter;d._lastHighlighter=this.id;var f=this.selectStyle||this.renderIntent;c.drawFeature(d,f);this.events.triggerEvent("featurehighlighted",{feature:d})}},unhighlight:function(c){var b=c.layer;if(c._prevHighlighter==undefined){delete c._lastHighlighter}else{if(c._prevHighlighter==this.id){delete c._prevHighlighter}else{c._lastHighlighter=c._prevHighlighter;delete c._prevHighlighter}}b.drawFeature(c,c.style||c.layer.style||"default");this.events.triggerEvent("featureunhighlighted",{feature:c})},select:function(d){var b=this.onBeforeSelect.call(this.scope,d);var c=d.layer;if(b!==false){b=c.events.triggerEvent("beforefeatureselected",{feature:d});if(b!==false){c.selectedFeatures.push(d);this.highlight(d);if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=c.selectedFeatures[0]}c.events.triggerEvent("featureselected",{feature:d});this.onSelect.call(this.scope,d)}}},unselect:function(c){var b=c.layer;this.unhighlight(c);OpenLayers.Util.removeItem(b.selectedFeatures,c);b.events.triggerEvent("featureunselected",{feature:c});this.onUnselect.call(this.scope,c)},selectBox:function(g){if(g instanceof OpenLayers.Bounds){var m=this.map.getLonLatFromPixel(new OpenLayers.Pixel(g.left,g.bottom));var o=this.map.getLonLatFromPixel(new OpenLayers.Pixel(g.right,g.top));var b=new OpenLayers.Bounds(m.lon,m.lat,o.lon,o.lat);if(!this.multipleSelect()){this.unselectAll()}var n=this.multiple;this.multiple=true;var f=this.layers||[this.layer];var j;for(var c=0;c<f.length;++c){j=f[c];for(var d=0,k=j.features.length;d<k;++d){var p=j.features[d];if(!p.getVisibility()){continue}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,p.geometry.CLASS_NAME)>-1){if(b.toGeometry().intersects(p.geometry)){if(OpenLayers.Util.indexOf(j.selectedFeatures,p)==-1){this.select(p)}}}}}this.multiple=n}},setMap:function(b){this.handlers.feature.setMap(b);if(this.box){this.handlers.box.setMap(b)}OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(c){var b=this.active;this.unselectAll();this.deactivate();if(this.layers){this.layer.destroy();this.layers=null}this.initLayer(c);this.handlers.feature.layer=this.layer;if(b){this.activate()}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry()},setBounds:function(b){if(b){this.bounds=b.clone()}},clearBounds:function(){this.bounds=null;if(this.parent){this.parent.clearBounds()}},extendBounds:function(c){var b=this.getBounds();if(!b){this.setBounds(c)}else{this.bounds.extend(c)}},getBounds:function(){if(this.bounds==null){this.calculateBounds()}return this.bounds},calculateBounds:function(){},distanceTo:function(c,b){},getVertices:function(b){},atPoint:function(g,l,j){var d=false;var f=this.getBounds();if((f!=null)&&(g!=null)){var c=(l!=null)?l:0;var b=(j!=null)?j:0;var k=new OpenLayers.Bounds(this.bounds.left-c,this.bounds.bottom-b,this.bounds.right+c,this.bounds.top+b);d=k.containsLonLat(g)}return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(j){var k=arguments.callee.format;if(!k){k=new OpenLayers.Format.WKT();arguments.callee.format=k}var f;var c=k.read(j);if(c instanceof OpenLayers.Feature.Vector){f=c.geometry}else{if(OpenLayers.Util.isArray(c)){var b=c.length;var g=new Array(b);for(var d=0;d<b;++d){g[d]=c[d].geometry}f=new OpenLayers.Geometry.Collection(g)}}return f};OpenLayers.Geometry.segmentsIntersect=function(b,O,c){var A=c&&c.point;var F=c&&c.tolerance;var k=false;var H=b.x1-O.x1;var M=b.y1-O.y1;var s=b.x2-b.x1;var E=b.y2-b.y1;var B=O.y2-O.y1;var o=O.x2-O.x1;var J=(B*s)-(o*E);var g=(o*M)-(B*H);var f=(s*M)-(E*H);if(J==0){if(g==0&&f==0){k=true}}else{var K=g/J;var I=f/J;if(K>=0&&K<=1&&I>=0&&I<=1){if(!A){k=true}else{var m=b.x1+(K*s);var l=b.y1+(K*E);k=new OpenLayers.Geometry.Point(m,l)}}}if(F){var v;if(k){if(A){var r=[b,O];var G,m,l;outer:for(var D=0;D<2;++D){G=r[D];for(var C=1;C<3;++C){m=G["x"+C];l=G["y"+C];v=Math.sqrt(Math.pow(m-k.x,2)+Math.pow(l-k.y,2));if(v<F){k.x=m;k.y=l;break outer}}}}}else{var r=[b,O];var u,N,m,l,q,n;outer:for(var D=0;D<2;++D){u=r[D];N=r[(D+1)%2];for(var C=1;C<3;++C){q={x:u["x"+C],y:u["y"+C]};n=OpenLayers.Geometry.distanceToSegment(q,N);if(n.distance<F){if(A){k=new OpenLayers.Geometry.Point(q.x,q.y)}else{k=true}break outer}}}}}return k};OpenLayers.Geometry.distanceToSegment=function(o,f){var d=o.x;var n=o.y;var c=f.x1;var m=f.y1;var b=f.x2;var j=f.y2;var q=b-c;var p=j-m;var l=((q*(d-c))+(p*(n-m)))/(Math.pow(q,2)+Math.pow(p,2));var k,g;if(l<=0){k=c;g=m}else{if(l>=1){k=b;g=j}else{k=c+l*q;g=m+l*p}}return{distance:Math.sqrt(Math.pow(k-d,2)+Math.pow(g-n,2)),x:k,y:g}};OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];if(b!=null){this.addComponents(b)}},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");for(var i=0,len=this.components.length;i<len;i++){geometry.addComponent(this.components[i].clone())}OpenLayers.Util.applyDefaults(geometry,this);return geometry},getComponentsString:function(){var c=[];for(var d=0,b=this.components.length;d<b;d++){c.push(this.components[d].toShortString())}return c.join(",")},calculateBounds:function(){this.bounds=null;var f=new OpenLayers.Bounds();var d=this.components;if(d){for(var c=0,b=d.length;c<b;c++){f.extend(d[c].getBounds())}}if(f.left!=null&&f.bottom!=null&&f.right!=null&&f.top!=null){this.setBounds(f)}},addComponents:function(d){if(!(OpenLayers.Util.isArray(d))){d=[d]}for(var c=0,b=d.length;c<b;c++){this.addComponent(d[c])}},addComponent:function(c,b){var f=false;if(c){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,c.CLASS_NAME)>-1)){if(b!=null&&(b<this.components.length)){var g=this.components.slice(0,b);var d=this.components.slice(b,this.components.length);g.push(c);this.components=g.concat(d)}else{this.components.push(c)}c.parent=this;this.clearBounds();f=true}}return f},removeComponents:function(c){var d=false;if(!(OpenLayers.Util.isArray(c))){c=[c]}for(var b=c.length-1;b>=0;--b){d=this.removeComponent(c[b])||d}return d},removeComponent:function(b){OpenLayers.Util.removeItem(this.components,b);this.clearBounds();return true},getLength:function(){var d=0;for(var c=0,b=this.components.length;c<b;c++){d+=this.components[c].getLength()}return d},getArea:function(){var d=0;for(var c=0,b=this.components.length;c<b;c++){d+=this.components[c].getArea()}return d},getGeodesicArea:function(c){var f=0;for(var d=0,b=this.components.length;d<b;d++){f+=this.components[d].getGeodesicArea(c)}return f},getCentroid:function(k){if(!k){return this.components.length&&this.components[0].getCentroid()}var o=this.components.length;if(!o){return false}var c=[];var d=[];var f=0;var l=Number.MAX_VALUE;var p;for(var n=0;n<o;++n){p=this.components[n];var g=p.getArea();var j=p.getCentroid(true);if(isNaN(g)||isNaN(j.x)||isNaN(j.y)){continue}c.push(g);f+=g;l=(g<l&&g>0)?g:l;d.push(j)}o=c.length;if(f===0){for(var n=0;n<o;++n){c[n]=1}f=c.length}else{for(var n=0;n<o;++n){c[n]/=l}f/=l}var m=0,b=0,j,g;for(var n=0;n<o;++n){j=d[n];g=c[n];m+=j.x*g;b+=j.y*g}return new OpenLayers.Geometry.Point(m/f,b/f)},getGeodesicLength:function(c){var f=0;for(var d=0,b=this.components.length;d<b;d++){f+=this.components[d].getGeodesicLength(c)}return f},move:function(c,f){for(var d=0,b=this.components.length;d<b;d++){this.components[d].move(c,f)}},rotate:function(f,c){for(var d=0,b=this.components.length;d<b;++d){this.components[d].rotate(f,c)}},resize:function(f,b,d){for(var c=0;c<this.components.length;++c){this.components[c].resize(f,b,d)}return this},distanceTo:function(l,m){var d=!(m&&m.edge===false);var b=d&&m&&m.details;var n,f,c;var g=Number.POSITIVE_INFINITY;for(var j=0,k=this.components.length;j<k;++j){n=this.components[j].distanceTo(l,m);c=b?n.distance:n;if(c<g){g=c;f=n;if(g==0){break}}}return f},equals:function(f){var c=true;if(!f||!f.CLASS_NAME||(this.CLASS_NAME!=f.CLASS_NAME)){c=false}else{if(!(OpenLayers.Util.isArray(f.components))||(f.components.length!=this.components.length)){c=false}else{for(var d=0,b=this.components.length;d<b;++d){if(!this.components[d].equals(f.components[d])){c=false;break}}}}return c},transform:function(g,d){if(g&&d){for(var f=0,b=this.components.length;f<b;f++){var c=this.components[f];c.transform(g,d)}this.bounds=null}return this},intersects:function(f){var c=false;for(var d=0,b=this.components.length;d<b;++d){c=f.intersects(this.components[d]);if(c){break}}return c},getVertices:function(c){var d=[];for(var f=0,b=this.components.length;f<b;++f){Array.prototype.push.apply(d,this.components[f].getVertices(c))}return d},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(b,c){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(b);this.y=parseFloat(c)},clone:function(b){if(b==null){b=new OpenLayers.Geometry.Point(this.x,this.y)}OpenLayers.Util.applyDefaults(b,this);return b},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(j,n){var f=!(n&&n.edge===false);var b=f&&n&&n.details;var c,g,l,d,k,m;if(j instanceof OpenLayers.Geometry.Point){g=this.x;l=this.y;d=j.x;k=j.y;c=Math.sqrt(Math.pow(g-d,2)+Math.pow(l-k,2));m=!b?c:{x0:g,y0:l,x1:d,y1:k,distance:c}}else{m=j.distanceTo(this,n);if(b){m={x0:m.x1,y0:m.y1,x1:m.x0,y1:m.y0,distance:m.distance}}}return m},equals:function(b){var c=false;if(b!=null){c=((this.x==b.x&&this.y==b.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(b.x)&&isNaN(b.y)))}return c},toShortString:function(){return(this.x+", "+this.y)},move:function(b,c){this.x=this.x+b;this.y=this.y+c;this.clearBounds()},rotate:function(f,c){f*=Math.PI/180;var b=this.distanceTo(c);var d=f+Math.atan2(this.y-c.y,this.x-c.x);this.x=c.x+(b*Math.cos(d));this.y=c.y+(b*Math.sin(d));this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(d,b,c){c=(c==undefined)?1:c;this.x=b.x+(d*c*(this.x-b.x));this.y=b.y+(d*(this.y-b.y));this.clearBounds();return this},intersects:function(c){var b=false;if(c.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.equals(c)}else{b=c.intersects(this)}return b},transform:function(c,b){if((c&&b)){OpenLayers.Projection.transform(this,c,b);this.bounds=null}return this},getVertices:function(b){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(b){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},addPoint:function(b,c){this.addComponent(b,c)},removePoint:function(b){this.removeComponent(b)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(b){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)},getLength:function(){var d=0;if(this.components&&(this.components.length>1)){for(var c=1,b=this.components.length;c<b;c++){d+=this.components[c-1].distanceTo(this.components[c])}}return d},getGeodesicLength:function(c){var g=this;if(c){var d=new OpenLayers.Projection("EPSG:4326");if(!d.equals(c)){g=this.clone().transform(c,d)}}var j=0;if(g.components&&(g.components.length>1)){var l,k;for(var f=1,b=g.components.length;f<b;f++){l=g.components[f-1];k=g.components[f];j+=OpenLayers.Util.distVincenty({lon:l.x,lat:l.y},{lon:k.x,lat:k.y})}}return j*1000},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(b){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(b){var c=this.components&&(this.components.length>2);if(c){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)}return c},intersects:function(p){var d=false;var o=p.CLASS_NAME;if(o=="OpenLayers.Geometry.LineString"||o=="OpenLayers.Geometry.LinearRing"||o=="OpenLayers.Geometry.Point"){var s=this.getSortedSegments();var q;if(o=="OpenLayers.Geometry.Point"){q=[{x1:p.x,y1:p.y,x2:p.x,y2:p.y}]}else{q=p.getSortedSegments()}var A,l,g,b,v,u,f,c;outer:for(var m=0,n=s.length;m<n;++m){A=s[m];l=A.x1;g=A.x2;b=A.y1;v=A.y2;inner:for(var k=0,r=q.length;k<r;++k){u=q[k];if(u.x1>g){break}if(u.x2<l){continue}f=u.y1;c=u.y2;if(Math.min(f,c)>Math.max(b,v)){continue}if(Math.max(f,c)<Math.min(b,v)){continue}if(OpenLayers.Geometry.segmentsIntersect(A,u)){d=true;break outer}}}}else{d=p.intersects(this)}return d},getSortedSegments:function(){var b=this.components.length-1;var c=new Array(b),g,f;for(var d=0;d<b;++d){g=this.components[d];f=this.components[d+1];if(g.x<f.x){c[d]={x1:g.x,y1:g.y,x2:f.x,y2:f.y}}else{c[d]={x1:f.x,y1:f.y,x2:g.x,y2:g.y}}}function j(l,k){return l.x1-k.x1}return c.sort(j)},splitWithSegment:function(v,c){var d=!(c&&c.edge===false);var r=c&&c.tolerance;var b=[];var B=this.getVertices();var q=[];var D=[];var l=false;var g,f,o;var m,u,C;var j={point:true,tolerance:r};var k=null;for(var p=0,n=B.length-2;p<=n;++p){g=B[p];q.push(g.clone());f=B[p+1];C={x1:g.x,y1:g.y,x2:f.x,y2:f.y};o=OpenLayers.Geometry.segmentsIntersect(v,C,j);if(o instanceof OpenLayers.Geometry.Point){if((o.x===v.x1&&o.y===v.y1)||(o.x===v.x2&&o.y===v.y2)||o.equals(g)||o.equals(f)){u=true}else{u=false}if(u||d){if(!o.equals(D[D.length-1])){D.push(o.clone())}if(p===0){if(o.equals(g)){continue}}if(o.equals(f)){continue}l=true;if(!o.equals(g)){q.push(o)}b.push(new OpenLayers.Geometry.LineString(q));q=[o.clone()]}}}if(l){q.push(f.clone());b.push(new OpenLayers.Geometry.LineString(q))}if(D.length>0){var s=v.x1<v.x2?1:-1;var A=v.y1<v.y2?1:-1;k={lines:b,points:D.sort(function(F,E){return(s*F.x-s*E.x)||(A*F.y-A*E.y)})}}return k},split:function(F,c){var q=null;var f=c&&c.mutual;var o,g,p,d;if(F instanceof OpenLayers.Geometry.LineString){var E=this.getVertices();var m,l,D,n,b,s;var A=[];p=[];for(var B=0,r=E.length-2;B<=r;++B){m=E[B];l=E[B+1];D={x1:m.x,y1:m.y,x2:l.x,y2:l.y};d=d||[F];if(f){A.push(m.clone())}for(var v=0;v<d.length;++v){n=d[v].splitWithSegment(D,c);if(n){b=n.lines;if(b.length>0){b.unshift(v,1);Array.prototype.splice.apply(d,b);v+=b.length-2}if(f){for(var u=0,C=n.points.length;u<C;++u){s=n.points[u];if(!s.equals(m)){A.push(s);p.push(new OpenLayers.Geometry.LineString(A));if(s.equals(l)){A=[]}else{A=[s.clone()]}}}}}}}if(f&&p.length>0&&A.length>0){A.push(l.clone());p.push(new OpenLayers.Geometry.LineString(A))}}else{q=F.splitWith(this,c)}if(d&&d.length>1){g=true}else{d=[]}if(p&&p.length>1){o=true}else{p=[]}if(g||o){if(f){q=[p,d]}else{q=d}}return q},splitWith:function(c,b){return c.split(this,b)},getVertices:function(b){var c;if(b===true){c=[this.components[0],this.components[this.components.length-1]]}else{if(b===false){c=this.components.slice(1,this.components.length-1)}else{c=this.components.slice()}}return c},distanceTo:function(m,l){var n=!(l&&l.edge===false);var H=n&&l&&l.details;var u,g={};var B=Number.POSITIVE_INFINITY;if(m instanceof OpenLayers.Geometry.Point){var v=this.getSortedSegments();var s=m.x;var r=m.y;var F;for(var D=0,E=v.length;D<E;++D){F=v[D];u=OpenLayers.Geometry.distanceToSegment(m,F);if(u.distance<B){B=u.distance;g=u;if(B===0){break}}else{if(F.x2>s&&((r>F.y1&&r<F.y2)||(r<F.y1&&r>F.y2))){break}}}if(H){g={distance:g.distance,x0:g.x,y0:g.y,x1:s,y1:r}}else{g=g.distance}}else{if(m instanceof OpenLayers.Geometry.LineString){var f=this.getSortedSegments();var d=m.getSortedSegments();var c,b,q,G,k;var p=d.length;var o={point:true};outer:for(var D=0,E=f.length;D<E;++D){c=f[D];G=c.x1;k=c.y1;for(var C=0;C<p;++C){b=d[C];q=OpenLayers.Geometry.segmentsIntersect(c,b,o);if(q){B=0;g={distance:0,x0:q.x,y0:q.y,x1:q.x,y1:q.y};break outer}else{u=OpenLayers.Geometry.distanceToSegment({x:G,y:k},b);if(u.distance<B){B=u.distance;g={distance:B,x0:G,y0:k,x1:u.x,y1:u.y}}}}}if(!H){g=g.distance}if(B!==0){if(c){u=m.distanceTo(new OpenLayers.Geometry.Point(c.x2,c.y2),l);var A=H?u.distance:u;if(A<B){if(H){g={distance:B,x0:u.x1,y0:u.y1,x1:u.x0,y1:u.y0}}else{g=A}}}}}else{g=m.distanceTo(this,l);if(H){g={distance:g.distance,x0:g.x1,y0:g.y1,x1:g.x0,y1:g.y0}}}}return g},simplify:function(l){if(this&&this!==null){var n=this.getVertices();if(n.length<3){return this}var f=function(p,o){return(p-o)};var d=function(r,v,s,o){var u=0;var q=0;for(var p=v,A;p<s;p++){A=c(r[v],r[s],r[p]);if(A>u){u=A;q=p}}if(u>o&&q!=v){g.push(q);d(r,v,q,o);d(r,q,s,o)}};var c=function(s,r,p){var u=Math.abs(0.5*(s.x*r.y+r.x*p.y+p.x*s.y-r.x*s.y-p.x*r.y-s.x*p.y));var q=Math.sqrt(Math.pow(s.x-r.x,2)+Math.pow(s.y-r.y,2));var o=u/q*2;return o};var j=0;var m=n.length-1;var g=[];g.push(j);g.push(m);while(n[j].equals(n[m])){m--;g.push(m)}d(n,j,m,l);var b=[];g.sort(f);for(var k=0;k<g.length;k++){b.push(n[g[k]])}return new OpenLayers.Geometry.LineString(b)}else{return this}},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(b){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments)},addComponent:function(b,c){var d=false;var f=this.components.pop();if(c!=null||!b.equals(f)){d=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)}var g=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[g]);return d},removeComponent:function(b){var c=this.components&&(this.components.length>3);if(c){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var d=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[d])}return c},move:function(c,f){for(var d=0,b=this.components.length;d<b-1;d++){this.components[d].move(c,f)}},rotate:function(f,c){for(var d=0,b=this.components.length;d<b-1;++d){this.components[d].rotate(f,c)}},resize:function(g,c,f){for(var d=0,b=this.components.length;d<b-1;++d){this.components[d].resize(g,c,f)}return this},transform:function(g,d){if(g&&d){for(var f=0,b=this.components.length;f<b-1;f++){var c=this.components[f];c.transform(g,d)}this.bounds=null}return this},getCentroid:function(){if(this.components&&(this.components.length>2)){var l=0;var k=0;for(var g=0;g<this.components.length-1;g++){var f=this.components[g];var n=this.components[g+1];l+=(f.x+n.x)*(f.x*n.y-n.x*f.y);k+=(f.y+n.y)*(f.x*n.y-n.x*f.y)}var j=-1*this.getArea();var d=l/(6*j);var m=k/(6*j);return new OpenLayers.Geometry.Point(d,m)}else{return null}},getArea:function(){var k=0;if(this.components&&(this.components.length>2)){var j=0;for(var g=0,f=this.components.length;g<f-1;g++){var d=this.components[g];var l=this.components[g+1];j+=(d.x+l.x)*(l.y-d.y)}k=-j/2}return k},getGeodesicArea:function(c){var f=this;if(c){var d=new OpenLayers.Projection("EPSG:4326");if(!d.equals(c)){f=this.clone().transform(c,d)}}var j=0;var b=f.components&&f.components.length;if(b>2){var l,k;for(var g=0;g<b-1;g++){l=f.components[g];k=f.components[g+1];j+=OpenLayers.Util.rad(k.x-l.x)*(2+Math.sin(OpenLayers.Util.rad(l.y))+Math.sin(OpenLayers.Util.rad(k.y)))}j=j*6378137*6378137/2}return j},containsPoint:function(p){var A=OpenLayers.Number.limitSigDigs;var o=14;var n=A(p.x,o);var m=A(p.y,o);function v(F,C,E,B,D){return(((C-B)*F)+((B*E)-(C*D)))/(E-D)}var b=this.components.length-1;var k,j,u,f,r,c,g,d;var l=0;for(var q=0;q<b;++q){k=this.components[q];u=A(k.x,o);f=A(k.y,o);j=this.components[q+1];r=A(j.x,o);c=A(j.y,o);if(f==c){if(m==f){if(u<=r&&(n>=u&&n<=r)||u>=r&&(n<=u&&n>=r)){l=-1;break}}continue}g=A(v(m,u,f,r,c),o);if(g==n){if(f<c&&(m>=f&&m<=c)||f>c&&(m<=f&&m>=c)){l=-1;break}}if(g<=n){continue}if(u!=r&&(g<Math.min(u,r)||g>Math.max(u,r))){continue}if(f<c&&(m>=f&&m<c)||f>c&&(m<f&&m>=c)){++l}}var s=(l==-1)?1:!!(l&1);return s},intersects:function(f){var c=false;if(f.CLASS_NAME=="OpenLayers.Geometry.Point"){c=this.containsPoint(f)}else{if(f.CLASS_NAME=="OpenLayers.Geometry.LineString"){c=f.intersects(this)}else{if(f.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){c=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[f])}else{for(var d=0,b=f.components.length;d<b;++d){c=f.components[d].intersects(this);if(c){break}}}}}return c},getVertices:function(b){return(b===true)?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(b){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},getArea:function(){var d=0;if(this.components&&(this.components.length>0)){d+=Math.abs(this.components[0].getArea());for(var c=1,b=this.components.length;c<b;c++){d-=Math.abs(this.components[c].getArea())}}return d},getGeodesicArea:function(c){var f=0;if(this.components&&(this.components.length>0)){f+=Math.abs(this.components[0].getGeodesicArea(c));for(var d=1,b=this.components.length;d<b;d++){f-=Math.abs(this.components[d].getGeodesicArea(c))}}return f},containsPoint:function(b){var g=this.components.length;var d=false;if(g>0){d=this.components[0].containsPoint(b);if(d!==1){if(d&&g>1){var f;for(var c=1;c<g;++c){f=this.components[c].containsPoint(b);if(f){if(f===1){d=1}else{d=false}break}}}}}return d},intersects:function(g){var c=false;var f,b;if(g.CLASS_NAME=="OpenLayers.Geometry.Point"){c=this.containsPoint(g)}else{if(g.CLASS_NAME=="OpenLayers.Geometry.LineString"||g.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(f=0,b=this.components.length;f<b;++f){c=g.intersects(this.components[f]);if(c){break}}if(!c){for(f=0,b=g.components.length;f<b;++f){c=this.containsPoint(g.components[f]);if(c){break}}}}else{for(f=0,b=g.components.length;f<b;++f){c=this.intersects(g.components[f]);if(c){break}}}}if(!c&&g.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var d=this.components[0];for(f=0,b=d.components.length;f<b;++f){c=g.containsPoint(d.components[f]);if(c){break}}}return c},distanceTo:function(f,c){var d=!(c&&c.edge===false);var b;if(!d&&this.intersects(f)){b=0}else{b=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[f,c])}return b},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(m,j,c,o){var d=Math.PI*((1/c)-(1/2));if(o){d+=(o/180)*Math.PI}var b,l,k;var n=[];for(var g=0;g<c;++g){b=d+(g*2*Math.PI/c);l=m.x+(j*Math.cos(b));k=m.y+(j*Math.sin(b));n.push(new OpenLayers.Geometry.Point(l,k))}var f=new OpenLayers.Geometry.LinearRing(n);return new OpenLayers.Geometry.Polygon([f])};OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,initialize:function(b,c){this.container=OpenLayers.Util.getElement(b);OpenLayers.Util.extend(this,c)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return false},setExtent:function(b,c){this.extent=b.clone();if(c){this.resolution=null}},setSize:function(b){this.size=b.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(d,g){if(g==null){g=d.style}if(d.geometry){var j=d.geometry.getBounds();if(j){if(!j.intersectsBounds(this.extent)){g={display:"none"}}var l=this.drawGeometry(d.geometry,g,d.id);if(g.display!="none"&&g.label&&l!==false){var b=d.geometry.getCentroid();if(g.labelXOffset||g.labelYOffset){var f=isNaN(g.labelXOffset)?0:g.labelXOffset;var k=isNaN(g.labelYOffset)?0:g.labelYOffset;var c=this.getResolution();b.move(f*c,k*c)}this.drawText(d.id,g,b)}else{this.removeText(d.id)}return l}}},drawGeometry:function(d,b,c){},drawText:function(d,c,b){},removeText:function(b){},clear:function(){},getFeatureIdFromEvent:function(b){},eraseFeatures:function(f){if(!(OpenLayers.Util.isArray(f))){f=[f]}for(var d=0,b=f.length;d<b;++d){var c=f[d];this.eraseGeometry(c.geometry,c.id);this.removeText(c.id)}},eraseGeometry:function(c,b){},moveRoot:function(b){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(c){var b=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(c.stroke===false){delete b.strokeWidth;delete b.strokeColor}if(c.fill===false){delete b.fillColor}OpenLayers.Util.extend(b,c);return b},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0};OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(b){this.compare=b?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(d){if(this.exists(d)){this.remove(d)}var j=d.id;this.determineZIndex(d);var f=-1;var g=this.order.length;var b;while(g-f>1){b=parseInt((f+g)/2);var c=this.compare(this,d,OpenLayers.Util.getElement(this.order[b]));if(c>0){f=b}else{g=b}}this.order.splice(g,0,j);this.indices[j]=this.getZIndex(d);return this.getNextElement(g)},remove:function(c){var f=c.id;var b=OpenLayers.Util.indexOf(this.order,f);if(b>=0){this.order.splice(b,1);delete this.indices[f];if(this.order.length>0){var d=this.order[this.order.length-1];this.maxZIndex=this.indices[d]}else{this.maxZIndex=0}}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(b){return(this.indices[b.id]!=null)},getZIndex:function(b){return b._style.graphicZIndex},determineZIndex:function(b){var c=b._style.graphicZIndex;if(c==null){c=this.maxZIndex;b._style.graphicZIndex=c}else{if(c>this.maxZIndex){this.maxZIndex=c}}},getNextElement:function(c){var b=c+1;if(b<this.order.length){var d=OpenLayers.Util.getElement(this.order[b]);if(d==undefined){d=this.getNextElement(b)}return d}else{return null}},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(g,f,c){var b=g.getZIndex(f);var j=0;if(c){var d=g.getZIndex(c);j=b-d}return j},Z_ORDER_DRAWING_ORDER:function(d,c,b){var f=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(d,c,b);if(b&&f==0){f=1}return f},Z_ORDER_Y_ORDER:function(f,d,c){var g=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(f,d,c);if(c&&g===0){var b=c._boundsBottom-d._boundsBottom;g=(b===0)?1:b}return g}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(b,c){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);if(c&&(c.zIndexing||c.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(c.yOrdering)}},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var c;var b=this.vectorRoot;if(b){while(c=b.firstChild){b.removeChild(c)}}b=this.textRoot;if(b){while(c=b.firstChild){b.removeChild(c)}}if(this.indexer){this.indexer.clear()}},getNodeType:function(c,b){},drawGeometry:function(m,b,f){var l=m.CLASS_NAME;var d=true;if((l=="OpenLayers.Geometry.Collection")||(l=="OpenLayers.Geometry.MultiPoint")||(l=="OpenLayers.Geometry.MultiLineString")||(l=="OpenLayers.Geometry.MultiPolygon")){for(var j=0,k=m.components.length;j<k;j++){d=this.drawGeometry(m.components[j],b,f)&&d}return d}d=false;var g=false;if(b.display!="none"){if(b.backgroundGraphic){this.redrawBackgroundNode(m.id,m,b,f)}else{g=true}d=this.redrawNode(m.id,m,b,f)}if(d==false){var c=document.getElementById(m.id);if(c){if(c._style.backgroundGraphic){g=true}c.parentNode.removeChild(c)}}if(g){var c=document.getElementById(m.id+this.BACKGROUND_ID_SUFFIX);if(c){c.parentNode.removeChild(c)}}return d},redrawNode:function(k,j,c,g){c=this.applyDefaultSymbolizer(c);var d=this.nodeFactory(k,this.getNodeType(j,c));d._featureId=g;d._boundsBottom=j.getBounds().bottom;d._geometryClass=j.CLASS_NAME;d._style=c;var b=this.drawGeometryNode(d,j,c);if(b===false){return false}d=b.node;if(this.indexer){var f=this.indexer.insert(d);if(f){this.vectorRoot.insertBefore(d,f)}else{this.vectorRoot.appendChild(d)}}else{if(d.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(d)}}this.postDraw(d);return b.complete},redrawBackgroundNode:function(g,f,c,d){var b=OpenLayers.Util.extend({},c);b.externalGraphic=b.backgroundGraphic;b.graphicXOffset=b.backgroundXOffset;b.graphicYOffset=b.backgroundYOffset;b.graphicZIndex=b.backgroundGraphicZIndex;b.graphicWidth=b.backgroundWidth||b.graphicWidth;b.graphicHeight=b.backgroundHeight||b.graphicHeight;b.backgroundGraphic=null;b.backgroundXOffset=null;b.backgroundYOffset=null;b.backgroundGraphicZIndex=null;return this.redrawNode(g+this.BACKGROUND_ID_SUFFIX,f,b,null)},drawGeometryNode:function(d,g,c){c=c||d._style;var b={isFilled:c.fill===undefined?true:c.fill,isStroked:c.stroke===undefined?!!c.strokeWidth:c.stroke};var f;switch(g.CLASS_NAME){case"OpenLayers.Geometry.Point":if(c.graphic===false){b.isFilled=false;b.isStroked=false}f=this.drawPoint(d,g);break;case"OpenLayers.Geometry.LineString":b.isFilled=false;f=this.drawLineString(d,g);break;case"OpenLayers.Geometry.LinearRing":f=this.drawLinearRing(d,g);break;case"OpenLayers.Geometry.Polygon":f=this.drawPolygon(d,g);break;case"OpenLayers.Geometry.Surface":f=this.drawSurface(d,g);break;case"OpenLayers.Geometry.Rectangle":f=this.drawRectangle(d,g);break;default:break}d._options=b;if(f!=false){return{node:this.setStyle(d,c,b,g),complete:f}}else{return false}},postDraw:function(b){},drawPoint:function(b,c){},drawLineString:function(b,c){},drawLinearRing:function(b,c){},drawPolygon:function(b,c){},drawRectangle:function(b,c){},drawCircle:function(b,c){},drawSurface:function(b,c){},removeText:function(c){var b=document.getElementById(c+this.LABEL_ID_SUFFIX);if(b){this.textRoot.removeChild(b)}},getFeatureIdFromEvent:function(b){var f=b.target;var c=f&&f.correspondingUseElement;var d=c?c:(f||b.srcElement);var g=d._featureId;return g},eraseGeometry:function(k,j){if((k.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(k.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(k.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(k.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var f=0,b=k.components.length;f<b;f++){this.eraseGeometry(k.components[f],j)}}else{var d=OpenLayers.Util.getElement(k.id);if(d&&d.parentNode){if(d.geometry){d.geometry.destroy();d.geometry=null}d.parentNode.removeChild(d);if(this.indexer){this.indexer.remove(d)}if(d._style.backgroundGraphic){var c=k.id+this.BACKGROUND_ID_SUFFIX;var g=OpenLayers.Util.getElement(c);if(g&&g.parentNode){g.parentNode.removeChild(g)}}}}},nodeFactory:function(d,b){var c=OpenLayers.Util.getElement(d);if(c){if(!this.nodeTypeCompare(c,b)){c.parentNode.removeChild(c);c=this.nodeFactory(d,b)}}else{c=this.createNode(b,d)}return c},nodeTypeCompare:function(c,b){},createNode:function(b,c){},moveRoot:function(c){var b=this.root;if(c.root.parentNode==this.rendererRoot){b=c.root}b.parentNode.removeChild(b);c.rendererRoot.appendChild(b)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(b){return(b!="circle")&&!!b},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(b){if(!this.supported()){return}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.symbolMetrics={}},supported:function(){var b="http://www.w3.org/TR/SVG11/feature#";return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(b+"SVG","1.1")||document.implementation.hasFeature(b+"BasicStructure","1.1")))},inValidRange:function(b,g,c){var f=b+(c?0:this.translationParameters.x);var d=g+(c?0:this.translationParameters.y);return(f>=-this.MAX_PIXEL&&f<=this.MAX_PIXEL&&d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL)},setExtent:function(c,f){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var b=this.getResolution();var j=-c.left/b;var g=c.top/b;if(f){this.left=j;this.top=g;var d="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",d);this.translate(0,0);return true}else{var k=this.translate(j-this.left,g-this.top);if(!k){this.setExtent(c,true)}return k}},translate:function(b,d){if(!this.inValidRange(b,d,true)){return false}else{var c="";if(b||d){c="translate("+b+","+d+")"}this.root.setAttributeNS(null,"transform",c);this.translationParameters={x:b,y:d};return true}},setSize:function(b){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(d,c){var b=null;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":if(c.externalGraphic){b="image"}else{if(this.isComplexSymbol(c.graphicName)){b="svg"}else{b="circle"}}break;case"OpenLayers.Geometry.Rectangle":b="rect";break;case"OpenLayers.Geometry.LineString":b="polyline";break;case"OpenLayers.Geometry.LinearRing":b="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":b="path";break;default:break}return b},setStyle:function(u,B,c){B=B||u._style;c=c||u._options;var o=parseFloat(u.getAttributeNS(null,"r"));var n=1;var f;if(u._geometryClass=="OpenLayers.Geometry.Point"&&o){u.style.visibility="";if(B.graphic===false){u.style.visibility="hidden"}else{if(B.externalGraphic){f=this.getPosition(u);if(B.graphicTitle){u.setAttributeNS(null,"title",B.graphicTitle);var j=this.nodeFactory(null,"title");j.textContent=B.graphicTitle;u.appendChild(j)}if(B.graphicWidth&&B.graphicHeight){u.setAttributeNS(null,"preserveAspectRatio","none")}var s=B.graphicWidth||B.graphicHeight;var q=B.graphicHeight||B.graphicWidth;s=s?s:B.pointRadius*2;q=q?q:B.pointRadius*2;var C=(B.graphicXOffset!=undefined)?B.graphicXOffset:-(0.5*s);var k=(B.graphicYOffset!=undefined)?B.graphicYOffset:-(0.5*q);var b=B.graphicOpacity||B.fillOpacity;u.setAttributeNS(null,"x",(f.x+C).toFixed());u.setAttributeNS(null,"y",(f.y+k).toFixed());u.setAttributeNS(null,"width",s);u.setAttributeNS(null,"height",q);u.setAttributeNS(this.xlinkns,"href",B.externalGraphic);u.setAttributeNS(null,"style","opacity: "+b);u.onclick=OpenLayers.Renderer.SVG.preventDefault}else{if(this.isComplexSymbol(B.graphicName)){var d=B.pointRadius*3;var p=d*2;var g=this.importSymbol(B.graphicName);f=this.getPosition(u);n=this.symbolMetrics[g.id][0]*3/p;var l=u.parentNode;var m=u.nextSibling;if(l){l.removeChild(u)}u.firstChild&&u.removeChild(u.firstChild);u.appendChild(g.firstChild.cloneNode(true));u.setAttributeNS(null,"viewBox",g.getAttributeNS(null,"viewBox"));u.setAttributeNS(null,"width",p);u.setAttributeNS(null,"height",p);u.setAttributeNS(null,"x",f.x-d);u.setAttributeNS(null,"y",f.y-d);if(m){l.insertBefore(u,m)}else{if(l){l.appendChild(u)}}}else{u.setAttributeNS(null,"r",B.pointRadius)}}}var A=B.rotation;if((A!==undefined||u._rotation!==undefined)&&f){u._rotation=A;A|=0;if(u.nodeName!=="svg"){u.setAttributeNS(null,"transform","rotate("+A+" "+f.x+" "+f.y+")")}else{var v=this.symbolMetrics[g.id];u.firstChild.setAttributeNS(null,"transform","rotate("+A+" "+v[1]+" "+v[2]+")")}}}if(c.isFilled){u.setAttributeNS(null,"fill",B.fillColor);u.setAttributeNS(null,"fill-opacity",B.fillOpacity)}else{u.setAttributeNS(null,"fill","none")}if(c.isStroked){u.setAttributeNS(null,"stroke",B.strokeColor);u.setAttributeNS(null,"stroke-opacity",B.strokeOpacity);u.setAttributeNS(null,"stroke-width",B.strokeWidth*n);u.setAttributeNS(null,"stroke-linecap",B.strokeLinecap||"round");u.setAttributeNS(null,"stroke-linejoin","round");B.strokeDashstyle&&u.setAttributeNS(null,"stroke-dasharray",this.dashStyle(B,n))}else{u.setAttributeNS(null,"stroke","none")}if(B.pointerEvents){u.setAttributeNS(null,"pointer-events",B.pointerEvents)}if(B.cursor!=null){u.setAttributeNS(null,"cursor",B.cursor)}return u},dashStyle:function(d,c){var b=d.strokeWidth*c;var f=d.strokeDashstyle;switch(f){case"solid":return"none";case"dot":return[1,4*b].join();case"dash":return[4*b,4*b].join();case"dashdot":return[4*b,4*b,1,4*b].join();case"longdash":return[8*b,4*b].join();case"longdashdot":return[8*b,4*b,1,4*b].join();default:return OpenLayers.String.trim(f).replace(/\s+/g,",")}},createNode:function(b,d){var c=document.createElementNS(this.xmlns,b);if(d){c.setAttributeNS(null,"id",d)}return c},nodeTypeCompare:function(c,b){return(b==c.nodeName)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(b){return this.nodeFactory(this.container.id+b,"g")},createDefs:function(){var b=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(b);return b},drawPoint:function(b,c){return this.drawCircle(b,c,1)},drawCircle:function(f,g,c){var d=this.getResolution();var b=(g.x/d+this.left);var j=(this.top-g.y/d);if(this.inValidRange(b,j)){f.setAttributeNS(null,"cx",b);f.setAttributeNS(null,"cy",j);f.setAttributeNS(null,"r",c);return f}else{return false}},drawLineString:function(c,d){var b=this.getComponentsString(d.components);if(b.path){c.setAttributeNS(null,"points",b.path);return(b.complete?c:null)}else{return false}},drawLinearRing:function(c,d){var b=this.getComponentsString(d.components);if(b.path){c.setAttributeNS(null,"points",b.path);return(b.complete?c:null)}else{return false}},drawPolygon:function(c,m){var l="";var n=true;var b=true;var f,o;for(var g=0,k=m.components.length;g<k;g++){l+=" M";f=this.getComponentsString(m.components[g].components," ");o=f.path;if(o){l+=" "+o;b=f.complete&&b}else{n=false}}l+=" z";if(n){c.setAttributeNS(null,"d",l);c.setAttributeNS(null,"fill-rule","evenodd");return b?c:null}else{return false}},drawRectangle:function(d,f){var c=this.getResolution();var b=(f.x/c+this.left);var g=(this.top-f.y/c);if(this.inValidRange(b,g)){d.setAttributeNS(null,"x",b);d.setAttributeNS(null,"y",g);d.setAttributeNS(null,"width",f.width/c);d.setAttributeNS(null,"height",f.height/c);return d}else{return false}},drawSurface:function(j,l){var k=null;var c=true;for(var g=0,b=l.components.length;g<b;g++){if((g%3)==0&&(g/3)==0){var f=this.getShortString(l.components[g]);if(!f){c=false}k="M "+f}else{if((g%3)==1){var f=this.getShortString(l.components[g]);if(!f){c=false}k+=" C "+f}else{var f=this.getShortString(l.components[g]);if(!f){c=false}k+=" "+f}}}k+=" Z";if(c){j.setAttributeNS(null,"d",k);return j}else{return false}},drawText:function(g,b,q){var c=this.getResolution();var p=(q.x/c+this.left);var m=(q.y/c-this.top);var o=this.nodeFactory(g+this.LABEL_ID_SUFFIX,"text");o.setAttributeNS(null,"x",p);o.setAttributeNS(null,"y",-m);if(b.fontColor){o.setAttributeNS(null,"fill",b.fontColor)}if(b.fontOpacity){o.setAttributeNS(null,"opacity",b.fontOpacity)}if(b.fontFamily){o.setAttributeNS(null,"font-family",b.fontFamily)}if(b.fontSize){o.setAttributeNS(null,"font-size",b.fontSize)}if(b.fontWeight){o.setAttributeNS(null,"font-weight",b.fontWeight)}if(b.fontStyle){o.setAttributeNS(null,"font-style",b.fontStyle)}if(b.labelSelect===true){o.setAttributeNS(null,"pointer-events","visible");o._featureId=g}else{o.setAttributeNS(null,"pointer-events","none")}var k=b.labelAlign||"cm";o.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[k[0]]||"middle");if(OpenLayers.IS_GECKO===true){o.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[k[1]]||"central")}var d=b.label.split("\n");var j=d.length;while(o.childNodes.length>j){o.removeChild(o.lastChild)}for(var f=0;f<j;f++){var l=this.nodeFactory(g+this.LABEL_ID_SUFFIX+"_tspan_"+f,"tspan");if(b.labelSelect===true){l._featureId=g;l._geometry=q;l._geometryClass=q.CLASS_NAME}if(OpenLayers.IS_GECKO===false){l.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[k[1]]||"-35%")}l.setAttribute("x",p);if(f==0){var n=OpenLayers.Renderer.SVG.LABEL_VFACTOR[k[1]];if(n==null){n=-0.5}l.setAttribute("dy",(n*(j-1))+"em")}else{l.setAttribute("dy","1em")}l.textContent=(d[f]==="")?" ":d[f];if(!l.parentNode){o.appendChild(l)}}if(!o.parentNode){this.textRoot.appendChild(o)}},getComponentsString:function(f,d){var j=[];var b=true;var g=f.length;var m=[];var k,l;for(var c=0;c<g;c++){l=f[c];j.push(l);k=this.getShortString(l);if(k){m.push(k)}else{if(c>0){if(this.getShortString(f[c-1])){m.push(this.clipLine(f[c],f[c-1]))}}if(c<g-1){if(this.getShortString(f[c+1])){m.push(this.clipLine(f[c],f[c+1]))}}b=false}}return{path:m.join(d||","),complete:b}},clipLine:function(g,m){if(m.equals(g)){return""}var j=this.getResolution();var c=this.MAX_PIXEL-this.translationParameters.x;var b=this.MAX_PIXEL-this.translationParameters.y;var f=m.x/j+this.left;var o=this.top-m.y/j;var d=g.x/j+this.left;var n=this.top-g.y/j;var l;if(d<-c||d>c){l=(n-o)/(d-f);d=d<0?-c:c;n=o+(d-f)*l}if(n<-b||n>b){l=(d-f)/(n-o);n=n<0?-b:b;d=f+(n-o)*l}return d+","+n},getShortString:function(c){var d=this.getResolution();var b=(c.x/d+this.left);var f=(this.top-c.y/d);if(this.inValidRange(b,f)){return b+","+f}else{return false}},getPosition:function(b){return({x:parseFloat(b.getAttributeNS(null,"cx")),y:parseFloat(b.getAttributeNS(null,"cy"))})},importSymbol:function(j){if(!this.defs){this.defs=this.createDefs()}var c=this.container.id+"-"+j;var d=document.getElementById(c);if(d!=null){return d}var g=OpenLayers.Renderer.symbol[j];if(!g){throw new Error(j+" is not a valid symbol name")}var l=this.nodeFactory(c,"symbol");var f=this.nodeFactory(null,"polygon");l.appendChild(f);var q=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var o=[];var n,m;for(var k=0;k<g.length;k=k+2){n=g[k];m=g[k+1];q.left=Math.min(q.left,n);q.bottom=Math.min(q.bottom,m);q.right=Math.max(q.right,n);q.top=Math.max(q.top,m);o.push(n,",",m)}f.setAttributeNS(null,"points",o.join(" "));var b=q.getWidth();var p=q.getHeight();var r=[q.left-b,q.bottom-p,b*3,p*3];l.setAttributeNS(null,"viewBox",r.join(" "));this.symbolMetrics[c]=[Math.max(b,p),q.getCenterLonLat().lon,q.getCenterLonLat().lat];this.defs.appendChild(l);return l},getFeatureIdFromEvent:function(b){var d=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!d){var c=b.target;d=c.parentNode&&c!=this.rendererRoot&&c.parentNode._featureId}return d},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(b){b.preventDefault&&b.preventDefault()};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:true,hitOverflow:0,canvas:null,features:null,pendingRedraw:false,initialize:function(b,c){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};if(this.hitDetection){this.hitCanvas=document.createElement("canvas");this.hitContext=this.hitCanvas.getContext("2d")}},eraseGeometry:function(c,b){this.eraseFeatures(this.features[b][0])},supported:function(){var b=document.createElement("canvas");return !!b.getContext},setSize:function(c){this.size=c.clone();var b=this.root;b.style.width=c.w+"px";b.style.height=c.h+"px";b.width=c.w;b.height=c.h;this.resolution=null;if(this.hitDetection){var d=this.hitCanvas;d.style.width=c.w+"px";d.style.height=c.h+"px";d.width=c.w;d.height=c.h}},drawFeature:function(b,c){var f;if(b.geometry){c=this.applyDefaultSymbolizer(c||b.style);var d=b.geometry.getBounds();f=(c.display!=="none")&&!!d&&d.intersectsBounds(this.extent);if(f){this.features[b.id]=[b,c]}else{delete (this.features[b.id])}this.pendingRedraw=true}if(this.pendingRedraw&&!this.locked){this.redraw();this.pendingRedraw=false}return f},drawGeometry:function(g,d,f){var c=g.CLASS_NAME;if((c=="OpenLayers.Geometry.Collection")||(c=="OpenLayers.Geometry.MultiPoint")||(c=="OpenLayers.Geometry.MultiLineString")||(c=="OpenLayers.Geometry.MultiPolygon")){for(var b=0;b<g.components.length;b++){this.drawGeometry(g.components[b],d,f)}return}switch(g.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(g,d,f);break;case"OpenLayers.Geometry.LineString":this.drawLineString(g,d,f);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(g,d,f);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(g,d,f);break;default:break}},drawExternalGraphic:function(m,b,f){var g=new Image();if(b.graphicTitle){g.title=b.graphicTitle}var c=b.graphicWidth||b.graphicHeight;var n=b.graphicHeight||b.graphicWidth;c=c?c:b.pointRadius*2;n=n?n:b.pointRadius*2;var k=(b.graphicXOffset!=undefined)?b.graphicXOffset:-(0.5*c);var d=(b.graphicYOffset!=undefined)?b.graphicYOffset:-(0.5*n);var j=b.graphicOpacity||b.fillOpacity;var l=function(){if(!this.features[f]){return}var r=this.getLocalXY(m);var v=r[0];var s=r[1];if(!isNaN(v)&&!isNaN(s)){var o=(v+k)|0;var u=(s+d)|0;var p=this.canvas;p.globalAlpha=j;var q=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);p.drawImage(g,o*q,u*q,c*q,n*q);if(this.hitDetection){this.setHitContextStyle("fill",f);this.hitContext.fillRect(o,u,c,n)}}};g.onload=OpenLayers.Function.bind(l,this);g.src=b.externalGraphic},setCanvasStyle:function(c,b){if(c==="fill"){this.canvas.globalAlpha=b.fillOpacity;this.canvas.fillStyle=b.fillColor}else{if(c==="stroke"){this.canvas.globalAlpha=b.strokeOpacity;this.canvas.strokeStyle=b.strokeColor;this.canvas.lineWidth=b.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}}},featureIdToHex:function(d){var f=Number(d.split("_").pop())+1;if(f>=16777216){this.hitOverflow=f-16777215;f=f%16777216+1}var c="000000"+f.toString(16);var b=c.length;c="#"+c.substring(b-6,b);return c},setHitContextStyle:function(c,f,b){var d=this.featureIdToHex(f);if(c=="fill"){this.hitContext.globalAlpha=1;this.hitContext.fillStyle=d}else{if(c=="stroke"){this.hitContext.globalAlpha=1;this.hitContext.strokeStyle=d;this.hitContext.lineWidth=b.strokeWidth+2}else{this.hitContext.globalAlpha=0;this.hitContext.lineWidth=1}}},drawPoint:function(k,d,j){if(d.graphic!==false){if(d.externalGraphic){this.drawExternalGraphic(k,d,j)}else{var f=this.getLocalXY(k);var l=f[0];var g=f[1];if(!isNaN(l)&&!isNaN(g)){var c=Math.PI*2;var b=d.pointRadius;if(d.fill!==false){this.setCanvasStyle("fill",d);this.canvas.beginPath();this.canvas.arc(l,g,b,0,c,true);this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",j,d);this.hitContext.beginPath();this.hitContext.arc(l,g,b,0,c,true);this.hitContext.fill()}}if(d.stroke!==false){this.setCanvasStyle("stroke",d);this.canvas.beginPath();this.canvas.arc(l,g,b,0,c,true);this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",j,d);this.hitContext.beginPath();this.hitContext.arc(l,g,b,0,c,true);this.hitContext.stroke()}this.setCanvasStyle("reset")}}}}},drawLineString:function(d,b,c){b=OpenLayers.Util.applyDefaults({fill:false},b);this.drawLinearRing(d,b,c)},drawLinearRing:function(d,b,c){if(b.fill!==false){this.setCanvasStyle("fill",b);this.renderPath(this.canvas,d,b,c,"fill");if(this.hitDetection){this.setHitContextStyle("fill",c,b);this.renderPath(this.hitContext,d,b,c,"fill")}}if(b.stroke!==false){this.setCanvasStyle("stroke",b);this.renderPath(this.canvas,d,b,c,"stroke");if(this.hitDetection){this.setHitContextStyle("stroke",c,b);this.renderPath(this.hitContext,d,b,c,"stroke")}}this.setCanvasStyle("reset")},renderPath:function(d,n,b,g,l){var j=n.components;var k=j.length;d.beginPath();var c=this.getLocalXY(j[0]);var o=c[0];var m=c[1];if(!isNaN(o)&&!isNaN(m)){d.moveTo(c[0],c[1]);for(var f=1;f<k;++f){var p=this.getLocalXY(j[f]);d.lineTo(p[0],p[1])}if(l==="fill"){d.fill()}else{d.stroke()}}},drawPolygon:function(j,d,g){var f=j.components;var b=f.length;this.drawLinearRing(f[0],d,g);for(var c=1;c<b;++c){this.canvas.globalCompositeOperation="destination-out";if(this.hitDetection){this.hitContext.globalCompositeOperation="destination-out"}this.drawLinearRing(f[c],OpenLayers.Util.applyDefaults({stroke:false,fillOpacity:1},d),g);this.canvas.globalCompositeOperation="source-over";if(this.hitDetection){this.hitContext.globalCompositeOperation="source-over"}this.drawLinearRing(f[c],OpenLayers.Util.applyDefaults({fill:false},d),g)}},drawText:function(o,b){b=OpenLayers.Util.extend({fontColor:"#000000",labelAlign:"cm"},b);var p=this.getLocalXY(o);this.setCanvasStyle("reset");this.canvas.fillStyle=b.fontColor;this.canvas.globalAlpha=b.fontOpacity||1;var f=[b.fontStyle?b.fontStyle:"normal","normal",b.fontWeight?b.fontWeight:"normal",b.fontSize?b.fontSize:"1em",b.fontFamily?b.fontFamily:"sans-serif"].join(" ");var d=b.label.split("\n");var j=d.length;if(this.canvas.fillText){this.canvas.font=f;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[1]]||"middle";var m=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];if(m==null){m=-0.5}var n=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;p[1]+=n*m*(j-1);for(var g=0;g<j;g++){this.canvas.fillText(d[g],p[0],p[1]+(n*g))}}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=f;var c=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[0]];if(c==null){c=-0.5}var m=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];if(m==null){m=-0.5}var n=this.canvas.mozMeasureText("xx");p[1]+=n*(1+(m*j));for(var g=0;g<j;g++){var l=p[0]+(c*this.canvas.mozMeasureText(d[g]));var k=p[1]+(g*n);this.canvas.translate(l,k);this.canvas.mozDrawText(d[g]);this.canvas.translate(-l,-k)}}}this.setCanvasStyle("reset")},getLocalXY:function(c){var d=this.getResolution();var f=this.extent;var b=(c.x/d+(-f.left/d));var g=((f.top/d)-c.y/d);return[b,g]},clear:function(){var b=this.root.height;var c=this.root.width;this.canvas.clearRect(0,0,c,b);this.features={};if(this.hitDetection){this.hitContext.clearRect(0,0,c,b)}},getFeatureIdFromEvent:function(c){var d=null;if(this.hitDetection){if(!this.map.dragging){var g=c.xy;var b=g.x|0;var k=g.y|0;var f=this.hitContext.getImageData(b,k,1,1).data;if(f[3]===255){var j=f[2]+(256*(f[1]+(256*f[0])));if(j){d=this.features["OpenLayers.Feature.Vector_"+(j-1+this.hitOverflow)][0]}}}}return d},eraseFeatures:function(c){if(!(OpenLayers.Util.isArray(c))){c=[c]}for(var b=0;b<c.length;++b){delete this.features[c[b].id]}this.redraw()},redraw:function(){if(!this.locked){var k=this.root.height;var d=this.root.width;this.canvas.clearRect(0,0,d,k);if(this.hitDetection){this.hitContext.clearRect(0,0,d,k)}var j=[];var m,b;for(var c in this.features){if(!this.features.hasOwnProperty(c)){continue}m=this.features[c][0];b=this.features[c][1];this.drawGeometry(m.geometry,b,m.id);if(b.label){j.push([m,b])}}var l;for(var f=0,g=j.length;f<g;++f){l=j[f];this.drawText(l[0].geometry.getCentroid(),l[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(c){if(!this.supported()){return}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);var g=document.createStyleSheet();var d=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];for(var f=0,b=d.length;f<b;f++){g.addRule("olv\\:"+d[f],"behavior: url(#default#VML); position: absolute; display: inline-block;")}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)},supported:function(){return !!(document.namespaces)},setExtent:function(m,b){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var d=this.getResolution();var c=(m.left/d)|0;var j=(m.top/d-this.size.h)|0;if(b||!this.offset){this.offset={x:c,y:j};c=0;j=0}else{c=c-this.offset.x;j=j-this.offset.y}var o=c+" "+j;this.root.coordorigin=o;var l=[this.root,this.vectorRoot,this.textRoot];var k;for(var f=0,g=l.length;f<g;++f){k=l[f];var n=this.size.w+" "+this.size.h;k.coordsize=n}this.root.style.flip="y";return true},setSize:function(j){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);var f=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];var d=this.size.w+"px";var k=this.size.h+"px";var c;for(var g=0,b=f.length;g<b;++g){c=f[g];c.style.width=d;c.style.height=k}},getNodeType:function(d,c){var b=null;switch(d.CLASS_NAME){case"OpenLayers.Geometry.Point":if(c.externalGraphic){b="olv:rect"}else{if(this.isComplexSymbol(c.graphicName)){b="olv:shape"}else{b="olv:oval"}}break;case"OpenLayers.Geometry.Rectangle":b="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":b="olv:shape";break;default:break}return b},setStyle:function(g,c,v,o){c=c||g._style;v=v||g._options;var d=c.fillColor;if(g._geometryClass==="OpenLayers.Geometry.Point"){if(c.externalGraphic){v.isFilled=true;if(c.graphicTitle){g.title=c.graphicTitle}var f=c.graphicWidth||c.graphicHeight;var p=c.graphicHeight||c.graphicWidth;f=f?f:c.pointRadius*2;p=p?p:c.pointRadius*2;var k=this.getResolution();var m=(c.graphicXOffset!=undefined)?c.graphicXOffset:-(0.5*f);var j=(c.graphicYOffset!=undefined)?c.graphicYOffset:-(0.5*p);g.style.left=(((o.x/k-this.offset.x)+m)|0)+"px";g.style.top=(((o.y/k-this.offset.y)-(j+p))|0)+"px";g.style.width=f+"px";g.style.height=p+"px";g.style.flip="y";d="none";v.isStroked=false}else{if(this.isComplexSymbol(c.graphicName)){var b=this.importSymbol(c.graphicName);g.path=b.path;g.coordorigin=b.left+","+b.bottom;var u=b.size;g.coordsize=u+","+u;this.drawCircle(g,o,c.pointRadius);g.style.flip="y"}else{this.drawCircle(g,o,c.pointRadius)}}}if(v.isFilled){g.fillcolor=d}else{g.filled="false"}var n=g.getElementsByTagName("fill");var s=(n.length==0)?null:n[0];if(!v.isFilled){if(s){g.removeChild(s)}}else{if(!s){s=this.createNode("olv:fill",g.id+"_fill")}s.opacity=c.fillOpacity;if(g._geometryClass==="OpenLayers.Geometry.Point"&&c.externalGraphic){if(c.graphicOpacity){s.opacity=c.graphicOpacity}s.src=c.externalGraphic;s.type="frame";if(!(c.graphicWidth&&c.graphicHeight)){s.aspect="atmost"}}if(s.parentNode!=g){g.appendChild(s)}}var r=c.rotation;if((r!==undefined||g._rotation!==undefined)){g._rotation=r;if(c.externalGraphic){this.graphicRotate(g,m,j,c);s.opacity=0}else{if(g._geometryClass==="OpenLayers.Geometry.Point"){g.style.rotation=r||0}}}var l=g.getElementsByTagName("stroke");var q=(l.length==0)?null:l[0];if(!v.isStroked){g.stroked=false;if(q){q.on=false}}else{if(!q){q=this.createNode("olv:stroke",g.id+"_stroke");g.appendChild(q)}q.on=true;q.color=c.strokeColor;q.weight=c.strokeWidth+"px";q.opacity=c.strokeOpacity;q.endcap=c.strokeLinecap=="butt"?"flat":(c.strokeLinecap||"round");if(c.strokeDashstyle){q.dashstyle=this.dashStyle(c)}}if(c.cursor!="inherit"&&c.cursor!=null){g.style.cursor=c.cursor}return g},graphicRotate:function(r,A,g,v){var v=v||r._style;var s=v.rotation||0;var b,n;if(!(v.graphicWidth&&v.graphicHeight)){var B=new Image();B.onreadystatechange=OpenLayers.Function.bind(function(){if(B.readyState=="complete"||B.readyState=="interactive"){b=B.width/B.height;n=Math.max(v.pointRadius*2,v.graphicWidth||0,v.graphicHeight||0);A=A*b;v.graphicWidth=n*b;v.graphicHeight=n;this.graphicRotate(r,A,g,v)}},this);B.src=v.externalGraphic;return}else{n=Math.max(v.graphicWidth,v.graphicHeight);b=v.graphicWidth/v.graphicHeight}var q=Math.round(v.graphicWidth||n*b);var o=Math.round(v.graphicHeight||n);r.style.width=q+"px";r.style.height=o+"px";var p=document.getElementById(r.id+"_image");if(!p){p=this.createNode("olv:imagedata",r.id+"_image");r.appendChild(p)}p.style.width=q+"px";p.style.height=o+"px";p.src=v.externalGraphic;p.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var j=s*Math.PI/180;var l=Math.sin(j);var f=Math.cos(j);var k="progid:DXImageTransform.Microsoft.Matrix(M11="+f+",M12="+(-l)+",M21="+l+",M22="+f+",SizingMethod='auto expand')\n";var c=v.graphicOpacity||v.fillOpacity;if(c&&c!=1){k+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+c+")\n"}r.style.filter=k;var u=new OpenLayers.Geometry.Point(-A,-g);var d=new OpenLayers.Bounds(0,0,q,o).toGeometry();d.rotate(v.rotation,u);var m=d.getBounds();r.style.left=Math.round(parseInt(r.style.left)+m.left)+"px";r.style.top=Math.round(parseInt(r.style.top)-m.bottom)+"px"},postDraw:function(b){b.style.visibility="visible";var d=b._style.fillColor;var c=b._style.strokeColor;if(d=="none"&&b.fillcolor!=d){b.fillcolor=d}if(c=="none"&&b.strokecolor!=c){b.strokecolor=c}},setNodeDimension:function(c,g){var f=g.getBounds();if(f){var b=this.getResolution();var d=new OpenLayers.Bounds((f.left/b-this.offset.x)|0,(f.bottom/b-this.offset.y)|0,(f.right/b-this.offset.x)|0,(f.top/b-this.offset.y)|0);c.style.left=d.left+"px";c.style.top=d.top+"px";c.style.width=d.getWidth()+"px";c.style.height=d.getHeight()+"px";c.coordorigin=d.left+" "+d.top;c.coordsize=d.getWidth()+" "+d.getHeight()}},dashStyle:function(b){var d=b.strokeDashstyle;switch(d){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return d;default:var c=d.split(/[ ,]/);if(c.length==2){if(1*c[0]>=2*c[1]){return"longdash"}return(c[0]==1||c[1]==1)?"dot":"dash"}else{if(c.length==4){return(1*c[0]>=2*c[1])?"longdashdot":"dashdot"}}return"solid"}},createNode:function(b,d){var c=document.createElement(b);if(d){c.id=d}c.unselectable="on";c.onselectstart=OpenLayers.Function.False;return c},nodeTypeCompare:function(d,c){var f=c;var b=f.indexOf(":");if(b!=-1){f=f.substr(b+1)}var g=d.nodeName;b=g.indexOf(":");if(b!=-1){g=g.substr(b+1)}return(f==g)},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(b){return this.nodeFactory(this.container.id+b,"olv:group")},drawPoint:function(b,c){return this.drawCircle(b,c,1)},drawCircle:function(f,g,b){if(!isNaN(g.x)&&!isNaN(g.y)){var c=this.getResolution();f.style.left=(((g.x/c-this.offset.x)|0)-b)+"px";f.style.top=(((g.y/c-this.offset.y)|0)-b)+"px";var d=b*2;f.style.width=d+"px";f.style.height=d+"px";return f}return false},drawLineString:function(b,c){return this.drawLine(b,c,false)},drawLinearRing:function(b,c){return this.drawLine(b,c,true)},drawLine:function(c,n,k){this.setNodeDimension(c,n);var d=this.getResolution();var b=n.components.length;var g=new Array(b);var l,o,m;for(var j=0;j<b;j++){l=n.components[j];o=(l.x/d-this.offset.x)|0;m=(l.y/d-this.offset.y)|0;g[j]=" "+o+","+m+" l "}var f=(k)?" x e":" e";c.path="m"+g.join("")+f;return c},drawPolygon:function(d,p){this.setNodeDimension(d,p);var f=this.getResolution();var v=[];var g,n,r,b,l,c,k,u,m,s,q,o;for(g=0,n=p.components.length;g<n;g++){v.push("m");r=p.components[g].components;b=(g===0);l=null;c=null;for(k=0,u=r.length;k<u;k++){m=r[k];q=(m.x/f-this.offset.x)|0;o=(m.y/f-this.offset.y)|0;s=" "+q+","+o;v.push(s);if(k==0){v.push(" l")}if(!b){if(!l){l=s}else{if(l!=s){if(!c){c=s}else{if(c!=s){b=true}}}}}}v.push(b?" x ":" ")}v.push("e");d.path=v.join("");return d},drawRectangle:function(c,d){var b=this.getResolution();c.style.left=((d.x/b-this.offset.x)|0)+"px";c.style.top=((d.y/b-this.offset.y)|0)+"px";c.style.width=((d.width/b)|0)+"px";c.style.height=((d.height/b)|0)+"px";return c},drawText:function(f,b,l){var k=this.nodeFactory(f+this.LABEL_ID_SUFFIX,"olv:rect");var j=this.nodeFactory(f+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");var d=this.getResolution();k.style.left=((l.x/d-this.offset.x)|0)+"px";k.style.top=((l.y/d-this.offset.y)|0)+"px";k.style.flip="y";j.innerText=b.label;if(b.cursor!="inherit"&&b.cursor!=null){j.style.cursor=b.cursor}if(b.fontColor){j.style.color=b.fontColor}if(b.fontOpacity){j.style.filter="alpha(opacity="+(b.fontOpacity*100)+")"}if(b.fontFamily){j.style.fontFamily=b.fontFamily}if(b.fontSize){j.style.fontSize=b.fontSize}if(b.fontWeight){j.style.fontWeight=b.fontWeight}if(b.fontStyle){j.style.fontStyle=b.fontStyle}if(b.labelSelect===true){k._featureId=f;j._featureId=f;j._geometry=l;j._geometryClass=l.CLASS_NAME}j.style.whiteSpace="nowrap";j.inset="1px,0px,0px,0px";if(!k.parentNode){k.appendChild(j);this.textRoot.appendChild(k)}var g=b.labelAlign||"cm";if(g.length==1){g+="m"}var m=j.clientWidth*(OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)]);var c=j.clientHeight*(OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(1,1)]);k.style.left=parseInt(k.style.left)-m-1+"px";k.style.top=parseInt(k.style.top)+c+"px"},drawSurface:function(b,k){this.setNodeDimension(b,k);var c=this.getResolution();var m=[];var f,l,j;for(var d=0,g=k.components.length;d<g;d++){f=k.components[d];l=(f.x/c-this.offset.x)|0;j=(f.y/c-this.offset.y)|0;if((d%3)==0&&(d/3)==0){m.push("m")}else{if((d%3)==1){m.push(" c")}}m.push(" "+l+","+j)}m.push(" x e");b.path=m.join("");return b},moveRoot:function(c){var b=this.map.getLayer(c.container.id);if(b instanceof OpenLayers.Layer.Vector.RootContainer){b=this.map.getLayer(this.container.id)}b&&b.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);b&&b.redraw()},importSymbol:function(f){var c=this.container.id+"-"+f;var b=this.symbolCache[c];if(b){return b}var d=OpenLayers.Renderer.symbol[f];if(!d){throw new Error(f+" is not a valid symbol name")}var n=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);var g=["m"];for(var j=0;j<d.length;j=j+2){var l=d[j];var k=d[j+1];n.left=Math.min(n.left,l);n.bottom=Math.min(n.bottom,k);n.right=Math.max(n.right,l);n.top=Math.max(n.top,k);g.push(l);g.push(k);if(j==0){g.push("l")}}g.push("x e");var o=g.join(" ");var m=(n.getWidth()-n.getHeight())/2;if(m>0){n.bottom=n.bottom-m;n.top=n.top+m}else{n.left=n.left+m;n.right=n.right-m}b={path:o,size:n.getWidth(),left:n.left,bottom:n.bottom};this.symbolCache[c]=b;return b},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","vertexremoved","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:false,isFixed:false,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,initialize:function(d,c){this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES);OpenLayers.Layer.prototype.initialize.apply(this,arguments);if(!this.renderer||!this.renderer.supported()){this.assignRenderer()}if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap()}this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies){for(var f=0,b=this.strategies.length;f<b;f++){this.strategies[f].setLayer(this)}}},destroy:function(){if(this.strategies){var d,c,b;for(c=0,b=this.strategies.length;c<b;c++){d=this.strategies[c];if(d.autoDestroy){d.destroy()}}this.strategies=null}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()}this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;if(this.renderer){this.renderer.destroy()}this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(g){if(g==null){g=new OpenLayers.Layer.Vector(this.name,this.getOptions())}g=OpenLayers.Layer.prototype.clone.apply(this,[g]);var d=this.features;var b=d.length;var f=new Array(b);for(var c=0;c<b;++c){f[c]=d[c].clone()}g.features=f;return g},refresh:function(b){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",b)}},assignRenderer:function(){for(var d=0,b=this.renderers.length;d<b;d++){var c=this.renderers[d];var f=(typeof c=="function")?c:OpenLayers.Renderer[c];if(f&&f.prototype.supported()){this.renderer=new f(this.div,this.rendererOptions);break}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))}},setMap:function(b){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(!this.renderer){this.map.removeLayer(this)}else{this.renderer.map=this.map;this.renderer.setSize(this.map.getSize())}},afterAdd:function(){if(this.strategies){var d,c,b;for(c=0,b=this.strategies.length;c<b;c++){d=this.strategies[c];if(d.autoActivate){d.activate()}}}},removeMap:function(d){this.drawn=false;if(this.strategies){var f,c,b;for(c=0,b=this.strategies.length;c<b;c++){f=this.strategies[c];if(f.autoActivate){f.deactivate()}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);this.renderer.setSize(this.map.getSize())},moveTo:function(b,c,k){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var f=(OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG);if(f){k||this.renderer.updateDimensions(c)}else{var d=true;if(!k){this.renderer.root.style.visibility="hidden";this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px";this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var l=this.map.getExtent();d=this.renderer.setExtent(l,c);this.renderer.root.style.visibility="visible";if(OpenLayers.IS_GECKO===true){this.div.scrollLeft=this.div.scrollLeft}if(!c&&d){for(var g in this.unrenderedFeatures){var m=this.unrenderedFeatures[g];this.drawFeature(m)}}}}if(!this.drawn||(!f&&(c||!d))){this.drawn=true;var m;for(var g=0,j=this.features.length;g<j;g++){this.renderer.locked=(g!==(j-1));m=this.features[g];this.drawFeature(m)}}},redraw:function(){if(OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG){this.drawn=false}return OpenLayers.Layer.prototype.redraw.apply(this,arguments)},display:function(b){OpenLayers.Layer.prototype.display.apply(this,arguments);var c=this.div.style.display;if(c!=this.renderer.root.style.display){this.renderer.root.style.display=c}},addFeatures:function(c,n){if(!(OpenLayers.Util.isArray(c))){c=[c]}var l=!n||!n.silent;if(l){var b={features:c};var k=this.events.triggerEvent("beforefeaturesadded",b);if(k===false){return}c=b.features}var f=[];for(var d=0,j=c.length;d<j;d++){if(d!=(c.length-1)){this.renderer.locked=true}else{this.renderer.locked=false}var m=c[d];if(this.geometryType&&!(m.geometry instanceof this.geometryType)){var g=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw g}m.layer=this;if(!m.style&&this.style){m.style=OpenLayers.Util.extend({},this.style)}if(l){if(this.events.triggerEvent("beforefeatureadded",{feature:m})===false){continue}this.preFeatureInsert(m)}f.push(m);this.features.push(m);this.drawFeature(m);if(l){this.events.triggerEvent("featureadded",{feature:m});this.onFeatureInsert(m)}}if(l){this.events.triggerEvent("featuresadded",{features:f})}},removeFeatures:function(g,b){if(!g||g.length===0){return}if(g===this.features){return this.removeAllFeatures(b)}if(!(OpenLayers.Util.isArray(g))){g=[g]}if(g===this.selectedFeatures){g=g.slice()}var f=!b||!b.silent;if(f){this.events.triggerEvent("beforefeaturesremoved",{features:g})}for(var d=g.length-1;d>=0;d--){if(d!=0&&g[d-1].geometry){this.renderer.locked=true}else{this.renderer.locked=false}var c=g[d];delete this.unrenderedFeatures[c.id];if(f){this.events.triggerEvent("beforefeatureremoved",{feature:c})}this.features=OpenLayers.Util.removeItem(this.features,c);c.layer=null;if(c.geometry){this.renderer.eraseFeatures(c)}if(OpenLayers.Util.indexOf(this.selectedFeatures,c)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,c)}if(f){this.events.triggerEvent("featureremoved",{feature:c})}}if(f){this.events.triggerEvent("featuresremoved",{features:g})}},removeAllFeatures:function(b){var f=!b||!b.silent;var g=this.features;if(f){this.events.triggerEvent("beforefeaturesremoved",{features:g})}var d;for(var c=g.length-1;c>=0;c--){d=g[c];if(f){this.events.triggerEvent("beforefeatureremoved",{feature:d})}d.layer=null;if(f){this.events.triggerEvent("featureremoved",{feature:d})}}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];if(f){this.events.triggerEvent("featuresremoved",{features:g})}},destroyFeatures:function(f,b){var d=(f==undefined);if(d){f=this.features}if(f){this.removeFeatures(f,b);for(var c=f.length-1;c>=0;c--){f[c].destroy()}}},drawFeature:function(b,c){if(!this.drawn){return}if(typeof c!="object"){if(!c&&b.state===OpenLayers.State.DELETE){c="delete"}var d=c||b.renderIntent;c=b.style||this.style;if(!c){c=this.styleMap.createSymbolizer(b,d)}}var f=this.renderer.drawFeature(b,c);if(f===false||f===null){this.unrenderedFeatures[b.id]=b}else{delete this.unrenderedFeatures[b.id]}},eraseFeatures:function(b){this.renderer.eraseFeatures(b)},getFeatureFromEvent:function(b){if(!this.renderer){OpenLayers.Console.error(OpenLayers.i18n("getFeatureError"));return null}var c=null;var d=this.renderer.getFeatureIdFromEvent(b);if(d){if(typeof d==="string"){c=this.getFeatureById(d)}else{c=d}}return c},getFeatureBy:function(g,f){var d=null;for(var c=0,b=this.features.length;c<b;++c){if(this.features[c][g]==f){d=this.features[c];break}}return d},getFeatureById:function(b){return this.getFeatureBy("id",b)},getFeatureByFid:function(b){return this.getFeatureBy("fid",b)},getFeaturesByAttribute:function(f,g){var d,c,b=this.features.length,j=[];for(d=0;d<b;d++){c=this.features[d];if(c&&c.attributes){if(c.attributes[f]===g){j.push(c)}}}return j},onFeatureInsert:function(b){},preFeatureInsert:function(b){},getDataExtent:function(){var c=null;var f=this.features;if(f&&(f.length>0)){var g=null;for(var d=0,b=f.length;d<b;d++){g=f[d].geometry;if(g){if(c===null){c=new OpenLayers.Bounds()}c.extend(g.getBounds())}}}return c},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,initialize:function(c,b){OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments)},display:function(){},getFeatureFromEvent:function(b){var f=this.layers;var d;for(var c=0;c<f.length;c++){d=f[c].getFeatureFromEvent(b);if(d){return d}}},setMap:function(b){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.collectRoots();b.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(b){b.events.unregister("changelayer",this,this.handleChangeLayer);this.resetRoots();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){var c;for(var b=0;b<this.map.layers.length;++b){c=this.map.layers[b];if(OpenLayers.Util.indexOf(this.layers,c)!=-1){c.renderer.moveRoot(this.renderer)}}},resetRoots:function(){var c;for(var b=0;b<this.layers.length;++b){c=this.layers[b];if(this.renderer&&c.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(c.renderer)}}},handleChangeLayer:function(b){var c=b.layer;if(b.property=="order"&&OpenLayers.Util.indexOf(this.layers,c)!=-1){this.resetRoots();this.collectRoots()}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b;this.active=false},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(b){this.layer=b},activate:function(){if(!this.active){this.active=true;return true}return false},deactivate:function(){if(this.active){this.active=false;return true}return false},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:false,activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});if(this.layer.visibility==true||this.preload){this.load()}else{this.layer.events.on({visibilitychanged:this.load,scope:this})}return true}return false},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);if(b){this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this})}return b},load:function(b){var c=this.layer;c.events.triggerEvent("loadstart");c.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,c.map.getProjectionObject()),filter:c.filter},b));c.events.un({visibilitychanged:this.load,scope:this})},merge:function(j,k){var f=this.layer;f.destroyFeatures();var g=k.features;if(g&&g.length>0){if(!j.equals(f.projection)){var d;for(var c=0,b=g.length;c<b;++c){d=g[c].geometry;if(d){d.transform(f.projection,j)}}}f.addFeatures(g)}f.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:false,resolution:null,activate:function(){var b=OpenLayers.Strategy.prototype.activate.call(this);if(b){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return b},deactivate:function(){var b=OpenLayers.Strategy.prototype.deactivate.call(this);if(b){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})}return b},cacheFeatures:function(c){var b=true;if(!this.clustering){this.clearCache();this.features=c.features;this.cluster();b=false}return b},clearCache:function(){this.features=null},cluster:function(b){if((!b||b.zoomChanged)&&this.features){var d=this.layer.map.getResolution();if(d!=this.resolution||!this.clustersExist()){this.resolution=d;var m=[];var p,c,n;for(var g=0;g<this.features.length;++g){p=this.features[g];if(p.geometry){c=false;for(var f=m.length-1;f>=0;--f){n=m[f];if(this.shouldCluster(n,p)){this.addToCluster(n,p);c=true;break}}if(!c){m.push(this.createCluster(this.features[g]))}}}this.layer.removeAllFeatures();if(m.length>0){if(this.threshold>1){var l=m.slice();m=[];var o;for(var g=0,k=l.length;g<k;++g){o=l[g];if(o.attributes.count<this.threshold){Array.prototype.push.apply(m,o.cluster)}else{m.push(o)}}}this.clustering=true;this.layer.addFeatures(m);this.clustering=false}this.clusters=m}}},clustersExist:function(){var c=false;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){c=true;for(var b=0;b<this.clusters.length;++b){if(this.clusters[b]!=this.layer.features[b]){c=false;break}}}return c},shouldCluster:function(b,c){var g=b.geometry.getBounds().getCenterLonLat();var d=c.geometry.getBounds().getCenterLonLat();var f=(Math.sqrt(Math.pow((g.lon-d.lon),2)+Math.pow((g.lat-d.lat),2))/this.resolution);return(f<=this.distance)},addToCluster:function(b,c){b.cluster.push(c);b.attributes.count+=1},createCluster:function(d){var c=d.geometry.getBounds().getCenterLonLat();var b=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c.lon,c.lat),{count:1});b.cluster=[d];return b},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Filter=OpenLayers.Class({initialize:function(b){OpenLayers.Util.extend(this,b)},destroy:function(){},evaluate:function(b){return true},clone:function(){return null},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(b){b=b||{};OpenLayers.Util.extend(this,b);this.options=b},mergeWithDefaultFilter:function(c){var b;if(c&&this.defaultFilter){b=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,c]})}else{b=c||this.defaultFilter||undefined}return b},destroy:function(){this.options=null;this.format=null},read:function(b){b=b||{};b.filter=this.mergeWithDefaultFilter(b.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(b){},createCallback:function(d,b,c){return OpenLayers.Function.bind(function(){d.apply(this,[b,c])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,reqFeatures:null,priv:null,error:null,initialize:function(b){OpenLayers.Util.extend(this,b)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,wildcarded:false,srsInBBOX:false,initialize:function(b){b=b||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var c=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(d,f){return c.write(d,f)}}},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(b){OpenLayers.Protocol.prototype.read.apply(this,arguments);b=b||{};b.params=OpenLayers.Util.applyDefaults(b.params,this.options.params);b=OpenLayers.Util.applyDefaults(b,this.options);if(b.filter&&this.filterToParams){b.params=this.filterToParams(b.filter,b.params)}var c=(b.readWithPOST!==undefined)?b.readWithPOST:this.readWithPOST;var d=new OpenLayers.Protocol.Response({requestType:"read"});if(c){d.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleRead,d,b),data:OpenLayers.Util.getParameterString(b.params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}else{d.priv=OpenLayers.Request.GET({url:b.url,callback:this.createCallback(this.handleRead,d,b),params:b.params,headers:b.headers})}return d},handleRead:function(c,b){this.handleResponse(c,b)},create:function(c,b){b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:c,requestType:"create"});d.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,d,b),headers:b.headers,data:this.format.write(c)});return d},handleCreate:function(c,b){this.handleResponse(c,b)},update:function(d,c){c=c||{};var b=c.url||d.url||this.options.url+"/"+d.fid;c=OpenLayers.Util.applyDefaults(c,this.options);var f=new OpenLayers.Protocol.Response({reqFeatures:d,requestType:"update"});f.priv=OpenLayers.Request.PUT({url:b,callback:this.createCallback(this.handleUpdate,f,c),headers:c.headers,data:this.format.write(d)});return f},handleUpdate:function(c,b){this.handleResponse(c,b)},"delete":function(d,c){c=c||{};var b=c.url||d.url||this.options.url+"/"+d.fid;c=OpenLayers.Util.applyDefaults(c,this.options);var f=new OpenLayers.Protocol.Response({reqFeatures:d,requestType:"delete"});f.priv=OpenLayers.Request.DELETE({url:b,callback:this.createCallback(this.handleDelete,f,c),headers:c.headers});return f},handleDelete:function(c,b){this.handleResponse(c,b)},handleResponse:function(d,b){var c=d.priv;if(b.callback){if(c.status>=200&&c.status<300){if(d.requestType!="delete"){d.features=this.parseFeatures(c)}d.code=OpenLayers.Protocol.Response.SUCCESS}else{d.code=OpenLayers.Protocol.Response.FAILURE}b.callback.call(b.scope,d)}},parseFeatures:function(b){var c=b.responseXML;if(!c||!c.documentElement){c=b.responseText}if(!c||c.length<=0){return null}return this.format.read(c)},commit:function(c,u){u=OpenLayers.Util.applyDefaults(u,this.options);var f=[],p=0;var n={};n[OpenLayers.State.INSERT]=[];n[OpenLayers.State.UPDATE]=[];n[OpenLayers.State.DELETE]=[];var s,o,d=[];for(var g=0,m=c.length;g<m;++g){s=c[g];o=n[s.state];if(o){o.push(s);d.push(s)}}var k=(n[OpenLayers.State.INSERT].length>0?1:0)+n[OpenLayers.State.UPDATE].length+n[OpenLayers.State.DELETE].length;var r=true;var b=new OpenLayers.Protocol.Response({reqFeatures:d});function l(A){var v=A.features?A.features.length:0;var C=new Array(v);for(var B=0;B<v;++B){C[B]=A.features[B].fid}b.insertIds=C;q.apply(this,[A])}function q(v){this.callUserCallback(v,u);r=r&&v.success();p++;if(p>=k){if(u.callback){b.code=r?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;u.callback.apply(u.scope,[b])}}}var j=n[OpenLayers.State.INSERT];if(j.length>0){f.push(this.create(j,OpenLayers.Util.applyDefaults({callback:l,scope:this},u.create)))}j=n[OpenLayers.State.UPDATE];for(var g=j.length-1;g>=0;--g){f.push(this.update(j[g],OpenLayers.Util.applyDefaults({callback:q,scope:this},u.update)))}j=n[OpenLayers.State.DELETE];for(var g=j.length-1;g>=0;--g){f.push(this["delete"](j[g],OpenLayers.Util.applyDefaults({callback:q,scope:this},u["delete"])))}return f},abort:function(b){if(b){b.priv.abort()}},callUserCallback:function(d,b){var c=b[d.requestType];if(c&&c.callback){c.callback.call(c.scope,d)}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(c,b){OpenLayers.Util.extend(this,b);this.rules=[];if(b&&b.rules){this.addRules(b.rules)}this.setDefaultStyle(c||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var c=0,b=this.rules.length;c<b;c++){this.rules[c].destroy();this.rules[c]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(n){var b=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),n);var m=this.rules;var l,c;var d=[];var j=false;for(var f=0,g=m.length;f<g;f++){l=m[f];var k=l.evaluate(n);if(k){if(l instanceof OpenLayers.Rule&&l.elseFilter){d.push(l)}else{j=true;this.applySymbolizer(l,b,n)}}}if(j==false&&d.length>0){j=true;for(var f=0,g=d.length;f<g;f++){this.applySymbolizer(d[f],b,n)}}if(m.length>0&&j==false){b.display="none"}if(b.label&&typeof b.label!=="string"){b.label=String(b.label)}return b},applySymbolizer:function(j,f,c){var b=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];var d=j.symbolizer[b]||j.symbolizer;if(this.defaultsPerSymbolizer===true){var g=this.defaultStyle;OpenLayers.Util.applyDefaults(d,{pointRadius:g.pointRadius});if(d.stroke===true||d.graphic===true){OpenLayers.Util.applyDefaults(d,{strokeWidth:g.strokeWidth,strokeColor:g.strokeColor,strokeOpacity:g.strokeOpacity,strokeDashstyle:g.strokeDashstyle,strokeLinecap:g.strokeLinecap})}if(d.fill===true||d.graphic===true){OpenLayers.Util.applyDefaults(d,{fillColor:g.fillColor,fillOpacity:g.fillOpacity})}if(d.graphic===true){OpenLayers.Util.applyDefaults(d,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}}return this.createLiterals(OpenLayers.Util.extend(f,d),c)},createLiterals:function(f,d){var c=OpenLayers.Util.extend({},d.attributes||d.data);OpenLayers.Util.extend(c,this.context);for(var b in this.propertyStyles){f[b]=OpenLayers.Style.createLiteral(f[b],c,d,b)}return f},findPropertyStyles:function(){var f={};var j=this.defaultStyle;this.addPropertyStyles(f,j);var l=this.rules;var g,k;for(var d=0,b=l.length;d<b;d++){g=l[d].symbolizer;for(var c in g){k=g[c];if(typeof k=="object"){this.addPropertyStyles(f,k)}else{this.addPropertyStyles(f,g);break}}}return f},addPropertyStyles:function(c,d){var f;for(var b in d){f=d[b];if(typeof f=="string"&&f.match(/\$\{\w+\}/)){c[b]=true}}return c},addRules:function(b){Array.prototype.push.apply(this.rules,b);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(b){this.defaultStyle=b;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(f){var d=OpenLayers.Style.SYMBOLIZER_PREFIXES;for(var c=0,b=d.length;c<b;c++){if(f.CLASS_NAME.indexOf(d[c])!=-1){return d[c]}}},clone:function(){var c=OpenLayers.Util.extend({},this);if(this.rules){c.rules=[];for(var d=0,b=this.rules.length;d<b;++d){c.rules.push(this.rules[d].clone())}}c.context=this.context&&OpenLayers.Util.extend({},this.context);var f=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(f,c)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(f,c,b,d){if(typeof f=="string"&&f.indexOf("${")!=-1){f=OpenLayers.String.format(f,c,[b,d]);f=(isNaN(f)||!f)?f:parseFloat(f)}return f};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(d,b){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(d instanceof OpenLayers.Style){this.styles["default"]=d;this.styles.select=d;this.styles.temporary=d;this.styles["delete"]=d}else{if(typeof d=="object"){for(var c in d){if(d[c] instanceof OpenLayers.Style){this.styles[c]=d[c]}else{if(typeof d[c]=="object"){this.styles[c]=new OpenLayers.Style(d[c])}else{this.styles["default"]=new OpenLayers.Style(d);this.styles.select=new OpenLayers.Style(d);this.styles.temporary=new OpenLayers.Style(d);this.styles["delete"]=new OpenLayers.Style(d);break}}}}}OpenLayers.Util.extend(this,b)},destroy:function(){for(var b in this.styles){this.styles[b].destroy()}this.styles=null},createSymbolizer:function(c,d){if(!c){c=new OpenLayers.Feature.Vector()}if(!this.styles[d]){d="default"}c.renderIntent=d;var b={};if(this.extendDefault&&d!="default"){b=this.styles["default"].createSymbolizer(c)}return OpenLayers.Util.extend(b,this.styles[d].createSymbolizer(c))},addUniqueValueRules:function(c,f,j,b){var g=[];for(var d in j){g.push(new OpenLayers.Rule({symbolizer:j[d],context:b,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:f,value:d})}))}this.styles[c].addRules(g)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(b){OpenLayers.Util.extend(this,b);this.options=b},destroy:function(){},read:function(b){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"))},write:function(b){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"))},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(b){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}OpenLayers.Format.prototype.initialize.apply(this,[b]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var c in this.namespaces){this.namespaceAlias[this.namespaces[c]]=c}},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(b,c){this.namespaces[b]=c;this.namespaceAlias[c]=b},read:function(d){var b=d.indexOf("<");if(b>0){d=d.substring(b)}var c=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var f;if(window.ActiveXObject&&!this.xmldom){f=new ActiveXObject("Microsoft.XMLDOM")}else{f=this.xmldom}f.loadXML(d);return f}),this),function(){return new DOMParser().parseFromString(d,"text/xml")},function(){var f=new XMLHttpRequest();f.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(d),false);if(f.overrideMimeType){f.overrideMimeType("text/xml")}f.send(null);return f.responseXML});if(this.keepData){this.data=c}return c},write:function(c){var d;if(this.xmldom){d=c.xml}else{var b=new XMLSerializer();if(c.nodeType==1){var f=document.implementation.createDocument("","",null);if(f.importNode){c=f.importNode(c,true)}f.appendChild(c);d=b.serializeToString(f)}else{d=b.serializeToString(c)}}return d},createElementNS:function(d,b){var c;if(this.xmldom){if(typeof d=="string"){c=this.xmldom.createNode(1,b,d)}else{c=this.xmldom.createNode(1,b,"")}}else{c=document.createElementNS(d,b)}return c},createTextNode:function(c){var b;if(typeof c!=="string"){c=String(c)}if(this.xmldom){b=this.xmldom.createTextNode(c)}else{b=document.createTextNode(c)}return b},getElementsByTagNameNS:function(g,f,d){var b=[];if(g.getElementsByTagNameNS){b=g.getElementsByTagNameNS(f,d)}else{var c=g.getElementsByTagName("*");var m,j;for(var k=0,l=c.length;k<l;++k){m=c[k];j=(m.prefix)?(m.prefix+":"+d):d;if((d=="*")||(j==m.nodeName)){if((f=="*")||(f==m.namespaceURI)){b.push(m)}}}}return b},getAttributeNodeNS:function(d,c,b){var m=null;if(d.getAttributeNodeNS){m=d.getAttributeNodeNS(c,b)}else{var g=d.attributes;var l,f;for(var j=0,k=g.length;j<k;++j){l=g[j];if(l.namespaceURI==c){f=(l.prefix)?(l.prefix+":"+b):b;if(f==l.nodeName){m=l;break}}}}return m},getAttributeNS:function(g,f,b){var c="";if(g.getAttributeNS){c=g.getAttributeNS(f,b)||""}else{var d=this.getAttributeNodeNS(g,f,b);if(d){c=d.nodeValue}}return c},getChildValue:function(b,d){var c=d||"";if(b){for(var f=b.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 3:case 4:c+=f.nodeValue}}}return c},concatChildValues:function(c,f){var d="";var g=c.firstChild;var b;while(g){b=g.nodeValue;if(b){d+=b}g=g.nextSibling}if(d==""&&f!=undefined){d=f}return d},isSimpleContent:function(b){var d=true;for(var c=b.firstChild;c;c=c.nextSibling){if(c.nodeType===1){d=false;break}}return d},contentType:function(d){var g=false,c=false;var b=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;for(var f=d.firstChild;f;f=f.nextSibling){switch(f.nodeType){case 1:c=true;break;case 8:break;default:g=true}if(c&&g){break}}if(c&&g){b=OpenLayers.Format.XML.CONTENT_TYPE.MIXED}else{if(c){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX}else{if(g){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}}}return b},hasAttributeNS:function(d,c,b){var f=false;if(d.hasAttributeNS){f=d.hasAttributeNS(c,b)}else{f=!!this.getAttributeNodeNS(d,c,b)}return f},setAttributeNS:function(f,d,b,g){if(f.setAttributeNS){f.setAttributeNS(d,b,g)}else{if(this.xmldom){if(d){var c=f.ownerDocument.createNode(2,b,d);c.nodeValue=g;f.setAttributeNode(c)}else{f.setAttribute(b,g)}}else{throw"setAttributeNS not implemented"}}},createElementNSPlus:function(c,b){b=b||{};var f=b.uri||this.namespaces[b.prefix];if(!f){var j=c.indexOf(":");f=this.namespaces[c.substring(0,j)]}if(!f){f=this.namespaces[this.defaultPrefix]}var d=this.createElementNS(f,c);if(b.attributes){this.setAttributes(d,b.attributes)}var g=b.value;if(g!=null){d.appendChild(this.createTextNode(g))}return d},setAttributes:function(d,g){var f,c;for(var b in g){if(g[b]!=null&&g[b].toString){f=g[b].toString();c=this.namespaces[b.substring(0,b.indexOf(":"))]||null;this.setAttributeNS(d,c,b,f)}}},readNode:function(d,g){if(!g){g={}}var f=this.readers[d.namespaceURI?this.namespaceAlias[d.namespaceURI]:this.defaultPrefix];if(f){var c=d.localName||d.nodeName.split(":").pop();var b=f[c]||f["*"];if(b){b.apply(this,[d,g])}}return g},readChildNodes:function(f,g){if(!g){g={}}var d=f.childNodes;var j;for(var c=0,b=d.length;c<b;++c){j=d[c];if(j.nodeType==1){this.readNode(j,g)}}return g},writeNode:function(b,j,f){var g,d;var c=b.indexOf(":");if(c>0){g=b.substring(0,c);d=b.substring(c+1)}else{if(f){g=this.namespaceAlias[f.namespaceURI]}else{g=this.defaultPrefix}d=b}var k=this.writers[g][d].apply(this,[j]);if(f){f.appendChild(k)}return k},getChildEl:function(d,b,c){return d&&this.getThisOrNextEl(d.firstChild,b,c)},getNextEl:function(d,b,c){return d&&this.getThisOrNextEl(d.nextSibling,b,c)},getThisOrNextEl:function(f,b,d){outer:for(var c=f;c;c=c.nextSibling){switch(c.nodeType){case 1:if((!b||b===(c.localName||c.nodeName.split(":").pop()))&&(!d||d===c.namespaceURI)){break outer}c=null;break outer;case 3:if(/^\s*$/.test(c.nodeValue)){break}case 4:case 6:case 12:case 10:case 11:c=null;break outer}}return c||null},lookupNamespaceURI:function(g,j){var f=null;if(g){if(g.lookupNamespaceURI){f=g.lookupNamespaceURI(j)}else{outer:switch(g.nodeType){case 1:if(g.namespaceURI!==null&&g.prefix===j){f=g.namespaceURI;break outer}var c=g.attributes.length;if(c){var b;for(var d=0;d<c;++d){b=g.attributes[d];if(b.prefix==="xmlns"&&b.name==="xmlns:"+j){f=b.value||null;break outer}else{if(b.name==="xmlns"&&j===null){f=b.value||null;break outer}}}}f=this.lookupNamespaceURI(g.parentNode,j);break outer;case 2:f=this.lookupNamespaceURI(g.ownerElement,j);break outer;case 9:f=this.lookupNamespaceURI(g.documentElement,j);break outer;case 6:case 12:case 10:case 11:break outer;default:f=this.lookupNamespaceURI(g.parentNode,j);break outer}}}return f},getXMLDoc:function(){if(!OpenLayers.Format.XML.document&&!this.xmldom){if(document.implementation&&document.implementation.createDocument){OpenLayers.Format.XML.document=document.implementation.createDocument("","",null)}else{if(!this.xmldom&&window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")}}}return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:false,createGeometryFromItem:function(q){var p=this.getElementsByTagNameNS(q,this.georssns,"point");var k=this.getElementsByTagNameNS(q,this.geons,"lat");var b=this.getElementsByTagNameNS(q,this.geons,"long");var s=this.getElementsByTagNameNS(q,this.georssns,"line");var n=this.getElementsByTagNameNS(q,this.georssns,"polygon");var d=this.getElementsByTagNameNS(q,this.georssns,"where");var f=this.getElementsByTagNameNS(q,this.georssns,"box");if(p.length>0||(k.length>0&&b.length>0)){var o;if(p.length>0){o=OpenLayers.String.trim(p[0].firstChild.nodeValue).split(/\s+/);if(o.length!=2){o=OpenLayers.String.trim(p[0].firstChild.nodeValue).split(/\s*,\s*/)}}else{o=[parseFloat(k[0].firstChild.nodeValue),parseFloat(b[0].firstChild.nodeValue)]}var l=new OpenLayers.Geometry.Point(parseFloat(o[1]),parseFloat(o[0]))}else{if(s.length>0){var m=OpenLayers.String.trim(this.concatChildValues(s[0])).split(/\s+/);var g=[];var p;for(var c=0,j=m.length;c<j;c+=2){p=new OpenLayers.Geometry.Point(parseFloat(m[c+1]),parseFloat(m[c]));g.push(p)}l=new OpenLayers.Geometry.LineString(g)}else{if(n.length>0){var m=OpenLayers.String.trim(this.concatChildValues(n[0])).split(/\s+/);var g=[];var p;for(var c=0,j=m.length;c<j;c+=2){p=new OpenLayers.Geometry.Point(parseFloat(m[c+1]),parseFloat(m[c]));g.push(p)}l=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(g)])}else{if(d.length>0){if(!this.gmlParser){this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})}var r=this.gmlParser.parseFeature(d[0]);l=r.geometry}else{if(f.length>0){var m=OpenLayers.String.trim(f[0].firstChild.nodeValue).split(/\s+/);var g=[];var p;if(m.length>3){p=new OpenLayers.Geometry.Point(parseFloat(m[1]),parseFloat(m[0]));g.push(p);p=new OpenLayers.Geometry.Point(parseFloat(m[1]),parseFloat(m[2]));g.push(p);p=new OpenLayers.Geometry.Point(parseFloat(m[3]),parseFloat(m[2]));g.push(p);p=new OpenLayers.Geometry.Point(parseFloat(m[3]),parseFloat(m[0]));g.push(p);p=new OpenLayers.Geometry.Point(parseFloat(m[1]),parseFloat(m[0]));g.push(p)}l=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(g)])}}}}}if(l&&this.internalProjection&&this.externalProjection){l.transform(this.externalProjection,this.internalProjection)}return l},createFeatureFromItem:function(l){var f=this.createGeometryFromItem(l);var j=this.getChildValue(l,"*","title",this.featureTitle);var k=this.getChildValue(l,"*","description",this.getChildValue(l,"*","content",this.getChildValue(l,"*","summary",this.featureDescription)));var g=this.getChildValue(l,"*","link");if(!g){try{g=this.getElementsByTagNameNS(l,"*","link")[0].getAttribute("href")}catch(d){g=null}}var b=this.getChildValue(l,"*","id",null);var c={title:j,description:k,link:g};var m=new OpenLayers.Feature.Vector(f,c);m.fid=b;return m},getChildValue:function(f,c,d,j){var g;var b=this.getElementsByTagNameNS(f,c,d);if(b&&b[0]&&b[0].firstChild&&b[0].firstChild.nodeValue){g=OpenLayers.Format.XML.prototype.getChildValue(b[0])}else{g=(j==undefined)?"":j}return g},read:function(g){if(typeof g=="string"){g=OpenLayers.Format.XML.prototype.read.apply(this,[g])}var b=null;b=this.getElementsByTagNameNS(g,"*","item");if(b.length==0){b=this.getElementsByTagNameNS(g,"*","entry")}var d=b.length;var f=new Array(d);for(var c=0;c<d;c++){f[c]=this.createFeatureFromItem(b[c])}return f},write:function(d){var f;if(OpenLayers.Util.isArray(d)){f=this.createElementNS(this.rssns,"rss");for(var c=0,b=d.length;c<b;c++){f.appendChild(this.createFeatureXML(d[c]))}}else{f=this.createFeatureXML(d)}return OpenLayers.Format.XML.prototype.write.apply(this,[f])},createFeatureXML:function(n){var j=this.buildGeometryNode(n.geometry);var b=this.createElementNS(this.rssns,"item");var f=this.createElementNS(this.rssns,"title");f.appendChild(this.createTextNode(n.attributes.title?n.attributes.title:""));var c=this.createElementNS(this.rssns,"description");c.appendChild(this.createTextNode(n.attributes.description?n.attributes.description:""));b.appendChild(f);b.appendChild(c);if(n.attributes.link){var l=this.createElementNS(this.rssns,"link");l.appendChild(this.createTextNode(n.attributes.link));b.appendChild(l)}for(var m in n.attributes){if(m=="link"||m=="title"||m=="description"){continue}var k=this.createTextNode(n.attributes[m]);var g=m;if(m.search(":")!=-1){g=m.split(":")[1]}var d=this.createElementNS(this.featureNS,"feature:"+g);d.appendChild(k);b.appendChild(d)}b.appendChild(j);return b},buildGeometryNode:function(c){if(this.internalProjection&&this.externalProjection){c=c.clone();c.transform(this.internalProjection,this.externalProjection)}var b;if(c.CLASS_NAME=="OpenLayers.Geometry.Polygon"){b=this.createElementNS(this.georssns,"georss:polygon");b.appendChild(this.buildCoordinatesNode(c.components[0]))}else{if(c.CLASS_NAME=="OpenLayers.Geometry.LineString"){b=this.createElementNS(this.georssns,"georss:line");b.appendChild(this.buildCoordinatesNode(c))}else{if(c.CLASS_NAME=="OpenLayers.Geometry.Point"){b=this.createElementNS(this.georssns,"georss:point");b.appendChild(this.buildCoordinatesNode(c))}else{throw"Couldn't parse "+c.CLASS_NAME}}}return b},buildCoordinatesNode:function(j){var d=null;if(j.components){d=j.components}var g;if(d){var c=d.length;var f=new Array(c);for(var b=0;b<c;b++){f[b]=d[b].y+" "+d[b].x}g=f.join(" ")}else{g=j.y+" "+j.x}return this.createTextNode(g)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(b){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};OpenLayers.Format.prototype.initialize.apply(this,[b])},read:function(j){var g,f,l;j=j.replace(/[\n\r]/g," ");var k=this.regExes.typeStr.exec(j);if(k){f=k[1].toLowerCase();l=k[2];if(this.parse[f]){g=this.parse[f].apply(this,[l])}if(this.internalProjection&&this.externalProjection){if(g&&g.CLASS_NAME=="OpenLayers.Feature.Vector"){g.geometry.transform(this.externalProjection,this.internalProjection)}else{if(g&&f!="geometrycollection"&&typeof g=="object"){for(var d=0,b=g.length;d<b;d++){var c=g[d];c.geometry.transform(this.externalProjection,this.internalProjection)}}}}}return g},write:function(b){var j,m,l,f,c;if(b.constructor==Array){j=b;c=true}else{j=[b];c=false}var d=[];if(c){d.push("GEOMETRYCOLLECTION(")}for(var g=0,k=j.length;g<k;++g){if(c&&g>0){d.push(",")}m=j[g].geometry;d.push(this.extractGeometry(m))}if(c){d.push(")")}return d.join("")},extractGeometry:function(f){var c=f.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[c]){return null}if(this.internalProjection&&this.externalProjection){f=f.clone();f.transform(this.internalProjection,this.externalProjection)}var b=c=="collection"?"GEOMETRYCOLLECTION":c.toUpperCase();var d=b+"("+this.extract[c].apply(this,[f])+")";return d},extract:{point:function(b){return b.x+" "+b.y},multipoint:function(d){var f=[];for(var c=0,b=d.components.length;c<b;++c){f.push("("+this.extract.point.apply(this,[d.components[c]])+")")}return f.join(",")},linestring:function(c){var f=[];for(var d=0,b=c.components.length;d<b;++d){f.push(this.extract.point.apply(this,[c.components[d]]))}return f.join(",")},multilinestring:function(d){var f=[];for(var c=0,b=d.components.length;c<b;++c){f.push("("+this.extract.linestring.apply(this,[d.components[c]])+")")}return f.join(",")},polygon:function(d){var f=[];for(var c=0,b=d.components.length;c<b;++c){f.push("("+this.extract.linestring.apply(this,[d.components[c]])+")")}return f.join(",")},multipolygon:function(f){var d=[];for(var c=0,b=f.components.length;c<b;++c){d.push("("+this.extract.polygon.apply(this,[f.components[c]])+")")}return d.join(",")},collection:function(d){var f=[];for(var c=0,b=d.components.length;c<b;++c){f.push(this.extractGeometry.apply(this,[d.components[c]]))}return f.join(",")}},parse:{point:function(c){var b=OpenLayers.String.trim(c).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b[0],b[1]))},multipoint:function(j){var c;var f=OpenLayers.String.trim(j).split(",");var g=[];for(var d=0,b=f.length;d<b;++d){c=f[d].replace(this.regExes.trimParens,"$1");g.push(this.parse.point.apply(this,[c]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(g))},linestring:function(g){var d=OpenLayers.String.trim(g).split(",");var f=[];for(var c=0,b=d.length;c<b;++c){f.push(this.parse.point.apply(this,[d[c]]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(f))},multilinestring:function(j){var d;var c=OpenLayers.String.trim(j).split(this.regExes.parenComma);var g=[];for(var f=0,b=c.length;f<b;++f){d=c[f].replace(this.regExes.trimParens,"$1");g.push(this.parse.linestring.apply(this,[d]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(g))},polygon:function(l){var d,c,j;var k=OpenLayers.String.trim(l).split(this.regExes.parenComma);var g=[];for(var f=0,b=k.length;f<b;++f){d=k[f].replace(this.regExes.trimParens,"$1");c=this.parse.linestring.apply(this,[d]).geometry;j=new OpenLayers.Geometry.LinearRing(c.components);g.push(j)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(g))},multipolygon:function(j){var f;var c=OpenLayers.String.trim(j).split(this.regExes.doubleParenComma);var g=[];for(var d=0,b=c.length;d<b;++d){f=c[d].replace(this.regExes.trimParens,"$1");g.push(this.parse.polygon.apply(this,[f]).geometry)}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(g))},geometrycollection:function(g){g=g.replace(/,\s*([A-Za-z])/g,"|$1");var f=OpenLayers.String.trim(g).split("|");var d=[];for(var c=0,b=f.length;c<b;++c){d.push(OpenLayers.Format.WKT.prototype.read.apply(this,[f[c]]))}return d}},CLASS_NAME:"OpenLayers.Format.WKT"});OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,nativeJSON:(function(){return !!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")})(),read:function(json,filter){var object;if(this.nativeJSON){object=JSON.parse(json,filter)}else{try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){object=eval("("+json+")");if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i])}}}return filter(k,v)}object=walk("",object)}}}catch(e){}}if(this.keepData){this.data=object}return object},write:function(g,d){this.pretty=!!d;var b=null;var c=typeof g;if(this.serialize[c]){try{b=(!this.pretty&&this.nativeJSON)?JSON.stringify(g):this.serialize[c].apply(this,[g])}catch(f){OpenLayers.Console.error("Trouble serializing: "+f)}}return b},writeIndent:function(){var c=[];if(this.pretty){for(var b=0;b<this.level;++b){c.push(this.indent)}}return c.join("")},writeNewline:function(){return(this.pretty)?this.newline:""},writeSpace:function(){return(this.pretty)?this.space:""},serialize:{object:function(d){if(d==null){return"null"}if(d.constructor==Date){return this.serialize.date.apply(this,[d])}if(d.constructor==Array){return this.serialize.array.apply(this,[d])}var j=["{"];this.level+=1;var f,c,g;var b=false;for(f in d){if(d.hasOwnProperty(f)){c=OpenLayers.Format.JSON.prototype.write.apply(this,[f,this.pretty]);g=OpenLayers.Format.JSON.prototype.write.apply(this,[d[f],this.pretty]);if(c!=null&&g!=null){if(b){j.push(",")}j.push(this.writeNewline(),this.writeIndent(),c,":",this.writeSpace(),g);b=true}}}this.level-=1;j.push(this.writeNewline(),this.writeIndent(),"}");return j.join("")},array:function(g){var d;var f=["["];this.level+=1;for(var c=0,b=g.length;c<b;++c){d=OpenLayers.Format.JSON.prototype.write.apply(this,[g[c],this.pretty]);if(d!=null){if(c>0){f.push(",")}f.push(this.writeNewline(),this.writeIndent(),d)}}this.level-=1;f.push(this.writeNewline(),this.writeIndent(),"]");return f.join("")},string:function(c){var b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(/["\\\x00-\x1f]/.test(c)){return'"'+c.replace(/([\x00-\x1f\\"])/g,function(f,d){var g=b[d];if(g){return g}g=d.charCodeAt();return"\\u00"+Math.floor(g/16).toString(16)+(g%16).toString(16)})+'"'}return'"'+c+'"'},number:function(b){return isFinite(b)?String(b):"null"},"boolean":function(b){return String(b)},date:function(b){function c(d){return(d<10)?"0"+d:d}return'"'+b.getFullYear()+"-"+c(b.getMonth()+1)+"-"+c(b.getDate())+"T"+c(b.getHours())+":"+c(b.getMinutes())+":"+c(b.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:false,read:function(m,k,b){k=(k)?k:"FeatureCollection";var f=null;var d=null;if(typeof m=="string"){d=OpenLayers.Format.JSON.prototype.read.apply(this,[m,b])}else{d=m}if(!d){OpenLayers.Console.error("Bad JSON: "+m)}else{if(typeof(d.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+m)}else{if(this.isValidType(d,k)){switch(k){case"Geometry":try{f=this.parseGeometry(d)}catch(c){OpenLayers.Console.error(c)}break;case"Feature":try{f=this.parseFeature(d);f.type="Feature"}catch(c){OpenLayers.Console.error(c)}break;case"FeatureCollection":f=[];switch(d.type){case"Feature":try{f.push(this.parseFeature(d))}catch(c){f=null;OpenLayers.Console.error(c)}break;case"FeatureCollection":for(var g=0,j=d.features.length;g<j;++g){try{f.push(this.parseFeature(d.features[g]))}catch(c){f=null;OpenLayers.Console.error(c)}}break;default:try{var l=this.parseGeometry(d);f.push(new OpenLayers.Feature.Vector(l))}catch(c){f=null;OpenLayers.Console.error(c)}}break}}}}return f},isValidType:function(d,b){var c=false;switch(b){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],d.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+d.type)}else{c=true}break;case"FeatureCollection":c=true;break;default:if(d.type==b){c=true}else{OpenLayers.Console.error("Cannot convert types from "+d.type+" to "+b)}}return c},parseFeature:function(f){var c,j,b,g;b=(f.properties)?f.properties:{};g=(f.geometry&&f.geometry.bbox)||f.bbox;try{j=this.parseGeometry(f.geometry)}catch(d){throw d}c=new OpenLayers.Feature.Vector(j,b);if(g){c.bounds=OpenLayers.Bounds.fromArray(g)}if(f.id){c.fid=f.id}return c},parseGeometry:function(g){if(g==null){return null}var k,j=false;if(g.type=="GeometryCollection"){if(!(OpenLayers.Util.isArray(g.geometries))){throw"GeometryCollection must have geometries array: "+g}var c=g.geometries.length;var f=new Array(c);for(var b=0;b<c;++b){f[b]=this.parseGeometry.apply(this,[g.geometries[b]])}k=new OpenLayers.Geometry.Collection(f);j=true}else{if(!(OpenLayers.Util.isArray(g.coordinates))){throw"Geometry must have coordinates array: "+g}if(!this.parseCoords[g.type.toLowerCase()]){throw"Unsupported geometry type: "+g.type}try{k=this.parseCoords[g.type.toLowerCase()].apply(this,[g.coordinates])}catch(d){throw d}}if(this.internalProjection&&this.externalProjection&&!j){k.transform(this.externalProjection,this.internalProjection)}return k},parseCoords:{point:function(b){if(this.ignoreExtraDims==false&&b.length!=2){throw"Only 2D points are supported: "+b}return new OpenLayers.Geometry.Point(b[0],b[1])},multipoint:function(j){var d=[];var g=null;for(var c=0,b=j.length;c<b;++c){try{g=this.parseCoords.point.apply(this,[j[c]])}catch(f){throw f}d.push(g)}return new OpenLayers.Geometry.MultiPoint(d)},linestring:function(j){var d=[];var g=null;for(var c=0,b=j.length;c<b;++c){try{g=this.parseCoords.point.apply(this,[j[c]])}catch(f){throw f}d.push(g)}return new OpenLayers.Geometry.LineString(d)},multilinestring:function(j){var d=[];var c=null;for(var f=0,b=j.length;f<b;++f){try{c=this.parseCoords.linestring.apply(this,[j[f]])}catch(g){throw g}d.push(c)}return new OpenLayers.Geometry.MultiLineString(d)},polygon:function(k){var j=[];var g,c;for(var d=0,b=k.length;d<b;++d){try{c=this.parseCoords.linestring.apply(this,[k[d]])}catch(f){throw f}g=new OpenLayers.Geometry.LinearRing(c.components);j.push(g)}return new OpenLayers.Geometry.Polygon(j)},multipolygon:function(j){var c=[];var g=null;for(var d=0,b=j.length;d<b;++d){try{g=this.parseCoords.polygon.apply(this,[j[d]])}catch(f){throw f}c.push(g)}return new OpenLayers.Geometry.MultiPolygon(c)},box:function(b){if(b.length!=2){throw"GeoJSON box coordinates must have 2 elements"}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(b[0][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[0][1]),new OpenLayers.Geometry.Point(b[1][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[1][1]),new OpenLayers.Geometry.Point(b[0][0],b[0][1])])])}},write:function(g,f){var b={type:null};if(OpenLayers.Util.isArray(g)){b.type="FeatureCollection";var k=g.length;b.features=new Array(k);for(var d=0;d<k;++d){var c=g[d];if(!c instanceof OpenLayers.Feature.Vector){var j="FeatureCollection only supports collections of features: "+c;throw j}b.features[d]=this.extract.feature.apply(this,[c])}}else{if(g.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){b=this.extract.geometry.apply(this,[g])}else{if(g instanceof OpenLayers.Feature.Vector){b=this.extract.feature.apply(this,[g]);if(g.layer&&g.layer.projection){b.crs=this.createCRSObject(g)}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[b,f])},createCRSObject:function(c){var d=c.layer.projection.toString();var b={};if(d.match(/epsg:/i)){var f=parseInt(d.substring(d.indexOf(":")+1));if(f==4326){b={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}}else{b={type:"name",properties:{name:"EPSG:"+f}}}}return b},extract:{feature:function(d){var c=this.extract.geometry.apply(this,[d.geometry]);var b={type:"Feature",properties:d.attributes,geometry:c};if(d.fid!=null){b.id=d.fid}return b},geometry:function(f){if(f==null){return null}if(this.internalProjection&&this.externalProjection){f=f.clone();f.transform(this.internalProjection,this.externalProjection)}var b=f.CLASS_NAME.split(".")[2];var d=this.extract[b.toLowerCase()].apply(this,[f]);var c;if(b=="Collection"){c={type:"GeometryCollection",geometries:d}}else{c={type:b,coordinates:d}}return c},point:function(b){return[b.x,b.y]},multipoint:function(d){var f=[];for(var c=0,b=d.components.length;c<b;++c){f.push(this.extract.point.apply(this,[d.components[c]]))}return f},linestring:function(c){var f=[];for(var d=0,b=c.components.length;d<b;++d){f.push(this.extract.point.apply(this,[c.components[d]]))}return f},multilinestring:function(d){var f=[];for(var c=0,b=d.components.length;c<b;++c){f.push(this.extract.linestring.apply(this,[d.components[c]]))}return f},polygon:function(d){var f=[];for(var c=0,b=d.components.length;c<b;++c){f.push(this.extract.linestring.apply(this,[d.components[c]]))}return f},multipolygon:function(f){var d=[];for(var c=0,b=f.components.length;c<b;++c){d.push(this.extract.polygon.apply(this,[f.components[c]]))}return d},collection:function(d){var b=d.components.length;var f=new Array(b);for(var c=0;c<b;++c){f[c]=this.extract.geometry.apply(this,[d.components[c]])}return f}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Format.EncodedPolyline=OpenLayers.Class(OpenLayers.Format,{geometryType:"linestring",initialize:function(b){OpenLayers.Format.prototype.initialize.apply(this,[b])},read:function(k){var d;if(this.geometryType=="linestring"){d=OpenLayers.Geometry.LineString}else{if(this.geometryType=="linearring"){d=OpenLayers.Geometry.LinearRing}else{if(this.geometryType=="multipoint"){d=OpenLayers.Geometry.MultiPoint}else{if(this.geometryType!="point"&&this.geometryType!="polygon"){return null}}}}var j=this.decodeDeltas(k,2);var f=j.length;var c=[];for(var g=0;g+1<f;){var l=j[g++],b=j[g++];c.push(new OpenLayers.Geometry.Point(b,l))}if(this.geometryType=="point"){return new OpenLayers.Feature.Vector(c[0])}if(this.geometryType=="polygon"){return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(c)]))}return new OpenLayers.Feature.Vector(new d(c))},decode:function(d,m,j){var k=j||100000;var b=this.decodeDeltas(d,m,k);var c=b.length;var n=[];for(var f=0;f+(m-1)<c;){var l=[];for(var g=0;g<m;++g){l.push(b[f++])}n.push(l)}return n},write:function(c){var m;if(c.constructor==Array){m=c[0]}else{m=c}var l=m.geometry;var k=l.CLASS_NAME.split(".")[2].toLowerCase();var g;if(k=="point"){g=new Array(l)}else{if(k=="linestring"||k=="linearring"||k=="multipoint"){g=l.components}else{if(k=="polygon"){g=l.components[0].components}else{return null}}}var b=[];var d=g.length;for(var j=0;j<d;++j){var f=g[j];b.push(f.y);b.push(f.x)}return this.encodeDeltas(b,2)},encode:function(m,k,f){var g=f||100000;var b=[];var j=m.length;for(var c=0;c<j;++c){var l=m[c];for(var d=0;d<k;++d){b.push(l[d])}}return this.encodeDeltas(b,k,g)},encodeDeltas:function(o,b,g){var k=g||100000;var j;var n=new Array(b);for(j=0;j<b;++j){n[j]=0}var l=o.length;for(var c=0;c<l;){for(j=0;j<b;++j,++c){var f=o[c];var m=f-n[j];n[j]=f;o[c]=m}}return this.encodeFloats(o,k)},decodeDeltas:function(b,c,g){var k=g||100000;var j;var m=new Array(c);for(j=0;j<c;++j){m[j]=0}var n=this.decodeFloats(b,k);var l=n.length;for(var f=0;f<l;){for(j=0;j<c;++j,++f){m[j]+=n[f];n[f]=m[j]}}return n},encodeFloats:function(d,c){var g=c||100000;var b=d.length;for(var f=0;f<b;++f){d[f]=Math.round(d[f]*g)}return this.encodeSignedIntegers(d)},decodeFloats:function(j,d){var g=d||100000;var c=this.decodeSignedIntegers(j);var b=c.length;for(var f=0;f<b;++f){c[f]/=g}return c},encodeSignedIntegers:function(c){var b=c.length;for(var f=0;f<b;++f){var d=c[f];var g=d<<1;if(d<0){g=~(g)}c[f]=g}return this.encodeUnsignedIntegers(c)},decodeSignedIntegers:function(g){var c=this.decodeUnsignedIntegers(g);var b=c.length;for(var f=0;f<b;++f){var d=c[f];c[f]=(d&1)?~(d>>1):(d>>1)}return c},encodeUnsignedIntegers:function(c){var f="";var b=c.length;for(var d=0;d<b;++d){f+=this.encodeUnsignedInteger(c[d])}return f},decodeUnsignedIntegers:function(l){var f=[];var k=0;var d=0;var j=l.length;for(var g=0;g<j;++g){var c=l.charCodeAt(g)-63;k|=(c&31)<<d;if(c<32){f.push(k);k=0;d=0}else{d+=5}}return f},encodeFloat:function(c,b){c=Math.round(c*(b||100000));return this.encodeSignedInteger(c)},decodeFloat:function(d,c){var b=this.decodeSignedInteger(d);return b/(c||100000)},encodeSignedInteger:function(b){var c=b<<1;if(b<0){c=~(c)}return this.encodeUnsignedInteger(c)},decodeSignedInteger:function(c){var b=this.decodeUnsignedInteger(c);return((b&1)?~(b>>1):(b>>1))},encodeUnsignedInteger:function(b){var c,d="";while(b>=32){c=(32|(b&31))+63;d+=(String.fromCharCode(c));b>>=5}c=b+63;d+=(String.fromCharCode(c));return d},decodeUnsignedInteger:function(k){var d=0;var f=0;var j=k.length;for(var g=0;g<j;++g){var c=k.charCodeAt(g)-63;d|=(c&31)<<f;if(c<32){break}f+=5}return d},CLASS_NAME:"OpenLayers.Format.EncodedPolyline"});OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["locationupdated","locationfailed","locationuncapable"],geolocation:navigator.geolocation,bind:true,watch:false,geolocationOptions:null,initialize:function(b){this.EVENT_TYPES=OpenLayers.Control.Geolocate.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);this.geolocationOptions={};OpenLayers.Control.prototype.initialize.apply(this,[b])},destroy:function(){this.deactivate();OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){if(!this.geolocation){this.events.triggerEvent("locationuncapable");return false}if(OpenLayers.Control.prototype.activate.apply(this,arguments)){if(this.watch){this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions)}else{this.getCurrentLocation()}return true}return false},deactivate:function(){if(this.active&&this.watchId!==null){this.geolocation.clearWatch(this.watchId)}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(c){var b=new OpenLayers.LonLat(c.coords.longitude,c.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());if(this.bind){this.map.setCenter(b)}this.events.triggerEvent("locationupdated",{position:c,point:new OpenLayers.Geometry.Point(b.lon,b.lat)})},getCurrentLocation:function(){if(!this.active||this.watch){return false}this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);return true},failure:function(b){this.events.triggerEvent("locationfailed",{error:b})},CLASS_NAME:"OpenLayers.Control.Geolocate"});OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode()}return OpenLayers.Lang.code},setCode:function(c){var f;if(!c){c=(OpenLayers.BROWSER_NAME=="msie")?navigator.userLanguage:navigator.language}var d=c.split("-");d[0]=d[0].toLowerCase();if(typeof OpenLayers.Lang[d[0]]=="object"){f=d[0]}if(d[1]){var b=d[0]+"-"+d[1].toUpperCase();if(typeof OpenLayers.Lang[b]=="object"){f=b}}if(!f){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+d.join("-")+" dictionary, falling back to default language");f=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=f},translate:function(c,b){var f=OpenLayers.Lang[OpenLayers.Lang.getCode()];var d=f&&f[c];if(!d){d=c}if(b){d=OpenLayers.String.format(d,b)}return d}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Base Layer",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>","Scale = 1 : ${scaleDenom}":"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",Graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",proxyNeeded:"You probably need to set OpenLayers.ProxyHost to access ${url}.See http://trac.osgeo.org/openlayers/wiki/FrequentlyAskedQuestions#ProxyHost",end:""};OpenLayers.IAAA_Style=OpenLayers.Class.create();OpenLayers.IAAA_Style.prototype={name:null,title:null,layer:null,legendList:null,initialize:function(c,f,g,b){this.legendList=new Array();this.name=c;if(g!=null){this.title=g;this.layer=f}else{this.title=c}if(b!=null){for(var d in b){this.legendList[d]=b[d]}}},setLayer:function(b){this.layer=b},getLegendList:function(){return this.legendList},getName:function(){return this.name},getTitle:function(){return this.title},setName:function(b){this.name=b},setTitle:function(b){this.title=b},setLegendList:function(b){this.legendList=b},clone:function(b){if(b==null){b=new OpenLayers.IAAA_Style(this.name,null,this.title,OpenLayers.IAAA_Utils.cloneObject(this.legendList))}return b},getStyleString:function(){var b="";if(this.getName()){b="<NamedStyle>";b+="<Name>"+this.getName()+"</Name>";b+="</NamedStyle>"}return b},CLASS_NAME:"OpenLayers.IAAA_Style"};if(OpenLayers&&((OpenLayers.IAAA_Utils==undefined)||(OpenLayers.IAAA_Utils==null))){OpenLayers.IAAA_Utils={};OpenLayers.IAAA_Utils.notifyMessage=function(b){alert(b)};OpenLayers.IAAA_Utils.baseClassLoaded=true;OpenLayers.IAAA_Utils.isNetscape=function(){if(document.all){if(navigator.userAgent.indexOf("Opera")!=-1&&document.getElementById){return true}return false}else{return true}};OpenLayers.IAAA_Utils.navigatorInfo=null;OpenLayers.IAAA_Utils.getNavigator=function(){if(OpenLayers.IAAA_Utils.navigatorInfo==null){var k="firefox";var g="3.x";var l=window.navigator.userAgent.toLowerCase();var b="pc";var m;if(/firefox[\/\s](\d+\.\d+)/.test(l)){k="firefox";var f=new Number(RegExp.$1);if(f>=4){g="4.x"}else{if(f>=3){g="3.x"}else{if(f>=2){g="2.x"}else{if(f>=1){g="1.x"}}}}var d=(typeof ontouchstart!="undefined");if((/android/.test(l))||d){b="mobile"}}else{if(/msie (\d+\.\d+);/.test(l)){k="msie";var j=new Number(RegExp.$1);if(j>=10){g="10.x"}else{if(j>=9){g="9.x"}else{if(j>=8){g="8.x"}else{if(j>=7){g="7.x"}else{if(j>=6){g="6.x"}else{if(j>=5){g="5.x"}}}}}}var d=(/touch;/.test(l))&&((typeof onpointerdown!="undefined")||(typeof onmspointerdown!="undefined"));if((/tablet pc (\d+\.\d+);/.test(l))||(/windows phone/.test(l))||d){b="mobile"}}else{if(/opera[\/\s](\d+\.\d+)/.test(l)){k="opera";var c=new Number(RegExp.$1);if(c>=10){g="10.x"}else{if(c>=9){g="9.x"}else{if(c>=8){g="8.x"}else{if(c>=7){g="7.x"}}}}var d=(typeof ontouchstart!="undefined");if((/android/.test(l))||d){b="mobile"}}else{if(/webkit/.test(l)&&!/chrome/.test(l)&&!/android/.test(l)){k="safari";g=(l.match(/.+(?:rv|it|ra|ie|me)[\/: ]([\d.]+)/)||[])[1];var d=(typeof ontouchstart!="undefined");if((/mobile/.test(l))||d){b="mobile"}}else{if((/mozilla[\/\s](\d+\.\d+)/.test(l))&&(/trident/.test(l))){var d=((/touch/.test(l))||(/tablet pc/.test(l)))&&((typeof onpointerdown!="undefined")||(typeof onmspointerdown!="undefined"));if((/tablet pc (\d+\.\d+);/.test(l))||(/windows phone/.test(l))||d){b="mobile"}(/rv\:(\d+\.\d+)/.test(l));g=new Number(RegExp.$1);m="msie"}else{if((/mozilla[\/\s](\d+\.\d+)/.test(l))&&(/edge/.test(l))){var d=(/msapphost/.test(l))&&((typeof onpointerdown!="undefined")||(typeof onmspointerdown!="undefined"));if((/windows phone/.test(l))||d){b="mobile"}(/rv\:(\d+\.\d+)/.test(l));g=new Number(RegExp.$1);m="msie"}else{if(/chrome/.test(l)){k="chrome";g=(l.match(/.+(?:rv|it|ra|ie|me)[\/: ]([\d.]+)/)||[])[1];var d=(typeof ontouchstart!="undefined");if((/android/.test(l))||d){b="mobile"}}else{if(/android/.test(l)){k="android";g=(l.match(/android (\d+(?:\.\d+){1,2});/)||[])[1];b="mobile"}}}}}}}}var n=new Array(4);n[0]=k;n[1]=g;n[2]=b;n[3]=m;OpenLayers.IAAA_Utils.navigatorInfo=n}return OpenLayers.IAAA_Utils.navigatorInfo};OpenLayers.IAAA_Utils.getActualNavigator=function(){var b=OpenLayers.IAAA_Utils.getNavigator();if(b[3]){return b[3]}else{return b[0]}};OpenLayers.IAAA_Utils.Trim=function(b){while((b.substring(0,1)==" ")||(b.substring(0,1)=="\n")||(b.substring(0,1)=="\r")){b=b.substring(1,b.length)}while((b.substring(b.length-1,b.length)==" ")||(b.substring(b.length-1,b.length)=="\n")||(b.substring(b.length-1,b.length)=="\r")){b=b.substring(0,b.length-1)}return b};OpenLayers.IAAA_Utils.replaceCad=function(j,g,f){var b=j+"";var c="";while(b.indexOf(g)!=-1){var d=b.indexOf(g);c+=b.substring(0,d)+f;b=b.substring(d+g.length)}return(c+b)};OpenLayers.IAAA_Utils.getLayerByName=function(j,d){var g=null;if(j.name==d){return j}else{var k;if(j.getLayerList){k=j.getLayerList()}else{if(j.getChildLayerList){k=j.getChildLayerList()}}for(var f=0;f<k.length;f++){var b=k[f];if(b.name==d){return b}else{if(b.getChildLayerList()){var c=OpenLayers.IAAA_Utils.getLayerByName(b,d);if(c){return c}}}}}return null};OpenLayers.IAAA_Utils.isLayerInLayers=function(c,f){var d=false;var b;for(b=0;b<f.length;b++){if(f[b].name==c.name){d=true;break}}if(!d){b=-1}return[d,b]};quotedStringToVector=function(g,j){var b=new Array();var c=0;var d=0;var f=0;while(d<g.length){c=d;while((d<g.length)&&(g.charAt(d)!=j)){d++}b[f]=g.substring(c,d);f++;d++}return b};addEvent=OpenLayers.IAAA_Utils.addEvent;OpenLayers.IAAA_Utils.addEvent=function(g,d,c,b){if(g.addEventListener){g.addEventListener(d,c,b);return true}else{if(g.attachEvent){var f=g.attachEvent("on"+d,c);return f}else{alert("Handler could not be attached")}}};removeEvent=function(g,d,c,b){if(g.removeEventListener){g.removeEventListener(d,c,b);return true}else{if(g.detachEvent){var f=g.detachEvent("on"+d,c);return f}else{alert("Handler could not be removed")}}};isPNGImage=function(b){if(b.substring(b.length-4,b.length)==".png"){return true}else{return false}};isClientReady=function(){if(parent){if(parent.clientReady){return parent.clientReady}}return false};enableMainClient=function(b){if(indexReference&&indexReference.doEnableClient){indexReference.doEnableClient(b)}};enableMainClient2=function(b){if(indexReference){if(indexReference.mapReference&&indexReference.mapReference.document.getElementById("disableClientDiv")){indexReference.mapReference.document.getElementById("disableClientDiv").style.visibility="hidden"}if(indexReference.treeReference&&indexReference.treeReference.document.getElementById("disableClientDiv")){indexReference.treeReference.document.getElementById("disableClientDiv").style.visibility="hidden"}}};disableMainClient=function(b){if(indexReference&&indexReference.doDisableClient){indexReference.doDisableClient(b)}};disableMainClient2=function(b){if(indexReference){if(indexReference.mapReference&&indexReference.mapReference.document.getElementById("disableClientDiv")){indexReference.mapReference.document.getElementById("disableClientDiv").style.visibility="visible"}if(indexReference.treeReference&&indexReference.treeReference.document.getElementById("disableClientDiv")){indexReference.treeReference.document.getElementById("disableClientDiv").style.visibility="visible"}}};getDragBox=function(){return dragBoxAux};degrees2radians=function(b){return(b*Math.PI/180)};radians2degrees=function(b){return(b*180/Math.PI)};getWMSClientPath=function(){return wmsClientPath};getVacioGif=function(){return getGraphicLibFolder()+"vacio.gif"};getWMSClientFolder=function(){return"../"};RoundDecimal=function(f,g){var b=Math.pow(10,g);var c=f*b;return(Math.round(c)/b)};getTree=function(){if(window.parent&&window.parent.frames&&window.parent.frames.tree&&window.parent.frames.tree.tree){return window.parent.frames.tree.tree}else{if(window.parent&&window.parent.frames&&window.parent.frames[1]&&window.parent.frames[1].tree){return window.parent.frames[1].tree}else{return null}}};getIndexWindow=function(){if(window.parent){return window.parent}else{return window}};OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs=false,OpenLayers.IAAA_Utils.buttonAutomaticSrs=function(){if(OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs||(!getMap())){return}var b=document.getElementById("automaticSrsList");if(b.selectedIndex>=0){var d=b.options[b.selectedIndex].value;if(d=="automaticSrs"){if(!getMap().baseLayer){return}var f=getMap().baseLayer.scales[getMap().getZoom()];getMap().automaticSrs=true;var c=getMap().getAutomaticSrs(f);OpenLayers.IAAA_Utils.changeSrs(c)}else{getMap().automaticSrs=false;if(isSupportedSrs(d)){OpenLayers.IAAA_Utils.changeSrs(d)}}comboSrsSelected=d}};OpenLayers.IAAA_Utils.changeSrs=function(b){oldSrs=getMap().getProjection();if(oldSrs!=b){getMap().changeSrs(b)}};OpenLayers.IAAA_Utils.changeAutomaticSrs=function(c){var b=getMap();if(automaticSrs){if(c>=scaleLevelSrs){newSrs="EPSG:4258"}else{var d=b.getExtent().right;if(b.getProjection()!="EPSG:4258"){punto=OpenLayers.IAAA_Utils.coordTransform(b.getProjection(),"EPSG:4258",b.getExtent().right,b.getExtent().left);xMaxA=punto[0];punto=OpenLayers.IAAA_Utils.coordTransform(b.getProjection(),"EPSG:4258",b.getExtent().right,b.getExtent().left);xMaxB=punto[0];d=((xMaxA+xMaxB)/2)}if(d<=-10){newSrs="EPSG:25828"}else{newSrs="EPSG:25830"}}OpenLayers.IAAA_Utils.changeSrs(newSrs)}};OpenLayers.IAAA_Utils.createNewSelectionMenu=function(d,g,b,c,f){return new OpenLayers.IAAA_SelectionMenu(d,g,b,c,f)};OpenLayers.IAAA_Utils.loadSelectionMenuFromVector=function(d,c,b){d.loadFromVector(c,b)};OpenLayers.IAAA_Utils.isCanariasExtent=function(c,b){if(!c){return false}var d=c.right;if(b!="EPSG:4258"){punto=OpenLayers.IAAA_Utils.coordTransform(b,"EPSG:4258",c.right,c.bottom);xMaxA=punto[0];punto=OpenLayers.IAAA_Utils.coordTransform(b,"EPSG:4258",c.right,c.top);xMaxB=punto[0];d=((xMaxA+xMaxB)/2)}if(d<=-10){return true}else{return false}};OpenLayers.IAAA_Utils.getSrsForDescription=function(c){for(var b=0;b<supportedSrsListDescription.length;b++){if(supportedSrsListDescription[b]==c){return supportedSrsList[b]}}return""};OpenLayers.IAAA_Utils.isDisabledSrs=function(f,c){var d=OpenLayers.IAAA_Utils.isCanariasExtent(getMap().getExtent(),getMap().getProjection());if(f>indexReference.disableScaleLevelSrs){if(isProjectedSrs(c)){return true}else{if(d){var b=getDatum(c);if(OpenLayers.IAAA_Utils.Trim(b)=="ED50"){return true}}}}else{if(d){var b=getDatum(c);if(OpenLayers.IAAA_Utils.Trim(b)=="ED50"){return true}}}return false};OpenLayers.IAAA_Utils.updateChangeSrsList=function(){var f=getMap().getActualScale();if(indexReference.useAutomaticSrs){var o=false;var c=document.getElementById("automaticSrsList");if(c){var l=new Array(c.childNodes.length);for(var g=0;g<c.childNodes.length;g++){var j=c.childNodes[g];if(j.nodeName=="OPTION"){var n=j.value;if(!getMap().automaticSrs){if(n==getMap().projection){j.selected=true}else{j.selected=false}}if(OpenLayers.IAAA_Utils.isDisabledSrs(f,n)){if(j.selected&&!OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs){c.selectedIndex=0;indexReference.automaticSrs=false;o=true}if((getMap&&getMap()&&(!getMap().automaticSrs))&&(OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs)&&j.selected){l[g]=-1}else{l[g]=0}j.style.fontStyle="italic";j.style.color="graytext";j.disabled=true}else{if(OpenLayers.IAAA_Utils.getNavigator()[0]!="msie"){l[g]=-1;j.style.fontStyle="normal";j.style.color="black";j.disabled=false}else{l[g]=-1}}}else{if(j.nodeName=="OPTGROUP"){var m=j.label;var n=OpenLayers.IAAA_Utils.getSrsForDescription(m);if(!OpenLayers.IAAA_Utils.isDisabledSrs(f,n)){l[g]=1;j.style.fontStyle="normal";j.style.color="black";j.disabled=false}else{l[g]=-1}}else{l[g]=-1}}}if(OpenLayers.IAAA_Utils.getNavigator()[0]=="msie"){for(var d=l.length-1;d>=0;d--){if(l[d]==0){var j=c.childNodes[d];var m=j.innerHTML;var n=OpenLayers.IAAA_Utils.getSrsForDescription(m);var b=document.createElement("<optgroup label='"+m+"' title='"+n+"' style='color:graytext; font-style:normal;'/>");b.innerHTML=m;j.parentNode.replaceChild(b,j)}else{if(l[d]==1){var j=c.childNodes[d];var m=j.label;var n=OpenLayers.IAAA_Utils.getSrsForDescription(m);var k=document.createElement("<option name='"+n+"' value='"+n+"' style='color:black; font-style:normal;'>"+m+"</option>");k.innerHTML=m;j.parentNode.replaceChild(k,j)}}}}if((o)&&(!getMap().automaticSrs)){OpenLayers.IAAA_Utils.buttonAutomaticSrs()}}}OpenLayers.IAAA_Utils.decode_utf8=function(p){return decodeURIComponent(escape(p))}};OpenLayers.IAAA_Utils.selectChangeSrsListNode=function(j){var b=document.getElementById("automaticSrsList");if(b){var d=new Array(b.childNodes.length);for(var g=0;g<b.childNodes.length;g++){var f=b.childNodes[g];if((f.nodeName=="OPTION")||(f.nodeName=="OPTGROUP")){var l=(f.nodeName=="OPTION")?f.value:f.title;if(l==j){if((OpenLayers.IAAA_Utils.getNavigator()[0]=="msie")&&(f.nodeName=="OPTGROUP")){var c=f.label;var l=f.title;var k=document.createElement("<option name='"+l+"' value='"+l+"' style='color:black; font-style:normal;'>"+c+"</option>");k.innerHTML=c;f.parentNode.replaceChild(k,f);f=k}f.selected=true}else{f.selected=false}}}}};OpenLayers.IAAA_Utils.decodeHTMLSpecialChars=function(d){var b=new Array(["%3F%3F",""],["%C3%A1",""],["%C3%A9",""],["%C3%AD",""],["%C3%B3",""],["%C3%BA",""],["%2F","/"],["%C2%A1",""],["%C2%BD",""],["%C5%93",""],["%C3%8F",""],["%C3%F",""],["%25a",""],["%2C"," "],["%3F",""],["%28","("],["%29",")"],["+"," "],["%20"," "],["%F3",""]);for(var c in b){var f=b[c];d=OpenLayers.IAAA_Utils.replaceCad(d,f[0],f[1])}return d};OpenLayers.IAAA_Utils.decodeHtmlIsoSpecialChars=function(b){var g=b;g=g.replace("&amp;","&");var f=g.match(/&#[0-9]+;/g);if(f){for(var d=0;d<f.length;d++){var c=f[d].replace("&#","").replace(";","");g=g.replace(f[d],String.fromCharCode(c))}}return g};OpenLayers.IAAA_Utils.utf8_decode=function(g){var c=[],f=0,k=0,j=0,d=0,b=0;g+="";while(f<g.length){j=g.charCodeAt(f);if(j<128){c[k++]=String.fromCharCode(j);f++}else{if((j>191)&&(j<224)){d=g.charCodeAt(f+1);c[k++]=String.fromCharCode(((j&31)<<6)|(d&63));f+=2}else{d=g.charCodeAt(f+1);b=g.charCodeAt(f+2);c[k++]=String.fromCharCode(((j&15)<<12)|((d&63)<<6)|(b&63));f+=3}}}return c.join("")};OpenLayers.IAAA_Utils.utf8_encode=function(f){for(var j,d=-1,b=(f=f.split("")).length,g=String.fromCharCode;++d<b;f[d]=(j=f[d].charCodeAt(0))>=127?g(192|(j>>>6))+g(128|(j&63)):f[d]){}return f.join("")};OpenLayers.IAAA_Utils.contieneAcentos=function(g){var d=g;var j="";var c=new Array(["","A"],["","E"],["","I"],["","O"],["","U"],["","a"],["","e"],["","i"],["","o"],["","u"],["","A"],["","E"],["","I"],["","O"],["","U"],["","a"],["","e"],["","i"],["","o"],["","u"]);var f=0;var l=true;while(f<c.length&&l){var k=c[f];if(g.indexOf(k[0])==0){j=k[1]+g.substring(1,g.length);l=false}f++}var b=new Array(2);b[0]=d;b[1]=j;return b};OpenLayers.IAAA_Utils.getIndexElement=function(d,c){for(var b=0;b<d.length;b++){if(d[b]==c){return b}}return -1};OpenLayers.IAAA_Utils.getAspectDescription=function(d){var c="";if(d!=messages_territorial.noData){if(typeof(d)=="string"){d=parseFloat(d)}if(d<0){d=0}if(((d>337.5)&&(d<=360))||((d>=0)&&(d<=22.5))){c=messages_territorial.aspectNorth}else{if(((d>22.5)&&(d<=45))||((d>45)&&(d<=67.5))){c=messages_territorial.aspectNorthEast}else{if(((d>67.5)&&(d<=90))||((d>90)&&(d<=112.5))){c=messages_territorial.aspectEast}else{if(((d>112.5)&&(d<=135))||((d>135)&&(d<=157.5))){c=messages_territorial.aspectSouthEast}else{if(((d>157.5)&&(d<=180))||((d>180)&&(d<=202.5))){c=messages_territorial.aspectSouth}else{if(((d>202.5)&&(d<=225))||((d>225)&&(d<=247.5))){c=messages_territorial.aspectSouthWest}else{if(((d>247.5)&&(d<=270))||((d>270)&&(d<=292.5))){c=messages_territorial.aspectWest}else{if(((d>292.5)&&(d<=315))||((d>315)&&(d<=337.5))){c=messages_territorial.aspectNorthWest}}}}}}}}var b=d+"";if(c!=""){b+=" ("+c+")"}return b}else{return d}};OpenLayers.IAAA_Utils.quotedStringToVector=function(g,j){var b=new Array();var c=0;var d=0;var f=0;while(d<g.length){c=d;while((d<g.length)&&(g.charAt(d)!=j)){d++}b[f]=g.substring(c,d);f++;d++}return b};OpenLayers.IAAA_Utils.quotedStringOfParametersToVector=function(l){var c=new Array();var q=0;var m=0;var p=0;var n="&";while(m<l.length){q=m;while((m<l.length)&&(l.charAt(m)!=n)){m++}c[p]=l.substring(q,m);p++;m++}var d=new Array();var b="=";for(var g in c){var o=c[g];var f=0;while((f<o.length)&&(o.charAt(f)!=b)){f++}d[o.substring(0,f)]=o.substring(f+1,o.length)}return d};OpenLayers.IAAA_Utils.getIAAA_Request=function(c,b){return new OpenLayers.Ajax.IAAA_Request(c,b)};OpenLayers.IAAA_Utils.getPixel=function(b,c){return new OpenLayers.Pixel(b,c)};OpenLayers.IAAA_Utils.getLonLat=function(c,b){return new OpenLayers.LonLat(c,b)};OpenLayers.IAAA_Utils.getBounds=function(c,b,f,d){return new OpenLayers.Bounds(c,b,f,d)};OpenLayers.IAAA_Utils.getParameterStringNoEncode=function(k){var j=[];for(var c in k){var f=k[c];if((f!=null)&&(typeof f!="function")){var b;if(typeof f=="object"&&f.constructor==Array){var g=[];for(var d=0;d<f.length;d++){g.push(f[d])}b=g.join(",")}else{b=f}j.push(c+"="+b)}}return j.join("&")};OpenLayers.IAAA_Utils.isURLProtocolValue=function(b){if((b.toLowerCase().startsWith("http"))||(b.toLowerCase().startsWith("ftp"))||(b.toLowerCase().startsWith("https"))||(b.toLowerCase().startsWith("data:"))||(b.toLowerCase().startsWith("file:///"))||(b.toLowerCase().startsWith("gopher://"))||(b.toLowerCase().startsWith("javascript:"))||(b.toLowerCase().startsWith("mailto:"))||(b.toLowerCase().startsWith("news:"))||(b.toLowerCase().startsWith("res://"))||(b.toLowerCase().startsWith("telnet://"))||(b.toLowerCase().startsWith("view-source:"))){return true}return false};OpenLayers.IAAA_Utils.isInteger=function(d){var b;if(OpenLayers.IAAA_Utils.isEmpty(d)){if(OpenLayers.IAAA_Utils.isInteger.arguments.length==1){return 0}else{return(OpenLayers.IAAA_Utils.isInteger.arguments[1]==true)}}for(b=0;b<d.length;b++){var f=d.charAt(b);if(!OpenLayers.IAAA_Utils.isDigit(f)){return false}}return true};OpenLayers.IAAA_Utils.isEmpty=function(b){return((b==null)||(b.length==0))};OpenLayers.IAAA_Utils.isDigit=function(b){return((b>="0")&&(b<="9"))};OpenLayers.IAAA_Utils.deleteNoIntegerElements=function(d){var c=new Array();for(var b in d){if(OpenLayers.IAAA_Utils.isInteger(d[b])){c.push(d[b])}}return c};OpenLayers.IAAA_Utils._cloneObjectAux=function(b,j){if(!b){b={}}for(var g in j){b[g]={};if(typeof(j[g])=="object"){if(j[g]==null){b[g]=null}else{if(j[g].clone){b[g]=j[g].clone()}else{if(j[g].length!=undefined){if(j[g].camelize=="undefined"){b[g]=new Array();for(var d=0;d<j[g].length;d++){if(typeof(j[g][d])=="object"){OpenLayers.IAAA_Utils._cloneObjectAux(b[g][d],j[g][d])}else{if(typeof(j[g][d])=="string"){var f=j[g][d].slice();b[g][d]=f}else{b[g][d]=j[g][d]}}}}else{b[g]=j[g].slice()}}else{OpenLayers.IAAA_Utils._cloneObjectAux(b[g],j[g])}}}}else{if(typeof(j[g])=="number"){var c=j[g];b[g]=c}else{if(typeof(j[g])=="string"){var c=j[g].slice();b[g]=c}else{if(typeof(j[g])=="boolean"){var c=j[g];b[g]=c}}}}}return b};OpenLayers.IAAA_Utils.cloneObject=function(b){return OpenLayers.IAAA_Utils._cloneObjectAux({},b)};OpenLayers.IAAA_Utils.readCookie=function(b){a=document.cookie.substring(document.cookie.indexOf(b+"=")+b.length+1,document.cookie.length);if(!a){a=parent.document.cookie.substring(parent.document.cookie.indexOf(b+"=")+b.length+1,parent.document.cookie.length)}if(!a){a=window.document.cookie.substring(window.document.cookie.indexOf(b+"=")+b.length+1,window.document.cookie.length)}if(a.indexOf(";")!=-1){a=a.substring(0,a.indexOf(";"))}return a};OpenLayers.Util.modifyAlphaImageDiv=function(b,c,n,m,k,j,d,f,l){OpenLayers.Util.modifyDOMElement(b,c,n,m,null,null,null,l);var g=b.childNodes[0];if(k){g.src=k}OpenLayers.Util.modifyDOMElement(g,b.id+"_innerImage",null,m,"relative",d);if(OpenLayers.Util.alphaHack()){b.style.display="inline-block";if(f==null){f="scale"}b.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+g.src+"', sizingMethod='"+f+"')";if(parseFloat(b.style.opacity)>=0&&parseFloat(b.style.opacity)<1){b.style.filter+=" alpha(opacity="+b.style.opacity*100+")"}g.style.filter="alpha(opacity=0)";if((navigator.appName=="Microsoft Internet Explorer")&&(navigator.appVersion.indexOf("MSIE 6")>-1)&&b.parentNode&&b.parentNode.style){b.parentNode.style.display="block";if(b&&b.parentElement&&b.parentElement.parentElement&&b.parentElement.parentElement.parentObject&&b.parentElement.parentElement.parentObject.events){b.parentElement.parentElement.parentObject.events.triggerEvent("tileloaded");b.parentElement.parentElement.parentObject.events.triggerEvent("loadend")}}}};OpenLayers.IAAA_Utils.alertWindow=null;OpenLayers.IAAA_Utils.alertCounter=0;OpenLayers.IAAA_Utils.alert=function(c){if(OpenLayers.IAAA_Utils.alertWindow==null){OpenLayers.IAAA_Utils.alertWindow=window.open("","alertWindow","width=500,height=500,scrollbars=yes,resizable=yes");OpenLayers.IAAA_Utils.alertWindow.document.title="Alert 2.0"}else{if(OpenLayers.IAAA_Utils.alertWindow.document==null){OpenLayers.IAAA_Utils.alertWindow=window.open("","alertWindow","width=500,height=500,scrollbars=yes,resizable=yes");OpenLayers.IAAA_Utils.alertWindow.document.title="Alert 2.0"}}var f=OpenLayers.IAAA_Utils.alertWindow.document.createElement("DIV");f.innerHTML="Mensaje n"+OpenLayers.IAAA_Utils.alertCounter+":<br><br>";OpenLayers.IAAA_Utils.alertCounter++;OpenLayers.IAAA_Utils.alertWindow.document.body.appendChild(f);var d=OpenLayers.IAAA_Utils.alertWindow.document.createElement("DIV");d.innerHTML=c;OpenLayers.IAAA_Utils.alertWindow.document.body.appendChild(d);var b=OpenLayers.IAAA_Utils.alertWindow.document.createElement("DIV");b.innerHTML="<br><br>";OpenLayers.IAAA_Utils.alertWindow.document.body.appendChild(b)};alert2=OpenLayers.IAAA_Utils.alert;OpenLayers.IAAA_Utils.alertObject=function(b){var d="";for(var c in b){d+=c+" => "+b[c]+"<br>"}OpenLayers.IAAA_Utils.alert(d)};alertObject=OpenLayers.IAAA_Utils.alertObject;OpenLayers.IAAA_Utils.alertMapLayersVisibility=function(l){var g="";for(var f in l.layers){g+="["+f+"] "+l.layers[f].url+" -> "+l.layers[f].getVisibility()+"<br>";for(var d in l.layers[f].getLayerList()){g+="["+f+","+d+"] "+l.layers[f].getLayerList()[d].title+" -> "+l.layers[f].getLayerList()[d].getVisibility()+"<br>";for(var c in l.layers[f].getLayerList()[d].getChildLayerList()){g+="["+f+","+d+","+c+"] "+l.layers[f].getLayerList()[d].getChildLayer(c).title+" -> "+l.layers[f].getLayerList()[d].getChildLayer(c).getVisibility()+"<br>";for(var b in l.layers[f].getLayerList()[d].getChildLayer(c).getChildLayerList()){g+="["+f+","+d+","+c+","+b+"] "+l.layers[f].getLayerList()[d].getChildLayer(c).getChildLayer(b).title+" -> "+l.layers[f].getLayerList()[d].getChildLayer(c).getChildLayer(b).getVisibility()+"<br>"}}}}OpenLayers.IAAA_Utils.alert(g)};alertMapLayersVisibility=OpenLayers.IAAA_Utils.alertMapLayersVisibility;OpenLayers.IAAA_Utils.isGeographicalProjection=function(b){var c=b;if(b&&((typeof b).toLowerCase()=="object")){c=b.projCode}return(c&&(c.slice(0,6)=="EPSG:4")&&(parseInt(c.slice(5))>=4000)&&(parseInt(c.slice(5))<5000))};OpenLayers.IAAA_Utils.gppkeyLoaded=function(b){};OpenLayers.IAAA_Utils.WMSOutOfScopeByMinZoom="This map service is only shown from a high zoom level (approximately scale 1:";OpenLayers.IAAA_Utils.WMSOutOfScopeByMaxZoom="This map service is only shown from a low zoom level (approximately scale 1:";OpenLayers.IAAA_Utils.WMSOutOfScopeByZoomInterval="This map service is only shown in an interval between two zoom levels (approximately between scale 1:";OpenLayers.IAAA_Utils.WMSOutOfScopeByZoomInterval2="and scale 1:";OpenLayers.IAAA_Utils.WMSOutOfScopeByZoom2="). They are also maps of a zone that isn't visible currently in the map.";OpenLayers.IAAA_Utils.WMSOutOfScopeByAreaText="This service shows information about a zone that is not visible currently in the map.";OpenLayers.IAAA_Utils.getServiceOutOfScopeText=function(b){var c="";if(b.minSupportedScale){if(b.maxSupportedScale){c=OpenLayers.IAAA_Utils.WMSOutOfScopeByZoomInterval;c+=parseInt(b.minSupportedScale);c+=" "+OpenLayers.IAAA_Utils.WMSOutOfScopeByZoomInterval2;c+=parseInt(b.maxSupportedScale)}else{c=OpenLayers.IAAA_Utils.WMSOutOfScopeByMinZoom;c+=parseInt(b.minSupportedScale)}c+=OpenLayers.IAAA_Utils.WMSOutOfScopeByZoom2}else{if(b.maxSupportedScale){c=OpenLayers.IAAA_Utils.WMSOutOfScopeByMaxZoom;c+=parseInt(b.maxSupportedScale);c+=OpenLayers.IAAA_Utils.WMSOutOfScopeByZoom2}else{c=OpenLayers.IAAA_Utils.WMSOutOfScopeByAreaText}}return c};OpenLayers.IAAA_Utils.applyClonedDefaults=function(g,f){g=g||{};var d=typeof window.Event=="function"&&f instanceof window.Event;for(var c in f){if(g[c]===undefined||(!d&&f.hasOwnProperty&&f.hasOwnProperty(c)&&!g.hasOwnProperty(c))){if(typeof(f[c])=="number"){var b=f[c];g[c]=b}else{if(typeof(f[c])=="string"){var b=f[c].slice();g[c]=b}else{if(typeof(f[c])=="boolean"){var b=f[c];g[c]=b}else{if(typeof(f[c])=="function"){var b=f[c];g[c]=b}else{if(typeof(f[c])=="object"){g[c]=OpenLayers.IAAA_Utils.cloneObject(f[c])}}}}}}}if(!d&&f&&f.hasOwnProperty&&f.hasOwnProperty("toString")&&!g.hasOwnProperty("toString")){g.toString=f.toString}return g};OpenLayers.IAAA_Utils.translateGoogleMapsMapType=function(c,b){if(c==2){if((typeof b).toLowerCase()=="string"){switch(b){case"G_NORMAL_MAP":return G_NORMAL_MAP;case"G_SATELLITE_MAP":return G_SATELLITE_MAP;case"G_HYBRID_MAP":return G_HYBRID_MAP;case"G_PHYSICAL_MAP":return G_PHYSICAL_MAP;default:OpenLayers.IAAA_Utils.report("log","[ERROR] Map "+b+" not available");return G_NORMAL_MAP}}else{if((b===G_NORMAL_MAP)||(b===G_SATELLITE_MAP)||(b===G_HYBRID_MAP)||(b===G_PHYSICAL_MAP)){return b}else{if(b===google.maps.MapTypeId.ROADMAP){return G_NORMAL_MAP}else{if(b===google.maps.MapTypeId.SATELLITE){return G_SATELLITE_MAP}else{if(b===google.maps.MapTypeId.HYBRID){return G_HYBRID_MAP}else{if(b===google.maps.MapTypeId.TERRAIN){return G_PHYSICAL_MAP}else{OpenLayers.IAAA_Utils.report("log","[ERROR] Map not available");return G_NORMAL_MAP}}}}}}}else{if((typeof b).toLowerCase()=="string"){switch(b){case"G_NORMAL_MAP":return google.maps.MapTypeId.ROADMAP;case"G_SATELLITE_MAP":return google.maps.MapTypeId.SATELLITE;case"G_HYBRID_MAP":return google.maps.MapTypeId.HYBRID;case"G_PHYSICAL_MAP":return google.maps.MapTypeId.TERRAIN;default:OpenLayers.IAAA_Utils.report("log","[ERROR] Map "+b+" not available");return google.maps.MapTypeId.ROADMAP}}else{if(b===G_NORMAL_MAP){return google.maps.MapTypeId.ROADMAP}else{if(b===G_SATELLITE_MAP){return google.maps.MapTypeId.SATELLITE}else{if(b===G_HYBRID_MAP){return google.maps.MapTypeId.HYBRID}else{if(b===G_PHYSICAL_MAP){return google.maps.MapTypeId.TERRAIN}else{if((b===google.maps.MapTypeId.ROADMAP)||(b===google.maps.MapTypeId.SATELLITE)||(b===google.maps.MapTypeId.HYBRID)||(b===google.maps.MapTypeId.TERRAIN)){return b}else{OpenLayers.IAAA_Utils.report("log","[ERROR] Map not available");return google.maps.MapTypeId.ROADMAP}}}}}}}};OpenLayers.IAAA_Utils.googleMapsMapTypeToString=function(c,b){if(c==2){if((typeof b).toLowerCase()=="string"){switch(b){case"G_NORMAL_MAP":return"G_NORMAL_MAP";case"G_SATELLITE_MAP":return"G_SATELLITE_MAP";case"G_HYBRID_MAP":return"G_HYBRID_MAP";case"G_PHYSICAL_MAP":return"G_PHYSICAL_MAP";case"google.maps.MapTypeId.ROADMAP":return"G_NORMAL_MAP";case"google.maps.MapTypeId.SATELLITE":return"G_SATELLITE_MAP";case"google.maps.MapTypeId.HYBRID":return"G_HYBRID_MAP";case"google.maps.MapTypeId.TERRAIN":return"G_PHYSICAL_MAP";default:OpenLayers.IAAA_Utils.report("log","[ERROR] Map "+b+" not available");return""}}else{if(b===G_NORMAL_MAP){return"G_NORMAL_MAP"}else{if(b===G_SATELLITE_MAP){return"G_SATELLITE_MAP"}else{if(b===G_HYBRID_MAP){return"G_HYBRID_MAP"}else{if(b===G_PHYSICAL_MAP){return"G_PHYSICAL_MAP"}}}}if(b===google.maps.MapTypeId.ROADMAP){return"G_NORMAL_MAP"}else{if(b===google.maps.MapTypeId.HYBRID){return"G_SATELLITE_MAP"}else{if(b===google.maps.MapTypeId.ROADMAP){return"G_HYBRID_MAP"}else{if(b===google.maps.MapTypeId.TERRAIN){return"G_PHYSICAL_MAP"}else{OpenLayers.IAAA_Utils.report("log","[ERROR] Map not available");return""}}}}}}else{if((typeof b).toLowerCase()=="string"){switch(b){case"G_NORMAL_MAP":return"google.maps.MapTypeId.ROADMAP";case"G_SATELLITE_MAP":return"google.maps.MapTypeId.SATELLITE";case"G_HYBRID_MAP":return"google.maps.MapTypeId.HYBRID";case"G_PHYSICAL_MAP":return"google.maps.MapTypeId.TERRAIN";case"google.maps.MapTypeId.ROADMAP":return"google.maps.MapTypeId.ROADMAP";case"google.maps.MapTypeId.SATELLITE":return"google.maps.MapTypeId.SATELLITE";case"google.maps.MapTypeId.HYBRID":return"google.maps.MapTypeId.HYBRID";case"google.maps.MapTypeId.TERRAIN":return"google.maps.MapTypeId.TERRAIN";default:OpenLayers.IAAA_Utils.report("log","[ERROR] Map "+b+" not available");return"google.maps.MapTypeId.ROADMAP"}}else{if(b===G_NORMAL_MAP){return"google.maps.MapTypeId.ROADMAP"}else{if(b===G_SATELLITE_MAP){return"google.maps.MapTypeId.SATELLITE"}else{if(b===G_HYBRID_MAP){return"google.maps.MapTypeId.HYBRID"}else{if(b===G_PHYSICAL_MAP){return"google.maps.MapTypeId.TERRAIN"}else{if(b===google.maps.MapTypeId.ROADMAP){return"google.maps.MapTypeId.ROADMAP"}else{if(b===google.maps.MapTypeId.SATELLITE){return"google.maps.MapTypeId.SATELLITE"}else{if(b===google.maps.MapTypeId.HYBRID){return"google.maps.MapTypeId.HYBRID"}else{if(b===google.maps.MapTypeId.TERRAIN){return"google.maps.MapTypeId.TERRAIN"}else{OpenLayers.IAAA_Utils.report("log","[ERROR] Map "+b+" not available");return"google.maps.MapTypeId.ROADMAP"}}}}}}}}}}};OpenLayers.IAAA_Utils.isGoogleMapTypeAvailable=function(d,c,b){if((b!=null)&&(b!=undefined)){if(d==2){return(OpenLayers.Util.indexOf(c.getMapTypes(),gMapType)!=-1)}else{if((b===google.maps.MapTypeId.ROADMAP)||(b===google.maps.MapTypeId.SATELLITE)||(b===google.maps.MapTypeId.HYBRID)||(b===google.maps.MapTypeId.TERRAIN)){return true}}}return false};OpenLayers.IAAA_Utils.getGoogleAPIVersion=function(){return((typeof GMap2==="function")?2:3)};OpenLayers.Util.getNodes=function(d,c){var b=OpenLayers.Util.Try(function(){return OpenLayers.Util._getNodes(d.documentElement.childNodes,c)},function(){return OpenLayers.Util._getNodes(d.childNodes,c)});return b};OpenLayers.Util._getNodes=function(d,g){var c=[];for(var f=0,b=d.length;f<b;f++){if(d[f].nodeName==g){c.push(d[f])}}return c};OpenLayers.IAAA_Utils.coordTransform=function(l,k,d,c){l=l+"";k=k+"";var g;if(l==k){return[d,c]}else{try{g=coordTransform(l,k,d,c);return g}catch(j){}try{var f=Proj4js.transform(new Proj4js.Proj(l),new Proj4js.Proj(k),{x:d,y:c});return[f.x,f.y]}catch(j){var b;try{b=new Proj4js.Proj(l)}catch(j){alert("El srs "+l+" no esta disponible")}try{b=new Proj4js.Proj(k)}catch(j){alert("El srs "+k+" no esta disponible")}return[d,c]}}};OpenLayers.IAAA_Utils.startsWith=function(d,b){if(d.length>=b.length){var c=d.substring(0,b.length);if(c==b){return true}else{return false}}else{return false}};OpenLayers.IAAA_Utils.getZona=function(b){if(OpenLayers.IAAA_Utils.startsWith(b,"EPSG:230")){var c=parseInt(b.substring(new String("EPSG:230").length,b.length));return c}if(OpenLayers.IAAA_Utils.startsWith(b,"EPSG:258")){var c=parseInt(b.substring(new String("EPSG:258").length,b.length));return c}};OpenLayers.IAAA_Utils.supportedSrsList=[];try{OpenLayers.IAAA_Utils.supportedSrsList=supportedSrsList}catch(e){}OpenLayers.IAAA_Utils.supportedSrsListDescription=[];try{OpenLayers.IAAA_Utils.supportedSrsListDescription=supportedSrsListDescription}catch(e){}OpenLayers.IAAA_Utils.getSupportedSrsList=function(){try{return getSupportedSrsList()}catch(b){return[]}};OpenLayers.IAAA_Utils.getSupportedSrs=function(b){try{return getSupportedSrs(b)}catch(c){return""}};OpenLayers.IAAA_Utils.isSupportedSrs=function(b){try{return isSupportedSrs(b)}catch(c){return false}};OpenLayers.IAAA_Utils.getSupportedSrsDescription=function(b){try{return getSupportedSrsDescription(b)}catch(c){return""}};OpenLayers.IAAA_Utils.isProjectedSrs=function(b){try{return isProjectedSrs(b)}catch(c){return false}};OpenLayers.IAAA_Utils.getPrioritySrsList=function(){try{return getPrioritySrsList()}catch(b){return[]}};OpenLayers.IAAA_Utils.getPrioritySrs=function(b){try{return getPrioritySrs(b)}catch(c){return""}};OpenLayers.IAAA_Utils.getDatum=function(b){try{return getDatum(b)}catch(c){return""}};OpenLayers.IAAA_Utils.DEBUG_MODE=false;OpenLayers.IAAA_Utils.report=function(d,f,b){b=((b!=null)&&(b!=undefined))?b:true;if(OpenLayers.IAAA_Utils.DEBUG_MODE||!b){d=(d)?d:"log";if(f){var c=window.console;if(c){if(c[d]){c[d](f)}else{if(c.log){c.log(f)}}}}}};OpenLayers.IAAA_Utils.isMobileNavigator=function(){return(OpenLayers.IAAA_Utils.getNavigator()[2]=="mobile")};OpenLayers.IAAA_Utils.isAppleDevice=function(){var b=navigator.userAgent.toLowerCase();return(b&&(b.indexOf("iphone")!=-1)||(b.indexOf("ipod")!=-1)||(b.indexOf("ipad")!=-1))};OpenLayers.IAAA_Utils.isMicrosoftMobileNavigator=function(){var b=OpenLayers.IAAA_Utils.getNavigator();return(((b[0]=="msie")||(b[3]=="msie"))&&(b[2]=="mobile"))};OpenLayers.IAAA_Utils.processURL=function(b){return b};OpenLayers.IAAA_Utils.isPointerEvent=function(b){if(b&&b.pointerType){switch(b.pointerType){case"touch":case"mouse":case"pen":case MSPOINTER_TYPE_TOUCH:case MSPOINTER_TYPE_PEN:case MSPOINTER_TYPE_MOUSE:return true;break;default:break}}return false};OpenLayers.IAAA_Utils.isPointerTouchEvent=function(c){if(c&&c.pointerType){var b="";switch(c.pointerType){case"mouse":break;case"touch":case"pen":case MSPOINTER_TYPE_TOUCH:case MSPOINTER_TYPE_PEN:return true;break;case MSPOINTER_TYPE_MOUSE:break;default:break}}return false};OpenLayers.IAAA_Utils.stackTrace=function(){var b=new Error();return b.stack};OpenLayers.IAAA_Utils.metersToDegrees=function(g,f){var d=f.clone();d.lon+=1;d.lat+=1;var b=OpenLayers.Util.distVincenty({lon:f.lon,lat:f.lat},{lon:d.lon,lat:d.lat});var c=(g*Math.sqrt(2))/(b*1000);return c};OpenLayers.IAAA_Utils.shadeColor=function(b,j){if(b.indexOf("rgb")>=0){b=OpenLayers.IAAA_Utils.rgbToHex(b)}var k=parseInt(b.slice(1),16),c=j<0?0:255,l=j<0?j*-1:j,g=k>>16,d=k>>8&255,m=k&255;return"#"+(16777216+(Math.round((c-g)*l)+g)*65536+(Math.round((c-d)*l)+d)*256+(Math.round((c-m)*l)+m)).toString(16).slice(1)};OpenLayers.IAAA_Utils.rgbToHex=function(d){var l,k,c;var j=d.replace(/\s/g,"");j=j.substring(j.lastIndexOf("(")+1,j.lastIndexOf(")"));var f=j.split(",");l=parseInt(f[0]);k=parseInt(f[1]);c=parseInt(f[2]);function m(g){var b=g.toString(16);return((b.length==1)?"0"+b:b)}return"#"+m(l)+m(k)+m(c)}}OpenLayers.IAAA_ComplexTreeNode=OpenLayers.Class({tree:null,treeNode:null,treeLoadImg:null,removeable:true,modifiable:true,disabled:false,loadFromTree:false,_treeNodeVisibility:true,_visibilityToRestore:false,nodeType:null,TREE_EVENT_TYPES:["loadedfromtree"],initialize:function(c,d){this.nodeType=c;OpenLayers.Util.extend(this,d);if(!this.events){this.events=new OpenLayers.Events(this,this.div,this.TREE_EVENT_TYPES);if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}}else{for(var f=0,b=this.TREE_EVENT_TYPES.length;f<b;f++){this.events.addEventType(this.TREE_EVENT_TYPES[f])}}},getTree:function(){if(!this.tree){if(getTree&&getTree()){this.tree=getTree()}}return this.tree},checkNodeVisibility:function(){if(this.treeNode){this.map.events.register("moveend",this,this.updateTreeNodeVisibility);this.updateTreeNodeVisibility()}},updateTreeNodeVisibility:function(){if(this.inSupportedRange&&!this.inSupportedRange()){this._treeNodeVisibility=false;this._visibilityToRestore=this.getVisibility();if(this.treeNode&&this.treeNode.domNode){this.treeNode.domNode.style.display="none"}this.setVisibility(false)}else{if(!this._treeNodeVisibility){this._treeNodeVisibility=true;this.setVisibility(this._visibilityToRestore);if(this.treeNode&&this.treeNode.domNode){this.treeNode.domNode.style.display="block"}}}},getTreeNode:function(){return this.treeNode},setTreeNode:function(b){this.treeNode=b;if(this.map&&(this.nodeType=="service")){this.map.events.register("moveend",this,this.updateTreeNodeVisibility);this.updateTreeNodeVisibility()}},getTreeNodeVisibility:function(){return this._treeNodeVisibility},updateMainTreeNode:function(){if(this.getTree()&&this.getTreeNode()){this.getTree()._updateWMSNode(this.getTreeNode(),this.getTree().dojo)}},getModifiable:function(){return this.modifiable},setModifiable:function(b){this.modifiable=b},getLoadFromTree:function(){return this.loadFromTree},setLoadFromTree:function(b){this.loadFromTree=b},showLoading:function(){if(this.treeLoadImg){this.treeLoadImg.style.visibility="visible";this.treeLoadImg.style.display="inline"}},hideLoading:function(){if(this.treeLoadImg){this.treeLoadImg.style.visibility="hidden";this.treeLoadImg.style.display="inline"}},getTreeNodeCheckBox:function(){var d;var b=this.getTreeNode();if(b&&this.getTree()){var f=b.widgetId;var c=f.split("_");switch(this.nodeType){case"service":d=this.getTree().dojo.widget.byId("chk_WMS_"+c[1]);break;case"layer":var g=c.length-1;switch(g){case 2:d=this.getTree().dojo.widget.byId("chk_WMSLayer_"+c[1]+"_"+c[2]);break;case 3:d=this.getTree().dojo.widget.byId("chk_WMSChildLayer_"+c[1]+"_"+c[2]+"_"+c[3]);break;case 4:d=this.getTree().dojo.widget.byId("chk_WMSGrandChildLayer_"+c[1]+"_"+c[2]+"_"+c[3]+"_"+c[4]);break;case 5:d=this.getTree().dojo.widget.byId("chk_WMSGrandGrandChildLayer_"+c[1]+"_"+c[2]+"_"+c[3]+"_"+c[4]+"_"+c[5]);break;default:break}break;default:break}}return d},CLASS_NAME:"OpenLayers.IAAA_ComplexTreeNode"});OpenLayers.IAAA_ComplexTreeNode.getNodeCheckBoxState=function(b){return b.checked};OpenLayers.IAAA_ComplexTreeNode.updateNodeCheckBoxState=function(c,b,d){c.checked=b;c.fillInTemplate();if(d){c.imageNode.setAttribute("title",d)}};OpenLayers.IAAA_WMS=OpenLayers.Class(OpenLayers.IAAA_ComplexTreeNode,{ISPARENTLAYER:false,name:null,title:null,styleList:null,styleSelected:0,queryable:false,selected:false,infoFormat:null,parent:null,visibility:false,excluder:false,metadataURLList:new Array(),attribution:null,abstractInformation:null,service:"WMS",featureNamespace:null,featureGeometryType:null,userStyleFirst:false,icon:null,dimensionList:null,dimensionExtentList:null,featureType:null,maxSupportedExtent:null,minSupportedScale:null,maxSupportedScale:null,tileSet:null,initialize:function(c,g,f,b){this.name=c;this.title=g;if(f){this.setStyleList(f)}else{this.styleList=new Array(new OpenLayers.IAAA_Style("default",this,"Default"))}this.styleSelected=this.getDefaultStyle();for(var d in b){this[d]=b[d]}this.dimensionList=[];this.dimensionExtentList=[];OpenLayers.IAAA_ComplexTreeNode.prototype.initialize.apply(this,["layer",b])},clone:function(b){if(b==null){b=new OpenLayers.IAAA_WMS(this.name,this.title,OpenLayers.IAAA_Utils.cloneObject(this.styleList),{styleSelected:this.styleSelected,modifiable:this.modifiable,queryable:this.queryable,selected:this.selected,parent:this.parent,visibility:this.visibility,excluder:this.excluder,metadataURLList:OpenLayers.IAAA_Utils.cloneObject(this.metadataURLList),removeable:this.removeable,treeNode:this.treeNode})}return b},getQueryable:function(){return this.queryable},getSelected:function(){return this.selected},setParent:function(b){this.parent=b},getParent:function(){return this.parent},getChildLayerList:function(){return new Array()},getStyleList:function(){return this.styleList},getMetadataURLList:function(){return this.metadataURLList},getStyleSelected:function(){return this.styleSelected},getDefaultStyle:function(){var d=0;if(this.styleList){if(this.styleList.length>1){for(var c=0,b=this.styleList.length;c<b;c++){if(this.styleList[c].name.toLowerCase().indexOf("default")!=-1){d=c;break}}}}return d},getTitle:function(){return this.title},getName:function(){return this.name},setQueryable:function(b){this.queryable=b},setSelected:function(b){this.selected=b},setLayerName:function(b){this.name=b},setLayerTitle:function(b){this.title=b},setStyleList:function(d,c){c=(((c!=undefined)&&(c!=null))?c:false);this.styleList=d;var f=0;for(var b in d){d[b].setLayer(this);if(c&&(d[b].name.toLowerCase().indexOf("default")!=-1)){f=b}}if(c){this.styleSelected=f}},setStyleSelected:function(b){this.styleSelected=b},unselectUserStyle:function(c){c=((c!=undefined)&&(c!=null))?c:false;if(this.getStyleList()[this.styleSelected].CLASS_NAME=="OpenLayers.IAAA_Style.IAAA_UserStyle"){var b=0;if(c){b=this.getDefaultStyle()}else{while((b<this.getStyleList().length)&&(this.getStyleList()[b].CLASS_NAME=="OpenLayers.IAAA_Style.IAAA_UserStyle")){b++}}if(b==this.getStyleList().length){b=0}if(this.styleSelected!=b){this.styleSelected=b;return true}}return false},addStyle:function(b){if(this.styleList==null){this.styleList=new Array()}this.styleList.push(b)},setMetadataURLList:function(b){this.metadataURLList=b},getVisibility:function(){return this.visibility},setVisibility:function(c,b){if(this.disabled==true){return}this.visibility=c;if(this.isExcluder()&&this.parent){if(this.parent.CLASS_NAME=="OpenLayers.Layer.IAAA_Server"&&c){this.parent.updateExcluderLayers(this,b)}else{if(this.parent.CLASS_NAME=="OpenLayers.IAAA_WMS.IAAA_ParentLayer"&&c){if(this.parent.parent&&(this.parent.parent.CLASS_NAME=="OpenLayers.Layer.IAAA_Server"&&c)){this.parent.parent.updateExcluderLayers(this,b)}}}}if(!b){if(this.parent!=null){this.parent.updateVisibility()}}},isExcluder:function(){return this.excluder},setExcluder:function(b){this.excluder=b},setAttribution:function(b){this.attribution=b},getAttribution:function(){return this.attribution},setMaxSupportedExtent:function(b){this.maxSupportedExtent=b},setMinSupportedScale:function(b){this.minSupportedScale=b},setMaxSupportedScale:function(b){this.maxSupportedScale=b},getFeatureNamespace:function(){return this.featureNamespace},getFeatureGeometryType:function(){return this.featureGeometryType},setFeatureNamespace:function(b){this.featureNamespace=b},setFeatureGeometryType:function(b){this.featureGeometryType=b},getAccessConstraints:function(){if(this.parent&&this.parent.getAccessConstraints){return this.parent.getAccessConstraints()}},getMainAttribution:function(){if(this.parent&&this.parent.getMainAttribution){return this.parent.getMainAttribution()}},getTileSet:function(){return(this.tileSet)},setTileSet:function(b){this.tileSet=b},addDimensionName:function(b){this.dimensionList[b]=null;var c=this.getParent();while(c&&!c.childDimensionsNamesList){c=c.getParent()}if(c&&c.childDimensionsNamesList){if(OpenLayers.Util.indexOf(c.childDimensionsNamesList,b)<0){c.childDimensionsNamesList.push(b)}}},setDimensionValue:function(c,f,b){var d=c.toUpperCase();if(!this.dimensionList[d]){this.addDimensionName(d)}this.dimensionList[d]=f;if(b){this.parent.updateVisibility()}},getDimensionValue:function(b){return this.dimensionList[b]},addDimensionExtension:function(c,f){var d=c.toUpperCase();var b={};if(f.minValue&&f.maxValue){b.minValue=f.minValue;b.maxValue=f.maxValue;if(f.resolution){b.resolution=f.resolution}if(f.defaultValue){b.defaultValue=f.defaultValue}}else{if(f.minValues&&f.minValues.length&&f.maxValues&&f.maxValues.length){b.minValues=f.minValues;b.maxValues=f.maxValues;if(f.resolutions&&f.resolutions.length){b.resolutions=f.resolutions}else{b.resolutions=[]}if(f.defaultValue){b.defaultValue=f.defaultValue}}else{if(f.values&&f.values.length){b.values=f.values;if(f.defaultValue){b.defaultValue=f.defaultValue}}}}this.dimensionExtentList[d]=b},getDimensionExtension:function(b){var c=b.toUpperCase();return this.dimensionExtentList[b]},CLASS_NAME:"OpenLayers.IAAA_WMS"});OpenLayers.IAAA_TileSet=OpenLayers.Class.create();OpenLayers.IAAA_TileSet.prototype={SRS:null,bounds:null,resolutions:null,tileSize:null,format:"image/png",layers:null,initialize:function(b){this.resolutions=new Array();this.layers=new Array();this.tileSize=new OpenLayers.Size(256,256);for(var c in b){this[c]=b[c]}},addLayer:function(c){for(var b in this.layers){if(this.layers[b].name==c.name){return}}this.layers.push(c);c.setTileSet(this)},getLayers:function(){return this.layers},supportsLayer:function(b){return(b.getTileSet()&&(this.compare(b.getTileSet())>0))},compare:function(k){var f=((this.SRS==k.SRS)&&(this.bounds.left==k.bounds.left)&&(this.bounds.bottom==k.bounds.bottom)&&(this.bounds.right==k.bounds.right)&&(this.bounds.top==k.bounds.top)&&(this.tileSize.w==k.tileSize.w)&&(this.tileSize.h==k.tileSize.h)&&(this.format==k.format));if(!f){return -1}var g=this.resolutions.sort(function(l,j){return j-l});var d=k.resolutions.sort(function(l,j){return j-l});var b=0;for(var c=0;(c<g.length)&&(b<d.length);c++){if(g[c]!=d[b]){while((g[c]!=d[b])&&(b<d.length)){b++}if(g[c]!=d[b]){return -1}}b++}if(g.length!=d.length){return 0}else{return 1}},CLASS_NAME:"OpenLayers.IAAA_TileSet"};OpenLayers.Map.IAAA_Map=OpenLayers.Class(OpenLayers.Map,{checkedLayerForFeatureInfo:new Array(),mapUpdated:true,extentAux:null,resAux:null,measureLayer:null,wmc:null,automaticSrs:false,primaryAutomaticSrs:"EPSG:4258",secondaryAutomaticSrs:"EPSG:25830",secondaryAutomaticSrs_Canarias:"EPSG:25828",projection:null,windowSizeForMinMapSize:new OpenLayers.Size(10,10),minWidth:9,minHeight:9,maxHeight:null,maxWidth:null,notMapHeight:0,selectedGeometryList:null,selectedGeometryLayer:null,selectedGeometryExtent:null,originalSelectedGeometry:null,analysisTreeNode:null,fullExtent:null,ignoreMaxExtent:false,scaleLevelSrs:0,ancientResolutions:[],ancientMaxExtent:null,ancientBaseLayerMaxExtent:null,ancientSRS:null,_ancientAutomaticSrs:null,_ignoreButtonAutomaticSRSAux:null,toolbarDiv:null,resizing:false,destroying:false,layerVisibilityInResizeMethod:null,useWCTS:false,serverWCTSCounter:0,alreadyInSetCenter:0,dragInMotion:false,mouseOnMap:false,loading:false,SLDignoreDraw:false,hasSLD:false,indexSLDList:[],indexLayersToClearOnBeforeMoveList:[],indexLayersToClearOnAfterMoveList:[],postRequestType:false,viewControls:new Array(),scaleCenteringInGeometries:1,notifyBaseLayerMoves:false,handlerClickDisabled:false,EVENT_TYPES:["preaddlayer","addlayer","preremovelayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer","resizeend","newExtent","changepropsforwmsc","changepropsforwmts","restoreprops","layerloading","layerloaded","layerupdated","layervisibilitychanged","iaaa_waitingserver","iaaa_finishCommunication","controlactivate","controldeactivate","mousewheelup","mousewheeldown","areaSelectedByUser","layeradded","endAddElement","sizeUpdated","updatestreetmapinfo","pinchstart","pinchend"],initialize:function(b,n,g){if(arguments.length===1&&typeof b==="object"){n=b;b=n&&n.div}this.destroying=false;if(!g){var c=new Array();c.push(b,n);OpenLayers.Map.prototype.initialize.apply(this,c);this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px"}else{this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-180,-90,180,90);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,n);this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=g.getElementById(b);var f=this.div.id+"_OpenLayers_ViewPort";this.viewPortDiv=g.createElement("div");OpenLayers.Util.modifyDOMElement(this.viewPortDiv,f,null,null,"relative",null,"hidden",null);this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);var k=document.createElement("div");k.id=this.id+"_events";k.style.position="absolute";k.style.width="100%";k.style.height="100%";k.style.zIndex=this.Z_INDEX_BASE.Control-1;this.viewPortDiv.appendChild(k);this.eventsDiv=k;this.events=new OpenLayers.Events(this,this.eventsDiv,this.EVENT_TYPES,this.fallThrough,{includeXY:true});f=this.id+"_OpenLayers_Container";this.layerContainerDiv=g.createElement(f);OpenLayers.Util.modifyDOMElement(this.layerContainerDiv,f,null,null,null,null,null,null);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.eventsDiv.appendChild(this.layerContainerDiv);this.updateSize();if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)}this.events.register("movestart",this,this.updateSize);if(OpenLayers.String.contains(navigator.appName,"Microsoft")){this.events.register("resize",this,this.updateSize)}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){var j=true;var d=g.getElementsByTagName("link");for(var l=0;l<d.length;++l){if(OpenLayers.Util.isEquivalentUrl(d.item(l).href,this.theme)){j=false;break}}if(j){var m=g.createElement("link");m.setAttribute("rel","stylesheet");m.setAttribute("type","text/css");m.setAttribute("href",this.theme);g.getElementsByTagName("head")[0].appendChild(m)}}this.layers=[];if(this.controls==null){if(OpenLayers.Control!=null){this.controls=[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoom(),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()]}else{this.controls=[]}}for(var l=0;l<this.controls.length;l++){this.addControlToMap(this.controls[l])}this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px"}if(n&&n.layers){delete this.center;this.addLayers(n.layers);if(n.center){this.setCenter(n.center,n.zoom)}}this.indexLayersToClearOnBeforeMoveList=new Array();this.indexLayersToClearOnBeforeMoveList=[];this.indexLayersToClearOnAfterMoveList=new Array();this.indexLayersToClearOnAfterMoveList=[];this.events.register("mouseout",this,this.outMap);this.events.register("mouseover",this,this.overMap);this.events.register("mousewheelup",this,this.zoomMouseInPan);this.events.register("mousewheeldown",this,this.zoomMouseOutPan);if(OpenLayers.Map.IAAA_Map.Services_Extension){OpenLayers.Util.applyDefaults(this,OpenLayers.Map.IAAA_Map.Services_Extension)}if(OpenLayers.Map.IAAA_Map.Print_Extension){OpenLayers.Util.applyDefaults(this,OpenLayers.Map.IAAA_Map.Print_Extension)}this.createIncompatibleWMSCWindow=this.createIncompatibleMapServerWindow},destroy:function(){try{this.destroying=true;if(!this.unloadDestroy){return false}if(this.panTween){this.panTween.stop();this.panTween=null}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)}else{this.events.unregister("resize",this,this.updateSize)}this.paddingForPopups=null;var d;if(this.controls!=null){for(var f=this.controls.length-1;f>=0;--f){try{d=this.controls[f].CLASS_NAME;this.controls[f].destroy()}catch(j){OpenLayers.IAAA_Utils.report("log","[ERROR] Destruyendo control "+d+":\n"+j)}}this.controls=null}if(this.layers!=null){var g=[];var c=[];for(var f=this.layers.length-1;f>=0;--f){if((this.layers[f].CLASS_NAME!="OpenLayers.Layer.IAAA_GenericVector")||this.layers[f].mainLayer){g.push(this.layers[f])}else{c.push(this.layers[f])}}for(var f=0,b=g.length;f<b;f++){try{d=g[f].name;g[f].destroy(false)}catch(j){OpenLayers.IAAA_Utils.report("log","[ERROR] Destruyendo capa "+d+":\n"+j)}}for(var f=0,b=c.length;f<b;f++){try{d=c[f].name;c[f].destroy(false)}catch(j){OpenLayers.IAAA_Utils.report("log","[ERROR] Destruyendo capa hija "+d+":\n"+j)}}this.layers=null}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)}this.viewPortDiv=null;if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}try{this.events.destroy()}catch(j){OpenLayers.IAAA_Utils.report("log","[ERROR] Destruyendo eventos:\n"+j)}this.events=null;this.destroying=false}catch(j){OpenLayers.IAAA_Utils.report("log","[ERROR] Destruyendo:\n"+j)}},outMap:function(){this.mouseOnMap=false},overMap:function(){this.mouseOnMap=true},beginPanning:function(){if(this.indexLayersToClearOnBeforeMoveList.length>0){for(var b=0,c=this.indexLayersToClearOnBeforeMoveList.length;b<c;b++){this.layers[this.indexLayersToClearOnBeforeMoveList[b]].clearTiles()}}if((this.mouseOnMap)&&(this.getToolBar()!=null)&&(this.getToolBar().lastOptionSelected!=-1)&&(this.getToolBar().lastOptionSelected==PAN)){this.dragInMotion=true}else{if((this.getToolBar()!=null)&&(this.getToolBar().lastOptionSelected!=PAN)){this.dragInMotion=false}}},endPanning:function(){if(this.indexLayersToClearOnAfterMoveList.length>0){for(var c=0,d=this.indexLayersToClearOnAfterMoveList.length;c<d;c++){this.layers[this.indexLayersToClearOnAfterMoveList[c]].clearTiles()}}if((this.mouseOnMap)&&(this.getToolBar()!=null)&&(this.getToolBar().lastOptionSelected!=-1)&&(this.getToolBar().lastOptionSelected==PAN)){this.dragInMotion=false;if(this.hasSLD){for(var c=0,b=this.indexSLDList.length;c<b;c++){this.layers[this.indexSLDList[c]].redraw()}}}},zoomMouseInPan:function(){if(this.zoom<(this.numZoomLevels-1)){if((this.mouseOnMap)&&(this.getToolBar()!=null)&&(this.getToolBar().lastOptionSelected!=-1)&&(this.getToolBar().lastOptionSelected==PAN)){if(this.hasSLD){for(var c=0,b=this.indexSLDList.length;c<b;c++){this.layers[this.indexSLDList[c]].redraw()}}this.dragInMotion=false}}},zoomMouseOutPan:function(){if(this.zoom>0){if((this.mouseOnMap)&&(this.getToolBar()!=null)&&(this.getToolBar().lastOptionSelected!=-1)&&(this.getToolBar().lastOptionSelected==PAN)){if(this.hasSLD){for(var c=0,b=this.indexSLDList.length;c<b;c++){this.layers[this.indexSLDList[c]].redraw()}}this.dragInMotion=false}}},setPostRequestType:function(b){this.postRequestType=b},setLoading:function(b){this.loading=b},isLoading:function(){return this.loading},setOptions:function(b){var c=this.minPx&&b.restrictedExtent!=this.restrictedExtent;this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.maxExtent=new OpenLayers.Bounds(-9999999999,-9999999999,9999999999,9999999999);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";OpenLayers.Util.extend(this,b);c&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:true})},addLayer:function(k,d){d=((d!=null)&&(d!=undefined))?d:true;for(var f=0;f<this.layers.length;f++){if(this.layers[f]==k){OpenLayers.IAAA_Utils.report("warn","layerAlreadyAdded: "+k.name);return false}}if(this.events.triggerEvent("preaddlayer",{layer:k})===false){return}var j=(k.isWMSC&&k.maxExtent&&k.resolutions&&k.getSRSList()[k.getSelectedSRS()]&&((!this.ancientMaxExtent)||((this.ancientResolutions)&&(this.ancientResolutions.length==0))));var g=(k.isWMTS&&(k.tileMatrixSetSRS!=null));var c=null;k.div.style.overflow="";this.setLayerZIndex(k,this.layers.length);if(k.isFixed){this.viewPortDiv.appendChild(k.div)}else{this.layerContainerDiv.appendChild(k.div)}this.layers.push(k);k.setMap(this);if(c!=null){this.setLayerIndex(k,c)}var n=false;if(k.isBaseLayer){if(this.baseLayer==null){this.setBaseLayer(k)}else{k.setVisibility(false)}}else{if(this.baseLayer==null){var b=k.getVisibility();k.isBaseLayer=true;this.setBaseLayer(k);this.baseLayer.setVisibility(b)}else{if(k.CLASS_NAME!="OpenLayers.Layer.IAAA_GeoRSS"){n=true}}}if(((k.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS"))&&(!k.loadFromTree)){if(j){this.changeMapPropertiesForWMSC(k,d)}else{if(g){var m=false;for(var f=0,l=this.layers.length-1;f<l;f++){if(this.layers[f].isWMTS){m=true;break}}if(!m){this.changeMapPropertiesForWMTS(k,d)}}else{k.changeSrs(this.getProjection())}}}else{if(k.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS"){this.events.register("mouseover",k,k.onMouseOverClosePopup);this.events.register("mousemove",k,k.onMouseMoveClosePopup)}else{if(k.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers"){k.initEvents()}else{if((k.CLASS_NAME=="OpenLayers.Layer.Google")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_Google")){if((k.ignoreWMSCChanges!=undefined)&&(k.ignoreWMSCChanges!=null)&&k.ignoreWMSCChanges){}else{this.changeMapPropertiesForGoogleMaps(k,d)}}}}}if(n){if(k.CLASS_NAME.indexOf("OpenLayers.Layer.IAAA_GenericVector")!=-1){if(k.features&&k.features.length>0){k.redraw()}}else{k.redraw()}}if((k.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")){k.events.register("loadstart",this,function(){this.events.triggerEvent("layerloaded")});k.events.register("tileloaded",this,function(){this.events.triggerEvent("layerloaded")});k.events.register("visibilitychanged",this,function(){this.events.triggerEvent("layervisibilitychanged")});k.events.register("layerlistvisibilityupdated",this,function(o){this.events.triggerEvent("layerupdated",{layer:o.layer})})}this.events.triggerEvent("addlayer",{layer:k});k.events.triggerEvent("added",{map:this,layer:k});if((k.CLASS_NAME=="OpenLayers.Layer.Vector")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVector")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVectorWithTolerance")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_KML")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")){if(k.afterAdd){k.afterAdd()}}if((k.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")||(k.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")){if((k.clearOnBeforeMove!=null)&&(k.clearOnBeforeMove!=undefined)&&k.clearOnBeforeMove){this.indexLayersToClearOnBeforeMoveList.push(this.layers.length-1)}else{if((k.clearOnAfterMove!=null)&&(k.clearOnAfterMove!=undefined)&&k.clearOnAfterMove){this.indexLayersToClearOnAfterMoveList.push(this.layers.length-1)}}}},addWCTSServer:function(){if(!this.useWCTS){this.useWCTS=true}this.serverWCTSCounter++},removeWCTSServer:function(){this.serverWCTSCounter--;if(this.serverWCTSCounter==0){this.useWCTS=false}},changeMapPropertiesForWMSC:function(l,d){d=((d!=null)&&(d!=undefined))?d:true;if(this.ancientSRS&&this.ancientResolutions&&this.ancientMaxExtent){this.restoreMapFromWMSC(d)}this.ancientSRS=this.getProjection();this.ancientIgnoreMaxExtent=this.ignoreMaxExtent;this.ignoreMaxExtent=true;if(this._ignoreButtonAutomaticSRSAux==null){this._ignoreButtonAutomaticSRSAux=OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs}this._ancientAutomaticSrs=this.automaticSrs;this.automaticSrs=false;OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs=true;this.ancientResolutions=this.resolutions;this.ancientMaxExtent=this.maxExtent.clone();this.ancientBaseLayerMaxExtent=this.baseLayer.maxExtent.clone();var k=this.getExtent();var m=(l.getSelectedTileSet())?l.getSelectedTileSet().SRS:l.getSRSList()[l.getSelectedSRS()];this.changeSrs(m,null,d);l.calculeLimitScaleValues();var f=l.getMergedResolutions(this.resolutions);if((k)&&(this.getProjection()!=this.ancientSRS)){var o=OpenLayers.IAAA_Utils.coordTransform(this.ancientSRS,this.getProjection(),k.left,k.bottom);var n=OpenLayers.IAAA_Utils.coordTransform(this.ancientSRS,this.getProjection(),k.right,k.top);k=new OpenLayers.Bounds(o[0],o[1],n[0],n[1])}this.resolutions=f;this.numZoomLevels=f.length;this.maxExtent=(l.getSelectedTileSet())?l.getSelectedTileSet().bounds:l.maxExtent.clone();var b;for(var g in this.layers){b=((this.layers[g].ignoreWMSCChanges!=null)&&(this.layers[g].ignoreWMSCChanges!=undefined)&&(this.layers[g].ignoreWMSCChanges));if((!b)&&(!this.layers[g].isWMSC)&&(!this.layers[g].isWMTS)&&((this.layers[g].CLASS_NAME!="OpenLayers.Layer.Google")&&(this.layers[g].CLASS_NAME!="OpenLayers.Layer.IAAA_Google"))){this.layers[g].maxExtent=this.maxExtent;this.layers[g].resolutions=this.resolutions;this.layers[g].numZoomLevels=this.numZoomLevels}}if(d){if(k){this.zoomToExtent(k,true)}else{this.redraw()}}if(OpenLayers.IAAA_Utils&&OpenLayers.IAAA_Utils.selectChangeSrsListNode){OpenLayers.IAAA_Utils.selectChangeSrsListNode(m)}for(var c in this.controls){if(this.controls[c].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.controls[c].disableSRSSelector()}}this.ignoreMaxExtent=false||this.ancientIgnoreMaxExtent;this.events.triggerEvent("changepropsforwmsc",{layer:l})},changeMapPropertiesForGoogleMaps:function(l,d){d=((d!=null)&&(d!=undefined))?d:true;if(this.ancientSRS&&this.ancientResolutions&&this.ancientMaxExtent){this.restoreMapFromWMSC(d)}this.ancientSRS=this.getProjection();this.ancientIgnoreMaxExtent=this.ignoreMaxExtent;this.ignoreMaxExtent=true;this.automaticSrs=false;var f;if(l.RESOLUTIONS){f=l.RESOLUTIONS}else{f=l.resolutions}this.ancientResolutions=this.resolutions;this.ancientMaxExtent=this.maxExtent.clone();this.ancientBaseLayerMaxExtent=this.baseLayer.maxExtent.clone();var k=this.getExtent();this.changeSrs(l.projection,f,d);if((k)&&(this.getProjection()!=this.ancientSRS)){var n=OpenLayers.IAAA_Utils.coordTransform(this.ancientSRS,this.getProjection(),k.left,k.bottom);var m=OpenLayers.IAAA_Utils.coordTransform(this.ancientSRS,this.getProjection(),k.right,k.top);k=new OpenLayers.Bounds(n[0],n[1],m[0],m[1])}this.resolutions=f.sort(function(o,j){return j-o});this.numZoomLevels=f.length;if(this.numZoomLevels!=l.numZoomLevels){l.numZoomLevels=this.numZoomLevels;l.initResolutions()}this.maxExtent=l.maxExtent.clone();var b;for(var g in this.layers){b=((this.layers[g].ignoreWMSCChanges!=null)&&(this.layers[g].ignoreWMSCChanges!=undefined)&&(this.layers[g].ignoreWMSCChanges));if((!b)&&(!this.layers[g].isWMSC)&&(!this.layers[g].isWMTS)&&((this.layers[g].CLASS_NAME!="OpenLayers.Layer.Google")&&(this.layers[g].CLASS_NAME!="OpenLayers.Layer.IAAA_Google"))){this.layers[g].maxExtent=this.maxExtent;this.layers[g].resolutions=this.resolutions;this.layers[g].numZoomLevels=this.numZoomLevels}}if(d){if(k){this.zoomToExtent(k,true)}else{this.redraw()}}for(var c in this.controls){if(this.controls[c].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.controls[c].disableSRSSelector()}}this.ignoreMaxExtent=false||this.ancientIgnoreMaxExtent;this.events.triggerEvent("changepropsforwmsc",{layer:l})},changeMapPropertiesForWMTS:function(k,d){if(!k||!k.tileMatrix||!k.tileMatrix.id){return}d=((d!=null)&&(d!=undefined))?d:true;if(this.ancientSRS&&this.ancientResolutions&&this.ancientMaxExtent){this.restoreMapFromWMSC(d)}this.ancientSRS=this.getProjection();this.ancientIgnoreMaxExtent=this.ignoreMaxExtent;this.ignoreMaxExtent=true;if(this._ignoreButtonAutomaticSRSAux==null){this._ignoreButtonAutomaticSRSAux=OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs}this._ancientAutomaticSrs=this.automaticSrs;this.automaticSrs=false;OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs=true;this.ancientResolutions=this.resolutions;this.ancientMaxExtent=this.maxExtent.clone();this.ancientBaseLayerMaxExtent=this.baseLayer.maxExtent.clone();var g=this.getExtent();var l=k.tileMatrixSetSRS;this.changeSrs(l,null,d);if((g)&&(this.getProjection()!=this.ancientSRS)){var n=OpenLayers.IAAA_Utils.coordTransform(this.ancientSRS,this.getProjection(),g.left,g.bottom);var m=OpenLayers.IAAA_Utils.coordTransform(this.ancientSRS,this.getProjection(),g.right,g.top);g=new OpenLayers.Bounds(n[0],n[1],m[0],m[1])}this.resolutions=k.resolutions;this.numZoomLevels=k.resolutions.length;this.maxExtent=k.maxExtent;var b;for(var f in this.layers){b=((this.layers[f].ignoreWMSCChanges!=null)&&(this.layers[f].ignoreWMSCChanges!=undefined)&&(this.layers[f].ignoreWMSCChanges));if((!b)&&(!this.layers[f].isWMSC)&&(!this.layers[f].isWMTS)&&((this.layers[f].CLASS_NAME!="OpenLayers.Layer.Google")&&(this.layers[f].CLASS_NAME!="OpenLayers.Layer.IAAA_Google"))){this.layers[f].maxExtent=this.maxExtent;this.layers[f].resolutions=this.resolutions;this.layers[f].numZoomLevels=this.numZoomLevels}}if(d){if(g){if(this.maxExtent.containsBounds(g)){this.zoomToExtent(g,true)}else{this.zoomToExtent(this.maxExtent,true)}}else{this.redraw()}}if(OpenLayers.IAAA_Utils&&OpenLayers.IAAA_Utils.selectChangeSrsListNode){OpenLayers.IAAA_Utils.selectChangeSrsListNode(l)}for(var c in this.controls){if(this.controls[c].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.controls[c].disableSRSSelector()}}this.ignoreMaxExtent=false||this.ancientIgnoreMaxExtent;this.events.triggerEvent("changepropsforwmts",{layer:k})},removeLayer:function(p){if(!this.destroying){if(this.events.triggerEvent("preremovelayer",{layer:p})===false){return}if(this.baseLayer==p){if(this.layers.length>1){if(p==this.layers[0]){var d=this.layers[1].getVisibility();this.setBaseLayer(this.layers[1]);this.layers[1].setVisibility(d)}else{var d=this.layers[0].getVisibility();this.setBaseLayer(this.layers[0]);this.layers[0].setVisibility(d)}}}}if(p.isFixed){this.viewPortDiv.removeChild(p.div)}else{if(p.div){this.layerContainerDiv.removeChild(p.div)}}if(!this.destroying){var f=null;for(var g=0,v=this.layers.length;g<v;g++){if(this.layers[g].name==p.name){f=g;break}}if(f!=null){if((p.setClearOnBeforeMove!=undefined)&&(p.setClearOnBeforeMove!=null)&&p.setClearOnBeforeMove){OpenLayers.Util.removeItem(this.indexLayersToClearOnBeforeMoveList,f);for(var C=0,k=this.indexLayersToClearOnBeforeMoveList.length;C<k;C++){if(this.indexLayersToClearOnBeforeMoveList[C]>f){this.indexLayersToClearOnBeforeMoveList[C]=this.indexLayersToClearOnBeforeMoveList[C]-1}}}else{if((p.setClearOnAfterMove!=undefined)&&(p.setClearOnAfterMove!=null)&&p.setClearOnAfterMove){OpenLayers.Util.removeItem(this.indexLayersToClearOnAfterMoveList,f);for(var C=0,k=this.indexLayersToClearOnAfterMoveList.length;C<k;C++){if(this.indexLayersToClearOnAfterMoveList[C]>f){this.indexLayersToClearOnAfterMoveList[C]=this.indexLayersToClearOnAfterMoveList[C]-1}}}}}}if((p.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(p.getSessionKey()!=null)){p.removeSession()}OpenLayers.Util.removeItem(this.layers,p);p.removeMap(this);p.map=null;if(this.layers.length==0){this.baseLayer=null}if(!this.destroying){if(((p.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(p.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS"))&&((p.isWMSC)||(p.isWMTS))&&(!p.getLoadFromTree())){var u=false;for(var n in this.layers){u=(u||((((this.layers[n].CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&this.layers[n].isWMSC)||((this.layers[n].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")&&this.layers[n].isWMTS))&&(!this.layers[n].getLoadFromTree())))}if(!u){var o=this.getExtent();if((o)&&(this.ancientSRS)&&(this.getProjection()!=this.ancientSRS)){var B=OpenLayers.IAAA_Utils.coordTransform(this.getProjection(),this.ancientSRS,o.left,o.bottom);var A=OpenLayers.IAAA_Utils.coordTransform(this.getProjection(),this.ancientSRS,o.right,o.top);o=new OpenLayers.Bounds(B[0],B[1],A[0],A[1])}if(this.ancientSRS){this.changeSrs(this.ancientSRS)}if(this._ancientAutomaticSrs!=null){this.automaticSrs=this._ancientAutomaticSrs;this._ancientAutomaticSrs=null}if(this._ignoreButtonAutomaticSRSAux!=null){OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs=this._ignoreButtonAutomaticSRSAux;this._ignoreButtonAutomaticSRSAux=null}var l;for(var n in this.layers){l=((this.layers[n].ignoreWMSCChanges!=null)&&(this.layers[n].ignoreWMSCChanges!=undefined)&&(this.layers[n].ignoreWMSCChanges));if((!l)&&(!this.layers[n].isWMSC)&&(!this.layers[n].isWMTS)&&((this.layers[n].CLASS_NAME!="OpenLayers.Layer.Google")&&(this.layers[n].CLASS_NAME!="OpenLayers.Layer.IAAA_Google"))&&(this.ancientMaxExtent)&&(this.ancientResolutions)){if((this.layers[n]===this.baseLayer)&&this.ignoreMaxExtent){this.layers[n].maxExtent=this.ancientBaseLayerMaxExtent}else{this.layers[n].maxExtent=this.ancientMaxExtent}this.layers[n].resolutions=this.ancientResolutions;this.layers[n].numZoomLevels=this.ancientResolutions.length}}this.maxExtent=this.ancientMaxExtent;this.resolutions=this.ancientResolutions;this.numZoomLevels=this.resolutions.length;this.ancientMaxExtent=null;this.ancientSRS=null;this.ancientResolutions=[];if(!this.destroying){if(o){this.zoomToExtent(o,true)}else{this.redraw()}}if(OpenLayers.IAAA_Utils&&OpenLayers.IAAA_Utils.selectChangeSrsListNode){OpenLayers.IAAA_Utils.selectChangeSrsListNode(this.getProjection())}for(var m in this.controls){if(this.controls[m].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.controls[m].enableSRSSelector()}}this.events.triggerEvent("restoreprops",{layer:p})}}else{if((p.CLASS_NAME=="OpenLayers.Layer.Google")||(p.CLASS_NAME=="OpenLayers.Layer.IAAA_Google")){this.restoreMapFromWMSC()}}}if((p.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")||(p.CLASS_NAME=="OpenLayers.Layer.IAAA_KML")){this.events.unregister("controlactivate",p,p.onActivateControl);p.destroy()}if((p.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS")&&p.tile){p.tile.map=this;p.tile.destroy()}else{if(((p.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(p.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS"))&&p.grid){for(var b in p.grid){for(var s in p.grid[b]){p.grid[b][s].map=this}}try{p.clearGrid()}catch(q){}}}if(!this.destroying){this.events.triggerEvent("removelayer",{layer:p,property:"remove"});p.events.triggerEvent("removed",{map:this,layer:p})}},restoreMapFromWMSC:function(d){d=((d!=null)&&(d!=undefined))?d:true;if(this.ancientSRS&&this.ancientResolutions&&this.ancientMaxExtent){var k=this.getProjection();if(this._ancientAutomaticSrs!=null){this.automaticSrs=this._ancientAutomaticSrs;this._ancientAutomaticSrs=null}if(this.ancientSRS){this.changeSrs(this.ancientSRS,this.ancientResolutions,d)}var g;for(var c in this.layers){g=((this.layers[c].ignoreWMSCChanges!=null)&&(this.layers[c].ignoreWMSCChanges!=undefined)&&(this.layers[c].ignoreWMSCChanges));if((!g)&&(!this.layers[c].isWMSC)&&(!this.layers[c].isWMTS)&&((this.layers[c].CLASS_NAME!="OpenLayers.Layer.Google")&&(this.layers[c].CLASS_NAME!="OpenLayers.Layer.IAAA_Google"))){if((this.layers[c]===this.baseLayer)&&this.ignoreMaxExtent){this.layers[c].maxExtent=this.ancientBaseLayerMaxExtent}else{this.layers[c].maxExtent=this.ancientMaxExtent}this.layers[c].resolutions=this.ancientResolutions;this.layers[c].numZoomLevels=this.ancientResolutions.length}}this.maxExtent=this.ancientMaxExtent;this.resolutions=this.ancientResolutions;this.numZoomLevels=this.resolutions.length;if(k==this.ancientSRS){var f=this.getExtent();if(f&&d){this.zoomToExtentForNewSrs(f,true)}}this.ancientMaxExtent=null;this.ancientSRS=null;this.ancientResolutions=[];this.redraw();for(var b in this.controls){if(this.controls[b].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){this.controls[b].enableSRSSelector()}}OpenLayers.IAAA_Utils.ignoreButtonAutomaticSrs=this._ignoreButtonAutomaticSRSAux;this._ignoreButtonAutomaticSRSAux=null;this.events.triggerEvent("restoreprops")}},setCenter:function(g,N,d,j){this.alreadyInSetCenter++;if(this.alreadyInSetCenter==1){this.indexSLDList=[];for(Q=0,f=this.layers.length;Q<f;Q++){if((this.layers[Q].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")&&this.layers[Q].visibility){this.indexSLDList.push(Q);this.layers[Q].setVisibility(false)}}}var X=false;var R=null;if(!this.mapUpdated){var T=this.extentAux;var V=this.getZoom();var K=this.extentAux.getWidth()*((g.lon-T.left)/T.getWidth());var p=this.extentAux.getHeight()*((g.lat-T.bottom)/T.getHeight());g=new OpenLayers.LonLat(K,p);if(N){R=N-V;N=this.getZoomForExtent(this.extentAux,true)+R}this.mapUpdated=true;this.zoomToExtent(this.extentAux);X=true}V=N||this.getZoom();if(this.automaticSrs&&this.baseLayer){var F=this.baseLayer.scales[V];if(this.getExtent()){var m=this.getAutomaticSrs(F);if(m!=this.getProjection()){j=true}}else{j=true}}newArguments=[g,N,d,j];if(((N!=undefined)&&(N!=null)&&(N!=this.getZoom())&&(N>=0)&&((!this.resolutions)||(N<this.resolutions.length)))){for(var Q=0,f=this.layers.length;Q<f;Q++){var b=this.layers[Q];if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")||((b.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")&&((b.clearOnZoom!=null)&&(b.clearOnZoom!=undefined)&&b.clearOnZoom))){b.clearTiles()}}}var S=false;if(this.automaticSrs&&this.baseLayer){try{var F=this.baseLayer.scales[V];var m=this.getAutomaticSrs(F);if(m!=this.getProjection()){S=true}}catch(U){}}var c=null;if(S){for(var O=0;O<this.controls.length;O++){if(this.controls[O].CLASS_NAME=="OpenLayers.Control.IAAA_NavigationHistory"){this.controls[O].deactivate();c=this.controls[O];continue}}}var M=false;if(this.getControlsByClass("OpenLayers.Control.IAAA_GoogleLayerSelector").length>0){var J=this.getControlsByClass("OpenLayers.Control.IAAA_GoogleLayerSelector")[0];var E=(this.getControlsByClass("OpenLayers.Control.DragPan")&&(this.getControlsByClass("OpenLayers.Control.DragPan").length>0))?(this.getControlsByClass("OpenLayers.Control.DragPan")[0]):null;var q=(this.getControlsByClass("OpenLayers.Control.IAAA_DragPan")&&(this.getControlsByClass("OpenLayers.Control.IAAA_DragPan").length>0))?(this.getControlsByClass("OpenLayers.Control.IAAA_DragPan")[0]):null;var n=(E)?E:((q)?q:null);if(J&&J.additionalLayer&&J.additionalLayer.getVisibility()&&n&&n.handler&&!(n.handler.dragging)){J.additionalLayer.setVisibility(false);M=true}}if(this.viewControls.length>0){var l=this.getViewControlActive();var E=(this.getControlsByClass("OpenLayers.Control.DragPan")&&(this.getControlsByClass("OpenLayers.Control.DragPan").length>0))?(this.getControlsByClass("OpenLayers.Control.DragPan")[0]):null;var q=(this.getControlsByClass("OpenLayers.Control.IAAA_DragPan")&&(this.getControlsByClass("OpenLayers.Control.IAAA_DragPan").length>0))?(this.getControlsByClass("OpenLayers.Control.IAAA_DragPan")[0]):null;var n=(E)?E:((q)?q:null);if(l){l.hideConstrainedAdditionalLayers((n&&n.handler&&!(n.handler.dragging)))}}if((navigator.appName=="Microsoft Internet Explorer")&&(this.div.style.display=="none")){this.size.w=this.div.style.width;this.size.h=this.div.style.height;if(this.useWCTS&&S){this.zoom=V;this.resolution=this.getResolutionForZoom(V);this.center=g.clone()}else{this.panTween&&this.panTween.stop();this.moveTo(g,N,{dragging:d,forceZoomChange:j,caller:"setCenter",noEvent:true})}}else{if(this.useWCTS&&S){this.zoom=V;this.resolution=this.getResolutionForZoom(V);this.center=g.clone()}else{OpenLayers.Map.prototype.setCenter.apply(this,newArguments)}}if(X){if(this.resAux!=null){var r=this.resAux;this.resAux=null;this.zoomToScale(r);if(R!=null){this.zoomTo(this.getZoom()+R)}}}if(c){c.activate()}var I=false;if(this.automaticSrs&&this.baseLayer){var F=this.baseLayer.scales[this.getZoom()];var m=this.getAutomaticSrs(F);if(m!=this.getProjection()){this.changeSrs(m);I=true}}this.events.triggerEvent("newExtent");for(var Q=0,C=this.controls.length;Q<C;Q++){if(this.controls[Q].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){if(this.controls[Q].analysisMenu!=null){this.controls[Q].events.triggerEvent("newExtent")}}else{if((this.controls[Q].CLASS_NAME=="OpenLayers.Control.IAAA_AspectAnalyzer")||(this.controls[Q].CLASS_NAME=="OpenLayers.Control.IAAA_GradientAnalyzer")||(this.controls[Q].CLASS_NAME=="OpenLayers.Control.IAAA_HeightAnalyzer")){this.controls[Q].events.triggerEvent("newExtent");if(I){this.controls[Q].events.triggerEvent("newSrs")}}else{if(this.controls[Q].CLASS_NAME=="OpenLayers.Control.IAAA_TerritorialAnalyzer"){this.controls[Q].events.triggerEvent("newExtent")}else{if(this.controls[Q].CLASS_NAME=="OpenLayers.Control.IAAA_BufferOperation"){if(I){this.controls[Q].events.triggerEvent("newSrs")}}else{if(this.controls[Q].CLASS_NAME=="OpenLayers.Control.IAAA_AreaSelectorByUserZone"){if(I){this.controls[Q].events.triggerEvent("newSrs")}}}}}}}for(var Q=0,f=this.layers.length;Q<f;Q++){if((this.layers[Q].CLASS_NAME=="OpenLayers.Layer.IAAA_Vector_PLZ")&&(this.layers[Q].features)){for(var v=0,o=this.layers[Q].features.length;v<o;v++){var G=this.layers[Q].features[v];if(G.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.layers[Q].defineIconStyle){this.layers[Q].defineIconStyle(G,null)}}else{if(!G.style||(G.style=={})){G.style=OpenLayers.Feature.Vector.style["default"]}this.layers[Q].drawFeature(G,this.layers[Q].defaultStyle);if(this.layers[Q].defineGeometryStyle){this.layers[Q].defineGeometryStyle(G)}}}}}var D=this.getControlsByClass("OpenLayers.Control.IAAA_ModifyFeature_PLZ");var B=null;if(D.length>0){B=D[0];if(B.feature!=null){B.resetVertices()}}if(this.getControlsByClass("OpenLayers.Control.IAAA_GoogleLayerSelector").length>0){var J=this.getControlsByClass("OpenLayers.Control.IAAA_GoogleLayerSelector")[0];var H=this.getLayerIndex(J.additionalLayer);if(J&&J.additionalLayer&&catastroMapServerLayersList){var s=OpenLayers.Util.indexOf(this.getLayersByName(mapServersTitlesList[0])[0].resolutions,this.getLayersByName(mapServersTitlesList[0])[0].getResolution());if(catastroMapServerLayersList[s]){J.additionalLayer.params.LAYERS=catastroMapServerLayersList[s];if(M){J.additionalLayer.setVisibility(true);M=false}}else{J.additionalLayer.params.LAYERS=catastroMapServerLayersListDefault;if(M){J.additionalLayer.setVisibility(true);M=false}}}if(J&&J.additionalLayer&&J.additionalLayerScaleLimit&&J.additionalLayerButtonDisabledImg){if(this.getActualScale()>J.additionalLayerScaleLimit){OpenLayers.Util.modifyAlphaImageDiv(J.additionalLayerButton,null,null,null,J.additionalLayerButtonDisabledImg);J.additionalLayer.setVisibility(false);if(this.layerVisibilityInResizeMethod&&this.layerVisibilityInResizeMethod[H]){this.layerVisibilityInResizeMethod[H]=false}}else{if(this.resizing){if(this.layerVisibilityInResizeMethod[H]==true){OpenLayers.Util.modifyAlphaImageDiv(J.additionalLayerButton,null,null,null,J.additionalLayerButtonSelectedImg)}else{OpenLayers.Util.modifyAlphaImageDiv(J.additionalLayerButton,null,null,null,J.additionalLayerButtonStableImg)}}else{if(J.additionalLayer.getVisibility()==true){OpenLayers.Util.modifyAlphaImageDiv(J.additionalLayerButton,null,null,null,J.additionalLayerButtonSelectedImg)}else{OpenLayers.Util.modifyAlphaImageDiv(J.additionalLayerButton,null,null,null,J.additionalLayerButtonStableImg)}}}}}if(this.viewControls.length>0){var l=this.getViewControlActive();if(l){l.changeExtentRestriction();l.checkAdditionalLayerConstraints()}}this.alreadyInSetCenter--;if(this.alreadyInSetCenter==0){if(this.indexSLDList.length>0){for(Q=0,indexSLDLen=this.indexSLDList.length;Q<indexSLDLen;Q++){this.layers[this.indexSLDList[Q]].visibility=true}this.hasSLD=true;if(!this.dragInMotion&&(!this.isLoading())){for(var Q=0,u=this.layers.length;Q<u;Q++){if(this.layers[Q].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD"){var A=this.layers[Q].getVisibility();this.layers[Q].display(A);this.layers[Q].setVisibility(false);this.layers[Q].setVisibility(A)}}}}else{this.hasSLD=false}}},moveByPx:function(r,q){var k=this.size.w/2;var c=this.size.h/2;var n=k+r;var m=c+q;var d=this.baseLayer.wrapDateLine;var o=0;var l=0;if(this.restrictedExtent){o=k;l=c;d=false}r=d||n<=this.maxPx.x-o&&n>=this.minPx.x+o?Math.round(r):0;q=m<=this.maxPx.y-l&&m>=this.minPx.y+l?Math.round(q):0;if(r||q){if(!this.dragging){this.dragging=true;this.events.triggerEvent("movestart");if(!OpenLayers.IAAA_Utils.isMobileNavigator()||(OpenLayers.IAAA_Utils.getNavigator()[0]=="chrome")){if(((this.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google"))&&OpenLayers.IAAA_Utils.getGoogleAPIVersion()==3){this.cloneGoogleScreen()}}}this.center=null;if(r){this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-r+"px";this.minPx.x-=r;this.maxPx.x-=r}if(q){this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-q+"px";this.minPx.y-=q;this.maxPx.y-=q}if(this.baseLayer&&this.baseLayer.visibility&&this.baseLayer.inRange){if(((this.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google"))&&OpenLayers.IAAA_Utils.getGoogleAPIVersion()==3){var p=this.baseLayer.mapObject&&this.baseLayer.mapObject.getDiv()&&this.baseLayer.mapObject.getDiv().firstChild;if(p){var b=document.getElementById("googleCloneNode");if(b){b.style.left=parseInt(b.style.left)-r+"px";b.style.top=parseInt(b.style.top)-q+"px";b.style.display="block";p.style.display="none"}}else{this.baseLayer.moveByPx(r,q)}}else{this.baseLayer.moveByPx(r,q)}}this.baseLayer.events.triggerEvent("move");var g,f,j;for(f=0,j=this.layers.length;f<j;++f){g=this.layers[f];if(g.visibility&&(g!==this.baseLayer&&g.inRange)){g.moveByPx(r,q);g.events.triggerEvent("move")}}this.events.triggerEvent("move")}},moveTo:function(m,c,g){if(!g){g={}}if(c!=null){c=parseFloat(c);if(!this.fractionalZoom){c=Math.round(c)}}var v=g.dragging||this.dragging;var o=g.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(m)){m=this.maxExtent.getCenterLonLat();this.center=m.clone()}if(this.restrictedExtent!=null){if(m==null){m=this.center}if(c==null){c=this.getZoom()}var A=this.getResolutionForZoom(c);var q=this.calculateBounds(m,A);if(!this.restrictedExtent.containsBounds(q)){var I=this.restrictedExtent.getCenterLonLat();if(q.getWidth()>this.restrictedExtent.getWidth()){m=new OpenLayers.LonLat(I.lon,m.lat)}else{if(q.left<this.restrictedExtent.left){m=m.add(this.restrictedExtent.left-q.left,0)}else{if(q.right>this.restrictedExtent.right){m=m.add(this.restrictedExtent.right-q.right,0)}}}if(q.getHeight()>this.restrictedExtent.getHeight()){m=new OpenLayers.LonLat(m.lon,I.lat)}else{if(q.bottom<this.restrictedExtent.bottom){m=m.add(0,this.restrictedExtent.bottom-q.bottom)}else{if(q.top>this.restrictedExtent.top){m=m.add(0,this.restrictedExtent.top-q.top)}}}}}var p=o||((this.isValidZoomLevel(c))&&(c!=this.getZoom()));var l=(this.isValidLonLat(m))&&(!m.equals(this.center));var u=!p&&!l&&!v&&(this.layerContainerOrigin==null);if(p||l||v||u){v||this.events.triggerEvent("movestart");if(l){if(!p&&this.center){this.centerLayerContainer(m)}this.center=m.clone()}var J=p?this.getResolutionForZoom(c):this.getResolution();if(p||this.layerContainerOrigin==null){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerDiv.style.left="0px";this.layerContainerDiv.style.top="0px";var s=this.getMaxExtent({restricted:true});var f=s.getCenterLonLat();var n=this.center.lon-f.lon;var d=f.lat-this.center.lat;var F=Math.round(s.getWidth()/J);var D=Math.round(s.getHeight()/J);var j=(parseInt(this.size.w)-F)/2-n/J;var r=(parseInt(this.size.h)-D)/2-d/J;this.minPx=new OpenLayers.Pixel(j,r);this.maxPx=new OpenLayers.Pixel(j+F,r+D)}if(u){return}if(p){this.zoom=c;this.resolution=J;this.viewRequestID++}var k=this.getExtent();if(this.baseLayer&&this.baseLayer.visibility){this.baseLayer.moveTo(k,p,g.dragging);g.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:p});if(((this.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google"))&&OpenLayers.IAAA_Utils.getGoogleAPIVersion()==3){var G=function(){try{var M=this.baseLayer.mapObject&&this.baseLayer.mapObject.getDiv()&&this.baseLayer.mapObject.getDiv().firstChild;if(M){M.style.display="block";if(OpenLayers.IAAA_Utils.isMobileNavigator()&&(OpenLayers.IAAA_Utils.getNavigator()[0]!="chrome")){if(((this.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google"))&&OpenLayers.IAAA_Utils.getGoogleAPIVersion()==3){this.cloneGoogleScreen()}}}if(this.baseLayer.tilesLoaded){google.maps.event.removeListener(this.baseLayer.repositionContainer);this.baseLayer.repositionContainer=null;var K=document.getElementById("googleCloneNode");if(K){if(OpenLayers.IAAA_Utils.isMobileNavigator()&&(OpenLayers.IAAA_Utils.getNavigator()[0]!="chrome")){window.setTimeout("try{OpenLayers.Map.IAAA_Map_213.prototype.resetGoogleCloneNode();}catch(e){}",250)}else{this.resetGoogleCloneNode()}}}}catch(N){}};var E=function(){try{var M=this.baseLayer.mapObject&&this.baseLayer.mapObject.getDiv()&&this.baseLayer.mapObject.getDiv().firstChild;if(M){M.style.display="block";if(OpenLayers.IAAA_Utils.isMobileNavigator()&&(OpenLayers.IAAA_Utils.getNavigator()[0]!="chrome")){if(((this.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google"))&&OpenLayers.IAAA_Utils.getGoogleAPIVersion()==3){this.cloneGoogleScreen()}}}if(this.baseLayer.repositionContainer){google.maps.event.removeListener(this.baseLayer.tilesLoaded);this.baseLayer.tilesLoaded=null;var K=document.getElementById("googleCloneNode");if(K){if(OpenLayers.IAAA_Utils.isMobileNavigator()&&(OpenLayers.IAAA_Utils.getNavigator()[0]!="chrome")){window.setTimeout("try{OpenLayers.Map.IAAA_Map_213.prototype.resetGoogleCloneNode();}catch(e){}",250)}else{this.resetGoogleCloneNode()}}}}catch(N){}};this.baseLayer.tilesLoaded=google.maps.event.addListenerOnce(this.baseLayer.mapObject,"tilesloaded",OpenLayers.Function.bind(E,this));this.baseLayer.repositionContainer=google.maps.event.addListenerOnce(this.baseLayer.mapObject,"idle",OpenLayers.Function.bind(G,this))}}if(this.baseLayer){k=this.baseLayer.getExtent()}for(var B=this.layers.length-1;B>=0;--B){var H=this.layers[B];if(H!==this.baseLayer&&!H.isBaseLayer){var b=H.calculateInRange();if(H.inRange!=b){H.inRange=b;if(!b){H.display(false)}this.events.triggerEvent("changelayer",{layer:H,property:"visibility"})}if(b&&H.visibility){if(((typeof this.baseLayer.projection!="string")&&(typeof H.projection!="string")&&!this.baseLayer.projection.equals(H.projection))||((typeof H.projection=="string")&&(typeof this.baseLayer.projection=="string")&&(this.baseLayer.projection!=H.projection))){k=H.getExtent()}H.moveTo(k,p,g.dragging);g.dragging||H.events.triggerEvent("moveend",{zoomChanged:p})}}}this.events.triggerEvent("move");v||this.events.triggerEvent("moveend");if(p){for(var B=0,C=this.popups.length;B<C;B++){this.popups[B].updatePosition()}this.events.triggerEvent("zoomend")}}},cloneGoogleScreen:function(){if(((this.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google"))&&OpenLayers.IAAA_Utils.getGoogleAPIVersion()==3){var b=document.getElementById("googleCloneNode");if(b){if(b.firstChild){b.removeChild(b.firstChild)}this.viewPortDiv.removeChild(b)}else{b=document.createElement("div");b.id="googleCloneNode"}var d=this.baseLayer.mapObject&&this.baseLayer.mapObject.getDiv()&&this.baseLayer.mapObject.getDiv().firstChild;if(d.cloneNode){b.appendChild(d.cloneNode(true))}b.style.display="none";b.style.width="100%";b.style.top="0px";b.style.height="100%";b.style.left="0px";b.style.position="absolute";if(OpenLayers.IAAA_Utils.isMobileNavigator()){if(this.baseLayer.div&&this.baseLayer.div.style&&this.baseLayer.div.style.zIndex){b.style.zIndex=this.baseLayer.div.style.zIndex}}this.viewPortDiv.appendChild(b);var f=b.style;if(OpenLayers.Util.vendorPrefix){var c=OpenLayers.Util.vendorPrefix.style("transform");f[c]=""}else{f["-webkit-transform"]="";f["-moz-transform"]="";f.msTransform=""}}},resetGoogleCloneNode:function(){var c=document.getElementById("googleCloneNode");if(c){c.style.display="none";var b=c.style;b["-webkit-transform"]="";b["-moz-transform"]="";b.msTransform=""}},getAutomaticSrs:function(b){if(this.automaticSrs){if(b>=this.scaleLevelSrs){newSrs=this.primaryAutomaticSrs}else{var c=this.getExtent().right;if(this.getProjection()!=this.primaryAutomaticSrs){punto=OpenLayers.IAAA_Utils.coordTransform(this.getProjection(),this.primaryAutomaticSrs,this.getExtent().right,this.getExtent().left);c=punto[0]}if(c<=-10){newSrs=this.secondaryAutomaticSrs_Canarias}else{newSrs=this.secondaryAutomaticSrs}}return newSrs}},redraw:function(){if(!this.mapUpdated){this.mapUpdated=true;this.zoomToExtent(this.extentAux)}if(this.resAux!=null){newRes=this.resAux;this.resAux=null;this.zoomToScale(newRes)}for(var b in this.layers){if((this.layers[b].CLASS_NAME!="OpenLayers.Layer.IAAA_GML")&&(this.layers[b].CLASS_NAME!="OpenLayers.Layer.IAAA_KML")){if((this.layers[b].CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(this.layers[b].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")){this.layers[b].updateTreeNodeVisibility()}var c=this.layers[b].getVisibility();this.layers[b].display(c);this.layers[b].setVisibility(false);this.layers[b].setVisibility(c)}else{this.layers[b].moveTo(this.getExtent(),true)}}},setExtentAux:function(b){this.extentAux=b;this.mapUpdated=false},setResAux:function(b){this.resAux=b},setMapBounds:function(c){var f=OpenLayers.IAAA_Utils.coordTransform(c.srs,this.getProjection(),c.left,c.top);var d=OpenLayers.IAAA_Utils.coordTransform(c.srs,this.getProjection(),c.right,c.bottom);var b=new OpenLayers.Bounds(f[0],d[1],d[0],f[1]);this.bounds=b;this.bounds.projection=this.getProjection()},getServer:function(b,d){var c=0;if(d==null){while((c<this.layers.length)&&(this.layers[c].getUrl()!=b)){c++}}else{while((c<this.layers.length)&&!((this.layers[c].getUrl()==b)&&(this.layers[c].name==d))){c++}}if(c<this.layers.length){return this.layers[c]}else{return null}},getLayerPosition:function(c){for(var b in this.layers){if(this.layers[b]==c){return parseInt(b)}}return -1},removeServerByIndex:function(g){var c=g;if(c<this.layers.length){var f=this.layers[c].getLayerList();var d=f.length;for(var b=d-1;b>=0;b--){this.layers[c].removeLayer(b)}while(c<(this.layers.length-1)){this.layers[c]=this.layers[c+1];c++}this.layers[c]=null;this.layers.length--;return true}else{return false}},getMapServerConnection:function(b){return this.layers[b]},getMapServerConnectionCount:function(){return this.layers.length},interchangeLayers2:function(n,m){if(n[1]<m[0]){var v=n;var q=m}else{if(m[1]<m[0]){var v=m;var q=n}else{return}}if(this.layers[v[0]]==this.baseLayer){this.layers[q[0]].isBaseLayer=true;var r=this.layers[v[0]].getVisibility();var o=this.layers[q[0]].getVisibility();this.setBaseLayer(this.layers[q[0]]);this.layers[v[0]].isBaseLayer=false;this.layers[v[0]].setVisibility(r);this.layers[q[0]].setVisibility(o)}var g=new Array();var u=new Array();var s=new Array();var p=new Array();for(var f=q[0];f<=q[1];f++){g.push(this.layers[f])}for(var f=v[0];f<=v[1];f++){u.push(this.layers[f])}for(var f=v[1]+1;f<q[0];f++){s.push(this.layers[f])}for(var f=q[1]+1;f<this.layers.length;f++){p.push(this.layers[f])}var f=v[0];while((f-v[0])<=(q[1]-q[0])){this.setLayerIndex(g[f-v[0]],f);f++}var d=0;while(d<s.length){this.setLayerIndex(s[d],f);f++;d++}var c=0;while(c<u.length){this.setLayerIndex(u[c],f);f++;c++}var b=0;while(b<p.length){this.setLayerIndex(p[b],f);f++;b++}},setBaseLayer:function(c,b){if(c!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,c)!=-1){this.baseLayer=c;this.viewRequestID++;if((b==null)||(b==false)){this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}}}},removeControl:function(c){if((c)&&(c==this.getControl(c.id))){if((!c.outsideViewport)&&(c.div!=null)){try{this.viewPortDiv.removeChild(c.div)}catch(b){}}OpenLayers.Util.removeItem(this.controls,c)}},resize:function(b,m,C){C=((C!=null)&&(C!=undefined))?C:false;this.resizing=true;var H=this.getWindowSizeForMinMapSize().w;var D=this.getWindowSizeForMinMapSize().h;var B=this.size;var v=B?B.w:0;factorX=b/H;factorY=m/D;var A=this.getExtent();var E=(navigator.appName=="Microsoft Internet Explorer")?12:6;if(factorX>=1){if((this.getMaxWidth()!=null)&&((this.getMinWidth()*factorX)>this.getMaxWidth())){this.div.style.width=this.getMaxWidth()-E+"px"}else{this.div.style.width=parseInt(this.getMinWidth()*factorX)-E+"px"}}else{this.div.style.width=this.getMinWidth()-E+"px"}if(factorY>=1){if((this.getMaxHeight()!=null)&&((this.getMinHeight()*factorY)>this.getMaxHeight())){this.div.style.height=(this.getMaxHeight()-E)-this.notMapHeight+"px"}else{this.div.style.height=(parseInt(this.getMinHeight()*factorY)-E)-this.notMapHeight+"px"}}else{this.div.style.height=this.getMinHeight()-E+"px"}this.size=new OpenLayers.Size(this.div.style.width,this.div.style.height);if(!C){this.layerVisibilityInResizeMethod=[];for(var G in this.layers){this.layerVisibilityInResizeMethod[this.layerVisibilityInResizeMethod.length]=this.layers[G].getVisibility();this.layers[G].setVisibility(false);if(((this.layers[G].CLASS_NAME=="OpenLayers.Layer.Grid")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.WMS")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS"))&&this.layers[G].singleTile){this.layers[G].onMapResize()}}}var J=document.getElementById("fondo_img");if(J){var q=v-J.width;var l=(navigator.appName=="Microsoft Internet Explorer")?6:0;if(this.div.style.width.split("px").length==0){J.width=(this.div.style.width-q)-l}else{J.width=this.div.style.width.split("px")[0]-q-l}}if(!C){if(this.baseLayer&&(this.baseLayer.CLASS_NAME!="OpenLayers.Layer.Google")&&(this.baseLayer.CLASS_NAME!="OpenLayers.Layer.IAAA_Google")&&A){this.zoomToExtent(A,true)}var F=0;for(var G in this.layers){this.layers[G].setVisibility(this.layerVisibilityInResizeMethod[F]);F++}if(this.baseLayer&&((this.baseLayer.CLASS_NAME=="OpenLayers.Layer.Google")||(this.baseLayer.CLASS_NAME=="OpenLayers.Layer.IAAA_Google"))){if(A){this.zoomToExtent(A,true);if(this.baseLayer.numZoomLevels<=this.getZoom()){this.zoomTo(this.baseLayer.numZoomLevels-1)}}var d=false;var g=this.getControlsByClass("OpenLayers.Control.IAAA_GoogleLayerSelector");var o=this.getControlsByClass("OpenLayers.Control.IAAA_GoogleViewSelector");var p=null;if((g&&g[0]&&g[0].active)){p=g[0]}else{if((o&&o[0]&&o[0].active)){p=o[0]}}var n=false;if(p&&p.streetViewLayerVisible()){p.setStreetViewLayerVisibility(false);p.streetViewControl.deactivate();n=true}if(this.baseLayer.reset){if(this.baseLayer.setGoogleCenterToUpdate){this.baseLayer.setGoogleCenterToUpdate()}this.baseLayer.reset()}else{var f=parseInt(this.baseLayer.version);if(f==2){delete this.baseLayer.mapObject;this.baseLayer.mapObject=null;this.baseLayer.removeBrandingDivs();delete OpenLayers.Layer.Google.cache[this.id];OpenLayers.Layer.Google.cache[this.id]=null;try{if(this.baseLayer.div.childNodes.length>0){this.baseLayer.div.removeChild(this.baseLayer.div.firstChild)}while(this.baseLayer.pane.childNodes.length>0){this.baseLayer.pane.removeChild(this.baseLayer.pane.firstChild)}this.viewPortDiv.removeChild(document.getElementById(this.id+"_GMap2Container"))}catch(I){}this.baseLayer.loadMapObject();this.baseLayer.redraw();if(this.baseLayer.setMapType){this.baseLayer.setMapType()}else{if(OpenLayers.Util.indexOf(this.baseLayer.mapObject.getMapTypes(),this.baseLayer.type)==-1){this.baseLayer.mapObject.addMapType(this.baseLayer.type)}this.baseLayer.mapObject.setMapType(this.baseLayer.type)}}else{if(this.baseLayer.setGoogleCenterToUpdate){this.baseLayer.setGoogleCenterToUpdate()}try{this.baseLayer.removeGMapElements();if(this.baseLayer.repositionListener){google.maps.event.removeListener(this.baseLayer.repositionListener);this.baseLayer.repositionListener=null}}catch(I){}delete this.baseLayer.mapObject;this.baseLayer.mapObject=null;delete OpenLayers.Layer.Google.cache[this.baseLayer.map.id];var c;var u=OpenLayers.Layer.Google.cache[this.baseLayer.map.id];var r=this.baseLayer.map.viewPortDiv;var s=document.createElement("div");s.id=this.baseLayer.map.id+"_GMapContainer";s.style.position="absolute";s.style.width="100%";s.style.height="100%";r.appendChild(s);center=this.baseLayer.map.getCenter();c=new google.maps.Map(s,{center:center?new google.maps.LatLng(center.lat,center.lon):new google.maps.LatLng(0,0),zoom:this.baseLayer.map.getZoom()||0,mapTypeId:this.baseLayer.type,disableDefaultUI:true,keyboardShortcuts:false,draggable:false,disableDoubleClickZoom:true,scrollwheel:false,streetViewControl:false});u={mapObject:c,count:1};OpenLayers.Layer.Google.cache[this.baseLayer.map.id]=u;this.baseLayer.mapObject=c;this.baseLayer.redraw();if(this.baseLayer.setMapType){this.baseLayer.setMapType()}else{if(OpenLayers.IAAA_Utils.isGoogleMapTypeAvailable(f,this.baseLayer.mapObject,this.baseLayer.type)){this.baseLayer.type=google.maps.MapTypeId.ROADMAP}this.baseLayer.mapObject.setMapTypeId(this.baseLayer.type)}if(this.baseLayer.repositionMapElements){this.baseLayer.updateMapObjectCenter=true;this.baseLayer.forceReposition=true;this.baseLayer.repositionMapElements()}this.baseLayer.setGMapVisibility(this.baseLayer.visibility)}}if(n){p.setStreetViewLayerVisibility(true);p.streetViewControl.activate();n=false}}for(var G in this.layers){if((this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_JSON")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_Markers")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.Markers")){this.layers[G].redraw()}else{if((this.layers[G].CLASS_NAME=="OpenLayers.Layer.Vector")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_Vector_PLZ")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVector")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVectorWithTolerance")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_VectorGenericPopups")||(this.layers[G].CLASS_NAME=="OpenLayers.Layer.Vector.RootContainer")){if(this.layers[G].CLASS_NAME=="OpenLayers.Layer.Vector.RootContainer"){this.layers[G].removeMap(this)}if(this.layers[G].map!=this){this.layers[G].setMap(this)}this.layers[G].setMap(this);this.layers[G].redraw();if((this.layers[G].CLASS_NAME=="OpenLayers.Layer.IAAA_Vector_PLZ")&&(this.layers[G].features)){for(var K in this.layers[G].features){var k=this.layers[G].features[K];if(k.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.layers[G].defineIconStyle){this.layers[G].defineIconStyle(k,null)}}else{k.style=OpenLayers.Feature.Vector.style["default"];this.layers[G].drawFeature(k,this.layers[G].defaultStyle);if(this.layers[G].defineGeometryStyle){this.layers[G].defineGeometryStyle(k)}}}}}}}this.resizeDrawFeatureLayers()}if(this._incompatibleMapServerDialog){this._incompatibleMapServerDialog.style.top=(m/2)-100;this._incompatibleMapServerDialog.style.left=(b/2)-175}if(this._serviceOutOfScopeDialog){this._serviceOutOfScopeDialog.style.top=(m/2)-100;this._serviceOutOfScopeDialog.style.left=(b/2)-275}this.resizing=false;this.events.triggerEvent("resizeend")},updateSize:function(){OpenLayers.Map.prototype.updateSize.apply(this,arguments);this.events.triggerEvent("sizeUpdated")},resizeDrawFeatureLayers:function(){for(var b in this.controls){if((this.controls[b].CLASS_NAME=="OpenLayers.Control.DrawFeature")&&(this.controls[b].handler)&&(this.controls[b].handler.layer)){this.controls[b].handler.layer.renderer.setSize(this.getSize());this.controls[b].handler.layer.maxResolution=this.baseLayer.resolutions[0];this.controls[b].handler.layer.minResolution=this.baseLayer.resolutions[this.baseLayer.resolutions.length-1];this.controls[b].handler.layer.inRange=this.controls[b].handler.layer.calculateInRange(this.getResolution());this.controls[b].handler.layer.moveTo(this.getExtent());switch(this.controls[b].handler.CLASS_NAME){case"OpenLayers.Handler.Point":if(this.controls[b].handler.point!=null){this.controls[b].handler.drawFeature()}break;case"OpenLayers.Handler.Path":if((this.controls[b].handler.point!=null)&&(this.controls[b].handler.line!=null)){this.controls[b].handler.drawFeature()}break;case"OpenLayers.Handler.Polygon":if((this.controls[b].handler.point!=null)&&(this.controls[b].handler.polygon!=null)){this.controls[b].handler.drawFeature()}break;default:this.controls[b].handler.drawFeature()}}}},getMinWidth:function(){return this.minWidth},getMinHeight:function(){return this.minHeight},getMaxWidth:function(){return this.maxWidth},getMaxHeight:function(){return this.maxHeight},getWindowSizeForMinMapSize:function(){return this.windowSizeForMinMapSize},getMaxExtent:function(f){var c=null;if(!OpenLayers.IAAA_Utils.isGeographicalProjection(this.projection)&&this.ignoreMaxExtent){if(!this.utmMaxExtent){if(this.bounds.projection!=this.getProjection()){var k=OpenLayers.IAAA_Utils.coordTransform(this.bounds.projection,this.getProjection(),this.bounds.left,this.bounds.top);var j=OpenLayers.IAAA_Utils.coordTransform(this.bounds.projection,this.getProjection(),this.bounds.right,this.bounds.bottom);this.bounds=new OpenLayers.Bounds(k[0],j[1],j[0],k[1]);this.bounds.projection=this.getProjection()}var d=this.bounds.clone();var g=Math.abs(d.right-d.left);var b=Math.abs(d.top-d.bottom);c=new OpenLayers.Bounds(d.left-10*g,d.bottom-10*b,d.right+10*g,d.top+10*b);this.utmMaxExtent=c.clone();this.utmMaxExtent.projection=this.getProjection()}else{c=this.utmMaxExtent.clone();if(this.utmMaxExtent.projection&&(this.utmMaxExtent.projection!=this.getProjection)){var k=OpenLayers.IAAA_Utils.coordTransform(this.utmMaxExtent.projection,this.getProjection(),this.utmMaxExtent.left,this.utmMaxExtent.top);var j=OpenLayers.IAAA_Utils.coordTransform(this.utmMaxExtent.projection,this.getProjection(),this.utmMaxExtent.right,this.utmMaxExtent.bottom);c=new OpenLayers.Bounds(k[0],j[1],j[0],k[1]);c.projection=this.getProjection()}}}else{if((this.baseLayer!=null)&&(this.baseLayer.maxExtent)&&(!this.changingSrs)){c=this.baseLayer.maxExtent}else{c=this.maxExtent}}return c},getToolBar:function(){for(var b in this.controls){if(this.controls[b].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar"){return this.controls[b]}}return null},setCheckedLayerForFeatureInfo:function(b,c){this.checkedLayerForFeatureInfo[c]=b},getCheckedLayerForFeatureInfo:function(b){return this.checkedLayerForFeatureInfo[b]},setCoordsCenter:function(d,c){var b=new OpenLayers.LonLat(d,c);this.setCenter(b)},zoomToCoordsExtent:function(g,f,d,c){var b=new OpenLayers.Bounds(g,f,d,c);OpenLayers.Map.prototype.zoomToExtent.apply(this,[b])},getPixelDistanceInMeters:function(f,d){var c=this.getLonLatFromPixel(f);var b=this.getLonLatFromPixel(d);if(c&&b){return this.getCoordDistanceInMeters(c,b)}else{return 0}},getCoordDistanceInMeters:function(f,c){var b=this.getProjection();var j;if((OpenLayers.IAAA_Utils.startsWith(b,"EPSG:230"))||(OpenLayers.IAAA_Utils.startsWith(b,"EPSG:258"))){j=Math.sqrt((c.lon-f.lon)*(c.lon-f.lon)+(c.lat-f.lat)*(c.lat-f.lat));return j}else{if(b!="EPSG:4326"){var g=OpenLayers.IAAA_Utils.coordTransform(b,"EPSG:4326",f.lon,f.lat);var d=OpenLayers.IAAA_Utils.coordTransform(b,"EPSG:4326",c.lon,c.lat);f=new OpenLayers.LonLat(g[0],g[1]);c=new OpenLayers.LonLat(d[0],d[1])}j=OpenLayers.Util.distVincenty({lon:f.lon,lat:f.lat},{lon:c.lon,lat:c.lat});return j*1000}},addMeasureLayer:function(b){b.div.style.overflow="";this.setLayerZIndex(b,this.layers.length);if(b.isFixed){this.viewPortDiv.appendChild(b.div)}else{this.layerContainerDiv.appendChild(b.div)}b.setMap(this);b.setVisibility(true);b.redraw();this.measureLayer=b},changeSrs:function(k,g,m){m=((m!=null)&&(m!=undefined))?m:true;var d=this.getProjection().toString();if(k==d){return}this.changingSrs=true;this.projection=k.toString();if(this.maxExtent){var l=OpenLayers.IAAA_Utils.isGeographicalProjection(d);if(l){if(this.maxExtent.left<=-180){this.maxExtent.left=-179.99}if(this.maxExtent.top>=90){this.maxExtent.top=89.99}if(this.maxExtent.right>=180){this.maxExtent.right=179.99}if(this.maxExtent.bottom<=-90){this.maxExtent.bottom=-89.99}}var j=OpenLayers.IAAA_Utils.coordTransform(d,k,this.maxExtent.left,this.maxExtent.top);var f=OpenLayers.IAAA_Utils.coordTransform(d,k,this.maxExtent.right,this.maxExtent.bottom);this.maxExtent=new OpenLayers.Bounds(j[0],f[1],f[0],j[1])}this.units=null;this.changeLayersSrs(k,d);for(var o=0,q=this.popups.length;o<q;o++){if(this.popups[o].lonlat){var c=OpenLayers.IAAA_Utils.coordTransform(d,k,this.popups[o].lonlat.lon,this.popups[o].lonlat.lat);this.popups[o].lonlat.lon=c[0];this.popups[o].lonlat.lat=c[1]}}var s=this.getExtent();if(s){punto=OpenLayers.IAAA_Utils.coordTransform(d,k,s.left,s.top);xMinA=punto[0];yMaxA=punto[1];punto=OpenLayers.IAAA_Utils.coordTransform(d,k,s.right,s.bottom);xMaxA=punto[0];yMinA=punto[1];punto=OpenLayers.IAAA_Utils.coordTransform(d,k,s.left,s.bottom);xMinB=punto[0];yMinB=punto[1];punto=OpenLayers.IAAA_Utils.coordTransform(d,k,s.right,s.top);xMaxB=punto[0];yMaxB=punto[1];xMin=((xMinA+xMinB)/2);yMin=((yMinA+yMinB)/2);xMax=((xMaxA+xMaxB)/2);yMax=((yMaxA+yMaxB)/2);var b=new OpenLayers.Bounds(xMin,yMin,xMax,yMax)}var u;var n;if(this.WMSCMaxExtent){u=this.WMSCMaxExtent;n=0}else{if(this.extentReference&&this.zoomReference&&this.SRSReference){var v=this.extentReference;var r=this.SRSReference;var j=OpenLayers.IAAA_Utils.coordTransform(r,k,v.left,v.top);var f=OpenLayers.IAAA_Utils.coordTransform(r,k,v.right,v.bottom);u=new OpenLayers.Bounds(j[0],f[1],f[0],j[1]);n=this.zoomReference}else{var p=false;var o=0;while((o<this.controls.length)&&(!p)){p=(this.controls[o].CLASS_NAME=="OpenLayers.Control.IAAA_ToolBar");o++}if(p){o--;var v=this.controls[o].getInitialExtent();var r=this.controls[o]._initialSrs;if(v&&r){var j=OpenLayers.IAAA_Utils.coordTransform(r,k,v.left,v.top);var f=OpenLayers.IAAA_Utils.coordTransform(r,k,v.right,v.bottom);u=new OpenLayers.Bounds(j[0],f[1],f[0],j[1]);n=this.controls[o].getInitialZoomLevel()}else{u=b;n=this.getZoom()}}else{u=b;n=this.getZoom()}}}if(g){this.resolutions=g.sort(function(B,A){return A-B})}else{if(u){this.initResolutionsFromParameters(u,n)}else{if(this.maxExtent){this.initResolutionsFromParameters(this.maxExtent,0)}}}if(b){this.zoomToExtentForNewSrs(b,true,null,m)}this.changingSrs=false},zoomToExtent:function(d,k){var f=null;if((d.CLASS_NAME=="OpenLayers.IAAA_Bounds")&&d.srs&&(d.srs!=this.getProjection())){var j=OpenLayers.IAAA_Utils.coordTransform(d.srs,this.getProjection(),d.left,d.top);var g=OpenLayers.IAAA_Utils.coordTransform(d.srs,this.getProjection(),d.right,d.bottom);f=new OpenLayers.Bounds(j[0],g[1],g[0],j[1])}else{f=d;if((f.srs==undefined)||(f.srs==null)){f.srs=this.getProjection()}}var c=f.getCenterLonLat();if(this.baseLayer&&this.baseLayer.wrapDateLine){var b=this.getMaxExtent();f=f.clone();while(f.right<f.left){f.right+=b.getWidth()}c=f.getCenterLonLat().wrapDateLine(b)}if(f&&f.left&&f.right&&f.top&&f.bottom&&!isNaN(f.left)&&!isNaN(f.right)&&!isNaN(f.top)&&!isNaN(f.bottom)){this.bounds=f;this.bounds.projection=this.getProjection()}this.setCenter(c,this.getZoomForExtent(f,true),null,k)},getExtent:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.getExtent()}if((b&&b.left&&b.right&&b.top&&b.bottom&&!isNaN(b.left)&&!isNaN(b.right)&&!isNaN(b.top)&&!isNaN(b.bottom))||!this.bounds){return b}return this.bounds},getCenter:function(){var b=this.center;if(!b){b=this.getCachedCenter()}if(!b&&this.bounds){b=this.bounds.getCenterLonLat()}if(b){b=b.clone()}return b},getResolution:function(){var b=null;if((this.baseLayer!=null)&&(this.baseLayer.resolutions)){b=this.baseLayer.getResolution()}else{if(this.allOverlays===true&&this.layers.length>0){b=this.layers[0].getResolution()}}if(!b&&this.bounds){b=this.resolutions[this.getZoom()]}return b},zoomToExtentForNewSrs:function(b,d,k,g){k=((k!=null)&&(k!=undefined)?k:null);g=((g!=null)&&(g!=undefined)?g:true);var c=b.getCenterLonLat();if(this.baseLayer&&this.baseLayer.wrapDateLine){var n=this.getMaxExtent();b=b.clone();while(b.right<b.left){b.right+=n.getWidth()}c=b.getCenterLonLat().wrapDateLine(n)}var l=this.getSize();var f=Math.max(b.getWidth()/l.w,b.getHeight()/l.h);var m;var p=Number.POSITIVE_INFINITY;for(var j=0;j<this.resolutions.length;j++){m=Math.abs(this.resolutions[j]-f);if(m>p){break}p=m}var o=Math.max(0,j-1);if(k!=null){this.setBaseLayer(k)}if(g){this.setCenter(c,o,null,d)}else{this.zoom=o;this.center=c}},getExtentForMapResolutions:function(){var g=null;var b=this.getCenter();var k=this.getZoom();var c=this.resolutions[Math.round(k)];if((b!=null)&&(c!=null)){var f=this.getSize();var j=f.w*c;var d=f.h*c;g=new OpenLayers.Bounds(b.lon-j/2,b.lat-d/2,b.lon+j/2,b.lat+d/2)}return g},changeLayersSrs:function(E,o){if(E==o){return}for(var B=0;B<this.getMapServerConnectionCount();B++){var u=this.getMapServerConnection(B);if(((u.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")&&(!u.getLoadFromTree()))||((u.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")&&(!u.getLoadFromTree()))||((u.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS")&&(!u.getLoadFromTree()))||((u.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")&&(!u.getLoadFromTree()))||(u.CLASS_NAME=="OpenLayers.Layer.IAAA_WFS")||(u.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")||(u.CLASS_NAME=="OpenLayers.Layer.IAAA_KML")||(u.CLASS_NAME=="OpenLayers.Layer.IAAA_Markers")){u.changeSrs(E)}else{if((u.CLASS_NAME=="OpenLayers.Layer.Vector")||(u.CLASS_NAME=="OpenLayers.Layer.Vector.RootContainer")||(u.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVector")||(u.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVectorWithTolerance")||(u.CLASS_NAME=="OpenLayers.Layer.IAAA_VectorGenericPopups")){if(!((this.selectedGeometryLayer!=null)&&(u.id==this.selectedGeometryLayer.id))){u.projection=((typeof E=="string")?new OpenLayers.Projection(E):E);if(u.features.length==0){continue}if(u.dontCloneFeaturesInSrsChange){try{u.eraseFeatures(u.features)}catch(F){OpenLayers.IAAA_Utils.report("error","[ERROR]: On map.changeLayersSrs:\n"+F)}for(var D=0;D<u.features.length;D++){if(u.features[D].geometry){var H=new OpenLayers.IAAA_SRSGeometry(u.features[D].geometry.clone(),o);H.transformSrs(E);u.features[D].geometry=H.geometry}}}else{var c=[];var I=[];for(var D=0;D<u.features.length;D++){if(u.features[D].geometry){var H=new OpenLayers.IAAA_SRSGeometry(u.features[D].geometry.clone(),o);H.transformSrs(E);c.push(H.geometry)}else{c.push(null)}var f=u.features[D].clone();f.id=u.features[D].id;I.push(f)}u.destroyFeatures();var J=[];for(var r in c){var l;if(u.additionalInfo){l=new OpenLayers.Feature.Vector();for(var v in I[r]){l[v]=I[r][v]}l.geometry=c[r]}else{l=new OpenLayers.Feature.Vector(c[r])}J.push(l)}u.addFeatures(J)}}}else{if(u.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS"){var c=[];for(var D in u.features){var m=new OpenLayers.Geometry.Point(u.features[D].marker.lonlat.lon,u.features[D].marker.lonlat.lat);var H=new OpenLayers.IAAA_SRSGeometry(m.clone(),o);H.transformSrs(E);u.features[D].marker.lonlat.lon=H.geometry.x;u.features[D].marker.lonlat.lat=H.geometry.y}}else{if(u.CLASS_NAME=="OpenLayers.Layer.Markers"){var c=[];for(var D in u.markers){var m=new OpenLayers.Geometry.Point(u.markers[D].lonlat.lon,u.markers[D].lonlat.lat);var H=new OpenLayers.IAAA_SRSGeometry(m.clone(),o);H.transformSrs(E);u.markers[D].lonlat.lon=H.geometry.x;u.markers[D].lonlat.lat=H.geometry.y}}else{if(u.CLASS_NAME=="OpenLayers.Layer.Image"){var s=OpenLayers.IAAA_Utils.isGeographicalProjection(E);if((!u.vectorLayer)||s){if(u.vectorLayer){u.setVisibility(u.vectorLayer.getVisibility());ancientSrsAux=u.projection}else{ancientSrsAux=o}var j=this.layers[B].extent;var q=new OpenLayers.IAAA_Bounds(j.left,j.bottom,j.right,j.top);q.setSrs(ancientSrsAux);q.transformSrs(this.getProjection());if(this.layers[B].getVisibility()){this.layers[B].setVisibility(false);this.layers[B].extent=new OpenLayers.Bounds(q.left,q.bottom,q.right,q.top);this.layers[B].setVisibility(true)}else{this.layers[B].extent=new OpenLayers.Bounds(q.left,q.bottom,q.right,q.top)}}else{var C=u.getVisibility();u.setVisibility(false);if(C){var n=u.vectorLayer;var b=true;for(var G in n.layerImages){b=(b&&(!n.layerImages[G].getVisibility()))}if(b){alert(messages.noKMLImageReprojection1+u.vectorLayer.name+messages.noKMLImageReprojection2+E+messages.noKMLImageReprojection3)}}}}}}}}}if(this.selectedGeometryList!=null){if(this.selectedGeometryLayer!=null){this.selectedGeometryLayer.destroyFeatures()}for(var B in this.selectedGeometryList){this.selectedGeometryList[B].transformSrs(this.getProjection());if(this.selectedGeometryLayer!=null){var A=new OpenLayers.Feature.Vector(this.selectedGeometryList[B].geometry);this.selectedGeometryLayer.addFeatures(A)}}if(this.selectedGeometryExtent!=null){this.selectedGeometryExtent.transformSrs(this.getProjection())}if((this.originalSelectedGeometry!=null)&&(this.selectedGeometryLayer!=null)){this.originalSelectedGeometry.transformSrs(this.getProjection());var k=new OpenLayers.Feature.Vector(this.originalSelectedGeometry.geometry,{},this.originalSelectedGeometry.style);this.selectedGeometryLayer.addFeatures(k)}}},initResolutionsFromParameters:function(f,c){if((c>=0)&&(c<this.getNumZoomLevels())){this.resolutions=this.getResolutionsFromParameters(f,c);var d;for(var b=0;b<this.layers.length;b++){d=((this.layers[b].ignoreWMSCChanges!=null)&&(this.layers[b].ignoreWMSCChanges!=undefined)&&(this.layers[b].ignoreWMSCChanges));if((!d)&&(!this.layers[b].isWMSC)&&(!this.layers[b].isWMTS)&&((this.layers[b].CLASS_NAME!="OpenLayers.Layer.Google")&&(this.layers[b].CLASS_NAME!="OpenLayers.Layer.IAAA_Google"))){this.layers[b].resolutions=this.resolutions}}}},getResolutionsFromParameters:function(f,b){if((b>=0)&&(b<this.getNumZoomLevels())){var d=new Array();d[b]=Math.max(f.getWidth()/this.getSize().w,f.getHeight()/this.getSize().h);for(var c=b+1;c<this.getNumZoomLevels();c++){d[c]=d[c-1]/2}for(var c=b-1;c>=0;c--){d[c]=d[c+1]*2}return d.sort(function(j,g){return g-j})}else{return null}},getResolutionsForSrs:function(b){if(this.getProjection()==b){return this.resolutions}else{var g;var d=this.getExtent();if(d!=null){var j=OpenLayers.IAAA_Utils.coordTransform(this.getProjection(),b,d.left,d.top);var f=OpenLayers.IAAA_Utils.coordTransform(this.getProjection(),b,d.right,d.bottom);var c=new OpenLayers.Bounds(j[0],f[1],f[0],j[1]);g=this.getResolutionsFromParameters(c,this.getZoom())}return g}},clearMapServerConnection:function(){for(var b=0;b<this.layers.length;b++){this.removeLayer(this.layers[b])}},setMaxExtent:function(c){this.maxExtent=c;for(var b=0;b<this.layers.length;b++){this.layers[b].maxExtent=c}},getProjection:function(){return this.projection},getProjectionObject:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.projection}if((typeof b).toLowerCase()=="string"){b=new OpenLayers.Projection(b)}return b},isValidLonLat:function(b){if(this.ignoreMaxExtent){return((b!=undefined)&&(b!=null))}else{return OpenLayers.Map.prototype.isValidLonLat.apply(this,[b])}},getSelectedGeometryList:function(){return this.selectedGeometryList},setSelectedGeometryList:function(b){this.selectedGeometryList=b},setFullExtentValue:function(b){this.fullExtent=b},zoomToFullExtent:function(){if(this.fullExtent){this.zoomToExtent(this.fullExtent);for(var b in this.layers){if((this.layers[b].CLASS_NAME=="OpenLayers.Layer.WMS")||(this.layers[b].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")){this.layers[b].redraw()}}}},getPointer:function(){return this.viewPortDiv.style.cursor},setPointer:function(b){this.viewPortDiv.style.cursor=b},getActualScale:function(){var b=this.getExtent();if(!b){return -1}return this.getActualScaleFromExtent(b)},getActualScaleFromExtent:function(g){var f=new OpenLayers.LonLat(g.top,g.left);var l=new OpenLayers.LonLat(g.top,g.right);var b=this.getCoordDistanceInMeters(f,l,this.getProjection())/this.getSize().w;var j=b*100;var d=32;try{var c=d/screen.availWidth}catch(k){var c=d/1024}scale=j/c;return scale},getActualScaleFromResolution:function(b){var c=this.calculateBounds(this.getCenter(),b);return this.getActualScaleFromExtent(c)},setActualScale:function(n){var l=32;try{var d=l/screen.availWidth}catch(o){var d=l/1024}var c=n*d;var j=c/100;if((this.getProjection()=="EPSG:4326")||(this.getProjection()=="EPSG:4230")||(this.getProjection()=="EPSG:4258")){constantValue=111194.874284}else{constantValue=1}var b=this.getCenter();var k=this.getSize().w;var m=this.getSize().h;var s=(k*j)/constantValue;var p=(m*j)/constantValue;var r=b.lon-(s/2);var g=b.lat-(p/2);var f=b.lon+(s/2);var q=b.lat+(p/2);this.zoomToExtent(new OpenLayers.Bounds(r,g,f,q))},getNumZoomLevels:function(){var b=null;if(this.baseLayer!=null){b=this.baseLayer.numZoomLevels}else{b=this.numZoomLevels}return b},getZoomForExtent:function(f,d){var c=null;if(this.baseLayer!=null){c=this.baseLayer.getZoomForExtent(f,d)}else{var g=this.getSize();var b=Math.max(f.getWidth()/g.w,f.getHeight()/g.h);c=this.getZoomForResolution(b,d)}return c},getZoomForResolution:function(g,c){var r=null;if(this.baseLayer!=null){r=this.baseLayer.getZoomForResolution(g,c)}else{if((this.resolutions==null)||isNaN(this.resolutions[0])){if(this.maxResolution){var p=this.getNumZoomLevels();this.resolutions=[];this.resolutions[0]=this.maxResolution;for(var j=1;j<this.getNumZoomLevels();j++){this.resolutions[j]=this.resolutions[j-1]/2}}else{if(this.maxExtent){this.initResolutionsFromParameters(this.maxExtent,0)}}}if(this.fractionalZoom){var n=0;var d=this.resolutions.length-1;var f=this.resolutions[n];var b=this.resolutions[d];var m;for(var j=0,k=this.resolutions.length;j<k;++j){m=this.resolutions[j];if(m>=g){f=m;n=j}if(m<=g){b=m;d=j;break}}var l=f-b;if(l>0){r=n+((g-b)/l)}else{r=n}}else{var o;var q=Number.POSITIVE_INFINITY;for(var j=0,k=this.resolutions.length;j<k;j++){if(c){o=Math.abs(this.resolutions[j]-g);if(o>q){break}q=o}else{if(this.resolutions[j]<g){break}}}r=Math.max(0,j-1)}}return r},addControl:function(c,b){OpenLayers.Map.prototype.addControl.apply(this,[c,b]);onActivateControl=function(){if(this.map){this.map.events.triggerEvent("controlactivate",{control:this})}};onDeactivateControl=function(){if(this.map){this.map.events.triggerEvent("controldeactivate",{control:this})}};c.events.register("activate",c,onActivateControl);c.events.register("deactivate",c,onDeactivateControl);if((c.CLASS_NAME.indexOf("ViewSelector")!=-1)&&(c.positionReference=="right")){c.resizeMapHandler()}},getViewControlActive:function(){if(this.viewControls&&this.viewControls.length>0){for(var b=0;b<this.viewControls.length;b++){if(this.viewControls[b].active){return this.viewControls[b]}}}return null},addPopup:function(b,j,d){if((d!=undefined)&&(d!=null)){if(navigator.appName=="Microsoft Internet Explorer"){if(j){for(var f=this.popups.length-1;f>=0;--f){this.removePopup(this.popups[f])}}b.map=this;this.popups.push(b);b.externDiv=true;var g=b.draw();b.basePositionLeft=parseInt(b.div.style.left);b.basePositionTop=parseInt(b.div.style.top);if(g){g.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;if((d.addToDiv!=null)&&(d.addToDiv!=undefined)){d.addToDiv.appendChild(g);g.style.left=parseInt(g.style.left)-parseInt(d.addToDiv.style.left)+"px";g.style.top=parseInt(g.style.top)-parseInt(d.addToDiv.style.top)+"px"}else{this.layerContainerDiv.appendChild(g)}}if(d.addToDiv&&(b.updateDivPosition!=undefined)&&(b.updateDivPosition!=null)){b.map.events.register("moveend",b,b.updateDivPosition);b.map.events.register("resizeend",b,b.updateDivPosition)}}else{var c=new Array();c.push(b,j);OpenLayers.Map.prototype.addPopup.apply(this,c)}if((d.updateZIndex!=undefined)&&(d.updateZIndex!=null)&&d.updateZIndex){if((b.updatePopupZIndexes!=undefined)&&(b.updatePopupZIndexes!=null)){b.updatePopupZIndexes()}}}else{var c=new Array();c.push(b,j);OpenLayers.Map.prototype.addPopup.apply(this,c)}},removePopup:function(c){if((c.externDiv!=undefined)&&(c.externDiv!=null)&&c.externDiv){if((c.updateDivPosition!=undefined)&&(c.updateDivPosition!=null)){if(c.map&&c.map.events){c.map.events.unregister("moveend",c,c.updateDivPosition);c.map.events.unregister("resizeend",c,c.updateDivPosition)}}OpenLayers.Util.removeItem(this.popups,c);if(c.div){var b=c.div.parentNode;try{b.removeChild(c.div)}catch(d){}}c.map=null}else{OpenLayers.Map.prototype.removePopup.apply(this,arguments)}},setHandlerClickDisabled:function(b){this.handlerClickDisabled=b},isHandlerClickDisabled:function(){if((this.handlerClickDisabled==null)||(this.handlerClickDisabled==undefined)){return false}else{return this.handlerClickDisabled}},getLayerMaxZIndex:function(){var f=0,b;for(var d=0,c=this.layers.length;d<c;d++){b=this.layers[d].getZIndex()||0;if(f<parseInt(b)){f=parseInt(b)}}return f},resetLayerContainerPosition:function(){this.layerContainerOrigin=null},CLASS_NAME:"OpenLayers.Map.IAAA_Map"});OpenLayers.Control.IAAA_LoadingMap=OpenLayers.Class(OpenLayers.Control,{imgUrl:null,layersLoaded:new Array(),loadingMessage:null,timeOutRef:null,loadingDiv:null,verticalOffset:25,horizontalOffset:60,messageColor:null,wmsClientFontFamily:null,standardFontSize:null,showLoadingMessage:true,showLoadingBackGroundColor:true,loadingBackGroundColor:"#FFFFFF",loadingBackGroundWidth:"141px",loadingBackGroundHeight:"auto",loadingImg:null,loadingImgHeight:null,loadingImgWidth:null,uniqueId:null,errorMessage:null,waitingTime:40000,timeOutBehavior:true,waitingSeq:new Array(),showLoadingDivOnVisibilityChange:false,hideLayerIfTimeout:true,initialize:function(b){this.messageColor="#003399";OpenLayers.Control.prototype.initialize.apply(this,[b]);this.active=true;this.uniqueId=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");if((b.showLoadingDivOnVisibilityChange!=null)&&(b.showLoadingDivOnVisibilityChange!=undefined)){this.showLoadingDivOnVisibilityChange=b.showLoadingDivOnVisibilityChange}else{this.showLoadingDivOnVisibilityChange=false}},setMap:function(d){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.generateLoadingDiv();for(var b in this.map.layers){var c={layer:this.map.layers[b]};this.generateLoadingVector(c)}this.map.events.register("addlayer",this,this.generateLoadingVector);this.map.events.register("removelayer",this,this.removeLayerHandler);this.map.events.register("resizeend",this,this.readjustLoadingDiv)},changeImg:function(b){this.imgUrl=b;this.generateLoadingDiv()},generateLoadingDiv:function(){var c=(this.loadingMessage!=null)?this.loadingMessage:messages.loadingMap;var b="#FF2300";var d="#D4D0C8";this.loadingDiv=OpenLayers.Util.createDiv("loading_div_"+this.uniqueId,null,null,null,"relative",null,"hidden");this.map.div.appendChild(this.loadingDiv);this.loadingDiv.style["background-color"]="#FFFFFF";this.loadingDiv.style.display="none";this.loadingDiv.style.position="absolute";var k=0;var j=0;var g=this.loadingDiv;while(g.parentNode&&g.parentNode.offsetLeft&&g.parentNode.offsetTop){k+=g.parentNode.offsetLeft;j+=g.parentNode.offsetTop;g=g.parentNode}try{this.loadingDiv.style.left=k+((this.map.getSize().w/2)-this.horizontalOffset)+"px";this.loadingDiv.style.top=j+((this.map.getSize().h/2)-this.verticalOffset)+"px"}catch(f){this.loadingDiv.style.left=(k-this.horizontalOffset)+"px";this.loadingDiv.style.top=(j-this.verticalOffset)+"px"}this.loadingDiv.style.width=((this.loadingBackgroundWidth!=null)&&(this.loadingBackgroundWidth!=undefined))?this.loadingBackgroundWidth:"141px";this.loadingDiv.style.height=((this.loadingBackgroundHeight!=null)&&(this.loadingBackgroundHeight!=undefined))?this.loadingBackgroundHeight:"auto";if(this.showLoadingBackGroundColor){this.loadingDiv.style.border="1px solid "+d}if(this.map.eventsDiv&&this.map.eventsDiv.style&&this.map.eventsDiv.style.zIndex){this.loadingDiv.style.zIndex=parseInt(this.map.eventsDiv.style.zIndex)+1}else{this.loadingDiv.style.zIndex=2300}if(this.loadingImgHeight==null){this.loadingImgHeight=13}if(this.loadingImgWidth==null){this.loadingImgWidth=101}if(this.showLoadingMessage){this.loadingDiv.innerHTML='<table id ="'+this.loadingDiv.id+'_table" width="100%" height="100%"'+((this.showLoadingBackGroundColor)?'style="background-color:'+this.loadingBackGroundColor+';"':"")+'><tr id ="'+this.loadingDiv.id+'_tableUpperTR" valign="middle" align="center"><td id ="'+this.loadingDiv.id+'_tableUpperTD" >&nbsp;<font style="font-family:'+this.wmsClientFontFamily+";font-size:"+this.standardFontSize+";color:"+this.messageColor+';">'+c+'</font></td></tr><tr id ="'+this.loadingDiv.id+'_tableMiddleTR" valign="middle" align="center"><td id ="'+this.loadingDiv.id+'_tableMiddleTD" ><img id ="'+this.loadingDiv.id+'_img"  width="'+this.loadingImgWidth+'" height="'+this.loadingImgHeight+'" src="'+this.loadingImg+'"></td></tr><tr id ="'+this.loadingDiv.id+'_tableLowerTR"  style="height: 4px;"></tr></table>'}else{this.loadingDiv.innerHTML='<table id ="'+this.loadingDiv.id+'_table" width="100%" height="100%"'+((this.showLoadingBackGroundColor)?'style="background-color:'+this.loadingBackGroundColor+';"':"")+'><tr id ="'+this.loadingDiv.id+'_tableTR" valign="middle" align="center"><td id ="'+this.loadingDiv.id+'_tableTD" valign="middle"><img id ="'+this.loadingDiv.id+'_img" width="'+this.loadingImgWidth+'" height="'+this.loadingImgHeight+'" src="'+this.loadingImg+'"></td></tr></table>'}this.loadingDiv.refControl=this},generateLoadingVector:function(c){if((c)&&(c.layer)){var b=c.layer;if(((b.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerLMS"))&&(b.showLoadingIcon)&&(!this.layersLoaded["IAAA_Server_"+b.name+"_"+b.url])){b.events.register("tileloaded",this,this.layerLoadedHandler);b.events.register("tileunload",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){this.layerLoadedHandler(d)}else{if(this.showLoadingDivOnVisibilityChange){this.layerLoadingHandler(d)}}});b.events.register("urlchanged",this,this.changeUrlWMS);b.events.register("titlechanged",this,this.changeTitleWMS);if((this.numLoadingTiles==0)||(!b.getVisibility())){this.layersLoaded["IAAA_Server_"+b.name+"_"+b.url]=true}else{this.layersLoaded["IAAA_Server_"+b.name+"_"+b.url]=false;this.showLoadingDiv(b)}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS")&&(b.showLoadingIcon)&&(!this.layersLoaded["IAAA_ServerWFS_"+b.name+"_"+b.url])){b.events.register("tileloaded",this,this.layerLoadedHandler);b.events.register("tileunload",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){this.layerLoadedHandler(d)}});b.events.register("urlchanged",this,this.changeUrlWMS);b.events.register("titlechanged",this,this.changeTitleWMS);if((this.numLoadingTiles==0)||(!b.getVisibility())){this.layersLoaded["IAAA_ServerWFS_"+b.name+"_"+b.url]=true}else{this.layersLoaded["IAAA_ServerWFS_"+b.name+"_"+b.url]=false;this.showLoadingDiv(b)}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")&&(b.showLoadingIcon)&&(!this.layersLoaded["IAAA_ServerWMTS_"+b.name+"_"+b.url])){b.events.register("tileloaded",this,this.layerLoadedHandler);b.events.register("tileunload",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){this.layerLoadedHandler(d)}});b.events.register("urlchanged",this,this.changeUrlWMS);b.events.register("titlechanged",this,this.changeTitleWMS);if((this.numLoadingTiles==0)||(!b.getVisibility())){this.layersLoaded["IAAA_ServerWMTS_"+b.name+"_"+b.url]=true}else{this.layersLoaded["IAAA_ServerWMTS_"+b.name+"_"+b.url]=false;this.showLoadingDiv(b)}}else{if(((b.CLASS_NAME=="OpenLayers.Layer.WMS")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_LMS"))&&(b.showLoadingIcon)&&(!this.layersLoaded["IAAA_WMS_"+b.name+"_"+b.url])){b.events.register("loadend",this,this.layerLoadedHandler);b.events.register("loadcancel",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){if(d.object.useRequestSequencing){d.seq=-1}this.layerLoadedHandler(d)}else{if(this.showLoadingDivOnVisibilityChange){this.layerLoadingHandler(d)}}});if(b.useRequestSequencing){this.waitingSeq["IAAA_WMS_"+b.name+"_"+b.url]=null}if((this.numLoadingTiles==0)||(!b.getVisibility())){this.layersLoaded["IAAA_WMS_"+b.name+"_"+b.url]=true}else{this.layersLoaded["IAAA_WMS_"+b.name+"_"+b.url]=false;this.showLoadingDiv(b)}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")&&(b.showLoadingIcon)&&(!this.layersLoaded["IAAA_GML_"+b.location+"_"+b.name])){b.events.register("loadend",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){this.layerLoadedHandler(d)}});if(b.loaded){this.layersLoaded["IAAA_GML_"+b.name+"_"+b.url]=true}else{this.layersLoaded["IAAA_GML_"+b.name+"_"+b.url]=false;if(this.timeOutBehavior){window.clearTimeout(this.timeOutRef);if(this.errorMessage){this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}else{this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'");',this.waitingTime)}}this.showLoadingDiv(b)}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVector")&&(b.showLoadingIcon)&&(!this.layersLoaded["IAAA_GenericVector_"+b.name])){b.events.register("loadend",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){this.layerLoadedHandler(d)}});if(b.loaded){this.layersLoaded["IAAA_GenericVector_"+b.name]=true}else{if((b.showLoadingOnDrawOnce==null)||(b.showLoadingOnDrawOnce==undefined)||(b.showLoadingOnDrawOnce==false)){this.layersLoaded["IAAA_GenericVector_"+b.name]=false;if(this.timeOutBehavior){window.clearTimeout(this.timeOutRef);if(this.errorMessage){this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}else{this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'");',this.waitingTime)}}this.showLoadingDiv(b)}else{this.layersLoaded["IAAA_GenericVector_"+b.name]=true}}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVectorWithTolerance")&&(b.showLoadingIcon)&&(!this.layersLoaded["IAAA_GenericVectorWithTolerance_"+b.name])){b.events.register("loadend",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){this.layerLoadedHandler(d)}});if(b.loaded){this.layersLoaded["IAAA_GenericVectorWithTolerance_"+b.name]=true}else{this.layersLoaded["IAAA_GenericVectorWithTolerance_"+b.name]=false;if(this.timeOutBehavior){window.clearTimeout(this.timeOutRef);if(this.errorMessage){this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}else{this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'");',this.waitingTime)}}this.showLoadingDiv(b)}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")&&(b.showLoadingIcon)&&(!this.layersLoaded["SaveImageWMS_"+b.name+"_"+b.url])){this.layersLoaded["SaveImageWMS_"+b.name+"_"+b.url]=true;b.events.register("loadend",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){this.layerLoadedHandler(d)}})}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")&&(b.showLoadingIcon)&&(!this.layersLoaded["IAAA_GeoRSS_"+b.id])){this.layersLoaded["IAAA_GeoRSS_"+b.id]=true;b.events.register("loadend",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){this.layerLoadedHandler(d)}})}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers")&&(b.showLoadingIcon)&&(!this.layersLoaded["TooltipMarkersLayer_"+b.serviceUrl+"_"+b.name])){this.layersLoaded["TooltipMarkersLayer_"+b.serviceUrl+"_"+b.name]=true;b.events.register("loadend",this,this.layerLoadedHandler);b.events.register("loadstart",this,this.layerLoadingHandler);b.events.register("visibilitychanged",this,function(d){if(!d.object.getVisibility()){this.layerLoadedHandler(d)}})}}}}}}}}}}}},removeLayerHandler:function(c){if(c&&c.layer){var b=c.layer;if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerLMS")){this.layersLoaded["IAAA_Server_"+b.name+"_"+b.url]=undefined}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS"){this.layersLoaded["IAAA_ServerWFS_"+b.name+"_"+b.url]=undefined}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS"){this.layersLoaded["IAAA_ServerWMTS_"+b.name+"_"+b.url]=undefined}else{if((b.CLASS_NAME=="OpenLayers.Layer.WMS")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_LMS")){this.layersLoaded["IAAA_WMS_"+b.name+"_"+b.url]=undefined}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_GML"){this.layersLoaded["IAAA_GML_"+b.name+"_"+b.url]=undefined}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVector"){this.layersLoaded["IAAA_GenericVector_"+b.name]=undefined}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVectorWithTolerance"){this.layersLoaded["IAAA_GenericVectorWithTolerance_"+b.name]=undefined}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"){this.layersLoaded["SaveImageWMS_"+b.name+"_"+b.url]=undefined}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS"){this.layersLoaded["IAAA_GeoRSS_"+b.id]=undefined}else{if(b.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers"){this.layersLoaded["TooltipMarkersLayer_"+b.serviceUrl+"_"+b.name]=undefined}}}}}}}}}}}},showLoadingDiv:function(b){if(this.active){this.loadingDiv.style.display="block"}if(this.uniqueId&&this.timeOutBehavior){var c=this.uniqueId;window.clearTimeout(this.timeOutRef);if(this.errorMessage){this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}else{this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'");',this.waitingTime)}}},hideLoadingDiv:function(){this.loadingDiv.style.display="none";window.clearTimeout(this.timeOutRef)},allLayersLoaded:function(){for(var b in this.layersLoaded){if(this.layersLoaded[b]==false){return false}}return true},layerLoadingHandler:function(c){var b=c.object;if(((b.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerLMS"))&&(b.showLoadingIcon)&&(b.getVisibility())){this.layersLoaded["IAAA_Server_"+b.name+"_"+b.url]=false}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS")&&(b.showLoadingIcon)&&(b.getVisibility())){this.layersLoaded["IAAA_ServerWFS_"+b.name+"_"+b.url]=false}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")&&(b.showLoadingIcon)&&(b.getVisibility())){this.layersLoaded["IAAA_ServerWMTS_"+b.name+"_"+b.url]=false}else{if(((b.CLASS_NAME=="OpenLayers.Layer.WMS")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_LMS"))&&(b.showLoadingIcon)&&(b.getVisibility())){this.layersLoaded["IAAA_WMS_"+b.name+"_"+b.url]=false;if(b.useRequestSequencing){if((c.seq!=undefined)&&(c.seq!=null)){this.waitingSeq["IAAA_WMS_"+b.name+"_"+b.url]=c.seq}else{this.waitingSeq["IAAA_WMS_"+b.name+"_"+b.url]=-1}}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")&&(b.showLoadingIcon)&&(b.getVisibility())){this.layersLoaded["IAAA_GML_"+b.name+"_"+b.url]=false;if(this.uniqueId&&this.timeOutBehavior){window.clearTimeout(this.timeOutRef);if(this.errorMessage){this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}else{this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'");',this.waitingTime)}}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVector")&&(b.showLoadingIcon)&&(b.getVisibility()||(!b.getVisibility()&&((b.forceShowLoadingDiv!=null)&&(b.forceShowLoadingDiv!=undefined)&&(b.forceShowLoadingDiv))))){this.layersLoaded["IAAA_GenericVector_"+b.name]=false;if(this.uniqueId&&this.timeOutBehavior){window.clearTimeout(this.timeOutRef);if(this.errorMessage){this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}else{this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'");',this.waitingTime)}}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVectorWithTolerance")&&(b.showLoadingIcon)&&(b.getVisibility())){this.layersLoaded["IAAA_GenericVectorWithTolerance_"+b.name]=false;if(this.uniqueId&&this.timeOutBehavior){window.clearTimeout(this.timeOutRef);if(this.errorMessage){this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'", "'+this.errorMessage+'");',this.waitingTime)}else{this.timeOutRef=window.setTimeout('OpenLayers.Control.IAAA_LoadingMap.timeOut("'+this.uniqueId+'");',this.waitingTime)}}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")&&(b.showLoadingIcon)){this.layersLoaded["SaveImageWMS_"+b.name+"_"+b.url]=false}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")&&(b.showLoadingIcon)){this.layersLoaded["IAAA_GeoRSS_"+b.id]=false}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers")&&(b.showLoadingIcon)){this.layersLoaded["TooltipMarkersLayer_"+b.serviceUrl+"_"+b.name]=false}else{return}}}}}}}}}}this.showLoadingDiv(b)},layerLoadedHandler:function(c){var b=c.object;if(((b.CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerLMS"))&&(b.showLoadingIcon)){this.layersLoaded["IAAA_Server_"+b.name+"_"+b.url]=true}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS")&&(b.showLoadingIcon)){this.layersLoaded["IAAA_ServerWFS_"+b.name+"_"+b.url]=true}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")&&(b.showLoadingIcon)){this.layersLoaded["IAAA_ServerWMTS_"+b.name+"_"+b.url]=true}else{if(((b.CLASS_NAME=="OpenLayers.Layer.WMS")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(b.CLASS_NAME=="OpenLayers.Layer.IAAA_LMS"))&&(b.showLoadingIcon)){if((b.useRequestSequencing&&((this.waitingSeq["IAAA_WMS_"+b.name+"_"+b.url]==c.seq)||(c.seq==-1)||(this.waitingSeq["IAAA_WMS_"+b.name+"_"+b.url]==-1)))||(!b.useRequestSequencing)){this.layersLoaded["IAAA_WMS_"+b.name+"_"+b.url]=true}}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GML")&&(b.showLoadingIcon)){this.layersLoaded["IAAA_GML_"+b.location+"_"+b.name]=true}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVector")&&(b.showLoadingIcon)){this.layersLoaded["IAAA_GenericVector_"+b.name]=true}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GenericVectorWithTolerance")&&(b.showLoadingIcon)){this.layersLoaded["IAAA_GenericVectorWithTolerance_"+b.name]=true}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS")&&(b.showLoadingIcon)){this.layersLoaded["SaveImageWMS_"+b.name+"_"+b.url]=true}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_TooltipMarkers")&&(b.showLoadingIcon)){this.layersLoaded["TooltipMarkersLayer_"+b.serviceUrl+"_"+b.name]=true}else{if((b.CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")&&(b.showLoadingIcon)){this.layersLoaded["IAAA_GeoRSS_"+b.id]=true}}}}}}}}}}if(this.allLayersLoaded()){this.hideLoadingDiv()}},changeUrlWMS:function(c){var b=this.layersLoaded["IAAA_Server_"+c.layer.name+"_"+c.ancientUrl];this.layersLoaded["IAAA_Server_"+c.layer.name+"_"+c.ancientUrl]=true;this.layersLoaded["IAAA_Server_"+c.layer.name+"_"+c.layer.url]=b},changeTitleWMS:function(c){var b=this.layersLoaded["IAAA_Server_"+c.ancientTitle+"_"+c.layer.url];this.layersLoaded["IAAA_Server_"+c.ancientTitle+"_"+c.layer.url]=true;this.layersLoaded["IAAA_Server_"+c.layer.name+"_"+c.layer.url]=b},readjustLoadingDiv:function(){this.loadingDiv.style.left=((this.map.getSize().w/2)-this.horizontalOffset)+"px";this.loadingDiv.style.top=((this.map.getSize().h/2)-this.verticalOffset)+"px"},deactivate:function(){this.loadingDiv.style.display="none";OpenLayers.Control.prototype.deactivate.apply(this,arguments);this.active=false},CLASS_NAME:"OpenLayers.Control.IAAA_LoadingMap"});OpenLayers.Control.IAAA_LoadingMap.timeOut=function(f,o){document.getElementById("loading_div_"+f).style.display="none";window.clearTimeout(f);var s="";if(o&&document.getElementById("loading_div_"+f).refControl){var k=document.getElementById("loading_div_"+f).refControl.layersLoaded;if(k){for(var n in k){var g=n.split("_");var d="";if(g[0]=="IAAA"){d=g[2]}else{d=g[1]}if(k[n]==false){s+="\n"+d;document.getElementById("loading_div_"+f).refControl.layersLoaded[n]=true}}}}if(this.hideLayerIfTimeout){var m=document.getElementById("loading_div_"+f).refControl.map.layers;for(var l in m){if(((m[l].CLASS_NAME=="OpenLayers.Layer.Grid")||(m[l].CLASS_NAME=="OpenLayers.Layer.WMS")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_WMS")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_LMS")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerLMS")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_GeoRSS")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_IconsWMS"))&&(m[l].numLoadingTiles>0)){if((m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_Server")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerLMS")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerSLD")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWFS")||(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_ServerWMTS")){m[l].setVisibilityToAllLayers(false);try{if(getTree&&getTree()){getTree().updateCheckBoxesVisibility();if(m[l].treeLoadImg!=null){m[l].treeLoadImg.style.visibility="hidden";m[l].treeLoadImg.style.display="inline"}}if(m[l].useWCTS){if(m[l].CLASS_NAME=="OpenLayers.Layer.IAAA_Server"){for(var b in m[l].grid){for(var q in m[l].grid[b]){m[l].grid[b][q].changeWCTSLoadingDivStatus(false)}}}else{m[l].tile.changeWCTSLoadingDivStatus(false);m[l].tile.events.triggerEvent("loadend")}}}catch(p){}m[l].stopTileLoading()}else{m[l].setVisibility(false)}}}}if(o&&s!=""){alert(o+s)}};OpenLayers.Control.IAAA_GoogleDirectionsAPIRouter=OpenLayers.Class(OpenLayers.Control,{serviceURL:null,serviceSRS:"EPSG:4326",servletURL:null,routesLayer:null,showLoadingControl:null,defaultRouteOptions:{mode:"transit",transit_modes:["tram","bus","rural_bus"],transit_routing_preference:""},defaultRouteDisplayOptions:{drawOrigin:true,drawDestination:false},transportPostTimesServiceURLs:{tram:null,bus:null,rural_bus:null},routeStyle:null,routeStyleImgDir:"",currentRouteOptions:{},routeLoadedCallback:function(b){},routeErrorCallback:function(){},initialize:function(c,b){this.serviceURL=c;if(b&&b.routeStyleImgDir){this.routeStyleImgDir=b.routeStyleImgDir}this.routeStyle=this.generateRouteDefaultStyle();OpenLayers.Control.prototype.initialize.apply(this,[b])},requestDirections:function(n,o,k){this.currentRouteOptions={};OpenLayers.Util.extend(this.currentRouteOptions,this.defaultRouteOptions);OpenLayers.Util.extend(this.currentRouteOptions,this.defaultRouteDisplayOptions);OpenLayers.Util.extend(this.currentRouteOptions,k);var g=this.buildRequest(n,o,this.currentRouteOptions);this.showLoading();var b;var d={};if(this.servletURL!=null){b=this.servletURL;var c=g.split("?");d.urlFile=c[0];var p=c[1].split("&");for(var j=0,l=p.length;j<l;j++){var f=p[j].split("=");d[f[0]]=f[1]}d.outputType=1}else{b=g}var m=new OpenLayers.IAAA_Request(null,b,"GET");m.setRequestParams(d);m.events.register("loaddata",this,this.onRouteLoad);m.events.register("faildata",this,this.onRouteLoadError);m.doRequest()},buildRequest:function(f,d,b){var c=this.serviceURL+"?";c+="origin="+f.lat+","+f.lon;c+="&destination="+d.lat+","+d.lon;if((b.mode!=null)&&(b.mode!="")){c+="&mode="+b.mode}if((b.transit_modes!=null)&&(b.transit_modes.length>0)){c+="&transit_mode="+b.transit_modes.join("|")}if((b.transit_routing_preference!=null)&&(b.transit_routing_preference!="")){c+="&transit_routing_preference="+b.transit_routing_preference}return c},onRouteLoad:function(evt){var routeJSON;try{routeJSON=eval("("+evt.object.getResponse()+")")}catch(e){this.onRouteLoadError({error:"JSON de rutas mal formado"});return}this.hideLoading();var routeFeatures=this.parseRoute(routeJSON);if(routeFeatures.length==0){this.onRouteLoadError(({error:"No hay ruta disponible"}));return}if(this.routesLayer==null){this.routesLayer=this.createVectorialLayer()}this.routesLayer.addFeatures(routeFeatures);this.routesLayer.setVisibility(true);var routeExtent=null;for(var i=0,len=routeFeatures.length;i<len;i++){var featureBounds=routeFeatures[i].geometry.getBounds();if(routeExtent==null){routeExtent=featureBounds}else{routeExtent.extend(featureBounds)}}if(routeExtent!=null){this.map.zoomToExtent(routeExtent);this.map.zoomTo(this.map.getZoom()-1)}this.routeLoadedCallback(routeJSON)},onRouteLoadError:function(b){if(console&&console.log){console.log("Error cargando ruta: "+b.error)}this.hideLoading();this.routeErrorCallback()},parseRoute:function(V){var E=[];var p=[];if(V.status=="NOT_FOUND"){return[]}var C=V.routes[0].legs[0];var ac=C.steps;var o={duration:C.duration.text,distance:C.distance.text};var I=false;for(var Z=0,u=ac.length;Z<u;Z++){var m=ac[Z];var d=m.travel_mode.toLowerCase();if(d=="walking"){var M="walking";for(var Y=0,k=m.steps.length;Y<k;Y++){var T=m.steps[Y];var G=this.parseEncodedPolyline(T.polyline.points);G.style=this.routeStyle.step[M];G.attributes={routeElement:true,routeDetails:{directions:T.html_instructions,distance:T.distance.text,duration:T.duration.text,transitMode:M},clusterize:false,externalGraphic:this.routeStyle[M].externalGraphic,originalGraphicWidth:this.routeStyle[M].graphicWidth,originalGraphicHeight:this.routeStyle[M].graphicHeight};if((Z==(ac.length-1))&&(Y==(m.steps.length-1))){G.attributes.routeDetails.routeSummary=o}E.push(G)}I=false}else{if(d=="transit"){var M=m.transit_details.line.vehicle.type.toLowerCase();var G=this.parseEncodedPolyline(m.polyline.points);G.style=this.routeStyle.step[M];G.attributes={routeElement:true,routeDetails:{lineName:m.transit_details.line.name,lineNumber:m.transit_details.line.short_name,lineHeadsign:m.transit_details.headsign,distance:m.distance.text,duration:m.duration.text,transitMode:M},clusterize:false,externalGraphic:this.routeStyle.stop[M].externalGraphic,originalGraphicWidth:this.routeStyle.stop[M].graphicWidth,originalGraphicHeight:this.routeStyle.stop[M].graphicHeight};E.push(G);var g=coordTransform(this.serviceSRS,this.map.getProjection(),m.transit_details.departure_stop.location.lng,m.transit_details.departure_stop.location.lat);var b=new OpenLayers.Geometry.Point(g[0],g[1]);var F;if(I){F=this.routeStyle.transfer_stop[M]}else{F=this.routeStyle.departure_stop[M]}var N={routeElement:true,routeDetails:{lineName:m.transit_details.line.name,lineNumber:m.transit_details.line.short_name,lineHeadsign:m.transit_details.headsign,stopName:m.transit_details.departure_stop.name,transitMode:M,departure:true,transfer:I},clusterize:false};if(this.transportPostTimesServiceURLs[M]!=null){var c=m.transit_details.departure_stop.name;var n=(c.split("POSTE: ")[1]?c.split("POSTE: ")[1].replace(")",""):"");var U=c.split(" (")[0];var R=this.transportPostTimesServiceURLs[M];R=R.replace("POST_NUMBER",n);R=R.replace("POST_NAME",U);N.link=encodeURI(R);F.cursor="pointer"}var q=new OpenLayers.Feature.Vector(b,N,F);p.push(q);var A=coordTransform(this.serviceSRS,this.map.getProjection(),m.transit_details.arrival_stop.location.lng,m.transit_details.arrival_stop.location.lat);var v=new OpenLayers.Geometry.Point(A[0],A[1]);var l=this.routeStyle.arrival_stop[M];var B={routeElement:true,routeDetails:{lineName:m.transit_details.line.name,lineNumber:m.transit_details.line.short_name,lineHeadsign:m.transit_details.headsign,stopName:m.transit_details.arrival_stop.name,transitMode:M,departure:false},clusterize:false};var Q=new OpenLayers.Feature.Vector(v,B,l);p.push(Q);I=true}}}if(this.currentRouteOptions.drawOrigin){var D=coordTransform(this.serviceSRS,this.map.getProjection(),C.start_location.lng,C.start_location.lat);var ab=new OpenLayers.Geometry.Point(D[0],D[1]);var H=this.routeStyle.origin;var r=null;if(this.currentRouteOptions.originName){r="<b><center>"+this.currentRouteOptions.originName+"</center></b>"}var X={routeElement:true,routeDetails:{directions:r,origin:true},clusterize:false};var s=new OpenLayers.Feature.Vector(ab,X,H);p.push(s)}if(this.currentRouteOptions.drawDestination){var J=coordTransform(this.serviceSRS,this.map.getProjection(),C.end_location.lng,C.end_location.lat);var K=new OpenLayers.Geometry.Point(J[0],J[1]);var f=this.routeStyle.destination;var O=null;if(this.currentRouteOptions.destinationName){O="<b><center>"+this.currentRouteOptions.destinationName+"</center></b>"}var aa={routeElement:true,routeDetails:{directions:O,origin:true},clusterize:false};var S=new OpenLayers.Feature.Vector(K,aa,f);p.push(S)}return E.concat(p)},parseEncodedPolyline:function(b){var g=new OpenLayers.Format.EncodedPolyline();var f=this.map.getProjection();var c=g.read(b);var d=new OpenLayers.IAAA_SRSGeometry(c.geometry,this.serviceSRS);d.transformSrs(f);c.geometry=d.geometry;return c},createVectorialLayer:function(){var b=new OpenLayers.Layer.IAAA_GenericVector("GoogleDirectionsAPIRouter_Layer",{visibility:true,displayOutsideMaxExtent:true,alwaysInRange:true,additionalInfo:true});this.map.addLayer(b);return b},showLoading:function(){if(this.showLoadingControl==null){for(var c=0,b=this.map.controls.length;c<b;c++){if(this.map.controls[c].CLASS_NAME=="OpenLayers.Control.IAAA_LoadingMap"){this.showLoadingControl=this.map.controls[c];break}}}if(this.showLoadingControl!=null){this.showLoadingControl.showLoadingDiv()}},hideLoading:function(){if(this.showLoadingControl!=null){this.showLoadingControl.hideLoadingDiv()}},generateRouteDefaultStyle:function(){var b=[];b.origin={externalGraphic:this.routeStyleImgDir+"origin.png",graphicWidth:30,graphicHeight:45};b.destination={externalGraphic:this.routeStyleImgDir+"destination.png",graphicWidth:30,graphicHeight:45};b.step=[];b.step["walking"]={strokeWidth:7,strokeColor:"#0000FF",strokeOpacity:0.8};b.step["bus"]={strokeWidth:7,strokeColor:"#D33029",strokeOpacity:0.8};b.step["rural_bus"]={strokeWidth:7,strokeColor:"#147668",strokeOpacity:0.8};b.step["tram"]={strokeWidth:7,strokeColor:"#088A08",strokeOpacity:0.8};b.departure_stop=[];b.departure_stop["bus"]={externalGraphic:this.routeStyleImgDir+"departure_stop_bus.png",graphicWidth:20,graphicHeight:20};b.departure_stop["rural_bus"]={externalGraphic:this.routeStyleImgDir+"departure_stop_rural_bus.png",graphicWidth:20,graphicHeight:20};b.departure_stop["tram"]={externalGraphic:this.routeStyleImgDir+"departure_stop_tram.png",graphicWidth:20,graphicHeight:20};b.arrival_stop=[];b.arrival_stop["bus"]={externalGraphic:this.routeStyleImgDir+"arrival_stop_bus.png",graphicWidth:20,graphicHeight:20};b.arrival_stop["rural_bus"]={externalGraphic:this.routeStyleImgDir+"arrival_stop_rural_bus.png",graphicWidth:20,graphicHeight:20};b.arrival_stop["tram"]={externalGraphic:this.routeStyleImgDir+"arrival_stop_tram.png",graphicWidth:20,graphicHeight:20};b.transfer_stop=[];b.transfer_stop["bus"]={externalGraphic:this.routeStyleImgDir+"transfer_stop_bus.png",graphicWidth:20,graphicHeight:20};b.transfer_stop["rural_bus"]={externalGraphic:this.routeStyleImgDir+"transfer_stop_rural_bus.png",graphicWidth:20,graphicHeight:20};b.transfer_stop["tram"]={externalGraphic:this.routeStyleImgDir+"transfer_stop_tram.png",graphicWidth:20,graphicHeight:20};b.stop=[];b.stop["bus"]={externalGraphic:this.routeStyleImgDir+"stop_bus.png",graphicWidth:20,graphicHeight:20};b.stop["rural_bus"]={externalGraphic:this.routeStyleImgDir+"stop_rural_bus.png",graphicWidth:20,graphicHeight:20};b.stop["tram"]={externalGraphic:this.routeStyleImgDir+"stop_tram.png",graphicWidth:20,graphicHeight:20};b.walking={externalGraphic:this.routeStyleImgDir+"walking.png",graphicWidth:20,graphicHeight:20};return b},CLASS_NAME:"OpenLayers.Control.IAAA_GoogleDirectionsAPIRouter"});OpenLayers.IAAA_WMS.IAAA_ParentLayer=OpenLayers.Class(OpenLayers.IAAA_WMS,{ISPARENTLAYER:true,childLayers:null,originalName:null,initialize:function(d,g,f,c){var b=new Array();b.push(d,g,f,c);OpenLayers.IAAA_WMS.prototype.initialize.apply(this,b);this.childLayers=new Array()},clone:function(d){d=OpenLayers.IAAA_WMS.prototype.clone.apply(this,[d]);var b=new Array();if(this.childLayers){for(var c in this.childLayers){b[c]=this.childLayers[c].clone()}}d.ISPARENTLAYER=this.ISPARENTLAYER;d.childLayers=b;return d},addChildLayer:function(b){if(b.maxSupportedExtent){if(this.maxSupportedExtent){var g=b.maxSupportedExtent.getSrs();var d=this.maxSupportedExtent.getSrs();var j=coordTransform(g,d,b.maxSupportedExtent.right,b.maxSupportedExtent.bottom);var f=coordTransform(g,d,b.maxSupportedExtent.left,b.maxSupportedExtent.top);var c=new OpenLayers.Bounds(f[0],j[1],j[0],f[1]);this.maxSupportedExtent.left=(c.left<this.maxSupportedExtent.left)?c.left:this.maxSupportedExtent.left;this.maxSupportedExtent.top=(c.top>this.maxSupportedExtent.top)?c.top:this.maxSupportedExtent.top;this.maxSupportedExtent.right=(c.right>this.maxSupportedExtent.right)?c.right:this.maxSupportedExtent.right;this.maxSupportedExtent.bottom=(c.bottom<this.maxSupportedExtent.bottom)?c.bottom:this.maxSupportedExtent.bottom}else{if(this.getChildLayerList().length<=0){this.setMaxSupportedExtent(b.maxSupportedExtent)}else{}}}b.setParent(this);this.childLayers[this.childLayers.length]=b;if(b.getVisibility()){this.setVisibility(true);if(b.isExcluder()&&this.parent){this.parent.updateExcluderLayers(b)}}},addChildLayers:function(c){for(var b in c){this.addChildLayer(c[b])}},getChildLayerList:function(){return this.childLayers},getChildLayer:function(b){return this.childLayers[b]},getChildLayerIndex:function(b,d){var c;for(c=0;c<this.childLayers.length;c++){if((this.childLayers[c].name==b)&&(this.childLayers[c].title==d)){return c}}return -1},removeChildLayer:function(d){var c=d;if((c>=0)&&(c<this.childLayers.length)){while(c<(this.childLayers.length-1)){this.childLayers[c]=this.childLayers[c+1];c++}var b=this.childLayers.pop().getVisibility();if(this.childLayers.length>0){this.updateVisibility()}else{this.setVisibility(b)}return true}else{return false}},interchangeChildLayers:function(b,d){var c=this.getChildLayerList()[b];this.getChildLayerList()[b]=this.getChildLayerList()[d];this.getChildLayerList()[d]=c},updateVisibility:function(){for(var b=0;b<this.childLayers.length;b++){if(this.childLayers[b].getVisibility()){this.setVisibility(true);return}}this.setVisibility(false)},getMetadataUrlList:function(){return new Array()},setChildLayerList:function(b){this.childLayers=b},setParent:function(c){this.parent=c;for(var b in this.getChildLayerList()){this.getChildLayerList()[b].setParent(this)}},CLASS_NAME:"OpenLayers.IAAA_WMS.IAAA_ParentLayer"});OpenLayers.Layer.IAAA_Server=OpenLayers.Class(OpenLayers.Layer.WMS,OpenLayers.IAAA_ComplexTreeNode,{service:null,version:"1.3.0",formatList:new Array(),versionParameterName:"VERSION",capabilitiesRequest:"GetCapabilities",dimensionNamesList:new Array(),dimensionValuesList:new Array(),childDimensionsNamesList:null,formatSelected:-1,defaultFormatSelected:null,SRSList:new Array(),selectedSRS:-1,exception:null,loaded:false,layers:new Array(),isSLD:false,returnPx:null,clearBeforeLoading:true,initQueryTime:-1,endQueryTime:-1,isWMSC:false,accessConstraints:null,mainAttribution:null,abstractInformation:null,contactInformation:{},delayDisplay:true,maxSupportedExtent:null,mainLayerMaxSupportedExtent:null,minSupportedScale:null,mainLayerMinSupportedScale:null,maxSupportedScale:null,mainLayerMaxSupportedScale:null,scaleScopeErrorMargin:0.001,mainLayerTitle:null,legendList:null,ignoreScope:true,selectedTileSet:null,urlServlet:null,useWCTS:false,urlWCTS:null,defaultSrs:null,sessionKey:null,loading:false,isWCTS:true,geoDRMServerIndex:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","tileloadstart","tileloaded","tileunload","urlchanged","titlechanged","layerlistvisibilityupdated","move","moveend"],initialize:function(f,d,j,c){var b=new Array();j=OpenLayers.Util.upperCaseObject(j);if(c&&c.isWMSC){c.singleTile=false}if(d&&d.indexOf("&")!=-1){d=d.substring(0,d.indexOf("&"))+"?"+d.substring(d.indexOf("&")+1,d.length)}b.push(f,d,j,c);if(this.version){this.DEFAULT_PARAMS.version=this.version}OpenLayers.Layer.WMS.prototype.initialize.apply(this,b);OpenLayers.IAAA_ComplexTreeNode.prototype.initialize.apply(this,["service",c]);this.params.LAYERS="";if((this.params.BGCOLOR==undefined)||(this.params.BGCOLOR==null)||(this.params.BGCOLOR=="")){this.params.BGCOLOR="0xFFFFFF"}if((this.params.SERVICE!=undefined)&&(this.params.SERVICE!=null)){this.service=this.params.SERVICE}else{this.service="WMS"}this.layers=new Array();this.setVisibility(false);this.formatList=new Array(this.params.FORMAT);if((this.getFormatSelected()<0)&&this.defaultFormatSelected){var g=0;while((g<this.formatList.length)&&(this.getFormatSelected()<0)){if(this.defaultFormatSelected==this.formatList[g]){this.setFormatSelected(g)}g++}if(this.getFormatSelected()<0){this.setFormatSelected(0)}}this.events.register("loadstart",null,this.onLoadStartHandler);this.events.register("loadend",null,this.onLoadHandler);this.events.register("tileloaded",null,this.onTileLoadHandler);if(this.useWCTS){this.getFullRequestString=function(m,l){var k=this.defaultSrs;if(this.params.VERSION){this.params.VERSION=this.params.VERSION+""}if((this.params.VERSION)&&(parseInt(this.params.VERSION.split(".")[0])>=1)&&(parseInt(this.params.VERSION.split(".")[1])>=2)){this.params.CRS=(k=="none")?null:k;this.params.SRS=null}else{this.params.SRS=(k=="none")?null:k;this.params.CRS=null}if((typeof this.params.TRANSPARENT=="boolean")&&m){m.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)}}this.childDimensionsNamesList=[]},setMap:function(d){if(this.map==null){this.map=d;if(this.sessionKey){var c=this.map.isGeoDRMServerLoaded(this.url,this.sessionKey.getPrimaryKey());if(c!=-1){this.map.addLayerToGeoDRMServer(this,c)}else{this.sessionKey.synchronizeWithLayer(this);this.setGeoDRMServerIndex(this.map.addGeoDRMServer(this))}}this.maxExtent=this.maxExtent||this.map.maxExtent;this.projection=this.projection||this.map.projection;if(this.projection&&typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)}this.units=this.projection.getUnits()||this.units||this.map.units;if((!this.isWMSC)||(!this.resolutions)){this.initResolutions()}else{if(this.isWMSC&&this.resolutions){this.numZoomLevels=this.resolutions.length;this.setMaxSupportedScale(this.map.getActualScaleFromResolution(this.resolutions[0]));this.setMinSupportedScale(this.map.getActualScaleFromResolution(this.resolutions[this.resolutions.length-1]));this.setMainLayerMaxSupportedScale(this.maxSupportedScale);this.setMainLayerMinSupportedScale(this.minSupportedScale)}}if(!this.isBaseLayer){this.inRange=this.calculateInRange();var b=((this.visibility)&&(this.inRange));this.div.style.display=b?"":"none"}this.setTileSize();this.checkNodeVisibility();if(this.map.generateIncompatibleMapServerDialog&&!this.map._incompatibleMapServerDialog){this.map.createIncompatibleMapServerWindow()}}if(this.useWCTS){this.map.addWCTSServer()}},addLayer:function(d){this.updateScopeVisibilityParams(d);if(d.ISPARENT){var c=0;while((c<this.layers.length)&&((d.name!=this.layers[c].name)||(!this.layers[c].ISPARENT))){c++}if(c<this.layers.length){var n=d.getChildLayerList().length;var m=this.layers[c].getChildLayerList().length;var l=0;var j=0;while(l<n){while((j<m)&&(d.childLayers[l].name!=this.layers[c].childLayers[j].name)){j++}if(j=m){this.layers[c].childLayers[this.layers[c].childLayers.length]=d.childLayers[l]}l++;j=0}return}}this.layers[this.layers.length]=d;d.setParent(this);if(d.getVisibility()){this.updateVisibility()}if(d.CLASS_NAME=="OpenLayers.IAAA_WMS"){if(d.isExcluder()&&d.getVisibility()){this.updateExcluderLayers(d)}}else{if(d.CLASS_NAME=="OpenLayers.IAAA_WMS.IAAA_ParentLayer"){for(var k=0;k<d.getChildLayerList().length;k++){var b=d.getChildLayerList()[k];if(b.isExcluder()&&b.getVisibility()){this.updateExcluderLayers(b)}}}}},addLayers:function(c){for(var b in c){this.addLayer(c[b])}},setLayerList:function(c){this.layers=new Array();for(var b in c){this.updateScopeVisibilityParams(c[b]);this.layers.push(c[b]);c[b].setParent(this)}},removeLayer:function(d){var b=d;var c=this.layers.length;if(b<c){while(b<(c-1)){this.layers[b]=this.layers[b+1];b++}this.layers.pop();this.updateVisibility();this.updateScopeVisibilityParams(null);return true}else{return false}},getLayerIndex:function(b,d){var c;for(c=0;c<this.layers.length;c++){if((this.layers[c].name==b)&&(this.layers[c].title==d)){return c}}return -1},interchangeLayers:function(b,d){var c=this.layers[b];this.layers[b]=this.layers[d];this.layers[d]=c},getVersion:function(){return this.params.VERSION},getTransparent:function(){return(((this.params.TRANSPARENT==undefined)||(this.params.TRANSPARENT==null)||((this.params.TRANSPARENT+"").toUpperCase()!="FALSE"))+"")},getVersionParameterName:function(){return this.versionParameterName},getCapabilitiesRequest:function(){return this.capabilitiesRequest},getBgColor:function(){return this.params.BGCOLOR},getDimensionNamesList:function(){return this.dimensionNamesList},getDimensionName:function(b){return this.dimensionNamesList[b]},getDimensionValuesList:function(){return this.dimensionValuesList},getDimensionValue:function(b){return this.dimensionValuesList[b]},getFormatSelected:function(){return this.formatSelected},getFormatList:function(){return this.formatList},getException:function(){return this.exception},setVersion:function(b){this.version=b;this.params.VERSION=b},setTransparent:function(b){this.params.TRANSPARENT=b},setBgColor:function(b){this.params.BGCOLOR=b},setDimensionName:function(c,b){this.dimensionNamesList[c]=b},setDimensionValue:function(c,b){this.dimensionValuesList[c]=b},setDimensionNamesList:function(b){this.dimensionNamesList=b},setFormatList:function(c){this.formatList=c;if(this.defaultFormatSelected){for(var b in this.formatList){if(this.defaultFormatSelected==this.formatList[b]){this.setFormatSelected(b);return}}}this.setFormatSelected(0)},setDimensionValuesList:function(b){this.dimensionValuesList=b},setFormatSelected:function(b){this.formatSelected=b;this.params.FORMAT=this.formatList[this.formatSelected]},setException:function(b){this.exception=b;this.params.EXCEPTIONS=b},setLoading:function(b){this.loading=b},updateVisibility:function(l){this.params.LAYERS="";this.params.STYLES="";for(var j=0;j<this.childDimensionsNamesList.length;j++){var b=this.childDimensionsNamesList[j];this.params[b]=""}for(var c=0;c<this.layers.length;c++){if(this.layers[c].getVisibility()){if((!this.layers[c].ISPARENTLAYER)||(this.layers[c].getChildLayerList().length==0)){if(this.params.LAYERS!=""){this.params.LAYERS=this.params.LAYERS+",";this.params.STYLES=this.params.STYLES+","}this.params.LAYERS=this.params.LAYERS+this.layers[c].name;this.params.STYLES=this.params.STYLES+this.layers[c].styleList[this.layers[c].getStyleSelected()].getName();for(var j=0;j<this.childDimensionsNamesList.length;j++){var b=this.childDimensionsNamesList[j];if(this.params[b]!=""){this.params[b]=this.params[b]+","}var f=this.layers[c].getDimensionValue(b);if(f){this.params[b]=this.params[b]+f}}}else{var g={layers:"",styles:""};for(var j=0;j<this.childDimensionsNamesList.length;j++){var b=this.childDimensionsNamesList[j];g[b]=""}this.getChildVisibleLayers(this.layers[c],g);if(this.params.LAYERS!=""){this.params.LAYERS=this.params.LAYERS+",";this.params.STYLES=this.params.STYLES+","}this.params.LAYERS=this.params.LAYERS+g.layers;this.params.STYLES=this.params.STYLES+g.styles;for(var j=0;j<this.childDimensionsNamesList.length;j++){var b=this.childDimensionsNamesList[j];if(this.params[b]!=""){this.params[b]=this.params[b]+","}this.params[b]=this.params[b]+g[b]}}}}for(var j=0;j<this.childDimensionsNamesList.length;j++){var b=this.childDimensionsNamesList[j];if(this.params[b]!=undefined){this.params[b]=this.deleteDuplicatedValuesFromDimensionParam(this.params[b]);if(this.params[b]==""){delete this.params[b]}}}if((l==null)||l){if(this.params.LAYERS!=""){if(!this.loading&&((this.map!=null)&&(!this.map.isLoading()))){var k=this.getVisibility();this.setVisibility(true);if(k){this.redraw()}}else{this.visibility=true}}else{this.setVisibility(false)}}this.events.triggerEvent("layerlistvisibilityupdated",{layer:this})},deleteDuplicatedValuesFromDimensionParam:function(k){var b="";if(k&&(k.length>0)){var g=k.split(",");var l=new Array();for(var f=0;f<g.length;f++){var d=false;for(var c=0;c<l.length;c++){if(l[c]==g[f]){d=true;break}}if(!d){l.push(g[f])}}if(l&&l.length>0){b=l[0];for(var f=1;f<l.length;f++){b=b+","+l[f]}}}return b},getChildVisibleLayers:function(f,j){var k=f.getChildLayerList();for(var c in k){if(k[c].getVisibility()){if((!k[c].ISPARENTLAYER)||(k[c].getChildLayerList().length==0)){if(j.layers!=""){j.layers=j.layers+",";j.styles=j.styles+","}j.layers=j.layers+k[c].name;j.styles=j.styles+k[c].styleList[k[c].getStyleSelected()].getName();for(var l=0;l<this.childDimensionsNamesList.length;l++){var b=this.childDimensionsNamesList[l];if(j[b]!=""){j[b]=j[b]+","}var g=k[c].getDimensionValue(b);if(g){j[b]=j[b]+g}}}else{this.getChildVisibleLayers(k[c],j)}}}},setVisibilityToAllLayers:function(c){for(var d=0,b=this.layers.length;d<b;d++){if(this.layers[d].disabled==true){continue}else{if((!this.layers[d].ISPARENTLAYER)||(this.layers[d].getChildLayerList().length==0)){this.layers[d].visibility=c}else{this.setVisibilityToChildLayers(this.layers[d],c);this.layers[d].visibility=c}}}this.updateVisibility()},setVisibilityToChildLayers:function(f,c){var g=f.getChildLayerList();for(var d=0,b=g.length;d<b;d++){if(g[d].disabled==true){continue}else{if((!g[d].ISPARENTLAYER)||(g[d].getChildLayerList().length==0)){g[d].visibility=c}else{this.setVisibilityToChildLayers(g[d],c);g[d].visibility=c}}}},addTile:function(f,b){var d=this.getURL(f);if((this.useWCTS)&&(!this.isWMSC)){var c=new OpenLayers.Tile.IAAA_Image_WCTS(this,b,f,d,this.tileSize,{delayDisplay:this.delayDisplay});c.isWCTS=this.isWCTS;return c}else{return new OpenLayers.Tile.IAAA_Image(this,b,f,d,this.tileSize,{delayDisplay:this.delayDisplay})}},spiralTileLoad:function(){this.showLoading();this.loaded=false;OpenLayers.Layer.Grid.prototype.spiralTileLoad.apply(this,arguments)},resizeTiles:function(d,b){var g=(this.tileSize.w*d)-((this.tileSize.w*d)%1);var c=(this.tileSize.h*b)-((this.tileSize.h*b)%1);var f=new OpenLayers.Size(g,c);this.setTileSize(f);this.clearGrid();this.initGriddedTiles(this.getExtent())},moveTo:function(c,b,d){if(this.getVisibility()){OpenLayers.Layer.WMS.prototype.moveTo.apply(this,arguments)}},getLayerList:function(){return this.layers},getTitle:function(){return this.name},getUrl:function(){return this.url},getSRSList:function(){return this.SRSList},getSelectedSRS:function(){return this.selectedSRS},setTitle:function(c){var b=this.name;this.name=c;this.events.triggerEvent("titlechanged",{ancientTitle:b,layer:this})},setUrl:function(c){if(c.indexOf("&")!=-1){c=c.substring(0,c.indexOf("&"))+"?"+c.substring(c.indexOf("&")+1,c.length)}var b=this.url;this.url=c;this.events.triggerEvent("urlchanged",{ancientUrl:b,layer:this})},getIsSLD:function(){return this.isSLD},setIsSLD:function(b){this.isSLD=b},setSRSList:function(b){this.SRSList=b;this.defaultSrs=this.SRSList[0]},setSelectedSRS:function(c){this.selectedSRS=c;this.projection=this.getSRSList()[c];this.params.SRS=this.getSRSList()[c];var b=this.params.VERSION;if(b){if((parseInt(b.split(".")[0])>=1)&&(parseInt(b.split(".")[1])>=2)){this.params.CRS=this.getSRSList()[c];this.params.SRS=null}}},changeSrs:function(k){var d=this.findSrs(k);if(d>=0&&d<this.getSRSList().length){this.setSelectedSRS(d)}else{var c=0;var g=false;while(!g&&c<getPrioritySrsList().length){var b=getPrioritySrs(c);if(b!=k){var f=this.findSrs(b);if(f>=0&&f<this.getSRSList().length){this.setSelectedSRS(f);g=true}}c++}if(!g){alert(indexReference.messages.wmsSrsNotSupported)}}},findSrs:function(d){var b=-1;var c=0;while((b==-1)&&(c<this.getSRSList().length)){if(this.getSRSList()[c]==d){b=c}c++}return b},getFullRequestString:function(f){var b=this.map.getProjection();if(this.getVersion().charAt(2)&&(parseInt(this.getVersion().charAt(2))>=2)){this.params.CRS=(this.projection)?this.projection:b;this.params.SRS=null}else{this.params.SRS=(this.projection)?this.projection:b;this.params.CRS=null}if((typeof this.params.TRANSPARENT=="boolean")&&f){f.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}var c=this.getDimensionNamesList();for(var d in c){if(c[d]){this.params[c[d].toUpperCase()]=this.getDimensionValue(d)}}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},calculateInRange:function(){return true},initSingleTile:function(j){var b=j.getCenterLonLat();var l=j.getWidth()*this.ratio;var c=j.getHeight()*this.ratio;var k=new OpenLayers.Bounds(b.lon-(l/2),b.lat-(c/2),b.lon+(l/2),b.lat+(c/2));var f=new OpenLayers.LonLat(k.left,k.top);var d=this.map.getLayerPxFromLonLat(f);this.returnPx=d;if(!this.grid.length){this.grid[0]=[]}var g=this.grid[0][0];if(!g){g=this.addTile(k,d);this.addTileMonitoringHooks(g);g.draw();this.grid[0][0]=g}else{if((this.useWCTS&&(g.CLASS_NAME!="OpenLayers.Tile.IAAA_Image_WCTS"))||(!this.useWCTS&&(g.CLASS_NAME!="OpenLayers.Tile.IAAA_Image"))){if(g.clearDiv){g.clearDiv()}if(g.clear){g.clear()}this.removeTileMonitoringHooks(g);g.destroy();this.redefineGetFullRequestString();g=this.addTile(k,d);this.addTileMonitoringHooks(g);g.draw();this.grid[0][0]=g}else{g.moveTo(k,g.position)}}this.removeExcessTiles(1,1)},initGriddedTiles:function(f){if(this.grid){while(this.grid.length>0){var g=this.grid.pop();for(var c=0,b=g.length;c<b;c++){var d=g[c];this.removeTileMonitoringHooks(d);d.destroy()}}if(this.grid[0]){while(this.grid[0].length>0){for(var c=0,b=this.grid.length;c<b;c++){var g=this.grid[c];var d=g.pop();this.removeTileMonitoringHooks(d);d.destroy()}}}}OpenLayers.Layer.WMS.prototype.initGriddedTiles.apply(this,[f])},addTileMonitoringHooks:function(b){b.onLoadStart=function(){this.events.triggerEvent("tileloadstart");if(this.numLoadingTiles==0){this.events.triggerEvent("loadstart")}this.numLoadingTiles++};b.events.register("loadstart",this,b.onLoadStart);b.onLoadEnd=function(){this.numLoadingTiles--;this.events.triggerEvent("tileloaded");if(this.numLoadingTiles==0){this.events.triggerEvent("loadend")}};b.events.register("loadend",this,b.onLoadEnd);b.onUnload=function(){this.numLoadingTiles--;this.events.triggerEvent("tileunload")};b.events.register("unload",this,b.onUnload)},onLoadHandler:function(){if((this.singleTile)&&(this.returnPx)&&(this.grid)&&(this.grid[0])&&(this.grid[0][0])){try{OpenLayers.Util.modifyDOMElement(this.grid[0][0].frame,null,this.returnPx);this.grid[0][0].position=this.returnPx}catch(b){}}this.hideLoading()},onTileLoadHandler:function(){this.setEndQueryTime(new Date().getTime())},onLoadStartHandler:function(){this.showLoading();this.resetEndQueryTime();this.setInitQueryTime(new Date().getTime())},getZoomForResolution:function(f){var o;if(this.map.fractionalZoom){var l=0;var c=this.resolutions.length-1;var d=this.resolutions[l];var b=this.resolutions[c];var k;for(var g=0;g<this.resolutions.length;++g){k=this.resolutions[g];if(k>=f){d=k;l=g}if(k<=f){b=k;c=g;break}}var j=d-b;if(j>0){o=l+((f-b)/j)}else{o=l}}else{var m;var n=Number.POSITIVE_INFINITY;for(var g=0;g<this.resolutions.length;g++){m=Math.abs(this.resolutions[g]-f);if(m>n){break}n=m}o=Math.max(0,g-1)}return o},setInitQueryTime:function(b){this.initQueryTime=b},resetEndQueryTime:function(){this.endQueryTime=-1},setEndQueryTime:function(b){if(this.endQueryTime<0){this.endQueryTime=b}},getInitQueryTime:function(){return this.initQueryTime},getEndQueryTime:function(){return this.endQueryTime},getResponseTime:function(){return(this.endQueryTime-this.initQueryTime)},updateExcluderLayers:function(k,b){for(var g=0;g<this.layers.length;g++){var f=this.layers[g];var d;if((f!=k)&&(f.isExcluder())){this.layers[g].setVisibility(false,b);d=f.getTreeNodeCheckBox()}else{if(f.CLASS_NAME=="OpenLayers.IAAA_WMS.IAAA_ParentLayer"){for(var c=0;c<f.getChildLayerList().length;c++){var l=f.getChildLayerList()[c];if((l!=k)&&(l.isExcluder())){l.setVisibility(false,b);d=l.getTreeNodeCheckBox()}}}}if(d&&(OpenLayers.IAAA_ComplexTreeNode.getNodeCheckBoxState(d)!=false)){OpenLayers.IAAA_ComplexTreeNode.updateNodeCheckBoxState(d,false,messages.showLayer)}}this.updateMainTreeNode()},clearTiles:function(){for(var f=0,j=this.grid.length;f<j;f++){var g=this.grid[f];for(var k=0,b=g.length;k<b;k++){var d=g[k];d.clear()}}},setAccessConstraints:function(b){this.accessConstraints=b},getAccessConstraints:function(){return this.accessConstraints},setMainAttribution:function(b){this.mainAttribution=b},getMainAttribution:function(){return this.mainAttribution},redraw:function(b){OpenLayers.Layer.WMS.prototype.redraw.apply(this,[b])},inSupportedRange:function(){var j=true;var d=this.scaleScopeErrorMargin+1;if(!this.ignoreScope){if(!this.map){j=true}else{if((this.minSupportedScale&&(this.map.getActualScale()*d<this.minSupportedScale))||(this.maxSupportedScale&&(this.map.getActualScale()>this.maxSupportedScale*d))){j=false}else{if(this.maxSupportedExtent){var c,b;if(this.maxSupportedExtent.srs==this.map.projection){c=this.maxSupportedExtent;b=this.map.getExtent()}else{if(OpenLayers.IAAA_Utils.isGeographicalProjection(this.maxSupportedExtent.srs)){var g=OpenLayers.IAAA_Utils.coordTransform(this.map.projection,this.maxSupportedExtent.srs,this.map.getExtent().right,this.map.getExtent().bottom);var f=OpenLayers.IAAA_Utils.coordTransform(this.map.projection,this.maxSupportedExtent.srs,this.map.getExtent().left,this.map.getExtent().top);c=new OpenLayers.Bounds(f[0],g[1],g[0],f[1]);b=this.maxSupportedExtent}else{var g=OpenLayers.IAAA_Utils.coordTransform(this.maxSupportedExtent.srs,this.map.projection,this.maxSupportedExtent.right,this.maxSupportedExtent.bottom);var f=OpenLayers.IAAA_Utils.coordTransform(this.maxSupportedExtent.srs,this.map.projection,this.maxSupportedExtent.left,this.maxSupportedExtent.top);c=new OpenLayers.Bounds(f[0],g[1],g[0],f[1]);b=this.map.getExtent()}}if(!c.intersectsBounds(b)){j=false}}}}}return j},setMaxSupportedExtent:function(c){var b=this.inSupportedRange();this.maxSupportedExtent=c;this.updateTreeNodeVisibility();OpenLayers.IAAA_Utils._addedServiceArea=this.maxSupportedExtent;if(this.map){if(!this.inSupportedRange()&&b){if(this.map.showServiceOutOfScopeDialog){this.map.showServiceOutOfScopeDialog(OpenLayers.IAAA_Utils.getServiceOutOfScopeText(this))}}else{if(this.inSupportedRange()){if(this.map.hideServiceOutOfScopeDialog){this.map.hideServiceOutOfScopeDialog()}}}}},setMainLayerMaxSupportedExtent:function(b){this.mainLayerMaxSupportedExtent=b;this.setMaxSupportedExtent(b)},setMinSupportedScale:function(c){var b=this.inSupportedRange();this.minSupportedScale=c;this.updateTreeNodeVisibility();if(this.map){if(!this.inSupportedRange()&&b){this.map.showServiceOutOfScopeDialog(OpenLayers.IAAA_Utils.getServiceOutOfScopeText(this))}else{if(this.inSupportedRange()){if(this.map.hideServiceOutOfScopeDialog){this.map.hideServiceOutOfScopeDialog()}}}}},setMainLayerMinSupportedScale:function(b){this.mainLayerMinSupportedScale=b;this.setMinSupportedScale(b)},setMaxSupportedScale:function(c){var b=this.inSupportedRange();this.maxSupportedScale=c;this.updateTreeNodeVisibility();OpenLayers.IAAA_Utils._addedServiceMaxScale=this.maxSupportedScale;if(this.map){if(!this.inSupportedRange()&&b){this.map.showServiceOutOfScopeDialog(OpenLayers.IAAA_Utils.getServiceOutOfScopeText(this))}else{if(this.inSupportedRange()){if(this.map.hideServiceOutOfScopeDialog){this.map.hideServiceOutOfScopeDialog()}}}}},setMainLayerMaxSupportedScale:function(b){this.mainLayerMaxSupportedScale=b;this.setMaxSupportedScale(b)},updateScopeVisibilityParams:function(j){if(j){if(!this.mainLayerMaxSupportedExtent){if(j.maxSupportedExtent){if(this.maxSupportedExtent){var k=j.maxSupportedExtent.getSrs();var n=this.maxSupportedExtent.getSrs();var q=OpenLayers.IAAA_Utils.coordTransform(k,n,j.maxSupportedExtent.right,j.maxSupportedExtent.bottom);var p=OpenLayers.IAAA_Utils.coordTransform(k,n,j.maxSupportedExtent.left,j.maxSupportedExtent.top);var g=new OpenLayers.Bounds(p[0],q[1],q[0],p[1]);var o=(g.left<this.maxSupportedExtent.left)?g.left:this.maxSupportedExtent.left;var r=(g.top>this.maxSupportedExtent.top)?g.top:this.maxSupportedExtent.top;var b=(g.right>this.maxSupportedExtent.right)?g.right:this.maxSupportedExtent.right;var d=(g.bottom<this.maxSupportedExtent.bottom)?g.bottom:this.maxSupportedExtent.bottom;this.setMaxSupportedExtent(new OpenLayers.IAAA_Bounds(o,d,b,r));this.maxSupportedExtent.setSrs(n)}else{if(this.getLayerList().length<=0){this.setMaxSupportedExtent(j.maxSupportedExtent)}else{}}}else{if(!this.isWMSC){this.setMaxSupportedExtent(null)}}}if(!this.mainLayerMinSupportedScale){if(j.minSupportedScale){if(this.minSupportedScale){this.minSupportedScale=(this.minSupportedScale>j.minSupportedScale)?j.minSupportedScale:this.minSupportedScale}else{if(this.getLayerList().length<=0){this.setMinSupportedScale(j.minSupportedScale)}else{}}}else{this.setMinSupportedScale(null)}}if(!this.mainLayerMaxSupportedScale){if(j.maxSupportedScale){if(this.maxSupportedScale){this.maxSupportedScale=(this.maxSupportedScale<j.maxSupportedScale)?j.maxSupportedScale:this.maxSupportedScale}else{if(this.getLayerList().length<=0){this.setMaxSupportedScale(j.maxSupportedScale)}else{}}}else{this.setMaxSupportedScale(null)}}}else{if(!this.mainLayerMaxSupportedExtent){var f=(this.layers[0])?this.layers[0].maxSupportedExtent:null;var c=1;while((c<this.layers.length)&&f){if(this.layers[c].maxSupportedExtent){var k=this.layers[c].maxSupportedExtent.getSrs();var n=this.maxSupportedExtent.getSrs();var q=OpenLayers.IAAA_Utils.coordTransform(k,n,this.layers[c].maxSupportedExtent.right,this.layers[c].maxSupportedExtent.bottom);var p=OpenLayers.IAAA_Utils.coordTransform(k,n,this.layers[c].maxSupportedExtent.left,this.layers[c].maxSupportedExtent.top);var g=new OpenLayers.Bounds(p[0],q[1],q[0],p[1]);f.left=(g.left<f.left)?g.left:this.maxSupportedExtent.left;f.top=(g.top>f.top)?g.top:this.maxSupportedExtent.top;f.right=(g.right>f.right)?g.right:this.maxSupportedExtent.right;f.bottom=(g.bottom<f.bottom)?g.bottom:this.maxSupportedExtent.bottom}else{f=null}c++}this.maxSupportedExtent=f}if(!this.mainLayerMinSupportedScale){var l=(this.layers[0])?this.layers[0].minSupportedScale:null;var c=1;while((c<this.layers.length)&&l){if(this.layers[c].minSupportedScale){l=(l>this.layers[c].minSupportedScale)?this.layers[c].minSupportedScale:l}else{l=null}c++}this.minSupportedScale=l}if(!this.mainLayerMaxSupportedScale){var m=(this.layers[0])?this.layers[0].maxSupportedScale:null;var c=1;while((c<this.layers.length)&&m){if(this.layers[c].maxSupportedScale){m=(m<this.layers[c].maxSupportedScale)?this.layers[c].maxSupportedScale:m}else{m=null}c++}this.maxSupportedScale=m}}this.updateTreeNodeVisibility()},sphericalReproject:true,getSphericalReproject:function(){return this.sphericalReproject},setSphericalReproject:function(b){this.sphericalReproject=b},getLegendList:function(){return this.legendList},setLegendList:function(b){this.legendList=b},getMainLayerTitle:function(){return this.mainLayerTitle},setMainLayerTitle:function(b){this.mainLayerTitle=b},customizedFeatureInfo:null,stopTileLoading:function(){if(this.grid){for(var c in this.grid){if(this.grid[c]){for(var b in this.grid[c]){if(this.grid[c][b]&&this.grid[c][b].isLoading){this.grid[c][b].isLoading=false;this.numLoadingTiles--}}}}}},isLatLon:function(d){var b=(d?d:this.getSRSList()[this.getSelectedSRS()]);var c=OpenLayers.IAAA_Utils.isGeographicalProjection(b);var g;try{g=((parseInt(this.params.VERSION.charAt(0))>=1)&&(parseInt(this.params.VERSION.charAt(2))>=2)&&c)}catch(f){g=((parseInt(this.params.VERSION[0])>=1)&&(parseInt(this.params.VERSION[2])>=2)&&c)}return g},getURL:function(d,c){d=this.adjustBounds(d);var f=this.getImageSize();var g;if(!this.isLatLon(c)){g={BBOX:this.encodeBBOX?d.toBBOX():d.toArray(),WIDTH:f.w,HEIGHT:f.h}}else{g={BBOX:[d.bottom,d.left,d.top,d.right],WIDTH:f.w,HEIGHT:f.h}}var b=this.getFullRequestString(g);return b},clone:function(c){if(c==null){c=new OpenLayers.Layer.IAAA_Server(this.name,this.url,OpenLayers.IAAA_Utils.cloneObject(this.params),OpenLayers.IAAA_Utils.cloneObject(this.options))}c.layers=new Array();for(var b in this.layers){c.addLayer(this.layers[b].clone())}c=OpenLayers.Layer.WMS.prototype.clone.apply(this,[c]);c.params.LAYERS=this.params.LAYERS;c.params.STYLES=this.params.STYLES;return c},getSelectedTileSet:function(){return this.selectedTileSet},calculeLimitScaleValues:function(){if(this.map&&this.resolutions&&(this.resolutions.length>0)){this.setMaxSupportedScale(this.map.getActualScaleFromResolution(this.resolutions[0],this.map));this.setMinSupportedScale(this.map.getActualScaleFromResolution(this.resolutions[this.resolutions.length-1],this.map));this.setMainLayerMaxSupportedScale(this.maxSupportedScale);this.setMainLayerMinSupportedScale(this.minSupportedScale)}},applyTileSet:function(f){this.selectedTileSet=f;this.resolutions=f.resolutions.sort(function(k,j){return j-k});this.calculeLimitScaleValues();this.maxExtent=f.bounds;this.setMaxSupportedExtent(this.maxExtent);this.setSRSList([f.SRS]);this.setSelectedSRS(0);this.setTileSize(new OpenLayers.Size(f.tileSize.w,f.tileSize.h));var g=this.getFormatList();var d=null;var c=-1;var b=0;while((b<g.length)&&(!d)){if(f.format==g[b]){d=g[b];c=b}b++}var b=0;while((b<g.length)&&(!d)){if(g[b].indexOf(f.format)>=0){d=g[b];c=b}b++}if(!d){if(g.length>0){d=g[0];c=0}else{d=f.format;this.setFormatList([d]);c=0}}this.setFormatSelected(c)},getSessionKey:function(){return this.sessionKey},setSessionKey:function(b){this.sessionKey=b;this.sessionKey.synchronizeWithLayer(this)},generateSessionKey:function(d,c,b){this.sessionKey=new OpenLayers.IAAA_SessionKey(d,c,b)},getMergedResolutions:function(l){if(this.isWMSC||this.isWMTS){var b=new Array();var f=(this.getSelectedTileSet())?this.getSelectedTileSet().resolutions:this.resolutions;var k=f.sort(function(n,m){return m-n});var c=k[0];var d=k[k.length-1];var j=l.sort(function(n,m){return m-n});var g=0;while((g<j.length)&&(j[g]>c)){b.push(j[g]);g++}b=b.concat(f);g=j.length-1;while((g>=0)&&(j[g]<d)){b.push(j[g]);g--}return b.sort(function(n,m){return m-n})}else{return null}},redefineGetFullRequestString:function(){if(this.useWCTS){this.getFullRequestString=function(d,c){var b=this.defaultSrs;if(this.params.VERSION){this.params.VERSION=this.params.VERSION+""}if((this.params.VERSION)&&(parseInt(this.params.VERSION.split(".")[0])>=1)&&(parseInt(this.params.VERSION.split(".")[1])>=2)){this.params.CRS=(b=="none")?null:b;this.params.SRS=null}else{this.params.SRS=(b=="none")?null:b;this.params.CRS=null}if((typeof this.params.TRANSPARENT=="boolean")&&d){d.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)}}else{this.getFullRequestString=function(f){var b=this.map.getProjection();if(this.getVersion().charAt(2)&&(parseInt(this.getVersion().charAt(2))>=2)){this.params.CRS=(this.projection)?this.projection:b;this.params.SRS=null}else{this.params.SRS=(this.projection)?this.projection:b;this.params.CRS=null}if((typeof this.params.TRANSPARENT=="boolean")&&f){f.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"}var c=this.getDimensionNamesList();for(var d in c){if(c[d]){this.params[c[d].toUpperCase()]=this.getDimensionValue(d)}}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)}}},setUseWCTS:function(b){if(b!=this.useWCTS){if(!b){this.map.removeWCTSServer()}else{this.map.addWCTSServer()}this.useWCTS=b}},removeSession:function(){if(this.sessionKey!=null){this.map.removeGeoDRMServer(this.geoDRMServerIndex,this.geoDRMId);this.sessionKey=null}},setGeoDRMServerIndex:function(c){this.geoDRMServerIndex=c;var d=this.map.getGeoDRMServerLayers(c);var b=0;if((d!=null)&&(d!=undefined)&&(d.length>0)){b=d.length-1}this.geoDRMId=this.name+"_"+c+"_"+b},setSharedSessionKey:function(b){if(this.sessionKey!=null){this.sessionKey.setSharedSessionKey(b,this)}},updateSessionKey:function(){if(this.sessionKey!=null){this.sessionKey.updateSessionKey(this)}},CLASS_NAME:"OpenLayers.Layer.IAAA_Server"});OpenLayers.Layer.IAAA_GenericVector=OpenLayers.Class(OpenLayers.Layer.Vector,OpenLayers.IAAA_ComplexTreeNode,{parent:null,layers:null,title:null,mainLayer:true,dontCloneFeaturesInSrsChange:false,additionalInfo:false,initialize:function(d,c){this.title=d;this.layers=[];OpenLayers.Layer.Vector.prototype.initialize.apply(this,[d,c]);var b=(this.mainLayer?"service":"layer");OpenLayers.IAAA_ComplexTreeNode.prototype.initialize.apply(this,[b,c]);this.childLayers=this.layers;this.getChildLayerList=this.getLayerList;this.getChildLayer=this.getLayer;this.getChildLayerIndex=this.getLayerIndex;this.interchangeChildLayers=this.interchangeLayers;this.addChildLayer=this.addLayer;this.addChildLayers=this.addLayers;this.removeChildLayer=this.removeLayer;this.removeAllChildLayers=this.removeAllLayers},setMap:function(b){if(this.map){this.events.unregister("loadstart",null,this.showLoading);this.events.unregister("loadend",null,this.hideLoading)}OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);this.checkNodeVisibility();this.addLayers(this.layers,true);this.events.register("loadstart",null,this.showLoading);this.events.register("loadend",null,this.hideLoading)},clone:function(A,n,H){if(A==null){var o=this.options;if(o&&o.strategies){o.strategies=null}if(o&&o.protocol){o.protocol=null}A=new OpenLayers.Layer.IAAA_GenericVector(this.name,OpenLayers.IAAA_Utils.cloneObject(o))}var g=false;var D=null;var k=this.map.baseLayer;var l=0;if(H!=null){if(H.generatePrintInfo&&(H.paramsToPrintCount!=null)&&(H.paramsToPrintCount!=undefined)&&(H.printMapSize&&((H.printMapSize.height!=null)&&(H.printMapSize.height!=undefined))&&((H.printMapSize.width!=null)&&(H.printMapSize.width!=undefined)))){g=true;A.printInfo=new Object();A.printInfo.postParams="";A.printInfo.postParamsCont=0;D=new Object();D.height=H.printMapSize.height;D.width=H.printMapSize.width;l=H.paramsToPrintCount}if(H.printMapBaseLayer){k=H.printMapBaseLayer}}A.layers=[];var b;for(var I=0,J=this.layers.length;I<J;I++){b=this.layers[I].clone(null,n,H);A.layers.push(b);if(g){H.paramsToPrintCount+=b.printInfo.postParamsCont;A.printInfo.postParamsCont+=b.printInfo.postParamsCont}if(this.layers[I].getVisibility()){A.layers[A.layers.length-1].visibility=true}}A.map=null;var s,B,E,C,F,M,r,v,d,c,m;if(n||g){var f,u;mapResolution=k.map.getResolution();mapExtent=k.map.getExtent();for(var I=0,J=this.features.length;I<J;I++){if(n){this.features[I].clone=function(){clonedFeature=new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,OpenLayers.IAAA_Utils.cloneObject(this.attributes),OpenLayers.IAAA_Utils.cloneObject(this.style));if(this.data){clonedFeature.data=OpenLayers.IAAA_Utils.cloneObject(this.data)}return clonedFeature};A.features.push(this.features[I].clone())}if(g){m=this.features[I];c=l+A.printInfo.postParamsCont;var N;N=m.style||this.style;if(!N){N=this.styleMap.createSymbolizer(m,m.renderIntent)}if((m.geometry.CLASS_NAME=="OpenLayers.Geometry.Point")&&(!m.geometry.parent)){pxX=Math.round((1/mapResolution*(m.geometry.x-mapExtent.left)));pxY=Math.round((1/mapResolution*(mapExtent.top-m.geometry.y)));if((pxX>=0)&&(pxX<=D.width)&&(pxY>=0)&&(pxY<=D.height)){if(N.externalGraphic){A.printInfo.postParams+="&imageType_"+c+"=MAP_LAYER_IMAGE_SYMBOL";A.printInfo.postParams+="&imageURL_"+c+"="+OpenLayers.IAAA_Utils.processURL(N.externalGraphic,"http");E=pxX-(N.graphicWidth/2);C=pxY-(N.graphicHeight/2);A.printInfo.postParams+="&imagePixelX_"+c+"="+Math.round(E);A.printInfo.postParams+="&imagePixelY_"+c+"="+Math.round(C);A.printInfo.postParams+="&imageOriginalWidth_"+c+"="+Math.round(N.originalGraphicWidth?N.originalGraphicWidth:N.graphicWidth);A.printInfo.postParams+="&imageOriginalHeight_"+c+"="+Math.round(N.originalGraphicHeight?N.originalGraphicHeight:N.graphicHeight);A.printInfo.postParams+="&imagePrintWidth_"+c+"="+Math.round(N.graphicWidth);A.printInfo.postParams+="&imagePrintHeight_"+c+"="+Math.round(N.graphicHeight)}else{A.printInfo.postParams+="&geometryType_"+c+"=GEOMETRY_POINT";if(N.graphicWidth&&N.graphicHeight){A.printInfo.postParams+="&image_Width_"+c+"="+Math.round(N.graphicWidth);A.printInfo.postParams+="&image_Height_"+c+"="+Math.round(N.graphicHeight)}else{if(N.pointRadius){A.printInfo.postParams+="&image_Width_"+c+"="+parseInt(N.pointRadius)*2;A.printInfo.postParams+="&image_Height_"+c+"="+parseInt(N.pointRadius)*2}else{A.printInfo.postParams+="&image_Width_"+c+"=0";A.printInfo.postParams+="&image_Height_"+c+"=0"}}if(N.printLabel){A.printInfo.postParams+="&label_"+c+"="+N.printLabel;A.printInfo.postParams+="&labelColor_"+c+"="+N.fontColor;A.printInfo.postParams+="&labelFontFamily_"+c+"="+N.fontFamily;A.printInfo.postParams+="&labelFonSize_"+c+"="+N.fontSize}A.printInfo.postParams+="&imagePixel_X_"+c+"="+pxX;A.printInfo.postParams+="&imagePixel_Y_"+c+"="+pxY;F=N.fillColor;if(F.substring(0,3).toUpperCase()=="RGB"){M=F.substring(4,F.length-1);r=M.split(",");F=RGB2HTML(r[0],r[1],r[2])}A.printInfo.postParams+="&imagePixelColor_"+c+"="+F;var d=N.fillOpacity*256;if(d==0){d=N.strokeOpacity*256}A.printInfo.postParams+="&imagePixelOpacity_"+c+"="+Math.round(d);A.printInfo.postParams+="&imagePixelThickness_"+c+"="+N.strokeWidth;A.printInfo.postParams+="&imageBorderColor_"+c+"="+N.strokeColor}A.printInfo.postParamsCont++}}else{if(m.geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"){A.printInfo.postParams+="&geometryType_"+c+"=GEOMETRY_LINE";A.printInfo.postParams+="&imagePixelLength_"+c+"="+m.geometry.components.length;A.printInfo.postParams+="&imagePixelColor_"+c+"="+N.fillColor;A.printInfo.postParams+="&imagePixelThickness_"+c+"="+N.strokeWidth;if((N.strokeDashstyle!=null)&&(N.strokeDashstyle!=undefined)){if(N.strokeDashstyle.toUpperCase()=="DASH"){A.printInfo.postParams+="&imageLineDash_"+c+"=10"}else{if(N.strokeDashstyle.toUpperCase()=="DOT"){A.printInfo.postParams+="&imageLineDash_"+c+"="+N.strokeWidth+"_10"}}}for(var K=0,q=m.geometry.components.length;K<q;K++){v=m.geometry.components[K];pxX=Math.round((1/mapResolution*(v.x-mapExtent.left)));pxY=Math.round((1/mapResolution*(mapExtent.top-v.y)));A.printInfo.postParams+="&imagePixel_X_"+c+"_"+K+"="+pxX;A.printInfo.postParams+="&imagePixel_Y_"+c+"_"+K+"="+pxY}A.printInfo.postParamsCont++}else{if(m.geometry.CLASS_NAME=="OpenLayers.Geometry.Polygon"){A.printInfo.postParams+="&geometryType_"+c+"=GEOMETRY_POLYGON";A.printInfo.postParams+="&imagePixelLength_"+c+"="+m.geometry.components[0].components.length;A.printInfo.postParams+="&imagePixelColor_"+c+"="+N.fillColor;d=N.fillOpacity*256;if(d==0){d=N.strokeOpacity*256}A.printInfo.postParams+="&imagePixelOpacity_"+c+"="+Math.round(d);A.printInfo.postParams+="&imagePixelThickness_"+c+"="+N.strokeWidth;for(var K=0,q=m.geometry.components[0].components.length;K<q;K++){v=m.geometry.components[0].components[K];pxX=Math.round((1/mapResolution*(v.x-mapExtent.left)));pxY=Math.round((1/mapResolution*(mapExtent.top-v.y)));A.printInfo.postParams+="&imagePixel_X_"+c+"_"+K+"="+pxX;A.printInfo.postParams+="&imagePixel_Y_"+c+"_"+K+"="+pxY}A.printInfo.postParamsCont++}else{if(m.geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon"){for(var G=0,p=m.geometry.components.length;G<p;G++){A.printInfo.postParams+="&geometryType_"+c+"=GEOMETRY_POLYGON";A.printInfo.postParams+="&imagePixelLength_"+c+"="+m.geometry.components[G].components[0].components.length;A.printInfo.postParams+="&imagePixelColor_"+c+"="+N.fillColor;d=N.fillOpacity*256;if(d==0){d=N.strokeOpacity*256}A.printInfo.postParams+="&imagePixelOpacity_"+c+"="+Math.round(d);A.printInfo.postParams+="&imagePixelThickness_"+c+"="+N.strokeWidth;for(var K=0,q=m.geometry.components[G].components[0].components.length;K<q;K++){v=m.geometry.components[G].components[0].components[K];pxX=Math.round((1/mapResolution*(v.x-mapExtent.left)));pxY=Math.round((1/mapResolution*(mapExtent.top-v.y)));A.printInfo.postParams+="&imagePixel_X_"+c+"_"+K+"="+pxX;A.printInfo.postParams+="&imagePixel_Y_"+c+"_"+K+"="+pxY}A.printInfo.postParamsCont++}}}}}}}}if(this.scaleIcon){A.scaleIcon=this.scaleIcon}if(this.setIconsByScale){A.setIconsByScale=this.setIconsByScale}if(this.iconsScalesLimits){A.iconsScalesLimits=this.iconsScalesLimits}if(this.iconoGrandeList){A.iconoGrandeList=this.iconoGrandeList}if(this.iconoMedioList){A.iconoMedioList=this.iconoMedioList}if(this.iconoPeqList){A.iconoPeqList=this.iconoPeqList}if(this.poisIconsLibraryPath){A.poisIconsLibraryPath=this.poisIconsLibraryPath}if(this.dontCloneFeaturesInSrsChange){A.dontCloneFeaturesInSrsChange=this.dontCloneFeaturesInSrsChange}if(this.additionalInfo){A.additionalInfo=this.additionalInfo}return A},removeMap:function(b){this.removeAllLayers();OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},getTitle:function(){return this.title},getQueryable:function(){return false},setParent:function(b){this.parent=b},getParent:function(){return this.parent},getLayerList:function(){return this.layers},getLayer:function(c){var b;if((c>=0)&&(c<this.getLayerList().length)){b=this.getLayerList()[c]}return b},getLayerIndex:function(b,d){var c;for(c=0,len=this.getLayerList().length;c<len;c++){if((this.getLayer(c).name==b)&&(this.getLayer(c).title==d)){return c}}return -1},addLayer:function(c,b){c.mainLayer=false;c.nodeType="layer";this.map.addLayer(c);if(!b){this.getLayerList().push(c)}c.setParent(this);if(c.getVisibility()){this.setVisibility(true)}},addLayers:function(f,c){for(var d=0,b=f.length;d<b;d++){this.addLayer(f[d],c)}},removeLayer:function(c){var b=this.getLayer(c);if(b){this.childLayers.splice(c,1);if((this.map.destroying!=null)&&(this.map.destroying!=undefined)&&this.map.destroying){}else{b.parent.updateVisibility()}this.map.removeLayer(b)}},removeAllLayers:function(){var c=this.getLayerList();for(var b=c.length-1;b>=0;b--){this.removeLayer(b)}},interchangeLayers:function(b,j){var g=this.getLayerList()[b];var f=this.getLayerList()[j];this.getLayerList()[b]=f;this.getLayerList()[j]=g;var d=this.map.getLayerIndex(g);var c=this.map.getLayerIndex(f);this.map.layers[d]=f;this.map.layers[c]=g;this.map.resetLayersZIndex()},showLoading:function(){var b=this;while(b.getParent()){b=b.getParent()}OpenLayers.IAAA_ComplexTreeNode.prototype.showLoading.apply(b,[])},hideLoading:function(){var b=this;while(b.getParent()){b=b.getParent()}OpenLayers.IAAA_ComplexTreeNode.prototype.hideLoading.apply(b,[])},setVisibility:function(b){OpenLayers.Layer.Vector.prototype.setVisibility.apply(this,arguments);if(this.getParent()){this.getParent().updateVisibility()}},updateVisibility:function(){if(this.getLayerList()&&(this.getLayerList().length>0)){var d=false;for(var c=0,b=this.getLayerList().length;c<b;c++){d=d||this.getLayer(c).getVisibility();if(d){break}}this.setVisibility(d)}},CLASS_NAME:"OpenLayers.Layer.IAAA_GenericVector"});OpenLayers.Tile.IAAA_Image=OpenLayers.Class(OpenLayers.Tile.Image,{reloadTimeoutId:null,delayDisplay:true,initialize:function(g,b,j,d,f,c){OpenLayers.Tile.Image.prototype.initialize.apply(this,[g,b,j,d,f,c]);OpenLayers.Util.extend(this,c);this.events.register("loadend",null,this.onLoadHandler);if(OpenLayers.IAAA_Utils.drawTilesInSpecificDocument){this.frame=OpenLayers.IAAA_Utils.specificDocument.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute";this.initImgDiv=function(){var n=this.layer.imageOffset;var k=this.layer.getImageSize();if(this.layer.alpha){this.imgDiv=OpenLayers.IAAA_Utils.specificDocument.createElement("div");OpenLayers.Util.modifyDOMElement(this.imgDiv,OpenLayers.Util.createUniqueID("OpenLayersDiv"),null,null,"absolute",null,null,null);var m=OpenLayers.IAAA_Utils.specificDocument.createElement("img");var o=OpenLayers.Util.createUniqueID("OpenLayersDiv");OpenLayers.Util.modifyDOMElement(m,o,null,null,"relative",null,null,false);m.style.alt=o;m.galleryImg="no";this.imgDiv.appendChild(m);this.imgDiv.style.display="none";OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,this.imgDiv));OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,this.imgDiv));OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,n,k,null,"relative",null,null,null)}else{this.imgDiv=OpenLayers.IAAA_Utils.specificDocument.createElement("img");var o=OpenLayers.Util.createUniqueID("OpenLayersDiv");OpenLayers.Util.modifyDOMElement(this.imgDiv,o,n,k,"relative",null,null,null);this.imgDiv.style.display="none";OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,this.imgDiv));OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,this.imgDiv));this.imgDiv.style.alt=o;this.imgDiv.galleryImg="no"}this.imgDiv.className="olTileImage";this.imgDiv.setAttribute("unselectable","on");this.frame.setAttribute("unselectable","on");this.frame.style.MozUserSelect="none";this.imgDiv.tile=this;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map;var l=function(){if(!this.layer){return}if(this.layer.singleTile){OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size)}this.frame.style.display="block";if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}}}}},initImgDiv:function(){OpenLayers.Tile.Image.prototype.initImgDiv.apply(this,arguments);var b=function(){if((!this.layer.loaded)&&(this.layer.treeLoadImg)){this.layer.treeLoadImg.style.visibility="hidden";this.layer.treeLoadImg.style.display="none";this.layer.loaded=true}this.frame.style.display="block";this.imgDiv.style.display=""};OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(b,this));OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(b,this))},draw:function(){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)}if(this.layer.clearBeforeLoading){this.hide()}if(this.isLoading){this.events.triggerEvent("reload")}else{this.isLoading=true;this.events.triggerEvent("loadstart")}if(this.imgDiv==null){this.initImgDiv();var k=function(){try{if(this.imgDiv._attempts>OpenLayers.IAAA_IMAGE_RELOAD_ATTEMPTS){onload.call(this)}else{if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}}}catch(q){}};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(k,this))}this.imgDiv.viewRequestID=this.layer.map.viewRequestID;var g=new OpenLayers.Bounds();if(this.layer.map.projection!=this.layer.projection){g=this.bounds;punto=OpenLayers.IAAA_Utils.coordTransform(this.layer.map.projection,this.layer.projection,g.left,g.top);var f=punto[0];var n=punto[1];punto=OpenLayers.IAAA_Utils.coordTransform(this.layer.map.projection,this.layer.projection,g.right,g.bottom);var p=punto[0];var c=punto[1];punto=OpenLayers.IAAA_Utils.coordTransform(this.layer.map.projection,this.layer.projection,g.left,g.bottom);var d=punto[0];var b=punto[1];punto=OpenLayers.IAAA_Utils.coordTransform(this.layer.map.projection,this.layer.projection,g.right,g.top);var o=punto[0];var l=punto[1];g.left=((f+d)/2);g.bottom=((c+b)/2);g.right=((p+o)/2);g.top=((n+l)/2);g=this.layer.adjustBounds(g);var j=this.layer.getImageSize();var m;if(!this.layer.isLatLon()){m=this.encodeBBOX?g.toBBOX():g.toArray()}else{m=[g.bottom,g.left,g.top,g.right]}this.url=this.layer.getFullRequestString({BBOX:m,WIDTH:j.w,HEIGHT:j.h})}else{g=this.layer.adjustBounds(this.bounds);var j=this.layer.getImageSize();this.url=this.layer.getURL(this.bounds)}this.url=decodeURI(this.url);if(!this.layer.singleTile){OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size)}else{OpenLayers.Util.modifyDOMElement(this.frame,null,null,this.size)}var j=this.layer.getImageSize();if(this.layer.alpha){OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,j,this.url)}else{this.imgDiv.src=this.url;OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,j)}this.drawn=true;return true},onLoadHandler:function(){window.clearTimeout(this.reloadTimeoutId)},drawAux:function(){if(this.layer.clearBeforeLoading){this.clear()}var c=this.layer.maxExtent;var f=(c&&this.bounds.intersectsBounds(c,false));var b=this.layer.map.getExtent();var d=(b&&this.bounds.intersectsBounds(b,false));return((f||this.layer.displayOutsideMaxExtent)&&(d||(this.layer.buffer!=0)))},inverseMercator:function(b,f){var d=(b/20037508.34)*180;var c=(f/20037508.34)*180;c=180/Math.PI*(2*Math.atan(Math.exp(c*Math.PI/180))-Math.PI/2);return new OpenLayers.LonLat(d,c)},createDiv:function(){this.frame=document.createElement("div");this.frame.style.overflow="hidden";this.frame.style.position="absolute"},clearDiv:function(){if(this.imgDiv!=null){try{OpenLayers.Event.stopObservingElement(this.imgDiv.id)}catch(b){}if(this.imgDiv.parentNode==this.frame){this.frame.removeChild(this.imgDiv);this.imgDiv.map=null}}this.imgDiv=null;if((this.frame!=null)&&(this.frame.parentNode==this.layer.div)){this.layer.div.removeChild(this.frame)}this.frame=null},initImgDiv:function(){if(this.imgDiv==null){var d=this.layer.imageOffset;var b=this.size;if(this.layer.alpha){this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,d,b,null,"relative",null,null,null,this.delayDisplay)}else{this.imgDiv=OpenLayers.Util.createImage(null,d,b,null,"relative",null,null,this.delayDisplay)}this.imgDiv.className="olTileImage";this.imgDiv.setAttribute("unselectable","on");this.frame.setAttribute("unselectable","on");this.frame.style.MozUserSelect="none";this.imgDiv.tile=this;this.frame.appendChild(this.imgDiv);this.layer.div.appendChild(this.frame);if(this.layer.opacity!=null){OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity)}this.imgDiv.map=this.layer.map;var c=function(){if(!this.layer){return}if(this.layer.singleTile){OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size)}this.frame.style.display="block";if(this.isLoading){this.isLoading=false;this.events.triggerEvent("loadend")}};OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(c,this))}},moveTo:function(c,b,d){if(d==null){d=true}if(this.layer.clearBeforeLoading){this.clear()}this.bounds=c.clone();this.position=b.clone();if(d){this.draw()}},setImage:function(b,d,l){var f=this.imgDiv;var c=this.layer;var k=this.frame;var j=function(){if(c.alpha){f.style.visibility=l;c.div.style.display="";k.style.position="";k.style.overflow="";f.childNodes[0].style.visibility=l}else{f.style.visibility=l}};var g=new OpenLayers.Size(this.layer.getImageSize().w*this.layer.ratio,this.layer.getImageSize().h*this.layer.ratio);if(this.layer.alpha){this.imgDiv.childNodes[0].onload=j;OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,this.imgDiv.id,d,g,b,null,null,null,false)}else{this.imgDiv.onload=j;this.imgDiv.src=b;OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,g)}this.drawn=true},CLASS_NAME:"OpenLayers.Tile.IAAA_Image"});OpenLayers.Popup.IAAA_Anchored=OpenLayers.Class(OpenLayers.Popup.Anchored,{calculateNewPx:function(c){var j=c.offset(this.anchor.offset);var g=(this.relativePosition.charAt(0)=="t");var b=(this.contentSize.h!="auto")?this.contentSize.h:(((((this.contentHTML.length*6)+5)/140)+1)*2.5)+3;j.y+=(g)?-b:this.anchor.size.h;var f=(this.relativePosition.charAt(1)=="l");var d=(this.contentSize.w!="auto")?this.contentSize.w:((this.contentHTML.length*6)+5)+3;j.x+=(f)?-d:this.anchor.size.w;return j},setSize:function(b){if(b!=undefined){this.contentSize=b}if(this.div!=null){if(this.contentSize.w!="auto"){this.div.style.width=this.contentSize.w+"px"}else{this.div.style.width=this.contentSize.w}if(this.contentSize.h!="auto"){this.div.style.height=this.contentSize.h+"px"}else{this.div.style.height=this.contentSize.h}}if(this.contentDiv!=null){if(this.contentSize.w!="auto"){this.contentDiv.style.width=this.contentSize.w+"px"}else{this.contentDiv.style.width=this.contentSize.w}if(this.contentSize.h!="auto"){this.contentDiv.style.height=this.contentSize.h+"px"}else{this.contentDiv.style.height=this.contentSize.h}}},CLASS_NAME:"OpenLayers.Popup.IAAA_Anchored"});OpenLayers.Popup.IAAA_FramedCloud=OpenLayers.Class(OpenLayers.Popup.FramedCloud,{showShadow:false,popupImageSrc:null,shadowImageSrc:null,shadowBlocks:null,shadowRelX:10,shadowRelY:10,shadowOpacity:0.25,positionShadowBlocks:{},addLogo:false,logoImgSrc:null,logoSize:null,logoPosition:0,popupMargin:0,logoDiv:null,useLogoDivBackground:true,logoDivBackgroundColor:"white",useLogoMarginHeight:false,useLogoMarginWidth:true,imgLogo:null,imgLogoDiv:null,logoDivUseOpacity:true,closeImgSrc:null,imgCloseSize:null,imgCloseDiv:null,closeDivUseOpacity:true,stemSize:null,stemSizeOffsetLeft:0,stemSizeOffsetRight:0,stemImageOffset:null,stemDivOffset:null,shadowStemImageOffset:null,shadowStemDivOffset:null,popupDivOffset:null,blockOpacity:null,updateZIndex:false,zIndexChange:null,basePositionLeft:null,basePositionTop:null,useOpacityFilter:true,externDiv:false,blockPositionRightOffset:1238,blockPositionTopOffset:null,initialize:function(d,k,n,f,j,b,m,o){if(o&&(o.useOpacityfilter!=undefined)&&(o.useOpacityfilter!=null)){this.useOpacityfilter=o.useOpacityfilter}if(o&&(o.showShadow!=undefined)&&(o.showShadow!=null)){this.showShadow=o.showShadow}if(o&&(o.shadowOpacity!=undefined)&&(o.shadowOpacity!=null)){this.shadowOpacity=o.shadowOpacity}if(o&&(o.shadowRelX!=undefined)&&(o.shadowRelX!=null)){this.shadowRelX=o.shadowRelX}if(o&&(o.shadowRelY!=undefined)&&(o.shadowRelY!=null)){this.shadowRelY=o.shadowRelY}if(this.showShadow){if((o!=undefined)&&(o!=null)&&(o.shadowImageSrc!=undefined)&&(o.shadowImageSrc!=null)){if(o.shadowImageSrc.indexOf("http")==-1){this.shadowImageSrc=OpenLayers.Util.getImagesLocation()+o.shadowImageSrc}else{this.shadowImageSrc=o.shadowImageSrc}}else{this.shadowImageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-shadow.png"}}var l=f?f.replace("<a href=","<a target='_blank' href="):null;var l=f?f.replace("<A href=","<A target='_blank' href="):null;if((o!=undefined)&&(o!=null)&&(o.positionBlocks!=undefined)&&(o.positionBlocks!=null)){this.positionBlocks=this.clonePositionBlocks(o.positionBlocks)}if((o!=undefined)&&(o!=null)&&(o.popupImageSrc!=undefined)&&(o.popupImageSrc!=null)){if(o.popupImageSrc.slice(0,4)!="http"){if(o.popupImageSrc.slice(0,2)!="//"){this.imageSrc=OpenLayers.Util.getImagesLocation()+o.popupImageSrc}else{this.imageSrc=OpenLayers.IAAA_Utils.processURL(o.popupImageSrc)}}else{this.imageSrc=o.popupImageSrc}}else{this.imageSrc=OpenLayers.Util.getImagesLocation()+"cloud-popup-relative.png"}if((o!=undefined)&&(o!=null)&&(o.logoImgSrc!=undefined)&&(o.logoImgSrc!=null)){this.addLogo=true;if(o.logoImgSrc.slice(0,4)!="http"){if(o.logoImgSrc.slice(0,2)!="//"){this.logoImgSrc=OpenLayers.Util.getImagesLocation()+o.logoImgSrc}else{this.logoImgSrc=OpenLayers.IAAA_Utils.processURL(o.logoImgSrc)}}else{this.logoImgSrc=o.logoImgSrc}this.imgLogo=new Image();this.imgLogo.src=this.logoImgSrc}else{this.addLogo=false;this.logoImgSrc=null}var c=false;if(this.addLogo){if((o!=undefined)&&(o!=null)&&(o.logoPosition!=undefined)&&(o.logoPosition!=null)){this.logoPosition=o.logoPosition}else{this.logoPosition=3}if((o!=undefined)&&(o!=null)&&(o.useLogoDivBackground!=undefined)&&(o.useLogoDivBackground!=null)){this.useLogoDivBackground=o.useLogoDivBackground}if((o!=undefined)&&(o!=null)&&(o.logoDivBackgroundColor!=undefined)&&(o.logoDivBackgroundColor!=null)){this.logoDivBackgroundColor=o.logoDivBackgroundColor}this.popupMargin=10;if((o!=undefined)&&(o!=null)&&(o.logoSize!=undefined)&&(o.logoSize!=null)){this.logoSize=o.logoSize}else{if(this.imgLogo.width&&this.imgLogo.height){this.logoSize=new OpenLayers.Size(this.imgLogo.width,this.imgLogo.height)}else{this.logoSize=new OpenLayers.Size(0,0)}}if((this.logoSize.w==0)||(this.logoSize.h==0)){c=true}if((o!=undefined)&&(o!=null)&&(o.useLogoMarginWidth!=undefined)&&(o.useLogoMarginWidth!=null)){this.useLogoMarginWidth=o.useLogoMarginWidth}if((o!=undefined)&&(o!=null)&&(o.useLogoMarginHeight!=undefined)&&(o.useLogoMarginHeight!=null)){this.useLogoMarginHeight=o.useLogoMarginHeight}}else{this.logoPosition=0}if((o!=undefined)&&(o!=null)&&(o.popupMargin!=undefined)&&(o.popupMargin!=null)){this.popupMargin=o.popupMargin}if(b&&(o!=undefined)&&(o!=null)&&(o.closeImg!=undefined)&&(o.closeImg!=null)){if(o.closeImg.slice(0,4)!="http"){if(o.closeImg.slice(0,2)!="//"){this.closeImgSrc=OpenLayers.Util.getImagesLocation()+o.closeImg}else{this.closeImgSrc=OpenLayers.IAAA_Utils.processURL(o.closeImg)}}else{this.closeImgSrc=o.closeImg}if((o.imgCloseSize!=undefined)&&(o.imgCloseSize!=null)){this.imgCloseSize=o.imgCloseSize}else{this.imgCloseSize=new OpenLayers.Size(17,17)}}if(b&&(o!=undefined)&&(o!=null)&&(o.closeDivUseOpacity!=undefined)&&(o.closeDivUseOpacity!=null)){this.closeDivUseOpacity=o.closeDivUseOpacity}if((o!=undefined)&&(o!=null)&&(o.logoDivUseOpacity!=undefined)&&(o.logoDivUseOpacity!=null)){this.logoDivUseOpacity=o.logoDivUseOpacity}if(o&&(o.imageSize!=undefined)&&(o.imageSize!=null)){this.imageSize=new OpenLayers.Size(o.imageSize.w,o.imageSize.h)}if(o&&(o.maxSize!=undefined)&&(o.maxSize!=null)){this.maxSize=new OpenLayers.Size(o.maxSize.w,o.maxSize.h)}if(o&&(o.blockPositionRightOffset!=undefined)&&(o.blockPositionRightOffset!=null)){this.blockPositionRightOffset=o.blockPositionRightOffset;if(o&&(o.blockPositionTopOffset!=undefined)&&(o.blockPositionTopOffset!=null)){this.blockPositionTopOffset=o.blockPositionTopOffset}this.updatePositionBlocksPositionInitialOffsets(this.blockPositionRightOffset,this.blockPositionTopOffset)}if(o&&(o.autoSize!=undefined)&&(o.autoSize!=null)){this.autoSize=o.autoSize}if(o&&(o.fixedRelativePosition!=undefined)&&(o.fixedRelativePosition!=null)){if(o&&(o.relativePosition!=undefined)&&(o.relativePosition!=null)){this.relativePosition=o.relativePosition}this.fixedRelativePosition=o.fixedRelativePosition}OpenLayers.Popup.Framed.prototype.initialize.apply(this,[d,k,n,l,j,b,m]);if((o!=undefined)&&(o!=null)&&(o.keepInMap!=undefined)&&(o.keepInMap!=null)){this.keepInMap=o.keepInMap}if((o!=undefined)&&(o!=null)&&(o.panMapIfOutOfView!=undefined)&&(o.panMapIfOutOfView!=null)){this.panMapIfOutOfView=o.panMapIfOutOfView}if((o!=undefined)&&(o!=null)&&(o.opacity!=undefined)&&(o.opacity!=null)){this.opacity=o.opacity}if((o!=undefined)&&(o!=null)&&(o.stemImageOffset!=undefined)&&(o.stemImageOffset!=null)){this.stemImageOffset=o.stemImageOffset}this.positionBlocks=this.initPositionBlocks();if((o!=undefined)&&(o!=null)&&(o.stemSize!=undefined)&&(o.stemSize!=null)){if((this.stemImageOffset==null)||(this.stemImageOffset==undefined)){this.stemSize=o.stemSize}for(var g in this.positionBlocks){this.positionBlocks[g]["blocks"][4]["size"]=new OpenLayers.Size(o.stemSize.w,o.stemSize.h);if((this.stemImageOffset==null)||(this.stemImageOffset==undefined)){switch(g){case"tl":this.positionBlocks[g]["blocks"][4]["anchor"]=new OpenLayers.Bounds(null,0,o.stemSize.w,null);break;case"tr":this.positionBlocks[g]["blocks"][4]["anchor"]=new OpenLayers.Bounds(o.stemSize.w,0,null,null);break;case"bl":this.positionBlocks[g]["blocks"][4]["anchor"]=new OpenLayers.Bounds(null,null,o.stemSize.w,0);break;case"br":this.positionBlocks[g]["blocks"][4]["anchor"]=new OpenLayers.Bounds(o.stemSize.w,null,null,0);break;default:break}}}if((o.stemSizeOffsetLeft!=undefined)&&(o.stemSizeOffsetLeft!=null)){this.stemSizeOffsetLeft=o.stemSizeOffsetLeft}if((o.stemSizeOffsetRight!=undefined)&&(o.stemSizeOffsetRight!=null)){this.stemSizeOffsetRight=o.stemSizeOffsetRight}}if((o!=undefined)&&(o!=null)&&(o.stemDivOffset!=undefined)&&(o.stemDivOffset!=null)){this.stemDivOffset=o.stemDivOffset}if((o!=undefined)&&(o!=null)&&(o.shadowStemImageOffset!=undefined)&&(o.shadowStemImageOffset!=null)){this.shadowStemImageOffset=o.shadowStemImageOffset}if((o!=undefined)&&(o!=null)&&(o.shadowStemDivOffset!=undefined)&&(o.shadowStemDivOffset!=null)){this.shadowStemDivOffset=o.shadowStemDivOffset}if((o!=undefined)&&(o!=null)&&(o.popupDivOffset!=undefined)&&(o.popupDivOffset!=null)){this.popupDivOffset=o.popupDivOffset}if((o!=undefined)&&(o!=null)&&(o.blockOpacity!=undefined)&&(o.blockOpacity!=null)){this.blockOpacity=o.blockOpacity}if((o!=undefined)&&(o!=null)&&(this.updateZIndex!=null)&&(this.updateZIndex!=undefined)){this.updateZIndex=o.updateZIndex;if(this.updateZIndex&&(o.zIndexChange!=null)&&(o.zIndexChange!=undefined)){this.zIndexChange=o.zIndexChange}}this.contentDiv.className=this.contentDisplayClass;if(this.showShadow){this.initPositionShadowBlocks();if((o!=undefined)&&(o!=null)&&(o.stemSize!=undefined)&&(o.stemSize!=null)){for(var g in this.positionShadowBlocks){this.positionShadowBlocks[g]["blocks"][4]["size"]=new OpenLayers.Size(o.stemSize.w,o.stemSize.h);if((this.shadowStemImageOffset==null)||(this.shadowStemImageOffset==undefined)){switch(g){case"tl":this.positionShadowBlocks[g]["blocks"][4]["anchor"]=new OpenLayers.Bounds(null,0,o.stemSize.w,null);break;case"tr":this.positionShadowBlocks[g]["blocks"][4]["anchor"]=new OpenLayers.Bounds(o.stemSize.w,0,null,null);break;case"bl":this.positionShadowBlocks[g]["blocks"][4]["anchor"]=new OpenLayers.Bounds(null,null,o.stemSize.w,0);break;case"br":this.positionShadowBlocks[g]["blocks"][4]["anchor"]=new OpenLayers.Bounds(o.stemSize.w,null,null,0);break;default:break}}}}}if(this.autoSize){this.updateSize()}if(c){OpenLayers.Event.observe(this.imgLogoDiv,"load",OpenLayers.Function.bind(this.updateLogoImageInfo,this))}},initPositionBlocks:function(){return{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}}},updateDivPosition:function(){if(this.map&&this.basePositionLeft&&this.basePositionTop){var c=0;var b=0;if((this.relativePosition!=null)&&(this.relativePosition!=undefined)){if((this.popupDivOffset!=null)&&(this.popupDivOffset!=undefined)&&(this.popupDivOffset[this.relativePosition]!=null)&&(this.popupDivOffset[this.relativePosition]!=undefined)){if((this.popupDivOffset[this.relativePosition].left!=undefined)&&(this.popupDivOffset[this.relativePosition].left!=null)){c=this.popupDivOffset[this.relativePosition].left}if((this.popupDivOffset[this.relativePosition].top!=undefined)&&(this.popupDivOffset[this.relativePosition].top!=null)){b=this.popupDivOffset[this.relativePosition].top}}}this.div.style.left=(this.basePositionLeft-parseInt(this.div.parentNode.style.left)+c)+"px";this.div.style.top=(this.basePositionTop-parseInt(this.div.parentNode.style.top)+b)+"px"}},updateLogoImageInfo:function(){this.logoSize.w=this.imgLogo.width;this.logoSize.h=this.imgLogo.height;this.imgLogoDiv.style.width=this.logoSize.w+"px";this.imgLogoDiv.style.height=this.logoSize.h+"px";this.updateSize();if(this.externDiv){this.updateDivPosition()}if(this.updateZIndex){this.updatePopupZIndexes()}OpenLayers.Event.stopObservingElement(this.imgLogoDiv)},initPositionShadowBlocks:function(){this.positionShadowBlocks={tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-this.blockPositionRightOffset,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,32,80,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-this.blockPositionRightOffset,-629)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-668)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-this.blockPositionRightOffset,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-this.blockPositionRightOffset,-629)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-668)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-this.blockPositionRightOffset,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-this.blockPositionRightOffset,-629)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-this.blockPositionRightOffset,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-this.blockPositionRightOffset,-629)},{size:new OpenLayers.Size(81,54),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}}},createBlocks:function(){if(this.showShadow){this.shadowBlocks=[];var m=null;for(var l in this.positionShadowBlocks){m=l;break}if(m!=null){var f=this.positionShadowBlocks[m];for(var d=0;d<f.blocks.length;d++){var c={};this.shadowBlocks.push(c);var k=this.id+"_FrameShadowDecorationDiv_"+d;c.div=OpenLayers.Util.createDiv(k,null,null,null,"absolute",null,"hidden",null);var b=this.id+"_FrameShadowDecorationImg_"+d;var g=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;if((this.shadowOpacity<1)||this.useOpacityFilter){c.image=g(b,null,this.imageSize,this.shadowImageSrc,"absolute",null,this.shadowOpacity,null)}else{c.image=g(b,null,this.imageSize,this.shadowImageSrc,"absolute",null,null,null)}c.div.appendChild(c.image);if(this.groupDiv){this.groupDiv.appendChild(c.div)}}}}this.blocks=[];var m=null;for(var l in this.positionBlocks){m=l;break}if(m!=null){var f=this.positionBlocks[m];for(var d=0;d<f.blocks.length;d++){var c={};this.blocks.push(c);var k=this.id+"_FrameDecorationDiv_"+d;c.div=OpenLayers.Util.createDiv(k,null,null,null,"absolute",null,"hidden",null);var b=this.id+"_FrameDecorationImg_"+d;var g=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;c.image=g(b,null,this.imageSize,this.imageSrc,"absolute",null,null,null);c.div.appendChild(c.image);if(this.groupDiv){this.groupDiv.appendChild(c.div)}}if(this.addLogo){var g=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;k=this.id+"_FrameLogoDiv";this.logoDiv=OpenLayers.Util.createDiv(k,null,null,null,"absolute",null,"hidden",null);b=this.id+"_FrameLogoDivImg";this.imgLogoDiv=g(b,null,this.logoSize,this.logoImgSrc,"relative",null,null,true);if((this.useLogoDivBackground!=null)&&(this.useLogoDivBackground!=undefined)&&(this.useLogoDivBackground)&&(this.logoDivBackgroundColor!=null)&&(this.logoDivBackgroundColor!=undefined)&&((typeof this.logoDivBackgroundColor).toLowerCase()=="string")){try{this.logoDiv.style.background=this.logoDivBackgroundColor}catch(j){this.logoDiv.style.setAttribute("background",this.logoDivBackgroundColor)}}this.logoDiv.appendChild(this.imgLogoDiv);if(this.groupDiv){this.groupDiv.appendChild(this.logoDiv)}}}},moveTo:function(b){OpenLayers.Popup.Anchored.prototype.moveTo.apply(this,arguments);var c=0;var d=0;if((this.relativePosition!=null)&&(this.relativePosition!=undefined)){if((this.popupDivOffset!=null)&&(this.popupDivOffset!=undefined)&&(this.popupDivOffset[this.relativePosition]!=null)&&(this.popupDivOffset[this.relativePosition]!=undefined)){if((this.popupDivOffset[this.relativePosition].left!=undefined)&&(this.popupDivOffset[this.relativePosition].left!=null)){d=this.popupDivOffset[this.relativePosition].left}if((this.popupDivOffset[this.relativePosition].top!=undefined)&&(this.popupDivOffset[this.relativePosition].top!=null)){c=this.popupDivOffset[this.relativePosition].top}}}this.div.style.left=(parseInt(this.div.style.left)+d)+"px";this.div.style.top=(parseInt(this.div.style.top)+c)+"px";this.basePositionLeft=parseInt(this.div.style.left);this.basePositionTop=parseInt(this.div.style.top)},updateBlocks:function(){if(!this.blocks){this.createBlocks()}this.updatePositionBlocksPositionInitialOffsets(this.blockPositionRightOffset,this.blockPositionTopOffset);if(this.size&&this.relativePosition){var H=this.positionBlocks[this.relativePosition];var g,v;for(var A=0;A<H.blocks.length;A++){var c=H.blocks[A];var m=this.blocks[A];var u=c.anchor.left;var F=c.anchor.bottom;var q=c.anchor.right;var o=c.anchor.top;var n=(isNaN(c.size.w))?this.size.w-(q+u):c.size.w;var B=(isNaN(c.size.h))?this.size.h-(F+o):c.size.h;m.div.style.width=(n<0?0:n)+"px";m.div.style.height=(B<0?0:B)+"px";var k=0;var C=0;var E=0;var G=0;if((this.stemDivOffset!=null)&&(this.stemDivOffset!=undefined)&&(A==4)){if((this.stemDivOffset[this.relativePosition]!=null)&&(this.stemDivOffset[this.relativePosition]!=undefined)){if((this.stemDivOffset[this.relativePosition].left!=undefined)&&(this.stemDivOffset[this.relativePosition].left!=null)){k=this.stemDivOffset[this.relativePosition].left}if((this.stemDivOffset[this.relativePosition].top!=undefined)&&(this.stemDivOffset[this.relativePosition].top!=null)){C=this.stemDivOffset[this.relativePosition].top}if((this.stemDivOffset[this.relativePosition].right!=undefined)&&(this.stemDivOffset[this.relativePosition].right!=null)){E=this.stemDivOffset[this.relativePosition].right}if((this.stemDivOffset[this.relativePosition].bottom!=undefined)&&(this.stemDivOffset[this.relativePosition].bottom!=null)){G=this.stemDivOffset[this.relativePosition].bottom}}}m.div.style.left=(u!=null)?(u+k)+"px":"";m.div.style.bottom=(F!=null)?(F+G)+"px":"";m.div.style.right=(q!=null)?(q+E)+"px":"";m.div.style.top=(o!=null)?(o+C)+"px":"";if((m.div!=null)&&(this.opacity!=null)&&(this.opacity!=undefined)){if((this.opacity<1)||this.useOpacityFilter){m.div.style.opacity=this.opacity;m.div.style.filter="alpha(opacity="+this.opacity*100+")"}}if((A==4)&&(this.blockOpacity!=null)&&(this.blockOpacity!=undefined)&&(this.blockOpacity.stem!=null)&&(this.blockOpacity.stem!=undefined)){if((this.blockOpacity.stem<1)||this.useOpacityFilter){m.div.style.opacity=this.blockOpacity.stem;m.div.style.filter="alpha(opacity="+this.blockOpacity.stem*100+")"}}m.image.style.left=c.position.x+"px";m.image.style.top=c.position.y+"px";if((this.stemSize!=null)&&(this.stemSize!=undefined)&&(A==4)){switch(this.relativePosition){case"tr":case"br":m.image.style.left=c.position.x-this.stemSize.w-this.stemSizeOffsetRight+"px";break;case"tl":case"bl":m.image.style.left=c.position.x-this.stemSize.w-this.stemSizeOffsetLeft+"px";break;default:break}}if((this.stemImageOffset!=null)&&(this.stemImageOffset!=undefined)&&(A==4)){if((this.stemImageOffset[this.relativePosition]!=null)&&(this.stemImageOffset[this.relativePosition]!=undefined)){if((this.stemImageOffset[this.relativePosition].left!=undefined)&&(this.stemImageOffset[this.relativePosition].left!=null)){m.image.style.left=c.position.x+this.stemImageOffset[this.relativePosition].left+"px"}if((this.stemImageOffset[this.relativePosition].top!=undefined)&&(this.stemImageOffset[this.relativePosition].top!=null)){m.image.style.top=c.position.y+this.stemImageOffset[this.relativePosition].top+"px"}}}if((this.addLogo)&&(A==this.logoPosition)){this.logoDiv.align="center";if(this.logoSize!=null){this.logoDiv.style.width=this.logoSize.w+((this.useLogoDivBackground)?2:0);this.logoDiv.style.height=this.logoSize.h+((this.useLogoDivBackground)?2:0)}this.logoDiv.style.left=m.div.style.left;this.logoDiv.style.bottom=m.div.style.bottom;this.logoDiv.style.right=m.div.style.right;this.logoDiv.style.top=m.div.style.top;if(this.useLogoDivBackground){this.imgLogoDiv.style.top=1}var s;switch(this.logoPosition){case 0:if((typeof this.logoDiv.style.left).toLowerCase()=="string"){s=parseInt(this.logoDiv.style.left.substring(0,(this.logoDiv.style.left.indexOf("px"))));this.logoDiv.style.left=s+this.popupMargin+"px"}else{this.logoDiv.style.left+=this.popupMargin}if((typeof this.logoDiv.style.top).toLowerCase()=="string"){s=parseInt(this.logoDiv.style.top.substring(0,(this.logoDiv.style.top.indexOf("px"))));this.logoDiv.style.top=s+this.popupMargin+"px"}else{this.logoDiv.style.top+=this.popupMargin}break;case 1:if((typeof this.logoDiv.style.right).toLowerCase()=="string"){s=parseInt(this.logoDiv.style.right.substring(0,(this.logoDiv.style.right.indexOf("px"))));this.logoDiv.style.right=s+this.popupMargin+"px"}else{this.logoDiv.style.right+=this.popupMargin}if((typeof this.logoDiv.style.top).toLowerCase()=="string"){s=parseInt(this.logoDiv.style.top.substring(0,(this.logoDiv.style.top.indexOf("px"))));this.logoDiv.style.top=s+this.popupMargin+"px"}else{this.logoDiv.style.top+=this.popupMargin}break;case 2:if((typeof this.logoDiv.style.left).toLowerCase()=="string"){s=parseInt(this.logoDiv.style.left.substring(0,(this.logoDiv.style.left.indexOf("px"))));this.logoDiv.style.left=s+this.popupMargin+"px"}else{this.logoDiv.style.left+=this.popupMargin}if((typeof this.logoDiv.style.bottom).toLowerCase()=="string"){s=parseInt(this.logoDiv.style.bottom.substring(0,(this.logoDiv.style.bottom.indexOf("px"))));this.logoDiv.style.bottom=s+this.popupMargin+"px"}else{this.logoDiv.style.bottom+=this.popupMargin}break;case 3:if((typeof this.logoDiv.style.bottom).toLowerCase()=="string"){s=parseInt(this.logoDiv.style.bottom.substring(0,(this.logoDiv.style.bottom.indexOf("px"))));this.logoDiv.style.bottom=s+this.popupMargin+"px"}else{this.logoDiv.style.bottom+=this.popupMargin}if((typeof this.logoDiv.style.right).toLowerCase()=="string"){s=parseInt(this.logoDiv.style.right.substring(0,(this.logoDiv.style.right.indexOf("px"))));this.logoDiv.style.right=s+this.popupMargin+"px"}else{this.logoDiv.style.right+=this.popupMargin}break;default:break}if(this.logoDivUseOpacity&&(this.opacity!=null)&&(this.opacity!=undefined)){if((this.opacity<1)||this.useOpacityFilter){this.logoDiv.style.opacity=this.opacity;this.logoDiv.style.filter="alpha(opacity="+this.opacity*100+")"}}}}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}if(this.closeDivUseOpacity&&(this.closeDiv!=null)&&(this.closeDiv!=undefined)&&(this.opacity!=null)&&(this.opacity!=undefined)){if((this.opacity<1)||this.useOpacityFilter){this.closeDiv.style.opacity=this.opacity;this.closeDiv.style.filter="alpha(opacity="+this.opacity*100+")"}}if(this.showShadow){if(this.relativePosition){var H=this.positionShadowBlocks[this.relativePosition];var c,m,f,d,j,D,p;var k,C,E,G;for(var A=0;A<H.blocks.length;A++){c=H.blocks[A];m=this.blocks[A];f=this.shadowBlocks[A];d=((m.div.style.left!=null)&&(m.div.style.left!=undefined)?m.div.style.left:"");j=((m.div.style.bottom!=null)&&(m.div.style.bottom!=undefined)?m.div.style.bottom:"");D=((m.div.style.right!=null)&&(m.div.style.right!=undefined)?m.div.style.right:"");p=((m.div.style.top!=null)&&(m.div.style.top!=undefined)?m.div.style.top:"");f.div.style.width=m.div.style.width;f.div.style.height=m.div.style.height;k=0;C=0;E=0;G=0;if((this.stemDivOffset!=null)&&(this.stemDivOffset!=undefined)&&(A==4)){if((this.stemDivOffset[this.relativePosition]!=null)&&(this.stemDivOffset[this.relativePosition]!=undefined)){if((this.stemDivOffset[this.relativePosition].left!=undefined)&&(this.stemDivOffset[this.relativePosition].left!=null)){k-=this.stemDivOffset[this.relativePosition].left}if((this.stemDivOffset[this.relativePosition].top!=undefined)&&(this.stemDivOffset[this.relativePosition].top!=null)){C-=this.stemDivOffset[this.relativePosition].top}if((this.stemDivOffset[this.relativePosition].right!=undefined)&&(this.stemDivOffset[this.relativePosition].right!=null)){E-=this.stemDivOffset[this.relativePosition].right}if((this.stemDivOffset[this.relativePosition].bottom!=undefined)&&(this.stemDivOffset[this.relativePosition].bottom!=null)){G-=this.stemDivOffset[this.relativePosition].bottom}}}if((this.shadowStemDivOffset!=null)&&(this.shadowStemDivOffset!=undefined)&&(A==4)){if((this.shadowStemDivOffset[this.relativePosition]!=null)&&(this.shadowStemDivOffset[this.relativePosition]!=undefined)){if((this.shadowStemDivOffset[this.relativePosition].left!=undefined)&&(this.shadowStemDivOffset[this.relativePosition].left!=null)){k+=this.shadowStemDivOffset[this.relativePosition].left}if((this.shadowStemDivOffset[this.relativePosition].top!=undefined)&&(this.shadowStemDivOffset[this.relativePosition].top!=null)){C+=this.shadowStemDivOffset[this.relativePosition].top}if((this.shadowStemDivOffset[this.relativePosition].right!=undefined)&&(this.shadowStemDivOffset[this.relativePosition].right!=null)){E+=this.shadowStemDivOffset[this.relativePosition].right}if((this.shadowStemDivOffset[this.relativePosition].bottom!=undefined)&&(this.shadowStemDivOffset[this.relativePosition].bottom!=null)){G+=this.shadowStemDivOffset[this.relativePosition].bottom}}}f.div.style.left=((d!="")?(parseInt(d)-this.shadowRelX+k)+"px":d);f.div.style.bottom=((j!="")?(parseInt(j)-this.shadowRelY+G)+"px":j);f.div.style.right=((D!="")?(parseInt(D)+this.shadowRelX+E)+"px":D);f.div.style.top=((p!="")?(parseInt(p)+this.shadowRelY+C)+"px":p);f.image.style.left=m.image.style.left;f.image.style.top=m.image.style.top;if((this.stemImageOffset!=null)&&(this.stemImageOffset!=undefined)&&(A==4)){if((this.stemImageOffset[this.relativePosition]!=null)&&(this.stemImageOffset[this.relativePosition]!=undefined)){if((this.stemImageOffset[this.relativePosition].left!=undefined)&&(this.stemImageOffset[this.relativePosition].left!=null)){f.image.style.left=parseInt(f.image.style.left)-this.stemImageOffset[this.relativePosition].left+"px"}if((this.stemImageOffset[this.relativePosition].top!=undefined)&&(this.stemImageOffset[this.relativePosition].top!=null)){f.image.style.top=parseInt(f.image.style.top)-this.stemImageOffset[this.relativePosition].top+"px"}}}if((this.shadowStemImageOffset!=null)&&(this.shadowStemImageOffset!=undefined)&&(A==4)){if((this.shadowStemImageOffset[this.relativePosition]!=null)&&(this.shadowStemImageOffset[this.relativePosition]!=undefined)){if((this.shadowStemImageOffset[this.relativePosition].left!=undefined)&&(this.shadowStemImageOffset[this.relativePosition].left!=null)){f.image.style.left=parseInt(f.image.style.left)+this.shadowStemImageOffset[this.relativePosition].left+"px"}if((this.shadowStemImageOffset[this.relativePosition].top!=undefined)&&(this.shadowStemImageOffset[this.relativePosition].top!=null)){f.image.style.top=parseInt(f.image.style.top)+this.shadowStemImageOffset[this.relativePosition].top+"px"}}}if((f.div!=null)&&(this.shadowOpacity!=null)&&(this.shadowOpacity!=undefined)){if((this.shadowOpacity<1)||this.useOpacityFilter){f.div.style.opacity=this.shadowOpacity;f.div.style.filter="alpha(opacity="+this.shadowOpacity*100+")"}}}}this.contentDiv.parentNode.style.overflowX="visible";this.contentDiv.parentNode.style.overflowY="visible";this.contentDiv.parentNode.parentNode.style.overflowX="visible";this.contentDiv.parentNode.parentNode.style.overflowY="visible"}},hide:function(){this.map.removePopup(this)},panIntoView:function(){var g=this.map.getSize();var f=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));var d=f.clone();if(f.x<this.map.paddingForPopups.left){d.x=this.map.paddingForPopups.left}else{if((f.x+this.size.w)>(g.w-this.map.paddingForPopups.right)){d.x=g.w-this.map.paddingForPopups.right-this.size.w}}if(f.y<this.map.paddingForPopups.top){d.y=this.map.paddingForPopups.top}else{if((f.y+this.size.h)>(g.h-this.map.paddingForPopups.bottom)){d.y=g.h-this.map.paddingForPopups.bottom-this.size.h}}var c=f.x-d.x;var b=f.y-d.y;if((c!=0)||(b!=0)){this.map.pan(c,b)}},getSafeContentSize:function(r){var g=r.clone();var p=this.getContentDivPadding();var q=0;var n=0;if(p){q=(p.left?p.left:0)+(p.right?p.right:0);n=(p.top?p.top:0)+(p.bottom?p.bottom:0)}this.fixPadding();q+=((this.padding&&this.padding.left)?this.padding.left:0)+((this.padding&&this.padding.right)?this.padding.right:0);n+=((this.padding&&this.padding.top)?this.padding.top:0)+((this.padding&&this.padding.bottom)?this.padding.bottom:0);if(this.closeDiv){var d=parseInt(this.closeDiv.style.width);q+=d+p.right}if(this.minSize){g.w=Math.max(g.w,(this.minSize.w-q));g.h=Math.max(g.h,(this.minSize.h-n))}if(this.maxSize){g.w=Math.min(g.w,(this.maxSize.w-q));g.h=Math.min(g.h,(this.maxSize.h-n))}if(this.map&&this.map.size){var m=0,j=0;if(this.keepInMap&&!this.panMapIfOutOfView){var o=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":m=o.x;j=this.map.size.h-o.y;break;case"tl":m=this.map.size.w-o.x;j=this.map.size.h-o.y;break;case"bl":m=this.map.size.w-o.x;j=o.y;break;case"br":m=o.x;j=o.y;break;default:m=o.x;j=this.map.size.h-o.y;break}}var l=this.map.size;var f;if((typeof this.map.size.h).toLowerCase()=="string"){f=parseInt(l.h.substring(0,(l.h.indexOf("px"))))}else{f=l.h}var k;if((typeof this.map.size.w).toLowerCase()=="string"){k=parseInt(l.w.substring(0,(l.w.indexOf("px"))))}else{k=l.w}var b=f-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-n-j;var c=k-this.map.paddingForPopups.left-this.map.paddingForPopups.right-q-m;g.w=Math.min(g.w,c);g.h=Math.min(g.h,b)}return g},setOpacity:function(b){},setSize:function(j){this.size=j.clone();var g=this.getContentDivPadding();var c=0;var l=0;if(g){c=(g.left?g.left:0)+(g.right?g.right:0);l=(g.top?g.top:0)+(g.bottom?g.bottom:0)}this.fixPadding();c+=((this.padding&&this.padding.left)?this.padding.left:0)+((this.padding&&this.padding.right)?this.padding.right:0);l+=((this.padding&&this.padding.top)?this.padding.top:0)+((this.padding&&this.padding.bottom)?this.padding.bottom:0);var k=0;if(this.closeDiv){k=parseInt(this.closeDiv.style.width);c+=k+g.right}this.size.w+=c;this.size.h+=l;var f=((this.addLogo&&(this.logoSize!=null))?this.logoSize.h:0)+((this.useLogoDivBackground)?2:0)+((this.closeDiv)?parseInt(this.closeDiv.style.height):0)+((this.closeDiv&&this.addLogo)?2:0);if(this.logoSize){if(this.useLogoMarginWidth){this.size.w+=((this.popupMargin)?(this.popupMargin):0)}if(this.useLogoMarginHeight){this.size.h+=((this.popupMargin)?(this.popupMargin):0)}this.size.w+=((this.addLogo)?(((this.useLogoMarginWidth)?((this.logoSize.w>k)?this.logoSize.w-k:k-this.logoSize.w):0)+((this.useLogoDivBackground)?2:0)):0);this.size.h+=((this.addLogo)?(((this.useLogoMarginHeight)?this.logoSize.h:0)+((this.useLogoDivBackground)?2:0)):0)}if(OpenLayers.Util.getBrowserName()=="msie"){this.contentSize.w+=g.left+g.right+"px";this.contentSize.h+=g.bottom+g.top+"px"}if(this.contentDiv!=null){this.contentDiv.style.width=j.w+"px";this.contentDiv.style.height=j.h+"px";var d=parseInt(this.contentDiv.style.height);if(d<f){this.size.h+=(f-d-((this.popupMargin)?(this.popupMargin):0)+((this.addLogo)?4:0))}}if(this.div!=null){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if((this.lonlat)&&(this.map)){var b=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(b)}this.updateBlocks()},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=false;this.positionBlocks=null;if(this.blocks){for(var b=0;b<this.blocks.length;b++){var c=this.blocks[b];if(c.image){c.div.removeChild(c.image)}c.image=null;if(c.div){if(this.groupDiv){this.groupDiv.removeChild(c.div)}}c.div=null}}this.blocks=null;if((this.logoDiv!=null)&&(this.logoDiv!=undefined)){if((this.imgLogoDiv!=null)&&(this.imgLogoDiv!=undefined)){this.logoDiv.removeChild(this.imgLogoDiv);this.imgLogoDiv=null}if(this.groupDiv){this.groupDiv.removeChild(this.logoDiv)}this.logoDiv=null;this.imgLogo=null}if(this.closeDiv){if(this.imgCloseDiv){this.closeDiv.removeChild(this.imgCloseDiv);this.imgCloseDiv=null}}OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},addCloseBox:function(d){OpenLayers.Popup.prototype.addCloseBox.apply(this,arguments);if(this.closeImgSrc!=null){this.closeDiv.className=undefined;this.closeDiv.style.cursor="pointer";var c=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;var b=this.id+"_ClosePopupImg";this.imgCloseDiv=c(b,null,this.imgCloseSize,this.closeImgSrc,"absolute",null,null,null);this.closeDiv.appendChild(this.imgCloseDiv)}},updatePopupZIndexes:function(){var c=this.div.style.zIndex;this.div.style.zIndex="";this.contentDiv.style.zIndex=parseInt(this.contentDiv.style.zIndex)+parseInt(((this.zIndexChange)?this.zIndexChange:c));var d;for(var b=0;b<this.blocks.length;b++){d=this.blocks[b];if(d.div){d.div.style.zIndex=((this.zIndexChange)?parseInt(this.zIndexChange):parseInt(c))}}if(this.showShadow){for(var b=0;b<this.shadowBlocks.length;b++){d=this.shadowBlocks[b];if(d.div){d.div.style.zIndex=((this.zIndexChange)?parseInt(this.zIndexChange):parseInt(c))}}}if(this.closeDiv){this.closeDiv.style.zIndex=parseInt(this.closeDiv.style.zIndex)+parseInt(((this.zIndexChange)?this.zIndexChange:c))}if(this.addLogo){this.logoDiv.style.zIndex=parseInt(((this.zIndexChange)?this.zIndexChange:c))+1}},registerImageListeners:function(){var j=function(){if(this.popup){this.popup.updateSize();if(this.popup.externDiv){this.popup.updateDivPosition()}if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)}};var c=this.contentDiv.getElementsByTagName("img");for(var g=0,b=c.length;g<b;g++){var d=c[g];if(d.width==0||d.height==0){var f={popup:this,img:d};d._onImgLoad=OpenLayers.Function.bind(j,f);OpenLayers.Event.observe(d,"load",d._onImgLoad)}}},clonePositionBlocks:function(f){var g={};for(i in f){g[i]={};if(f[i]["offset"]){g[i]["offset"]=f[i]["offset"].clone()}if(f[i]["padding"]){g[i]["padding"]=f[i]["padding"].clone()}if(f[i]["blocks"]){g[i]["blocks"]=new Array();var d;for(var c in f[i]["blocks"]){d={};for(var b in f[i]["blocks"][c]){d[b]=f[i]["blocks"][c][b].clone()}g[i]["blocks"].push(d)}}}return g},updatePositionBlocksPositionInitialOffsets:function(d,c){if(this.positionBlocks&&this.positionBlocks.tl["blocks"]&&this.positionBlocks.tl["blocks"][0]&&this.positionBlocks.tl["blocks"][0]["position"]&&this.positionBlocks.tl["blocks"][1]&&this.positionBlocks.tl["blocks"][1]["position"]&&this.positionBlocks.tl["blocks"][2]&&this.positionBlocks.tl["blocks"][2]["position"]&&this.positionBlocks.tl["blocks"][3]&&this.positionBlocks.tl["blocks"][3]["position"]&&this.positionBlocks.tl["blocks"][4]&&this.positionBlocks.tl["blocks"][4]["position"]&&this.positionBlocks.tr["blocks"]&&this.positionBlocks.tr["blocks"][0]&&this.positionBlocks.tr["blocks"][0]["position"]&&this.positionBlocks.tr["blocks"][1]&&this.positionBlocks.tr["blocks"][1]["position"]&&this.positionBlocks.tr["blocks"][2]&&this.positionBlocks.tr["blocks"][2]["position"]&&this.positionBlocks.tr["blocks"][3]&&this.positionBlocks.tr["blocks"][3]["position"]&&this.positionBlocks.tr["blocks"][4]&&this.positionBlocks.tr["blocks"][4]["position"]&&this.positionBlocks.bl["blocks"]&&this.positionBlocks.bl["blocks"][0]&&this.positionBlocks.bl["blocks"][0]["position"]&&this.positionBlocks.bl["blocks"][1]&&this.positionBlocks.bl["blocks"][1]["position"]&&this.positionBlocks.bl["blocks"][2]&&this.positionBlocks.bl["blocks"][2]["position"]&&this.positionBlocks.bl["blocks"][3]&&this.positionBlocks.bl["blocks"][3]["position"]&&this.positionBlocks.bl["blocks"][4]&&this.positionBlocks.bl["blocks"][4]["position"]&&this.positionBlocks.br["blocks"]&&this.positionBlocks.br["blocks"][0]&&this.positionBlocks.br["blocks"][0]["position"]&&this.positionBlocks.br["blocks"][1]&&this.positionBlocks.br["blocks"][1]["position"]&&this.positionBlocks.br["blocks"][2]&&this.positionBlocks.br["blocks"][2]["position"]&&this.positionBlocks.br["blocks"][3]&&this.positionBlocks.br["blocks"][3]["position"]&&this.positionBlocks.br["blocks"][4]&&this.positionBlocks.br["blocks"][4]["position"]){var b=new Object();b.tl=new Object();b.tl[2]=-631;b.tl[3]=-632;b.tl[4]=-688;b.tr=new Object();b.tr[2]=-631;b.tr[3]=-631;b.tr[4]=-687;b.bl=new Object();b.bl[2]=-629;b.bl[3]=-629;b.bl[4]=-674;b.br=new Object();b.br[2]=-629;b.br[3]=-629;b.br[4]=-674;if(c){if(c.tl!=undefined){if(c.tl[2]!=undefined){b.tl[2]=c.tl[2]}if(c.tl[3]!=undefined){b.tl[3]=c.tl[3]}if(c.tl[4]!=undefined){b.tl[4]=c.tl[4]}}if(c.tr!=undefined){if(c.tr[2]!=undefined){b.tr[2]=c.tr[2]}if(c.tr[3]!=undefined){b.tr[3]=c.tr[3]}if(c.tr[4]!=undefined){b.tr[4]=c.tr[4]}}if(c.bl!=undefined){if(c.bl[2]!=undefined){b.bl[2]=c.bl[2]}if(c.bl[3]!=undefined){b.bl[3]=c.bl[3]}if(c.bl[4]!=undefined){b.bl[4]=c.bl[4]}}if(c.br!=undefined){if(c.br[2]!=undefined){b.br[2]=c.br[2]}if(c.br[3]!=undefined){b.br[3]=c.br[3]}if(c.br[4]!=undefined){b.br[4]=c.br[4]}}}this.positionBlocks.tl["blocks"][0]["position"]=new OpenLayers.Pixel(0,0);this.positionBlocks.tl["blocks"][1]["position"]=new OpenLayers.Pixel(-d,0);this.positionBlocks.tl["blocks"][2]["position"]=new OpenLayers.Pixel(0,b.tl[2]);this.positionBlocks.tl["blocks"][3]["position"]=new OpenLayers.Pixel(-d,b.tl[3]);this.positionBlocks.tl["blocks"][4]["position"]=new OpenLayers.Pixel(0,b.tl[4]);this.positionBlocks.tr["blocks"][0]["position"]=new OpenLayers.Pixel(0,0);this.positionBlocks.tr["blocks"][1]["position"]=new OpenLayers.Pixel(-d,0);this.positionBlocks.tr["blocks"][2]["position"]=new OpenLayers.Pixel(0,b.tr[2]);this.positionBlocks.tr["blocks"][3]["position"]=new OpenLayers.Pixel(-d,b.tr[3]);this.positionBlocks.tr["blocks"][4]["position"]=new OpenLayers.Pixel(-215,b.tr[4]);this.positionBlocks.bl["blocks"][0]["position"]=new OpenLayers.Pixel(0,0);this.positionBlocks.bl["blocks"][1]["position"]=new OpenLayers.Pixel(-d,0);this.positionBlocks.bl["blocks"][2]["position"]=new OpenLayers.Pixel(0,b.bl[2]);this.positionBlocks.bl["blocks"][3]["position"]=new OpenLayers.Pixel(-d,b.bl[3]);this.positionBlocks.bl["blocks"][4]["position"]=new OpenLayers.Pixel(-101,b.bl[4]);this.positionBlocks.br["blocks"][0]["position"]=new OpenLayers.Pixel(0,0);this.positionBlocks.br["blocks"][1]["position"]=new OpenLayers.Pixel(-d,0);this.positionBlocks.br["blocks"][2]["position"]=new OpenLayers.Pixel(0,b.br[2]);this.positionBlocks.br["blocks"][3]["position"]=new OpenLayers.Pixel(-d,b.br[3]);this.positionBlocks.br["blocks"][4]["position"]=new OpenLayers.Pixel(-311,b.br[4])}},updateSize:function(){var g="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";var l=(this.map)?this.map.div:document.body;var m=OpenLayers.Util.getRenderedDimensions(g,null,{displayClass:this.displayClass,containerElement:l});var k=this.getSafeContentSize(m);var j=null;if(k.equals(m)){j=m}else{var c=new OpenLayers.Size();c.w=(k.w<m.w)?k.w:null;c.h=(k.h<m.h)?k.h:null;if(c.w&&c.h){j=k}else{var f=OpenLayers.Util.getRenderedDimensions(g,c,{displayClass:this.contentDisplayClass,containerElement:l});var d=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if((d!="hidden")&&(f.equals(k))){var b=OpenLayers.Util.getScrollbarWidth();if(c.w){f.h+=b}else{f.w+=b}}j=this.getSafeContentSize(f)}}this.setSize(j)},visible:function(){if(this.div&&OpenLayers.Util.getElement(this.div)){return OpenLayers.Popup.FramedCloud.prototype.visible.apply(this,arguments)}},CLASS_NAME:"OpenLayers.Popup.IAAA_FramedCloud"});OpenLayers.Marker.IAAA_Marker=OpenLayers.Class(OpenLayers.Marker,{treeNode:null,modifiable:true,initialize:function(f,d,b){OpenLayers.Marker.prototype.initialize.apply(this,[f,d]);for(var c in b){this[c]=b[c]}},getVisibility:function(){return(this.icon.imageDiv.style.display!="none")},getTreeNode:function(){return this.treeNode},setVisibility:function(b){if(b){this.icon.imageDiv.style.display="block"}else{this.icon.imageDiv.style.display="none"}},setTreeNode:function(b){this.treeNode=b},getModifiable:function(){return this.modifiable},CLASS_NAME:"OpenLayers.Marker.IAAA_Marker"});OpenLayers.IAAA_Size=OpenLayers.Class(OpenLayers.Size,{w:0,h:0,initialize:function(b,c){if(b!="auto"){this.w=parseFloat(b)}else{this.w=b}if(c!="auto"){this.h=parseFloat(c)}else{this.h=c}},clone:function(){return new OpenLayers.IAAA_Size(this.w,this.h)},CLASS_NAME:"OpenLayers.IAAA_Size"});OpenLayers.IAAA_Bounds=OpenLayers.Class(OpenLayers.Bounds,{srs:null,clone:function(){var b=new OpenLayers.IAAA_Bounds(this.left,this.bottom,this.right,this.top);if(this.srs){b.setSrs(this.srs)}return b},getSrs:function(){return this.srs},setSrs:function(b){this.srs=b},toString:function(){return[this.left,this.bottom,this.right,this.top,this.getSrs()].join(",")},toStandarBBOX:function(c,g){if(c==null){c=10}if((g==null)||(g==undefined)){g=false}var k=Math.pow(10,c);var j=Math.round(this.left*k)/k;var f=Math.round(this.bottom*k)/k;var d=Math.round(this.right*k)/k;var b=Math.round(this.top*k)/k;if(!g){bbox=j+","+f+" "+d+","+b}else{bbox=f+","+j+" "+b+","+d}return bbox},toSRSGeometry:function(){var b=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])]);return new OpenLayers.IAAA_SRSGeometry(b,this.getSrs())},transformSrs:function(c){if(this.getSrs()!=c){var b;b=coordTransform(this.getSrs(),c,this.left,this.bottom);this.left=b[0];this.bottom=b[1];b=coordTransform(this.getSrs(),c,this.right,this.top);this.right=b[0];this.top=b[1];this.setSrs(c);this.centerLonLat=null}},CLASS_NAME:"OpenLayers.IAAA_Bounds"});OpenLayers.Ajax.IAAA_Request=OpenLayers.Class(OpenLayers.Ajax.Request,{_complete:false,initialize:function(c,b){OpenLayers.Ajax.Base.prototype.initialize.apply(this,[b]);this.transport=OpenLayers.Ajax.getTransport();this.request(c)},CLASS_NAME:"OpenLayers.Ajax.IAAA_Request"});OpenLayers.IAAA_Request=OpenLayers.Class({response:null,servletUrl:null,url:null,requestParams:{},method:"POST",responseType:"text",events:null,ajaxRequest:null,EVENT_TYPES:["loaddata","faildata"],initialize:function(c,d,f,b){this.url=c;this.servletUrl=d;if(f){this.method=f}this.requestParams=b;this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES)},setUrl:function(b){this.url=b},setServlet:function(b){this.servletUrl=b},setRequestParams:function(b){this.requestParams=b},addRequestParam:function(b,c){this.requestParams[b]=c},doRequest:function(){var b=this.requestParams;OpenLayers.loadURL=function(g,m,l,d,j,f){var k=(j)?OpenLayers.Function.bind(j,d):OpenLayers.nullHandler;var c=(f)?OpenLayers.Function.bind(f,d):OpenLayers.nullHandler;return new OpenLayers.Ajax.IAAA_Request(g,{method:m,parameters:l,onComplete:k,onFailure:c,contentType:"application/x-www-form-urlencoded; charset=UTF-8"})};this.ajaxRequest=OpenLayers.loadURL(this.servletUrl,this.method,b,this,this._onLoad,this._onFail)},_onLoad:function(b){if(this.responseType=="text"){this.response=b.responseText}else{this.response=b.responseXML}this.events.triggerEvent("loaddata")},_onFail:function(b){if(this.responseType=="text"){this.response=b.responseText}else{this.response=b.responseXML}this.events.triggerEvent("faildata")},getResponse:function(){return this.response},getRequestObject:function(){if((this.ajaxRequest!=null)&&(this.ajaxRequest!=undefined)){return this.ajaxRequest.transport}return null},CLASS_NAME:"OpenLayers.IAAA_Request"});OpenLayers.IAAA_SRSGeometry=OpenLayers.Class({geometry:null,srs:null,initialize:function(c,b){this.geometry=c;this.srs=b},getSrs:function(){return this.srs},setSrs:function(b){this.srs=b},transformSrs:function(g){if(this.getSrs()!=g){var f=function(){this.bounds=null;if(this.components&&this.components.length>0){this.components[0].bounds=null;this.setBounds(this.components[0].getBounds());for(var j=1;j<this.components.length;j++){this.components[j].bounds=null;this.extendBounds(this.components[j].getBounds())}}else{this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)}};if((this.geometry.CLASS_NAME=="OpenLayers.Geometry.Collection")||(this.geometry.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(this.geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")){for(var c in this.geometry.components){var d=this.transformInnerGeometry(this.geometry.components[c],this.getSrs(),g);this.geometry.components[c]=d;this.geometry.components[c].bounds=null;this.geometry.components[c].calculateBounds=f}this.geometry.bounds=null;this.geometry.calculateBounds=f}else{var b=this.transformInnerGeometry(this.geometry,this.getSrs(),g);this.geometry=b;this.geometry.bounds=null;this.geometry.calculateBounds=f}this.setSrs(g)}},transformInnerGeometry:function(n,o,f){if(o!=f){if(n.CLASS_NAME=="OpenLayers.Geometry.Point"){var d=new OpenLayers.Geometry.Point();var b=n;var l=coordTransform(o,f,b.x,b.y);d.x=l[0];d.y=l[1];d.bounds=null;return d}else{if(n.CLASS_NAME=="OpenLayers.Geometry.LineString"){var p=[];var m=new OpenLayers.Geometry.LineString(n.components);for(var k=0;k<n.components.length;k++){var b=n.components[k];if(p[b.id]==null){var l=coordTransform(o,f,b.x,b.y);m.components[k].x=l[0];m.components[k].y=l[1];m.components[k].bounds=null;p[b.id]=true}}return m}else{if(n.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){var p=[];var m=new OpenLayers.Geometry.LinearRing(n.components);for(var k=0;k<n.components.length;k++){var b=n.components[k];if(p[b.id]==null){var l=coordTransform(o,f,b.x,b.y);m.components[k].x=l[0];m.components[k].y=l[1];m.components[k].bounds=null;p[b.id]=true}}return m}else{var p=[];var c=new OpenLayers.Geometry.Polygon(n.components);for(var k=0;k<n.components[0].components.length;k++){var b=n.components[0].components[k];if(p[b.id]==null){var l=coordTransform(o,f,b.x,b.y);c.components[0].components[k].x=l[0];c.components[0].components[k].y=l[1];c.components[0].components[k].bounds=null;p[b.id]=true}}for(var k=1;k<n.components.length;k++){for(var g=0;g<n.components[k].components.length;g++){var b=n.components[k].components[g];if(p[b.id]==null){var l=coordTransform(o,f,b.x,b.y);c.components[k].components[g].x=l[0];c.components[k].components[g].y=l[1];c.components[k].components[g].bounds=null;p[b.id]=true}}}return c}}}}},toAsciiPolygon:function(){var g=asciiPolygon;var b="";if(this.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){b+="P  1\n";b+=" "+this.geometry.x+" "+this.geometry.y+"\n"}else{if(this.geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"){b+="L  "+(this.geometry.components.length-1)+"\n";for(var c=1;c<this.geometry.components.length;c++){var f=this.geometry.components[c].x;var d=this.geometry.components[c].y;b+=" "+f+" "+d+"\n"}}else{if(this.geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){b+="L  "+(this.geometry.components.length-1)+"\n";for(var c=1;c<this.geometry.components.length;c++){var f=this.geometry.components[c].x;var d=this.geometry.components[c].y;b+=" "+f+" "+d+"\n"}}else{b+="B  "+this.geometry.components[0].components.length+"\n";for(var c=0;c<this.geometry.components[0].components.length;c++){var f=this.geometry.components[0].components[c].x;var d=this.geometry.components[0].components[c].y;b+=" "+f+" "+d+"\n"}}}}g=OpenLayers.IAAA_Utils.replaceCad(g,"COORDS_LIST",b);return g},clone:function(){var b=new OpenLayers.IAAA_SRSGeometry(this.geometry.clone(),this.srs);return b},toString:function(){var b="Geometry: "+this.geometry.toString()+"\nSRS: "+this.getSrs();return b},CLASS_NAME:"OpenLayers.IAAA_SRSGeometry"});OpenLayers.Strategy.IAAA_MultipleCluster=OpenLayers.Class(OpenLayers.Strategy.Cluster,{layers:null,clusterExclusionAtt:null,nonClusteredFeatures:null,pause:false,clusterStyle:{fillColor:"#DF0101",fillOpacity:0.6,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",pointRadius:10,fontColor:"white",fontFamily:"Arial",fontSize:"10px",label:"",labelAlign:"cm"},incFunction:function(b){return Math.floor(b/4)},initialize:function(b){OpenLayers.Strategy.Cluster.prototype.initialize.apply(this,[b])},setLayer:function(b){OpenLayers.Strategy.prototype.setLayer.apply(this,arguments);b.getFeatureFromEvent=function(c){var d=OpenLayers.Layer.Vector.RootContainer.prototype.getFeatureFromEvent.apply(this,arguments);if(!d){var f=this.renderer.getFeatureIdFromEvent(c);d=this.getFeatureById(f)}return d};b.clone=function(c){if(c==null){c=new OpenLayers.Layer.Vector.RootContainer(this.name,this.options)}c.layers=this.layers;c.map=null;return c}},setLayers:function(b){this.layers=b},activate:function(){var c=OpenLayers.Strategy.prototype.activate.call(this);if(c){for(var d=0,b=this.layers.length;d<b;d++){this.layers[d].events.on({featuresadded:this.cacheFeatures,visibilitychanged:this.cluster,scope:this})}this.layer.map.events.on({zoomend:this.cluster,scope:this})}this.reloadFeatures();return c},deactivate:function(){this.restoreClusteredFeatures();var g=OpenLayers.Strategy.prototype.deactivate.call(this);if(g){this.clearCache();for(var f=0,b=this.layers.length;f<b;f++){if(this.layers[f].features){for(var d=0,c=this.layers[f].features.length;d<c;d++){this.checkFeatureState(this.layers[f].features[d],this.layers[f]);this.layers[f].drawFeature(this.layers[f].features[d])}}this.layers[f].events.unregister("beforefeaturesadded",this.layers[f],this.layers[f].stopDrawingFeatues);this.layers[f].events.unregister("featuresadded",this.layers[f],this.layers[f].startDrawingFeatues);this.layers[f].events.un({featuresadded:this.cacheFeatures,visibilitychanged:this.cluster,scope:this})}this.layer.map.events.un({zoomend:this.cluster,scope:this})}return g},reloadFeatures:function(){this.features=[];for(var f=0,b=this.layers.length;f<b;f++){if(this.layers[f].features){for(var d=0,c=this.layers[f].features.length;d<c;d++){this.features.push(this.layers[f].features[d])}}}},restoreClusteredFeatures:function(){for(var k=0,c=(this.clusters?this.clusters.length:0);k<c;k++){var l=c-(k+1);var b=this.clusters.pop();for(var f=0,d=(b.cluster?b.cluster.length:0);f<d;f++){var m=d-(f+1);var g=b.cluster.pop();g.attributes.originalLayer.addFeatures(g,{silent:true})}b.destroy()}this.layer.renderer.clear()},cacheFeatures:function(f){var c=true;if(!this.clustering){if(!this.features){this.features=[]}for(var d=0,b=f.features.length;d<b;d++){this.features.push(f.features[d])}this.cluster(f);c=false}return c},cluster:function(b){if(this.pause){return}if((!b||(b.type=="zoomend")||(b.type=="visibilitychanged")||(b.type=="featuresadded"))&&this.features){var d=this.layer.map.getResolution();var l=(b?b.object:null);if((d!=this.resolution)||!this.clustersExist(l)||(b&&(b.type=="featuresadded"))){this.resolution=d;var o=[];var u,c,q;this.nonClusteredFeatures=[];for(var k=0;k<this.features.length;++k){u=this.features[k];if(u.geometry&&((u.layer&&u.layer.getVisibility())||(u.attributes.originalLayer&&u.attributes.originalLayer.getVisibility()))){c=false;for(var g=0;g<o.length;++g){q=o[g];if(this.shouldCluster(q,u)){this.addToCluster(q,u);c=true;break}}if(!c){if(!((u.attributes.clusterize!=null)&&(u.attributes.clusterize==false))){o.push(this.createCluster(u))}else{this.nonClusteredFeatures.push(u)}}}else{if(!u.layer&&u.attributes.originalLayer){u.attributes.originalLayer.addFeatures(u,{silent:true})}}}var p=[];var r=[];for(var k=0,m=o.length;k<m;k++){if(o[k].cluster.length>1){for(var g=0,f=o[k].cluster.length;g<f;g++){if(!o[k].cluster[g].attributes.originalLayer&&o[k].cluster[g].layer){o[k].cluster[g].attributes.originalLayer=o[k].cluster[g].layer}r.push({feature:o[k].cluster[g],layer:o[k].cluster[g].layer})}p.push(o[k])}else{this.nonClusteredFeatures.push(o[k].cluster[0])}}for(var k=0,m=r.length;k<m;k++){if(r[k].layer){r[k].layer.removeFeatures(r[k].feature)}}for(var k=0,m=this.nonClusteredFeatures.length;k<m;k++){if(!this.nonClusteredFeatures[k].layer){this.checkFeatureState(this.nonClusteredFeatures[k],this.nonClusteredFeatures[k].attributes.originalLayer);this.nonClusteredFeatures[k].attributes.originalLayer.addFeatures(this.nonClusteredFeatures[k],{silent:true});this.nonClusteredFeatures[k].attributes.originalLayer=null}else{if(!this.nonClusteredFeatures[k].layer.getFeatureById(this.nonClusteredFeatures[k].id)){this.nonClusteredFeatures[k].layer.addFeatures(this.nonClusteredFeatures[k],{silent:true})}}}this.layer.destroyFeatures();if(p.length>0){if(this.threshold>1){var n=p.slice();p=[];var s;for(var k=0,m=n.length;k<m;++k){s=n[k];if(s.attributes.count<this.threshold){Array.prototype.push.apply(p,s.cluster)}else{p.push(s)}}}for(var k=0,m=p.length;k<m;k++){this.setClusterStyle(p[k])}this.clustering=true;this.layer.addFeatures(p);this.clustering=false}this.clusters=p}}},clustersExist:function(k){var l=0;for(var f=0,b=this.features.length;f<b;f++){if((!this.features[f].layer&&this.features[f].attributes.originalLayer&&this.features[f].attributes.originalLayer.getVisibility())||(this.features[f].layer&&this.features[f].layer.getVisibility())){l++}}var g=0;for(var f=0,b=this.clusters.length;f<b;f++){for(var d=0,c=this.clusters[f].cluster.length;d<c;d++){if((this.clusters[f].cluster[d].attributes.originalLayer.getVisibility())||(this.clusters[f].cluster[d].attributes.originalLayer==k)){g++;if((this.clusters[f].cluster[d].attributes.originalLayer==k)&&(k&&!k.getVisibility())){return false}}}}return((this.nonClusteredFeatures.length+g)==l)},checkFeatureState:function(b,c){},setClusterStyle:function(b){b.style=OpenLayers.Util.extend({},this.clusterStyle);b.style.pointRadius=b.style.pointRadius+this.resizeFactor(b.cluster.length,this.layer.map.getActualScale());b.style.label=new String(b.attributes.count);b.style.printLabel=new String(b.attributes.count)},resizeFactor:function(f,d){var c=this.incFunction(f,d);var b=this.distance-parseInt(this.clusterStyle.pointRadius);return((c>b)?b:c)},reset:function(){this.layer.destroyFeatures();for(var b=this.clusters.length-1;b>=0;b--){this.clusters[b].destroy()}for(var b=this.features.length-1;b>=0;b--){this.features[b].destroy()}for(var b=this.nonClusteredFeatures.length-1;b>=0;b--){this.nonClusteredFeatures[b].destroy()}this.clusters=[];this.features=[];this.nonClusteredFeatures=[]},CLASS_NAME:"OpenLayers.Strategy.IAAA_MultipleCluster"});function Unit(d){this.unit=d;this.canConvert=b;this.equals=c;function b(){return true}function c(f){return(f.unit==this.unit)}}function Unit_metre(){return new Unit("m")}function Unit_degree(){return new Unit("")}function WGS84ConversionInfo(){this.dx=-1;this.dy=-1;this.dz=-1;this.ex=-1;this.ey=-1;this.ez=-1;this.ppm=-1;this.areaOfUse="";this.equals=b;function b(c){if((this.dx==c.dx)&&(this.dy==c.dy)&&(this.dz==c.dz)&&(this.ex==c.ex)&&(this.ey==c.ey)&&(this.ez==c.ez)&&(this.ppm==c.ppm)&&(this.areaOfUse==c.areaOfUse)){return true}return false}}function Info(c){this.name=c;this.getName=f();this.ensureAngularUnit=b;this.ensureLinearUnit=d;function f(){return this.name}function d(g){if(!new Unit_metre().canConvert(g)){alert("Error: Unit::ensureLinearUnit")}}function b(g){if(!new Unit_degree.canConvert(g)){alert("Error: Unit::ensureAngularUnit")}}}function Ellipsoid(b,o,l,d,j,n){this._super=Info;this._super(b);this.unit=n;this.semiMajorAxis=c("semiMajorAxis",o);this.semiMinorAxis=c("semiMinorAxis",l);this.inverseFlattening=c("inverseFlattening",d);this.ivfDefinitive=j;this.check=c;this.equals=f;this.ensureLinearUnit(n);this.getSemiMinorAxis=k;this.getSemiMajorAxis=m;function k(){return this.semiMinorAxis}function m(){return this.semiMajorAxis}this.createEllipsoid=g;function c(p,q){if(q>0){return q}alert("Error Ellipsoid::check: "+p)}function g(q,r,p,s){if(r==p){return new Spheroid(q,r,false,s)}else{return new Ellipsoid(q,r,p,r/(r-p),false,s)}}function f(p){if(this.semiMajorAxis==p.semiMajorAxis){if(this.semiMinorAxis==p.semiMinorAxis){if(this.inverseFlattening==p.inverseFlattening){return true}}}return false}}Ellipsoid.prototype=Info;function Ellipsoid_FlattenedSphere(c,d,b,f){if(!isFinite(b)){return new Spheroid(c,d,true,f)}else{return new Ellipsoid(c,d,d*(1-1/b),b,true,f)}}function Spheroid(d,b,c,f){this._super=Ellipsoid;this._super(d,this.check("radius",b),b,Infinity,c,f)}Spheroid.prototype=Ellipsoid;function Ellipsoid_WGS84(){return new Ellipsoid_FlattenedSphere("WGS84",6378137,298.257223563,new Unit_metre())}function DatumType(b,d,c){this.name=b;this.value=d;this.key=c}function DatumType_classic(){return new DatumType("CLASSIC",1001,5)}function DatumType_geocentric(){return new DatumType("GEOCENTRIC",1002,15)}function Datum(c,d){this._super=Info;this._super(c);this.datumType=d;this.getDatumType=b;function b(){return this.datumType}}Datum.prototype=Info;function HorizontalDatum(b,d,j,g){this._super=Datum;this._super(b,d);this.ellipsoid=j;this.parameters=g;this.equals=f;this.getEllipsoid=c;this.equals=f;function c(){return this.ellipsoid}function f(k){if(this.getEllipsoid().equals(k.getEllipsoid())){if(this.parameters.equals(k.parameters)){return true}}return false}}HorizontalDatum.prototype=Datum;function Projection(b,l,c,f,o,v,g,n,q){this._super=Info;this._super(b);this.classification=l||"";this.falseNorthing=o;this.falseEasting=v;this.centralMeridian=g;this.centralLatitude=n;this.semiMinor=c;this.semiMajor=f;this.scaleFactor=q;this.getFalseNorthing=k;this.getFalseEasting=j;this.getCentralMeridian=d;this.getCentralLatitude=m;this.getSemiMinor=p;this.getSemiMajor=u;this.getScaleFactor=s;this.getClass=r;function k(){return this.falseNorthing}function j(){return this.falseEasting}function d(){return this.centralMeridian}function m(){return this.centralLatitude}function p(){return this.semiMinor}function u(){return this.semiMajor}function s(){return this.scaleFactor}function r(){return this.classification}}Projection.prototype=Info;function Point2D_Double(b,g){this.x=b||0;this.y=g||0;this.getX=d;this.getY=c;this.setLocation=f;function d(){return this.x}function c(){return this.y}function f(k,j){this.x=k;this.y=j}}function CoordinatePoint(d){this.ord=new Array(d);this.getOrd=b;this.setLocation=c;function b(){return this.getOrd}function c(f,g){this.ord[0]=f;this.ord[1]=g}}function MapProjection(b){this.semiMajor=b.getSemiMajor();this.semiMinor=b.getSemiMinor();this.centralMeridian=degrees2radians(b.getCentralMeridian());this.centralLatitude=degrees2radians(b.getCentralLatitude());this.scaleFactor=b.getScaleFactor();this.falseEasting=b.getFalseEasting();this.falseNorthing=b.getFalseNorthing();this.isSpherical=(this.semiMajor==this.semiMinor);this.es=1-(this.semiMinor*this.semiMinor)/(this.semiMajor*this.semiMajor);this.e=Math.sqrt(this.es);this.MAX_ERROR=1;this.EPS=0.000001;this.TOL=1e-10;this.transform=c;this.inverseTransform=g;this.transform2ptos=f;this.inverseTransform2ptos=d;function c(q,k,m,n,p,o){var l;var j;l=(q==m&&k<n&&k+(p<<1)>n);if(l){k+=2*p;n+=2*p}j=new Point2D_Double();while(--p>=0){j.x=q[k++];j.y=q[k++];this.transform2ptos(j,j,o);m[n++]=j.x;m[n++]=j.y;if(l){k-=4;n-=4}}}function g(q,k,m,n,p,o){var l;var j;l=(q==m&&k<n&&k+(p<<1)>n);if(l){k+=2*p;n+=2*p}var j=new Point2D_Double();while(--p>=0){j.x=q[k++];j.y=q[k++];this.inverseTransform2ptos(j,j,o);m[n++]=j.x;m[n++]=j.y;if(l){k-=4;n-=4}}}function f(n,k,l){var j;var m;j=n.getX();m=n.getY();if(l=="UTM"){k=this.transformUTM(degrees2radians(j),degrees2radians(m),k)}else{if(l=="LAMBERT"){k=this.transformLambert(degrees2radians(j),degrees2radians(m),k)}else{}}return k}function d(p,k,m){var j;var o;var l;var n;l=p.getX();n=k.getY();if(m=="UTM"){k=this.inverseTransformUTM(l,n,k)}else{if(m=="LAMBERT"){k=this.inverseTransformLambert(l,n,k)}else{}}j=radians2degrees(k.getX());o=radians2degrees(k.getY());k.setLocation(j,o);return k}}function TransverseMercatorProjection(J){this._super=MapProjection;this._super(J);var D=1;var C=0.5;var B=0.16666666666666666;var A=0.08333333333333333;var v=0.05;var s=0.03333333333333333;var q=0.023809523809523808;var o=0.017857142857142856;var r=1;var n=0.25;var m=0.046875;var j=0.01953125;var f=0.01068115234375;var b=0.75;var G=0.46875;var F=0.013020833333333334;var E=0.007120768229166667;var l=0.3645833333333333;var g=0.005696614583333333;var I=0.3076171875;var d=1e-10;var c=1e-11;this.ak0=this.semiMajor*this.scaleFactor;this.esp=(this.semiMajor*this.semiMajor)/(this.semiMinor*this.semiMinor)-1;this.en0=r-this.es*(n+this.es*(m+this.es*(j+this.es*f)));this.en1=this.es*(b-this.es*(m+this.es*(j+this.es*f)));this.en2=(t=this.es*this.es)*(G-this.es*(F+this.es*E));this.en3=(t*=this.es)*(l-this.es*g);this.en4=t*this.es*I;this.getZone=u;this.mlfn=p;this.transformUTM=k;this.inverseTransformUTM=H;function u(K,M){zoneCount=Math.abs(360/M);t=K-0.5*M;t=radians2degrees(centralMeridian)-t;t=Math.floor(t/M+this.EPS);t-=zoneCount*Math.floor(t/zoneCount);t_int=Math.floor(t);return(t_int)+1}function p(N,K,M){M*=K;K*=K;return this.en0*N-M*(this.en1+K*(this.en2+K*(this.en3+K*(this.en4))))}function k(V,S,T){var V;var S;var K;var N;var U;var R;var X;var Q;var O;var M;S-=this.centralLatitude;V-=this.centralMeridian;K=Math.sin(S);N=Math.cos(S);if(this.isSpherical){U=N*Math.sin(V);if(Math.abs(Math.abs(U)-1)<=d){alert("ERROR: TransverseMercatorProjection::transform ERROR_VALUE_TEND_TOWARD_INFINITY")}R=N*Math.cos(V)/Math.sqrt(1-U*U);V=0.5*this.ak0*Math.log((1+U)/(1-U));if((U=Math.abs(R))>=1){if((U-1)>d){alert("ERROR: TransverseMercatorProjection::transform ERROR_VALUE_TEND_TOWARD_INFINITY 2")}else{R=0}}else{R=Math.acos(R)}if(S<0){R=-R}S=this.ak0*R}else{X=Math.abs(N)>d?K/N:0;X*=X;Q=N*V;O=Q*Q;Q/=Math.sqrt(1-this.es*K*K);M=this.esp*N*N;S=this.ak0*(this.mlfn(S,K,N)+K*Q*V*C*(1+A*O*(5-X+M*(9+4*M)+s*O*(61+X*(X-58)+M*(270-330*X)+o*O*(1385+X*(X*(543-X)-3111))))));V=this.ak0*Q*(D+B*O*(1-X+M+v*O*(5+X*(X-18)+M*(14-58*X)+q*O*(61+X*(X*(179-X)-479)))))}V+=this.falseEasting;S+=this.falseNorthing;if(T!=null){T.setLocation(V,S);return T}else{return new Point2D_Double(V,S)}}function H(V,T,U){var V;var T;var X;var S;var R;var Q;var N;var O;var Z;var Y;var K;var M;V-=this.falseEasting;T-=this.falseNorthing;if(this.isSpherical){X=Math.exp(V/this.ak0);S=0.5*(X-1/X);X=Math.cos(T/this.ak0);R=Math.asin(Math.sqrt((1-X*X)/(1+S*S)));T=T<0?-R:R;V=(Math.abs(S)<=d&&Math.abs(X)<=d)?this.centralMeridian:Math.atan2(S,X)+this.centralMeridian}else{Q=T/this.ak0;N=1-this.es;R=Q;for(O=10;true;){if(--O<0){alert("ERROR: TransverseMercatorProjection::inverseTransform ERROR_NO_CONVERGENCE")}Z=Math.sin(R);X=1-this.es*(Z*Z);X=(this.mlfn(R,Z,Math.cos(R))-Q)/(N*X*Math.sqrt(X));R-=X;if(Math.abs(X)<c){break}}if(Math.abs(R)>=(Math.PI/2)){T=T<0?-(Math.PI/2):(Math.PI/2);V=this.centralMeridian}else{sinphi=Math.sin(R);cosphi=Math.cos(R);X=Math.abs(cosphi)>d?sinphi/cosphi:0;Y=this.esp*cosphi*cosphi;K=1-this.es*sinphi*sinphi;S=V*Math.sqrt(K)/this.ak0;K*=X;X*=X;M=S*S;T=R-(K*M/(1-this.es))*C*(1-M*A*(5+X*(3-9*Y)+Y*(1-4*Y)-M*s*(61+X*(90-252*Y+45*X)+46*Y-M*o*(1385+X*(3633+X*(4095+1574*X))))));V=S*(D-M*B*(1+2*X+Y-M*v*(5+X*(28+24*X+8*Y)+6*Y-M*q*(61+X*(662+X*(1320+720*X))))))/cosphi+this.centralMeridian}}T+=this.centralLatitude;if(U!=null){U.setLocation(V,T);return U}else{return new Point2D_Double(V,T)}}}TransverseMercatorProjection.prototype=MapProjection;function LambertConformalProjection(E){this._super=MapProjection;this._super(E);this.latitudeToRadians=j;this.cphi2=G;this.msfn=d;this.tsfn=f;function G(K){var J;var I;var H;var n;var F;J=0.5*this.e;I=(Math.PI/2)-2*Math.atan(K);for(H=0;H<16;H++){n=this.e*Math.sin(I);F=(Math.PI/2)-2*Math.atan(K*Math.pow((1-n)/(1+n),J))-I;I+=F;if(Math.abs(F)<=this.TOL){return I}}}function d(n,F){return F/Math.sqrt(1-n*n*this.es)}function f(F,n){n*=this.e;return Math.tan(0.5*((Math.PI/2)-F))/Math.pow((1-n)/(1+n),0.5*this.e)}function j(I,n){var H;var F;H=-90;F=90;if(n?(I>=H&&I<=F):(I>H&&I<F)){return degrees2radians(I)}}var u;var s;var D;var C;var v;var q;var A;var m;var p;var g;var c;var o;var r;var b;var l;u=45.89891889;s=47.69601444;D=this.latitudeToRadians(u,true);C=this.latitudeToRadians(s,true);this.a=this.semiMajor*this.scaleFactor;if(Math.abs(D+C)<this.EPS){alert("ERROR: LambertConformalProjection::transform ERROR_POLE_PROJECTION")}A=Math.cos(D);m=Math.sin(D);v=Math.abs(D-C)>this.EPS;if(this.isSpherical){if(v){q=Math.log(A/Math.cos(C))/Math.log(Math.tan((Math.PI/4)+0.5*C)/Math.tan((Math.PI/4)+0.5*D))}else{q=m}p=A*Math.pow(Math.tan((Math.PI/4)+0.5*D),q)/q;if(Math.abs(Math.abs(this.centralLatitude)-(Math.PI/2))>=this.EPS){g=p*Math.pow(Math.tan((Math.PI/4)+0.5*this.centralLatitude),-q)}else{g=0}}else{c=this.msfn(m,A);o=this.tsfn(D,m);if(v){r=Math.sin(C);b=this.msfn(r,Math.cos(C));l=this.tsfn(C,r);q=Math.log(c/b)/Math.log(o/l)}else{q=m}p=c*Math.pow(o,-q)/q;if(Math.abs(Math.abs(this.centralLatitude)-(Math.PI/2))>=this.EPS){g=p*Math.pow(this.tsfn(this.centralLatitude,Math.sin(this.centralLatitude)),q)}else{g=0}}this.transformLambert=B;this.inverseTransformLambert=k;function B(F,I,n){var H;if(Math.abs(Math.abs(I)-(Math.PI/2))<this.EPS){if(I*q<=0){alert("ERROR: LambertConformalProjection::transform ERROR_POLE_PROJECTION")}else{H=0}}else{if(this.isSpherical){H=Math.pow(Math.tan((Math.PI/4)+0.5*I),-q)}else{H=Math.pow(this.tsfn(I,Math.sin(I)),q)}H*=p}F=q*(F-this.centralMeridian);I=this.a*(g-H*Math.cos(F))+this.falseNorthing;F=this.a*(H*Math.sin(F))+this.falseEasting;if(n!=null){n.setLocation(F,I);return n}else{return new Point2D.Double(F,I)}}function k(F,I,n){var H;F=(F-this.falseEasting)/this.a;I=g-(I-this.falseNorthing)/this.a;H=Math.sqrt(F*F+I*I);if(H>this.EPS){if(q<0){H=-H;F=-F;I=-I}F=this.centralMeridian+Math.atan2(F,I)/q;if(this.isSpherical){I=2*Math.atan(Math.pow(p/H,1/q))-(Math.PI/2)}else{I=this.cphi2(Math.pow(H/p,1/q))}}else{F=this.centralMeridian;I=q<0?-(Math.PI/2):(Math.PI/2)}if(n!=null){n.setLocation(F,I);return n}else{return new Point2D.Double(F,I)}}}LambertConformalProjection.prototype=MapProjection;function MatrixTransform(b,f,d){this.numCol=b||0;this.numRow=f||0;this.elt=d||new Array();this.transformMatrix=c;function c(m,l,o,n,p){srcOffB=l;dstOffB=n;numPtsB=p;inputDimension=this.numCol-1;outputDimension=this.numRow-1;buffer=new Array();if(m==o){upperSrc=srcOffB+numPtsB*inputDimension;if(upperSrc>dstOffB){if(inputDimension>=outputDimension?dstOffB>srcOffB:dstOffB+numPtsB*outputDimension>upperSrc){m=new Array();ii=0;for(kk=srcOffB;kk<=(m.length+srcOffB);kk++){m[ii]=o[kk];ii++}srcOffB=0}}}while(--numPtsB>=0){mix=0;for(var g=0;g<this.numRow;g++){sum=this.elt[mix+inputDimension];for(var k=0;k<inputDimension;k++){sum+=m[srcOffB+k]*this.elt[mix++]}buffer[g]=sum;mix++}w=buffer[outputDimension];for(var g=0;g<outputDimension;g++){o[dstOffB++]=buffer[g]/w}srcOffB+=inputDimension}}}function GeocentricTransform(f){semiMajor=f.getSemiMajorAxis();semiMinor=f.getSemiMinorAxis();this.MAX_ERROR=0.01;this.COS_67P5=0.3826834323650898;this.AD_C=1.0026;this.a=semiMajor;this.b=semiMinor;this.a2=(this.a*this.a);this.b2=(this.b*this.b);this.e2=(this.a2-this.b2)/this.a2;this.ep2=(this.a2-this.b2)/this.b2;this.hasHeight=false;this.getDimSource=d;this.transformGeocentric=c;this.transformGeocentric_inverse=b;function d(){return 2}function c(j,g,m,l,n,k){numPtsB=n;step=0;dimSource=this.getDimSource();this.hasHeight|=(dimSource>=3);error=null;while(--numPtsB>=0){L=degrees2radians(j[g++]);P=degrees2radians(j[g++]);h=k?j[g++]:0;cosLat=Math.cos(P);sinLat=Math.sin(P);rn=this.a/Math.sqrt(1-this.e2*(sinLat*sinLat));m[l++]=(rn+h)*cosLat*Math.cos(L);m[l++]=(rn+h)*cosLat*Math.sin(L);m[l++]=(rn*(1-this.e2)+h)*sinLat;g+=step;l+=step}}function b(j,g,l,k,m){numPtsB=m;step=0;dimSource=this.getDimSource();hasHeight=(dimSource>=3);computeHeight=hasHeight;while(--numPtsB>=0){x=j[g++];y=j[g++];z=j[g++];W2=x*x+y*y;W=Math.sqrt(W2);T0=z*this.AD_C;S0=Math.sqrt(T0*T0+W2);sin_B0=T0/S0;cos_B0=W/S0;sin3_B0=sin_B0*sin_B0*sin_B0;T1=z+this.b*this.ep2*sin3_B0;sum=W-this.a*this.e2*(cos_B0*cos_B0*cos_B0);S1=Math.sqrt(T1*T1+sum*sum);sin_p1=T1/S1;cos_p1=sum/S1;longitude=radians2degrees(Math.atan2(y,x));latitude=radians2degrees(Math.atan(sin_p1/cos_p1));l[k++]=longitude;l[k++]=latitude;if(computeHeight){rn=this.a/Math.sqrt(1-this.e2*(sin_p1*sin_p1));if(cos_p1>=this.COS_67P5){height=W/+cos_p1-rn}else{if(cos_p1<=(-1*this.COS_67P5)){height=W/-cos_p1-rn}else{height=z/sin_p1+rn*(this.e2-1)}}if(this.hasHeight){l[k++]=height}}g+=step;k+=step}}}function startsWith(d,b){if(d.length>=b.length){var c=d.substring(0,b.length);if(c==b){return true}else{return false}}else{return false}}function getZona(b){if(startsWith(b,"EPSG:230")){var c=parseInt(b.substring(new String("EPSG:230").length,b.length));return c}if(startsWith(b,"EPSG:258")){var c=parseInt(b.substring(new String("EPSG:258").length,b.length));return c}}centralMeridianNTF=2.337229167;centralLatitudeNTF=46.8;falseNorthingNTF=2200000;falseEastingNTF=600000;scaleFactorNTF=1;ntfAwgs84=new WGS84ConversionInfo();ntfAwgs84.dx=-168;ntfAwgs84.dy=-60;ntfAwgs84.dz=320;ntfAwgs84.ex=0;ntfAwgs84.ey=0;ntfAwgs84.ez=0;ntfAwgs84.ppm=0;datumNTF=new HorizontalDatum("Nouvelle Triangulation Francaise Paris",new DatumType_classic(),new Ellipsoid_FlattenedSphere("Clarke 1880",6378249.2,293.4660212936269,new Unit_metre()),ntfAwgs84);ellipsoidNTF=datumNTF.getEllipsoid();projectionLambert=new Projection("Lambert Conformal Conic","Lambert",ellipsoidNTF.getSemiMinorAxis(),ellipsoidNTF.getSemiMajorAxis(),falseNorthingNTF,falseEastingNTF,centralMeridianNTF,centralLatitudeNTF,scaleFactorNTF);ntf_LCProjection=new LambertConformalProjection(projectionLambert);gt_ntf=new GeocentricTransform(ellipsoidNTF);zona28=28;centralMeridian28=-183+(zona28*6);zona29=29;centralMeridian29=-183+(zona29*6);zona30=30;centralMeridian30=-183+(zona30*6);zona31=31;centralMeridian31=-183+(zona31*6);zona32=32;centralMeridian32=-183+(zona32*6);zona33=33;centralMeridian33=-183+(zona33*6);zona34=34;centralMeridian34=-183+(zona34*6);zona35=35;centralMeridian35=-183+(zona35*6);zona36=36;centralMeridian36=-183+(zona36*6);zona37=37;centralMeridian37=-183+(zona37*6);zona38=38;centralMeridian38=-183+(zona38*6);centralLatitude=0;falseNorthing=0;falseEasting=500000;scaleFactor=0.9996;ed50Awgs84=new WGS84ConversionInfo();ed50Awgs84.dx=-84;ed50Awgs84.dy=-107;ed50Awgs84.dz=-120;horizDatum=new HorizontalDatum("European Datum 50",new DatumType_classic(),new Ellipsoid_FlattenedSphere("International 1924",6378388,297,new Unit_metre()),ed50Awgs84);ed50=horizDatum.getEllipsoid();horizDatum2=new HorizontalDatum("European Terrestrial Reference System",new DatumType_classic(),new Ellipsoid_FlattenedSphere("GRS 1980",6378137,298.257222,new Unit_metre()),new WGS84ConversionInfo());ellipsoidETRS89=horizDatum2.getEllipsoid();projectionZone28_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian28,centralLatitude,scaleFactor);projectionZone29_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian29,centralLatitude,scaleFactor);projectionZone30_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian30,centralLatitude,scaleFactor);projectionZone31_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian31,centralLatitude,scaleFactor);projectionZone32_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian32,centralLatitude,scaleFactor);projectionZone33_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian33,centralLatitude,scaleFactor);projectionZone34_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian34,centralLatitude,scaleFactor);projectionZone35_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian35,centralLatitude,scaleFactor);projectionZone36_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian36,centralLatitude,scaleFactor);projectionZone37_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian37,centralLatitude,scaleFactor);projectionZone38_etrs89=new Projection("ETRS89 / UTM Norte","Transverse_Mercator",ellipsoidETRS89.getSemiMinorAxis(),ellipsoidETRS89.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian38,centralLatitude,scaleFactor);projectionZone28_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian28,centralLatitude,scaleFactor);projectionZone29_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian29,centralLatitude,scaleFactor);projectionZone30_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian30,centralLatitude,scaleFactor);projectionZone31_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian31,centralLatitude,scaleFactor);projectionZone32_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian32,centralLatitude,scaleFactor);projectionZone33_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian33,centralLatitude,scaleFactor);projectionZone34_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian34,centralLatitude,scaleFactor);projectionZone35_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian35,centralLatitude,scaleFactor);projectionZone36_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian36,centralLatitude,scaleFactor);projectionZone37_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian37,centralLatitude,scaleFactor);projectionZone38_ed50=new Projection("ED50 / UTM Norte","Transverse_Mercator",ed50.getSemiMinorAxis(),ed50.getSemiMajorAxis(),falseNorthing,falseEasting,centralMeridian38,centralLatitude,scaleFactor);etrs89_TMProj28=new TransverseMercatorProjection(projectionZone28_etrs89);etrs89_TMProj29=new TransverseMercatorProjection(projectionZone29_etrs89);etrs89_TMProj30=new TransverseMercatorProjection(projectionZone30_etrs89);etrs89_TMProj31=new TransverseMercatorProjection(projectionZone31_etrs89);etrs89_TMProj32=new TransverseMercatorProjection(projectionZone32_etrs89);etrs89_TMProj33=new TransverseMercatorProjection(projectionZone33_etrs89);etrs89_TMProj34=new TransverseMercatorProjection(projectionZone34_etrs89);etrs89_TMProj35=new TransverseMercatorProjection(projectionZone35_etrs89);etrs89_TMProj36=new TransverseMercatorProjection(projectionZone36_etrs89);etrs89_TMProj37=new TransverseMercatorProjection(projectionZone37_etrs89);etrs89_TMProj38=new TransverseMercatorProjection(projectionZone38_etrs89);ed50_TMProj28=new TransverseMercatorProjection(projectionZone28_ed50);ed50_TMProj29=new TransverseMercatorProjection(projectionZone29_ed50);ed50_TMProj30=new TransverseMercatorProjection(projectionZone30_ed50);ed50_TMProj31=new TransverseMercatorProjection(projectionZone31_ed50);ed50_TMProj32=new TransverseMercatorProjection(projectionZone32_ed50);ed50_TMProj33=new TransverseMercatorProjection(projectionZone33_ed50);ed50_TMProj34=new TransverseMercatorProjection(projectionZone34_ed50);ed50_TMProj35=new TransverseMercatorProjection(projectionZone35_ed50);ed50_TMProj36=new TransverseMercatorProjection(projectionZone36_ed50);ed50_TMProj37=new TransverseMercatorProjection(projectionZone37_ed50);ed50_TMProj38=new TransverseMercatorProjection(projectionZone38_ed50);matrixED502WGS84_positive=[1,0,0,-84,0,1,0,-107,0,0,1,-120,0,0,0,1];matrixED502WGS84_negative=[1,0,0,84,0,1,0,107,0,0,1,120,0,0,0,1];matrixNTF2WGS84_positive=[1,0,0,-168,0,1,0,-60,0,0,1,320,0,0,0,1];matrixNTF2WGS84_negative=[1,0,0,168,0,1,0,60,0,0,1,-320,0,0,0,1];ED502WGS84_positive=new MatrixTransform(4,4,matrixED502WGS84_positive);ED502WGS84_negative=new MatrixTransform(4,4,matrixED502WGS84_negative);NTF2WGS84_positive=new MatrixTransform(4,4,matrixNTF2WGS84_positive);NTF2WGS84_negative=new MatrixTransform(4,4,matrixNTF2WGS84_negative);gt_ed50=new GeocentricTransform(ed50);gt_etrs89=new GeocentricTransform(ellipsoidETRS89);gt_wgs84=new GeocentricTransform(new Ellipsoid_WGS84());function getUTM_ETRS89_zone(b){switch(b){case 28:return etrs89_TMProj28;break;case 29:return etrs89_TMProj29;break;case 30:return etrs89_TMProj30;break;case 31:return etrs89_TMProj31;break;case 32:return etrs89_TMProj32;break;case 33:return etrs89_TMProj33;break;case 34:return etrs89_TMProj34;break;case 35:return etrs89_TMProj35;break;case 36:return etrs89_TMProj36;break;case 37:return etrs89_TMProj37;break;case 38:return etrs89_TMProj38;break;default:alert("Zona "+b+" no disponible en UTM con ETRS89");return etrs89_TMProj30}}function getUTM_ED50_zone(b){switch(b){case 28:return ed50_TMProj28;break;case 29:return ed50_TMProj29;break;case 30:return ed50_TMProj30;break;case 31:return ed50_TMProj31;break;case 32:return ed50_TMProj32;break;case 33:return ed50_TMProj33;break;case 34:return ed50_TMProj34;break;case 35:return ed50_TMProj35;break;case 36:return ed50_TMProj36;break;case 37:return ed50_TMProj37;break;case 38:return ed50_TMProj38;break;default:alert("Zona "+b+" no disponible en UTM con ED50");return ed50_TMProj30}}function transform230XX_4230(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ED50_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform4230_230XX(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ED50_zone(c).transform(srcPts,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform230XX_230XX(b,f,c,d){srcPts=new Array();srcPts[0]=b;srcPts[1]=f;dstPtsInv2=[0,0];getUTM_ED50_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts44=[0,0];getUTM_ED50_zone(d).transform(dstPtsInv2,0,dstPts44,0,1,"UTM");return dstPts44}function transform4258_258XX(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ETRS89_zone(c).transform(srcPts,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform258XX_4258(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ETRS89_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform4230_258XX(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPts=[0,0,0];gt_ed50.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);dstPtsInv2=[0,0];getUTM_ETRS89_zone(c).transform(dstPts33,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform258XX_4230(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ETRS89_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_etrs89.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);return dstPts33}function transform4326_258XX(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPts=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPts,0,1,false);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(dstPts,0,dstPts33,0,1,false);dstPtsInv2=[0,0];getUTM_ETRS89_zone(c).transform(dstPts33,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform258XX_4326(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ETRS89_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_etrs89.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);dstPts33=[0,0];gt_wgs84.transformGeocentric_inverse(dstPts,0,dstPts33,0,1,false);return dstPts33}function transform230XX_258XX(b,f,c,d){srcPts=new Array();srcPts[0]=b;srcPts[1]=f;dstPtsInv2=[0,0];getUTM_ED50_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_ed50.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);dstPts44=[0,0];getUTM_ETRS89_zone(d).transform(dstPts33,0,dstPts44,0,1,"UTM");return dstPts44}function transform258XX_258XX(b,f,c,d){srcPts=new Array();srcPts[0]=b;srcPts[1]=f;dstPtsInv2=[0,0];getUTM_ETRS89_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts44=[0,0];getUTM_ETRS89_zone(d).transform(dstPtsInv2,0,dstPts44,0,1,"UTM");return dstPts44}function transform258XX_230XX(b,f,c,d){srcPts=new Array();srcPts[0]=b;srcPts[1]=f;dstPtsInv2=[0,0];getUTM_ETRS89_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_etrs89.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);dstPts44=[0,0];getUTM_ED50_zone(d).transform(dstPts33,0,dstPts44,0,1,"UTM");return dstPts44}function transform230XX_4258(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ED50_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_ed50.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);return dstPts33}function transform230XX_4326(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ED50_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_ed50.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_wgs84.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);return dstPts33}function transform4258_4230(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPts=[0,0,0];gt_etrs89.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4230_4258(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPts=[0,0,0];gt_ed50.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4230_4326(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPts=[0,0,0];gt_ed50.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_wgs84.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4326_4230(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPts=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4258_4326(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPts=[0,0,0];gt_etrs89.transformGeocentric(srcPts,0,dstPts,0,1,false);dstPtsInv=[0,0];gt_wgs84.transformGeocentric_inverse(dstPts,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4326_4258(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPts=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPts,0,1,false);dstPtsInv=[0,0];gt_etrs89.transformGeocentric_inverse(dstPts,0,dstPtsInv,0,1,false);return dstPtsInv}function transform4258_230XX(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPts=[0,0,0];gt_etrs89.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);dstPtsInv2=[0,0];getUTM_ED50_zone(c).transform(dstPtsInv,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform4326_230XX(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPts=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_negative.transformMatrix(dstPts,0,srcPts22,0,1);dstPtsInv=[0,0];gt_ed50.transformGeocentric_inverse(srcPts22,0,dstPtsInv,0,1,false);dstPtsInv2=[0,0];getUTM_ED50_zone(c).transform(dstPtsInv,0,dstPtsInv2,0,1,"UTM");return dstPtsInv2}function transform4326_27572(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPtsStep1=[0,0,0];gt_wgs84.transformGeocentric(srcPts,0,dstPtsStep1,0,1,false);srcPts22=[0,0,0];NTF2WGS84_negative.transformMatrix(dstPtsStep1,0,srcPts22,0,1);dstPtsStep2=[0,0];gt_ntf.transformGeocentric_inverse(srcPts22,0,dstPtsStep2,0,1,false);dstPtsStep3=[0,0];ntf_LCProjection.transform(dstPtsStep2,0,dstPtsStep3,0,1,"LAMBERT");return dstPtsStep3}function transform4230_27572(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPts=[0,0,0];gt_ed50.transformGeocentric(srcPts,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);srcPts222=[0,0,0];NTF2WGS84_negative.transformMatrix(srcPts22,0,srcPts222,0,1);dstPts33=[0,0];gt_ntf.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);dstPtsInv2=[0,0];ntf_LCProjection.transform(dstPts33,0,dstPtsInv2,0,1,"LAMBERT");return dstPtsInv2}function transform4258_27572(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPtsStep1=[0,0,0];gt_etrs89.transformGeocentric(srcPts,0,dstPtsStep1,0,1,false);srcPts22=[0,0,0];NTF2WGS84_negative.transformMatrix(dstPtsStep1,0,srcPts22,0,1);dstPtsStep2=[0,0];gt_ntf.transformGeocentric_inverse(srcPts22,0,dstPtsStep2,0,1,false);dstPtsStep3=[0,0];ntf_LCProjection.transform(dstPtsStep2,0,dstPtsStep3,0,1,"LAMBERT");return dstPtsStep3}function transform230XX_27572(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ED50_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_ed50.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];ED502WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);srcPts222=[0,0,0];NTF2WGS84_negative.transformMatrix(srcPts22,0,srcPts222,0,1);pako=[0,0];gt_ntf.transformGeocentric_inverse(srcPts222,0,pako,0,1,false);pako2=[0,0];ntf_LCProjection.transform(pako,0,pako2,0,1,"LAMBERT");return pako2}function transform258XX_27572(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];getUTM_ETRS89_zone(c).inverseTransform(srcPts,0,dstPtsInv2,0,1,"UTM");dstPts=[0,0,0];gt_etrs89.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts222=[0,0,0];NTF2WGS84_negative.transformMatrix(dstPts,0,srcPts222,0,1);dstPts33=[0,0];gt_ntf.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);dstPts44=[0,0];ntf_LCProjection.transform(dstPts33,0,dstPts44,0,1,"LAMBERT");return dstPts44}function transform27572_4326(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_wgs84.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);return dstPts33}function transform27572_4230(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);srcPts222=[0,0,0];ED502WGS84_negative.transformMatrix(srcPts22,0,srcPts222,0,1);dstPts33=[0,0];gt_ed50.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);return dstPts33}function transform27572_4258(b,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=c;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);return dstPts33}function transform27572_230XX(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);srcPts222=[0,0,0];ED502WGS84_negative.transformMatrix(srcPts22,0,srcPts222,0,1);dstPts33=[0,0];gt_ed50.transformGeocentric_inverse(srcPts222,0,dstPts33,0,1,false);dstPts44=[0,0];getUTM_ED50_zone(c).transform(dstPts33,0,dstPts44,0,1,"UTM");return dstPts44}function transform27572_258XX(b,d,c){srcPts=new Array();srcPts[0]=b;srcPts[1]=d;dstPtsInv2=[0,0];ntf_LCProjection.inverseTransform(srcPts,0,dstPtsInv2,0,1,"LAMBERT");dstPts=[0,0,0];gt_ntf.transformGeocentric(dstPtsInv2,0,dstPts,0,1,false);srcPts22=[0,0,0];NTF2WGS84_positive.transformMatrix(dstPts,0,srcPts22,0,1);dstPts33=[0,0];gt_etrs89.transformGeocentric_inverse(srcPts22,0,dstPts33,0,1,false);dstPts44=[0,0];getUTM_ED50_zone(c).transform(dstPts33,0,dstPts44,0,1,"UTM");return dstPts44}function transform900913_4326(b,f){var d=(b/20037508.34)*180;var c=(f/20037508.34)*180;c=180/Math.PI*(2*Math.atan(Math.exp(c*Math.PI/180))-Math.PI/2);return[d,c]}function transform900913_230XX(b,f,c){var d=transform900913_4326(b,f);return transform4326_230XX(d[0],d[1],c)}function transform900913_258XX(b,f,c){var d=transform900913_4326(b,f);return transform4326_258XX(d[0],d[1],c)}function transform4326_900913(b,f){var d=b*20037508.34/180;var c=Math.log(Math.tan((90+f)*Math.PI/360))/(Math.PI/180);c=c*20037508.34/180;return[d,c]}function transform230XX_900913(b,f,c){var d=transform230XX_4326(b,f,c);return transform4326_900913(d[0],d[1])}function transform258XX_900913(b,f,c){var d=transform258XX_4326(b,f,c);return transform4326_900913(d[0],d[1])}function transform4258_900913(b,f,c){var d=transform4258_4326(b,f,c);return transform4326_900913(d[0],d[1])}function transform900913_4258(b,f,c){var d=transform900913_4326(b,f,c);return transform4326_4258(d[0],d[1])}function transform4230_900913(b,f,c){var d=transform4230_4326(b,f,c);return transform4326_900913(d[0],d[1])}function transform900913_4230(b,f,c){var d=transform900913_4326(b,f,c);return transform4326_4230(d[0],d[1])}function coordTransform(j,g,c,b){destino=new CoordinatePoint(2);j=j+"";g=g+"";if(g=="EPSG:3785"){g="EPSG:900913"}if(j==g){destino[0]=c;destino[1]=b;return destino}else{if(j=="EPSG:4326"){if(g=="EPSG:4230"){return transform4326_4230(c,b)}else{if(g=="EPSG:4258"){return transform4326_4258(c,b)}else{if(startsWith(g,"EPSG:230")){return transform4326_230XX(c,b,getZona(g))}else{if(startsWith(g,"EPSG:258")){return transform4326_258XX(c,b,getZona(g))}else{if(g=="EPSG:27572"){return transform4326_27572(c,b)}else{if(g=="EPSG:900913"){return transform4326_900913(c,b)}else{try{var d=Proj4js.transform(new Proj4js.Proj(j),new Proj4js.Proj(g),{x:c,y:b});return[d.x,d.y]}catch(f){alert("El srs "+g+" no est disponible")}}}}}}}}else{if(j=="EPSG:4230"){if(g=="EPSG:4326"){return transform4230_4326(c,b)}else{if(g=="EPSG:4258"){return transform4230_4258(c,b)}else{if(startsWith(g,"EPSG:230")){return transform4230_230XX(c,b,getZona(g))}else{if(startsWith(g,"EPSG:258")){return transform4230_258XX(c,b,getZona(g))}else{if(g=="EPSG:27572"){return transform4230_27572(c,b)}else{if(g=="EPSG:900913"){return transform4230_900913(c,b)}else{try{var d=Proj4js.transform(new Proj4js.Proj(j),new Proj4js.Proj(g),{x:c,y:b});return[d.x,d.y]}catch(f){alert("El srs "+g+" no est disponible")}}}}}}}}else{if(j=="EPSG:4258"){if(g=="EPSG:4230"){return transform4258_4230(c,b)}else{if(g=="EPSG:4326"){return transform4258_4326(c,b)}else{if(startsWith(g,"EPSG:230")){return transform4258_230XX(c,b,getZona(g))}else{if(startsWith(g,"EPSG:258")){return transform4258_258XX(c,b,getZona(g))}else{if(g=="EPSG:27572"){return transform4258_27572(c,b)}}}}}if(g=="EPSG:900913"){return transform4258_900913(c,b)}else{try{var d=Proj4js.transform(new Proj4js.Proj(j),new Proj4js.Proj(g),{x:c,y:b});return[d.x,d.y]}catch(f){alert("El srs "+g+" no est disponible")}}}else{if(startsWith(j,"EPSG:230")){if(g=="EPSG:4230"){return transform230XX_4230(c,b,getZona(j))}else{if(g=="EPSG:4258"){return transform230XX_4258(c,b,getZona(j))}else{if(g=="EPSG:4326"){return transform230XX_4326(c,b,getZona(j))}else{if(startsWith(g,"EPSG:230")){return transform230XX_230XX(c,b,getZona(j),getZona(g))}else{if(startsWith(g,"EPSG:258")){return transform230XX_258XX(c,b,getZona(j),getZona(g))}else{if(g=="EPSG:27572"){return transform230XX_27572(c,b,getZona(j))}else{if(g=="EPSG:900913"){return transform230XX_900913(c,b,getZona(j))}else{try{var d=Proj4js.transform(new Proj4js.Proj(j),new Proj4js.Proj(g),{x:c,y:b});return[d.x,d.y]}catch(f){alert("El srs "+g+" no est disponible")}}}}}}}}}else{if(startsWith(j,"EPSG:258")){if(g=="EPSG:4230"){return transform258XX_4230(c,b,getZona(j))}else{if(g=="EPSG:4258"){return transform258XX_4258(c,b,getZona(j))}else{if(g=="EPSG:4326"){return transform258XX_4326(c,b,getZona(j))}else{if(startsWith(g,"EPSG:230")){return transform258XX_230XX(c,b,getZona(j),getZona(g))}else{if(startsWith(g,"EPSG:258")){return transform258XX_258XX(c,b,getZona(j),getZona(g))}else{if(g=="EPSG:27572"){return transform258XX_27572(c,b,getZona(j))}else{if(g=="EPSG:900913"){return transform258XX_900913(c,b,getZona(j))}else{try{var d=Proj4js.transform(new Proj4js.Proj(j),new Proj4js.Proj(g),{x:c,y:b});return[d.x,d.y]}catch(f){alert("El srs "+g+" no est disponible")}}}}}}}}}else{if(j=="EPSG:27572"){if(g=="EPSG:4326"){return transform27572_4326(c,b)}else{if(g=="EPSG:4258"){return transform27572_4258(c,b)}else{if(startsWith(g,"EPSG:230")){return transform27572_230XX(c,b,getZona(g))}else{if(startsWith(g,"EPSG:258")){return transform27572_258XX(c,b,getZona(g))}else{if(g=="EPSG:4230"){return transform27572_4230(c,b)}else{try{var d=Proj4js.transform(new Proj4js.Proj(j),new Proj4js.Proj(g),{x:c,y:b});return[d.x,d.y]}catch(f){alert("El srs "+g+" no est disponible")}}}}}}}else{if(j=="EPSG:900913"){if(g=="EPSG:4326"){return transform900913_4326(c,b)}else{if(startsWith(g,"EPSG:230")){return transform900913_230XX(c,b,getZona(g))}else{if(startsWith(g,"EPSG:258")){return transform900913_258XX(c,b,getZona(g))}else{if(g=="EPSG:4258"){return transform900913_4258(c,b)}else{if(g=="EPSG:4230"){return transform900913_4230(c,b)}else{try{var d=Proj4js.transform(new Proj4js.Proj(j),new Proj4js.Proj(g),{x:c,y:b});return[d.x,d.y]}catch(f){alert("El srs "+g+" no est disponible")}}}}}}}else{try{var d=Proj4js.transform(new Proj4js.Proj(j),new Proj4js.Proj(g),{x:c,y:b});return[d.x,d.y]}catch(f){alert("El srs "+j+" no est disponible")}}}}}}}}}}var supportedSrsList=new Array("EPSG:4258","EPSG:4326","EPSG:4230","EPSG:25828","EPSG:25829","EPSG:25830","EPSG:25831","EPSG:23028","EPSG:23029","EPSG:23030","EPSG:23031","EPSG:900913","EPSG:3785");var supportedSrsListDescription=new Array("lon-lat, ETRS89","lon-lat, WGS84","lon-lat, ED50","UTM28N, ETRS89","UTM29N, ETRS89","UTM30N, ETRS89","UTM31N, ETRS89","UTM28N, ED50","UTM29N, ED50","UTM30N, ED50","UTM31N, ED50","Spherical Mercator, WGS84","Spherical Mercator, WGS84");var supportedSrsLongListDescription=new Array("EPSG:4258 (lon-lat, ETRS89)","EPSG:4326 (lon-lat, WGS84)","EPSG:4230 (lon-lat, ED50)","EPSG:25828 (UTM28N, ETRS89)","EPSG:25829 (UTM29N, ETRS89)","EPSG:25830 (UTM30N, ETRS89)","EPSG:25831 (UTM31N, ETRS89)","EPSG:23028 (UTM28N, ED50)","EPSG:23029 (UTM29N, ED50)","EPSG:23030 (UTM30N, ED50)","EPSG:23031 (UTM31N, ED50)");var projectedSrsList=new Array("EPSG:25828","EPSG:25829","EPSG:25830","EPSG:25831","EPSG:23028","EPSG:23029","EPSG:23030","EPSG:23031");var prioritySrsList=new Array("EPSG:4258","EPSG:4326","EPSG:4230","EPSG:25828","EPSG:25829","EPSG:25830","EPSG:25831","EPSG:23028","EPSG:23029","EPSG:23030","EPSG:23031","EPSG:900913","EPSG:3785");function getSupportedSrsList(){return supportedSrsList}function setSupportedSrsList(b){supportedSrsList=b}function getSupportedSrs(b){return(supportedSrsList[b])}function isSupportedSrs(d){var c=false;for(var b=0;b<supportedSrsList.length&&c==false;b++){c=(supportedSrsList[b]==d)}return c}function getSupportedSrsDescriptionList(){return supportedSrsListDescription}function setSupportedSrsDescriptionList(b){supportedSrsListDescription=b}function getSupportedSrsDescription(c){for(var b=0;b<supportedSrsList.length;b++){if(supportedSrsList[b]==c){return supportedSrsListDescription[b]}}return""}function getSupportedSrsDescriptionLongList(){return supportedSrsLongListDescription}function setSupportedSrsDescriptionLongList(b){supportedSrsLongListDescription=b}function getSupportedSrsLongDescription(c){for(var b=0;b<supportedSrsList.length;b++){if(supportedSrsList[b]==c){return supportedSrsLongListDescription[b]}}return""}function getProjectedSrsList(){return projectedSrsList}function setProjectedSrsList(b){projectedSrsList=b}function isProjectedSrs(c){var d=false;for(var b=0;b<projectedSrsList.length&&d==false;b++){d=(projectedSrsList[b]==c)}return d}function getPrioritySrsList(){return prioritySrsList}function setPrioritySrsList(b){prioritySrsList=b}function getPrioritySrs(b){return(prioritySrsList[b])}function getDatum(c){var d=getSupportedSrsLongDescription(c);if(d!=""){var b=d.substring(d.indexOf(",")+1,d.length);return b}return""}function resize(){var c=getWindowWidth(this);var b=getWindowHeight(this);getMap().resize(c,b)}function _calculateExtentResized(d,c){newExt=new OpenLayers.Bounds();var b=(map.getExtent().getWidth()/2)*(1/c);newExt.right=map.getCenter().lon+b;newExt.left=map.getCenter().lon-b;var f=(map.getExtent().getHeight()/2)*(1/d);newExt.top=map.getCenter().lat+f;newExt.bottom=map.getCenter().lat-f;return newExt}function getWindowWidth(b){if(OpenLayers.IAAA_Utils.isNetscape()){return(b.innerWidth)}else{if(b.document.body.clientWidth==0){return(b.document.documentElement.clientWidth)}else{return b.document.body.clientWidth}}}function getWindowHeight(b){if(OpenLayers.IAAA_Utils.isNetscape()){return(b.innerHeight-14)}else{if(b.document.body.clientWidth==0){return(b.document.documentElement.clientHeight)}else{return b.document.body.clientHeight}}};