<div class="inform repeat-item alert alert-{{alert.type}}" ng-repeat="alert in allInfos()" close="remove(alert)">{{alert.msg}}</div>
<form novalidate name="mainForm" ng-submit="mainForm.$valid && guardar()">
<div class="row">

    <div class="col-md-12">
		<button type="submit" class="btn btn-default" ng-show="permisos.MOD">
			<span class="fa fa-check" aria-hidden="true"></span> 
			<span class="hidden-xs"> Guardar</span>
		</button>
		<boton-copiar></boton-copiar>
		<span ng-class="actividadPropia || permisos.ADMIN ? '' : 'oculto'">
        <boton-visibilidad></boton-visibilidad>
        <modal-borrar recurso="evento"></modal-borrar>
        </span>
        <modal-peticion></modal-peticion>
        <button ng-show="!actividadPropia && permisos.VAL" type="button" class="btn btn-default" ng-click="desasociarPortal();">
            <span class="far fa-check-square" aria-hidden="true"></span>
            <span class="hidden-xs"> Desasociar del servicio</span>
        </button>
		<boton-debug ng-model="registro" ng-show="debug"></boton-debug>
        <span ng-if="registro.validacion === 'S'" role="alert" class="alert alert-warning destacado">Actividad pendiente de validación.</span>
        <span ng-if="registro.visible === 'N'" role="alert" class="alert alert-warning destacado">Actividad pendiente de publicación.</span>
        <span ng-repeat="org in registro.organizer">
            <span ng-if="org.validation === false" role="alert" class="alert alert-warning destacado">Entidad pendiente de validación.</span>
        </span>
    </div>

</div>

<hr/>

<div role="alert" class="alert alert-danger" ng-show="mainForm.$submitted && mainForm.$invalid">
	<ul>
		<li ng-repeat="(key, errors) in mainForm.$error track by $index"> 
			<!-- Errores: <strong>{{ key }}</strong> -->
			<div ng-if="key === 'required'">
				<strong>Faltan campos por completar:</strong>
				<ul>
					<li ng-repeat="e in errors">El campo <em>{{ e.$name }}</em> es obligatorio.</li>
				</ul>	
			</div>
			<div ng-if="key !== 'required'">
				<ul>
					<li ng-repeat="e in errors">El campo <em>{{ e.$name }}</em> tiene un error: <strong>{{ key }}</strong>.</li>
				</ul>	
			</div>
		</li>
	</ul>
</div>

<div class="row">

    <div class="col-md-12">

        <fieldset>
            <legend>Datos de la actividad 
            	<span ng-show="debug">[mainFormValid:<strong ng-class="{'text-success': mainForm.$valid, 'text-danger': !mainForm.$valid}">{{mainForm.$valid}}</strong>]</span>
            	<span ng-show="!actividadPropia" class="text-danger">Actividad creada por otra entidad</span>
            </legend>
			<div ng-if="registro.comentariosContacto" class="alert alert-info"><strong>Comentarios: </strong>{{registro.comentariosContacto}}</div>
			<div class="row">
                <div class="col-md-12 form-horizontal">
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <div class="btn-group" uib-dropdown>
                                <button type="button" class="btn btn-default dropdown-toggle" uib-dropdown-toggle>
                                    <span class="fa fa-info-circle" aria-hidden="true"></span> Control
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu" style="padding: 5px; min-width: 300px;">
                                    <li ng-hide="location === '/new'"><strong>ID: </strong>{{ registro.id }}</li>
                                    <li ng-hide="location === '/new'" class="divider"></li>
                                    <li>
                                        <strong>Servicio: </strong>
                                        <span class="label label-primary margin-r05em" ng-repeat="portal in registro.portales">{{portal.title}}</span>
                                    </li>
                                    <li><strong>Usuario de agenda: </strong>{{registro.codUsuario}}<span ng-show="registro.codUsuario === 1"> (web)</span></li>
                                    <li role="separator" class="divider"></li>
                                    <li ng-hide="location === '/new'"><strong>Fecha de alta: </strong>{{registro.creationDate | date:'dd-MM-yyyy'}}</li>
                                    <li ng-hide="location === '/new'"><strong>Fecha de modificaci&oacute;n: </strong>{{registro.lastUpdated | date:'dd-MM-yyyy'}}</li>
                                    <!-- <li><strong>Fecha de publicaci&oacute;n: </strong>{{registro.pubDate | date:'dd-MM-yyyy'}}</li> -->
                                    <li><strong>Usuario de alta: </strong>{{registro.usuarioAlta}}</li>
                                    <li><strong>Usuario de modificaci&oacute;n: </strong>{{registro.usuarioMod}}</li>
                                    <!-- <li><strong>Usuario de publicaci&oacute;n: </strong>{{registro.usuarioPub}}</li> -->
                                    <li role="separator" class="divider"></li>
                                    <li ng-if="registro.nombreContacto"><strong>Nombre: </strong>{{registro.nombreContacto}}</li>
                                    <li ng-if="registro.apellidosContacto"><strong>Apellidos: </strong>{{registro.apellidosContacto}}</li>
                                    <li ng-if="registro.emailContacto"><strong>Email: </strong>{{registro.emailContacto}}</li>
                                    <li ng-if="registro.telefonoContacto"><strong>Teléfono: </strong>{{registro.telefonoContacto}}</li>
                                </ul>
                            </div>
                            <button type="button" class="btn btn-default" ng-click="cargarFicha(registro.id, 'sede', registro.codUsuario);" ng-disabled="location === '/new'">
                            	<span class="fa fa-globe" aria-hidden="true"></span> 
                            	Ver ficha
                            </button>
                            <button type="button" class="btn btn-default" ng-click="cargarFicha(registro.id, 'ciudad', registro.codUsuario);" ng-disabled="location === '/new'">
                            	<span class="fa fa-globe" aria-hidden="true"></span> 
                            	Ver ficha ANTIGUA
                            </button>
                        </div>
                    </div>

                </div>
            </div>

            <div class="row margin-b2em">
                <div class="col-md-7 form-horizontal">

                    <div class="form-group" ng-class="{'has-error': (mainForm.$submitted || mainForm.titulo.$touched) && mainForm.titulo.$invalid}">
                        <label class="col-sm-2 control-label" for="titulo">
                        	<span class="obligatorio">Titulo:</span>
                        	<span class="oculto"> (campo obligatorio)</span>
                        </label>
                        <div class="col-sm-7">
                            <input ng-disabled="(!actividadPropia && !permisos.ADMIN) || permisos.MODRESTRICTED" class="form-control" type="text" name="titulo" id="titulo" ng-model="registro.title" value="{{ registro.title }}" required/>
                            <span ng-show="mainForm.$submitted || mainForm.titulo.$touched">
                                <span class="help-block" ng-show="mainForm.titulo.$error.required">Introduce el nombre de la actividad.</span>
                            </span>
                        </div>
                        <div class="col-sm-3">
                            <div class="input-group">
                                <input style="border-color:#CCC;" class="form-control" name="id" type="text" ng-model="registro.id" value="{{ registro.id }}" disabled/>
                                <div class="input-group-btn">
                                    <a href="" copy-to-clipboard="{{ registro.id }}" class="btn btn-default">
                                        <span class="fas fa-copy" aria-hidden="true"></span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
					
					<div class="form-group">
                        <label class="col-sm-2 control-label" for="citadestacada">Rese&ntilde;a destacados:</label>
                        <div class="col-sm-10">
                            <input ng-disabled="(!actividadPropia && !permisos.ADMIN) || permisos.MODRESTRICTED" class="form-control" type="text" name="citadestacada" id="citadestacada" ng-model="registro.citaDestacada" value="{{ registro.citaDestacada }}"/>
                        </div>
                    </div>
				
					<div class="form-group">
                        <label class="col-sm-2 control-label" for="web">Web de referencia:</label>
                        <div class="col-sm-10">
                            <div class="input-group">
								<input ng-disabled="(!actividadPropia && !permisos.ADMIN) || permisos.MODRESTRICTED" class="form-control" type="text" name="web" id="web" ng-model="registro.url" value="{{ registro.url }}"/>
								<div class="input-group-btn">
									<a ng-href="{{registro.url}}" target="_blank" class="btn btn-default" ng-class="{'disabled' : registro.url === undefined}">
						        		<span class="glyphicon glyphicon-share"></span>
						    		</a>
								</div>
							</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="twitter">Twitter:</label>
                        <div class="col-sm-10">
                            <input ng-disabled="(!actividadPropia && !permisos.ADMIN) || permisos.MODRESTRICTED" class="form-control" type="text" name="twitter" id="twitter" ng-model="registro.twitter" value="{{ registro.twitter }}"/>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="facebook">Facebook:</label>
                        <div class="col-sm-10">
                            <input ng-disabled="(!actividadPropia && !permisos.ADMIN) || permisos.MODRESTRICTED" class="form-control" type="text" name="facebook" id="facebook" ng-model="registro.facebook" value="{{ registro.facebook }}"/>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="instagram">Instagram:</label>
                        <div class="col-sm-10">
                            <input ng-disabled="(!actividadPropia && !permisos.ADMIN) || permisos.MODRESTRICTED" class="form-control" type="text" name="instagram" id="instagram" ng-model="registro.instagram" value="{{ registro.instagram }}"/>
                        </div>
                    </div>
                    
				</div>
				
				<div class="col-md-5">
					
					<label for="descripcion">Descripción:</label>
                    <textarea ng-disabled="(!actividadPropia && !permisos.ADMIN) || permisos.MODRESTRICTED" ck-editor-new id="descripcion" name="descripcion" ng-model="registro.description">{{ registro.description }}</textarea>
                    	
				</div>

            </div>
			
			<div class="row">
				<div class="col-md-12">
					<uib-tabset>
    					<uib-tab heading="Clasificación de la actividad">
    						
    						<div class="row">
    						
    							<div class="col-md-6 form-horizontal">

                                    <div class="form-group" ng-show="permisos.ADMIN">
                                        <label class="col-sm-2 control-label" for="portales">Servicio:</label>
                                        <div class="col-sm-10">
                                            <ui-select id="portales" multiple ng-model="portal.selected" style="width:400px;" on-select="onSelectPortal($item, $model)" on-remove="onRemovePortal($item, $model)" ng-disabled="usuario.propiedades.usr_agenda !== '1'">
                                                <ui-select-match class="ui-select-match" placeholder="Servicio al que pertenece: Web Municipal, CIPAJ...">
                                                    {{$item.title}}
                                                </ui-select-match>
                                                <ui-select-choices class="ui-select-choices" repeat="portal.id as portal in portales | filter: $select.search">
                                                    <div ng-bind-html="portal.title | highlight: $select.search"></div>
                                                </ui-select-choices>
                                            </ui-select>
                                            <span ng-show="debug">registro.portales: {{registro.portales}}<br/>portal.selected: {{portal.selected}}</span>
                                            <span ng-show="debug">registro.tipoActo: {{registro.tipoActo}}</span>
                                        </div>
                                    </div>
    								<div class="form-group" ng-class="{'has-error': (mainForm.$submitted || mainForm.formatoactividad.$touched) && mainForm.formatoactividad.$invalid}">
										<label class="col-sm-2 control-label" for="formatoActividad">
                                            <span class="obligatorio">Formato: </span>
                                            <span class="oculto"> (campo obligatorio)</span>
                                        </label>
										<div class="col-sm-10">
											<select ng-disabled="permisos.MODRESTRICTED" class="form-control" name="formatoActividad" id="formatoActividad" ng-model="registro.type" ng-options="formato.title as formato.title for formato in type" required>
												<option value="">- Selecciona formato -</option>
											</select>
                                            <span ng-show="mainForm.$submitted || mainForm.tema.$touched">
                                                <span class="help-block" ng-show="mainForm.tema.$error.required">Introduce la/s temática/s de la actividad.</span>
                                            </span>
                                            <span ng-if="debug">{{registro.type}}</span>
										</div>
									</div>
									
									<div class="form-group" ng-class="{'has-error': (mainForm.$submitted || mainForm.tema.$touched) && mainForm.tema.$invalid}">
   										<label class="col-sm-2 control-label" for="tema">
											<span class="obligatorio">Temáticas: </span>
                        					<span class="oculto"> (campo obligatorio)</span>
   										 </label>
   										<div class="col-sm-10">
   											<select ng-disabled="permisos.MODRESTRICTED" multiple class="form-control" id="tema" name="tema" ng-model="registro.category" ng-options="tema as tema.title for tema in category track by tema.id" required></select>
   											<span ng-show="mainForm.$submitted || mainForm.tema.$touched">
				                                <span class="help-block" ng-show="mainForm.tema.$error.required">Introduce la/s temática/s de la actividad.</span>
				                            </span>	
                                            <span ng-if="debug">{{registro.category}}</span>
   										</div>
   									</div>
									
									<div class="col-sm-offset-2 col-sm-10 small" ng-show="registro.programa && permisos.ADMIN"><strong>Programa gestión antigua:</strong> {{registro.program}}</div>

	    							<div class="form-group">
				                        <label class="col-sm-2 control-label" for="programa">Programa:</label>
				                        <div class="col-sm-10">
											<autocompletado id="programa" name="autoprograma" autocomplete="off" typeahead-editable="false" placeholder="Buscar programa o ciclo" modelo="registro.program" uri="/sede/servicio/cultura/evento/programa-list" filtro="'title'" check="selectPrograma(registro.programa);"></autocompletado>
											<span ng-if="debug">{{programaSeleccion}}</span>
				                        </div>
				                    </div>
									<div class="form-group">
                                        <label class="col-sm-6 control-label" for="accessible">
                                            <input type="checkbox" id="accessible" name="accessible" ng-model="registro.accessible"/>
                                            Actividad sin barreras <span ng-if="debug">{{[registro.accessible]}}</span>
                                        </label>
                                    </div>
	    							<div class="form-group">
										<label class="col-sm-2 control-label" for="poblaciondestino">Población:</label>
										<div class="col-sm-10">
											<ui-select multiple ng-model="pobDestino.selected" style="width:400px;" on-select="onSelectPobDestino($item, $model)" on-remove="onRemovePobDestino($item, $model)">
											    <ui-select-match class="ui-select-match" placeholder="Sector de población: Mujeres, Jóvenes...">
											    	{{$item.title}}
											    </ui-select-match>
											    <ui-select-choices class="ui-select-choices" repeat="sector.id as sector in poblacion | filter: $select.search">
											    	<div ng-bind-html="sector.title | highlight: $select.search"></div>
											    </ui-select-choices>
											</ui-select>
                                            <span ng-if="debug">registro.poblacion: {{registro.population}}<br/>pobDestino.selected: {{pobDestino.selected}}</span>
										</div>
									</div>

                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="col-sm-8 control-label" for="minAge">Edad mínima: </label>
                                                <div class="col-sm-4">
                                                    <input ng-disabled="permisos.MODRESTRICTED" class="form-control" name="minAge" id="minAge" type="number" ng-min="1" ng-model="registro.minAge" value="{{registro.minAge}}" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="col-sm-8 control-label" for="maxAge">Edad máxima: </label>
                                                <div class="col-sm-4">
                                                    <input ng-disabled="permisos.MODRESTRICTED" class="form-control" name="maxAge" id="maxAge" type="number" ng-model="registro.maxAge" value="{{registro.maxAge}}" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
    							</div>
    								
   								<div class="col-md-6 form-horizontal">
   									<div class="form-group">
                                        <label class="col-sm-2 control-label" for="origen">Estado: <span ng-show="debug">{{registro.status}}</span></label>
                                        <div class="col-sm-10">
                                            <select ng-disabled="permisos.MODRESTRICTED" class="form-control" id="status" ng-model="registro.status">
                                                <option value="S">Correcto</option>
                                                <option value="R">Reprogramado</option>
                                                <option value="C">Cancelado</option>
                                            </select>
                                        </div>
                                    </div>
   									<div class="form-group">
				                        <label class="col-sm-2 control-label" for="query">Querys:</label>
				                        <div class="col-sm-10">
				                            <input ng-disabled="permisos.MODRESTRICTED" class="form-control" type="text" name="query" ng-model="registro.query" value="{{ registro.query }}"/>
				                        </div>
				                    </div>

									
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label" for="origen">Origen:</label>
                                        <div class="col-sm-10">
                                            <select class="form-control" id="origen" ng-model="registro.origen" ng-options="origen for origen in origenes">
                                                <option value="">- Selecciona origen -</option>
                                            </select>
                                            <span ng-if="debug">{{registro.origen}}</span>
                                        </div>
                                    </div>
									
 									<!--
 									<label for="temaprincipal">Tema principal: <span ng-show="debug">{{registro.categorias}}</span></label>
									<select multiple class="form-control" id="temaprincipal" ng-model="registro.categorias" ng-options="(cat.title | indent:cat.subtema) for cat in categorias"></select>
									-->

									
									
									

               						<div class="form-group">
										<label class="col-sm-2 control-label" for="poblaciondestino">Valores:</label>
										<div class="col-sm-10">
											<ui-select multiple ng-model="valoresAct.selected" style="width:400px;" on-select="onSelectValores($item, $model)" on-remove="onRemoveValores($item, $model)">
											    <ui-select-match class="ui-select-match" placeholder="Valores que promulga el acto">
											    	{{$item.title}}
											    </ui-select-match>
											    <ui-select-choices class="ui-select-choices" repeat="valor.id as valor in valores | filter: $select.search">
											    	<div ng-bind-html="valor.title | highlight: $select.search"></div>
											    </ui-select-choices>
											</ui-select>
                                            <span ng-if="debug">registro.value: {{registro.value}}<br/>valores.selected: {{valores.selected}}</span>
										</div>
									</div>

                                    <div class="form-group">
                                        <label class="col-sm-2 control-label" for="bloqueZGZ16">Bloque ZGZ16:</label>
                                        <div class="col-sm-10">
                                            <autocompletado ng-disabled="permisos.MODRESTRICTED" name="bloqueZGZ16" id="bloqueZGZ16" autocomplete="off" typeahead-editable="false" modelo="registro.blockZGZ16" uri="/sede/servicio/cultura/evento/bloques-z16" filtro="'title'"></autocompletado>
                                            <span ng-if="debug">{{blockZGZ16}}</span>
                                        </div>
                                    </div>
   								</div>
    							
    						</div>
    					</uib-tab>
    					<uib-tab heading="Lugar, fecha y horario">
    						
							<div class="row">
							
								<div class="col-md-10 form-horizontal">

									<div class="col-sm-offset-3 col-sm-9 small" ng-if="registro.location && permisos.ADMIN"><strong>Lugar de Realización gestión antigua:</strong> {{registro.location}}</div>
								
				                    <div class="form-group" ng-class="{'has-error': (mainForm.$submitted || mainForm.lugarRealizacion.$touched) && mainForm.lugarRealizacion.$invalid}">
				                        <label class="col-sm-3 control-label" for="lugarRealizacion">
				                        	<span class="obligatorio">Lugar de realización:</span>
                        					<span class="oculto"> (campo obligatorio)</span>
				                        </label>
				                        <div class="col-sm-6">
				                            <autocompletado ng-disabled="permisos.MODRESTRICTED" id="lugarRealizacion" name="lugarRealizacion" modal-lugar check="lanzarModalLugar(lugarSeleccion, true);selectLugar(lugarSeleccion);lugarSeleccion=''" modelo="lugarSeleccion" uri="/sede/servicio/cultura/evento/lugar-realizacion" filtro="title" ng-required="registro.subEvent === undefined" ng-disabled="esLiderDeEquipamiento"></autocompletado>
				                            <span ng-show="mainForm.$submitted || mainForm.lugarRealizacion.$touched">
				                                <span class="help-block" ng-show="mainForm.lugarRealizacion.$error.required">Introduce un lugar de realización.</span>
				                            </span>
										</div>
				                    </div>

									<div class="form-group" ng-show="registro.subEvent.length > 0">
				                        
				                    	<div class="col-sm-12">
				                    		<table class="table table-striped table-condensed table-bordered table-hover table-btn">
												<thead>
													<tr>
														<th>Nombre del lugar</th>
														<th>Fechas y horarios</th>
														<th>Operaciones</th>
													</tr>
												</thead>
												<!-- <tr ng-class="{'danger': subEvent.location.id.indexOf('lug') !== -1}" ng-repeat="subEvent in registro.subEvent"> -->
                                                <tr ng-repeat="subEvent in registro.subEvent">
													<td>
                                                        <div class="btn-group" uib-dropdown>
                                                            <button type="button" class="btn btn-xs btn-default dropdown-toggle" uib-dropdown-toggle>
                                                                <span class="far fa-building" aria-hidden="true"></span>
                                                            </button>
                                                            <ul class="dropdown-menu" style="padding: 5px; min-width: 260px;">
                                                                <li><strong>Dirección: </strong> {{subEvent.location.streetAddress}}</li>
                                                                <li><strong>Cód. Postal: </strong> {{subEvent.location.postalCode}}</li>
                                                                <li ng-if="subEvent.location.addressLocality !== 'Zaragoza'"><strong>Localidad: </strong> {{subEvent.location.addressLocality}}</li>
                                                                <li><strong>Junta: </strong> {{subEvent.location.junta}}</li>
                                                                <li><strong>Teléfono: </strong> {{subEvent.location.telephone}}</li>
                                                            </ul>
                                                        </div>
                                                        {{subEvent.location.title}}
                                                        <span class="label label-default" ng-if="subEvent.space">
                                                            {{subEvent.space.title}}
                                                        </span>
                                                        <i ng-bind-html="subEvent.comment | trusted"></i>
                                                    </td>
													<td>
														{{subEvent.startDate | date:'dd/MM/yyyy'}}
                                                        <span ng-if="subEvent.startDate"> - </span>
                                                        {{subEvent.endDate | date:'dd/MM/yyyy'}}
														<div ng-if="subEvent.openingHours !== undefined">
															<!-- <strong>Calendario: </strong> -->
															<ul ng-repeat="oh in subEvent.openingHours">
                                                                <li>
                                                                    {{oh.dayOfWeek}} 
                                                                    {{oh.startTime}}
                                                                    <span ng-if="oh.endTime"> - </span>
                                                                    {{oh.endTime}}
                                                                    <div ng-if="oh.maximumCapacity">
                                                                        <strong>Entradas totales: </strong>{{oh.maximumCapacity}}
                                                                        <br/>
                                                                        <strong>Entradas restantes: </strong>{{oh.remainingCapacity}}
                                                                    </div>
                                                                </li>
                                                            </ul>
														</div>
                                                        <div ng-if="subEvent.horaInicio && permisos.ADMIN">
                                                            <strong>Calendario vieja gestión: </strong>
                                                            {{subEvent.horaInicio | date:'HH:mm'}}
                                                            <span ng-if="subEvent.horaFinal"> - </span>
                                                            {{subEvent.horaFinal | date:'HH:mm'}}
                                                        </div>
													</td>
													<td class="boton">
														<button type="button" ng-disabled="permisos.MODRESTRICTED" class="btn btn-default" ng-click="lanzarModalLugar(subEvent, false, $index);"><span class="fas fa-pencil-alt"></span><span class="hidden-xs"> Editar</span></button>
														<button type="button" ng-disabled="permisos.MODRESTRICTED" class="btn btn-default margin-l05em" ng-click="borrarLugarLista($index)"><span class="fas fa-trash-alt"></span><span class="hidden-xs"> Borrar</span></button>
													</td>
												</tr>
											</table>
				                    	</div>
				                    </div>

                                    <div class="form-group" ng-show="showLocation || registro.subEvent[0].location.title === 'Fuera de Zaragoza' || registro.subEvent[0].location.title === 'Lugar por determinar'">
                                        <label class="col-sm-3 control-label" for="location">Lugar de realización<br/>(Fuera de Zaragoza o por determinar)</label>
                                        <div class="col-sm-6">
                                            <input class="form-control" name="location" id="location" type="text" ng-model="registro.location" value="{{registro.location}}" />
                                        </div>
                                    </div>
                                    <span ng-if="debug">{{[registro.location]}}</span>
									
								</div>
							
							</div>

<!-- 							<div role="alert" class="alert alert-info" ng-show="permisos.ADMIN">
								Las fechas de Actividad solo están disponibles de forma manual para actividades en las que <strong>NO</strong> se indique lugar de realización.
								<br/>
								En caso contrario, estas fechas <u>se sustituyen automáticamente al guardar</u> con las fechas máxima y mínima de los lugares de realización asociados. Puedes encontrar más información en la ayuda.
							</div>
							<div class="row" ng-show="permisos.ADMIN">
				                <div class="col-md-6">
			                    	<div class="form-group" ng-class="{'has-error': mainForm.startDate.$invalid && mainForm.startDate.$dirty}">
				                        <label for="" class="col-sm-4 control-label">Fecha Inicio Actividad:</label>
				                        <div class="col-sm-8">
				                            <div class="input-group">
				                                <input name="startDate" type="text" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="registro.startDate" is-open="datepickers.startDate" close-text="Cerrar" current-text="Hoy" clear-text="Borrar" ng-disabled="registro.subEvent.length > 0" />
				                                <span class="input-group-btn">
				                                    <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'startDate')" ng-disabled="registro.subEvent.length > 0">
			                                        	<span class="fas fa-calendar-alt" aria-hidden="true"></span>
				                                	</button>
				                                </span>
				                            </div>
				                        </div>
				                    </div>
				                </div>
				                <div class="col-md-6">
				                    <div class="form-group" ng-class="{'has-error': mainForm.endDate.$invalid && mainForm.endDate.$dirty}">
				                        <label for="" class="col-sm-4 control-label">Fecha Final Actividad:</label>
				                        <div class="col-sm-8">
				                            <div class="input-group">
				                                <input name="endDate" type="text" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="registro.endDate" is-open="datepickers.endDate" close-text="Cerrar" current-text="Hoy" clear-text="Borrar" datepicker-options="{minDate: registro.startDate}" ng-disabled="registro.subEvent.length > 0" />
				                                <span class="input-group-btn">
			                                        <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'endDate')" ng-disabled="registro.subEvent.length > 0">
			                                            <span class="fas fa-calendar-alt" aria-hidden="true"></span>
			                                		</button>
				                                </span>
				                            </div>
				                        </div>
				                    </div>
				                </div>
				            </div> -->

    					</uib-tab>
    					<uib-tab heading="Inscripción">
    						
    						<div class="row">
    						
	    						<div class="col-md-6 form-horizontal">
                                    
	    							<a class="btn btn-default" ng-show="{{registro.registration.plazasOnline}}" href="/sede/servicio/cultura/evento/admin/inscripcion/{{registro.id}}/list" target="_blank">
                                        <span class="fa fa-user" aria-hidden="true"></span>
                                        <span class="hidden-xs"> Ver Inscritos</span>
                                    </a>

                                    <modal-monitores ng-show="{{registro.registration.plazasOnline}}"></modal-monitores>

                                    <hr class="sm"/>

	    							<div class="form-group">
				                        <label class="col-sm-2 control-label" for="lugarInscripcion">Lugar:</label>
				                        <div class="col-sm-10">
				                        	<div class="input-group">
				                        		<autocompletado ng-disabled="permisos.MODRESTRICTED" id="lugarInscripcion" name="lugarInscripcion" modelo="registro.registration.title" uri="/sede/servicio/cultura/evento/lugar-realizacion" filtro="title" check="completarInscripcion(registro.registration.title)"></autocompletado>
				                        		<span class="input-group-btn">
				                        			<button ng-disabled="permisos.MODRESTRICTED" type="button" class="btn btn-default" ng-click="borrarInscripcion()">Borrar</button>
				                        		</span>
				                        	</div>
				                        </div>
				                    </div>
	    							
	    							<div class="form-group">
				                        <label class="col-sm-2 control-label" for="direccionInscripcion">Direcci&oacute;n:</label>
				                        <div class="col-sm-10">
				                            <input class="form-control" ng-disabled="permisos.MODRESTRICTED" name="direccionInscripcion" id="direccionInscripcion" type="text" ng-model="registro.registration.streetAddress" value="{{registro.registration.streetAddress}}" />
				                        </div>
				                    </div>
	    							
	    							<div class="form-group">
				                        <label class="col-sm-2 control-label" for="telefonoInscripcion">Tel&eacute;fono:</label>
				                        <div class="col-sm-10">
				                            <input class="form-control" ng-disabled="permisos.MODRESTRICTED" name="telefonoInscripcion" id="telefonoInscripcion" type="text" ng-model="registro.registration.telephone" value="{{registro.telephone}}" />
				                        </div>
				                    </div>
				                    
				                    <div class="form-group">
				                        <label class="col-sm-2 control-label" for="faxInscripcion">Fax:</label>
				                        <div class="col-sm-10">
				                            <input class="form-control" ng-disabled="permisos.MODRESTRICTED" name="faxInscripcion" id="faxInscripcion" type="text" ng-model="registro.registration.faxNumber" value="{{registro.registration.faxNumber}}" />
				                        </div>
				                    </div>
			                    	
			                    	<div class="form-group">
				                        <label class="col-sm-2 control-label" for="emailInscripcion">Email</label>
				                        <div class="col-sm-10">
				                            <input class="form-control" ng-disabled="permisos.MODRESTRICTED" name="emailInscripcion" id="emailInscripcion" type="text" ng-model="registro.registration.email" value="{{registro.registration.email}}" />
				                        </div>
				                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label" for="webInscrip">Web Inscripción:</label>
                                        <div class="col-sm-10">
                                            <div class="input-group">
                                                <input class="form-control" name="webInscrip" id="webInscrip" type="text" ng-model="registro.registration.url" value="{{registro.registration.url}}" />
                                                <span class="input-group-btn" >
                                                    <a ng-href="{{registro.registration.url}}" target="_blank" class="btn btn-default disabled" ng-class="{'disabled' : registro.registration.url === undefined}">
                                                        <span class="glyphicon glyphicon-share"></span>
                                                    </a>
                                                    <button type="button" class="btn btn-default" ng-click="crearInscripcion(registro);" ng-disabled="location === '/new'">
                                                        Crear
                                                    </button>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
									<div class="form-group">
				                        <label class="col-sm-2 control-label" for="formaPago">Forma de Pago:</label>
				                        <div class="col-sm-4">
                                            <select class="form-control" id="formaPago" name="formaPago" ng-model="registro.formaPago" ng-options="fp.id as fp.title for fp in formasDePago" ng-change="checkFormaPago(registro.formaPago);">
                                                <option value="">- Seleccionar -</option>
                                            </select>
				                        </div>
                                        <label class="col-sm-2 control-label" for="numPagos">Num. Pagos:</label>
                                        <div class="col-sm-3">
                                            <input class="form-control" name="numPagos" id="numPagos" type="number" ng-model="registro.numPagos" value="{{registro.numPagos}}" />
                                        </div>
				                    </div>
                                    

                                    <div class="form-group">
                                        <label class="col-sm-6 control-label" for="cuestionario">
                                            <input type="checkbox" id="cuestionario" name="cuestionario" ng-model="registro.cuestionario" ng-disabled="location === '/new' || registro.registration.url === undefined"/>
                                            Enviar Cuestionario <span ng-show="debug">{{[registro.cuestionario]}}</span>
                                        </label>
                                        <label class="col-sm-2 control-label" for="tipoInscripcion">Tipo</label>
                                        <div class="col-sm-4">
                                            <select class="form-control" id="tipoInscripcion" name="tipoInscripcion" ng-model="registro.registration.tipo">
                                                <option value="D">Directa</option>
                                                <option value="P">Preinscripción</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="col-sm-4 control-label" for="emailInscripcion">plazasTotal</label>
                                                <div class="col-sm-8">
                                                    <input class="form-control" name="plazasTotal" id="plazasTotal" type="text" ng-model="registro.registration.plazasTotal" value="{{registro.registration.plazasTotal}}" ng-disabled="location === '/new' || registro.registration.url === undefined" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <label class="col-sm-4 control-label" for="emailInscripcion">plazasOnline</label>
                                                <div class="col-sm-8">
                                                    <input class="form-control" name="plazasOnline" id="plazasOnline" type="text" ng-model="registro.registration.plazasOnline" value="{{registro.registration.plazasOnline}}" ng-disabled="location === '/new' || registro.registration.url === undefined" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>                                    
			                    	
			                    </div>
			                    
				                <div class="col-md-6 form-horizontal">
				                   	
				                   	<div class="form-group">
				                        <label class="col-sm-2 control-label" for="requisitosInscrip">Requisitos:</label>
				                        <div class="col-sm-10">
				                            <textarea class="form-control" ng-disabled="permisos.MODRESTRICTED" name="requisitosInscrip" id="requisitosInscrip" ng-model="registro.registration.description">{{registro.registration.description}}</textarea>
				                        </div>
				                    </div>
				                   	
				                   	<div class="row">
					                   	<div class="col-sm-6">
						                    <div class="form-group">
								                <label for="fInicioInscrip" class="col-sm-4 control-label">Fecha Inicio: </label>
								                <div class="col-sm-8">
								                    <div class="input-group">
								                        <input type="text" id="fInicioInscrip" name="fInicioInscrip" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="registro.registration.startDate" is-open="datepickers.startDateInscrip" close-text="Cerrar" current-text="Hoy" clear-text="Borrar" my-date/>
								                        <span class="input-group-btn">
								                            <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'startDateInscrip')">
								                                <span class="fas fa-calendar-alt" aria-hidden="true"></span>
								                            </button>
								                        </span>
								                    </div>
								                    <span class="help-block" ng-show="debug">
		                                                [{{registro.registration.startDate}}]
		                                            </span>
								                </div>
								            </div>
							            </div>
					                    
					                   	<div class="col-sm-6">
						                    <div class="form-group">
								                <label for="fFinalInscrip" class="col-sm-4 control-label">Fecha Fin: </label>
								                <div class="col-sm-8">
								                    <div class="input-group">
								                        <input type="text" id="fFinalInscrip" name="fFinalInscrip" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="registro.registration.endDate" is-open="datepickers.endDateInscrip" close-text="Cerrar" current-text="Hoy" clear-text="Borrar" datepicker-options="{minDate: registro.registration.endDate}" />
								                        <span class="input-group-btn">
								                            <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'endDateInscrip')">
								                                <span class="fas fa-calendar-alt" aria-hidden="true"></span>
								                            </button>
								                        </span>
								                    </div>
								                    <span class="help-block" ng-show="debug">
		                                                [{{registro.registration.endDate}}]
		                                            </span>
								                </div>
								            </div>
							            </div>
				                    </div>
				                    
				                    <div class="form-group">
				                        <label class="col-sm-2 control-label" for="horarioInscrip">Horario:</label>
				                        <div class="col-sm-10">
											<textarea ng-disabled="permisos.MODRESTRICTED" ck-editor-new id="horarioInscrip" name="horarioInscrip" ng-model="registro.registration.openingHours">{{ registro.registration.openingHours }}</textarea>
				                        </div>
				                    </div>

				                   	<div class="form-group">
				                        <label class="col-sm-2 control-label" for="requisitosCanjeo">Requisitos Canjeo:</label>
				                        <div class="col-sm-10">
				                            <textarea ng-disabled="permisos.MODRESTRICTED" class="form-control" name="requisitosCanjeo" id="requisitosCanjeo" ng-model="registro.registration.requisitosCanjeo">{{registro.registration.requisitosCanjeo}}</textarea>
				                        </div>
				                    </div>
				                   	
				                   	<div class="row">
					                   	<div class="col-sm-6">
						                    <div class="form-group">
								                <label for="fechaInicioCanjeo" class="col-sm-4 control-label">Fecha Inicio Canjeo: </label>
								                <div class="col-sm-8">
								                    <div class="input-group">
								                        <input ng-disabled="permisos.MODRESTRICTED" type="text" id="fechaInicioCanjeo" name="fechaInicioCanjeo" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="registro.registration.fechaInicioCanjeo" is-open="datepickers.fechaInicioCanjeo" close-text="Cerrar" current-text="Hoy" clear-text="Borrar" my-date/>
								                        <span class="input-group-btn">
								                            <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'fechaInicioCanjeo')">
								                                <span class="fas fa-calendar-alt" aria-hidden="true"></span>
								                            </button>
								                        </span>
								                    </div>
								                    <span class="help-block" ng-show="debug">
		                                                [{{registro.registration.fechaInicioCanjeo}}]
		                                            </span>
								                </div>
								            </div>
							            </div>
					                    
					                   	<div class="col-sm-6">
						                    <div class="form-group">
								                <label for="fechaFinCanjeo" class="col-sm-4 control-label">Fecha Fin Canjeo: </label>
								                <div class="col-sm-8">
								                    <div class="input-group">
								                        <input ng-disabled="permisos.MODRESTRICTED" type="text" id="fechaFinCanjeo" name="fechaFinCanjeo" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="registro.registration.fechaFinCanjeo" is-open="datepickers.fechaFinCanjeo" close-text="Cerrar" current-text="Hoy" clear-text="Borrar" datepicker-options="{minDate: registro.registration.fechaInicioCanjeo}" />
								                        <span class="input-group-btn">
								                            <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'fechaFinCanjeo')">
								                                <span class="fas fa-calendar-alt" aria-hidden="true"></span>
								                            </button>
								                        </span>
								                    </div>
								                    <span class="help-block" ng-show="debug">
		                                                [{{registro.registration.fechaFinCanjeo}}]
		                                            </span>
								                </div>
								            </div>
							            </div>
				                    </div>
				                    
				                </div>
			                    
    						</div>
    					</uib-tab>
    					<uib-tab heading="Precio">
		                    <div class="row">
		                    	<div class="col-md-10">
		                    		<table class="table table-striped table-condensed table-bordered table-btn">
		                    			<thead>
							                <tr>
						                        <th>Precio</th>
						                        <!-- <th>Moneda</th> -->
						                        <th>Tipo/Grupo</th>
						                        <th>Nº mínimo de personas</th>
						                        <th>Operaciones</th>
							                </tr>
								        </thead>
								        <tbody>
						        			<tr ng-repeat="precio in registro.price"><form>
						        				<td>
						        					<div ng-hide="verCampo">{{precio.hasCurrencyValue | currency:"€":2}}</div>
													<!-- <div ng-show="modificarCampo">
														<input class="form-control" type="number" ng-model="precio.hasCurrencyValue" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" step="0.01" />
													</div> -->
						        				</td>
						        				<!-- <td>
													<div ng-hide="verCampo">{{precio.hasCurrency}}</div>
													<div ng-show="modificarCampo">
														{{precio.hasCurrency}}
													</div>
												</td -->
						        				<td>
						        					<div ng-hide="verCampo">{{precio.fareGroup}}</div>
													<!-- <div ng-show="modificarCampo">
														<select class="form-control" ng-model="precio.fareGroup" ng-options="tipo.title as tipo.title for tipo in tiposPrecio"></select>
													</div> -->
												</td>
						        				<td>
													<div ng-hide="verCampo">{{precio.minSize}}</div>
													<!-- <div ng-show="modificarCampo">
														<input class="form-control" type="text" ng-model="precio.minSize" />
													</div> -->
												</td>
						        				<td>
													<!--<button class="btn btn-default" ng-hide="verCampo" ng-click="modificarPrecio(precio);"><span class="glyphicon glyphicon-pencil"> Modificar</button>
													<button class="btn btn-default" ng-show="modificarCampo" ng-click="actualizarPrecio(precio);"><span class="glyphicon glyphicon-check"> Actualizar</button>-->
													<button type="button" class="btn btn-default" ng-hide="verCampo" ng-click="eliminarPrecio($index);"><span class="glyphicon glyphicon-trash"></span> Eliminar</button>
												</td></form>
						        			</tr>
						        			<tr>
						        				<td>
						        					<input ng-disabled="permisos.MODRESTRICTED" class="form-control" name="precio" type="number" ng-model="nPrecio.hasCurrencyValue" ng-pattern="/^[0-9]+(\.[0-9]{1,2})?$/" step="0.01" placeholder="Introduce un precio" ng-disabled="nPrecio.fareGroup === 'Gratuita'" />
						        				</td>
						        				<!-- <td>
						        					<div ng-show="modificarCampo">
														{{precio.hasCurrency}}
													</div>
						        				</td> -->
						        				<td>
													<select ng-disabled="permisos.MODRESTRICTED" class="form-control" ng-model="nPrecio.fareGroup" ng-options="tipo.title as tipo.title for tipo in tiposPrecio">
														<option value="">-- Selecciona tipo de entrada --</option>
													</select>
						        				</td>
						        				<td>
													<input ng-disabled="permisos.MODRESTRICTED" class="form-control" type="text" ng-model="nPrecio.minSize" placeholder="Introduce el num. de personas" />
						        				</td>
						        				<td>
						        					<button ng-disabled="permisos.MODRESTRICTED" type="button" class="btn btn-sm btn-primary" ng-click="aniadirPrecio(nPrecio);" ng-disabled="nPrecio.fareGroup === undefined || mainForm.precio.$invalid">Añadir precio</button>
						        				</td>
						        			</tr>
						        		</tbody>
					        		</table>
		                    	</div>
                                <div class="col-md-2">
                                    <label for="numParticipantes">Número de participantes:
                                        <input ng-disabled="permisos.MODRESTRICTED" class="form-control" id="numParticipantes" type="number" ng-maxlength="5"
                                         ng-model="registro.numParticipantes" value="{{registro.numParticipantes}}" style="width:6em;"/>
                                    </label>
                                </div>
		                    </div>
		                    <div class="row">
		                    	<div class="col-md-6">
									<label class="control-label" for="comentariosEntrada">Comentarios de la entrada:</label>
									<textarea ng-disabled="permisos.MODRESTRICTED" ck-editor-new id="comentariosEntrada" name="comentariosEntrada" ng-model="registro.priceComment">{{ registro.priceComment }}</textarea>
								</div>
                                <div class="col-md-6" ng-show="registro.precio">
                                    <strong>Precio Gestión Antigua:</strong> {{ registro.precio }}
                                </div>
								<!-- <div class="col-md-6" ng-show="permisos.ADMIN">
									<div class="pull-right margin-r3em" style="margin-top:-.5em;">
										<label> <input type="checkbox" ng-model="registro.tipoEntrada" ng-true-value="'libre'" ng-false-value="''" /> Actividad gratuita (gestión antigua: <em>libre</em>)<span ng-show="debug">[{{registro.tipoEntrada}}]</span></label>
									</div>
									<div ng-show="registro.tipoEntrada !== 'libre'">
										<label class="control-label" for="precioEntrada">Precio <strong>gestión antigua</strong>:</label>
										<textarea ck-editor-new id="precioEntrada" name="precioEntrada" ng-model="registro.precioEntrada">{{ registro.precioEntrada }}</textarea>
									</div>
								</div> -->
							</div>
    					</uib-tab>
    					<uib-tab heading="Entidades">
                            
                            <a href="/sede/servicio/cultura/evento/admin/entidad/#/new" target="_blank" class="btn btn-default">
                                <span class="far fa-address-card" aria-hidden="true"></span>
                                <span class="hidden-xs"> Crear entidad</span>
                            </a>
                            
                            <hr class="sm"/>

                            <div class="row">
                                <div class="col-sm-6">
	   								<div class="form-group" ng-class="{'has-error': (mainForm.$submitted || mainForm.entidadOrganiza.$touched) && mainForm.entidadOrganiza.$invalid}">
				                        <label class="col-sm-4 control-label" for="entidadOrganiza">
                                            <span ng-if="registro.codUsuario !== 2">Entidad que organiza:</span>
                                            <span ng-if="registro.codUsuario === 2">
                                                <span class="obligatorio">Entidad que organiza:</span>
                                                <span class="oculto"> (campo obligatorio)</span>
                                            </span>
                                        </label>
				                        <div class="col-sm-8">
				                        	<autocompletado ng-disabled="permisos.MODRESTRICTED" autocomplete="off" id="entidadOrganiza" name="entidadOrganiza" modelo="entidadOrganiza" uri="/sede/servicio/cultura/evento/entidad" filtro="title" fiql="updated==true" check="selectEntidadOrganiza(entidadOrganiza);entidadOrganiza=''" placeholder="Buscar entidad organizadora..." ng-required="registro.codUsuario === 2 && registro.organizer === undefined"></autocompletado>
                                            <span ng-show="mainForm.$submitted || mainForm.entidadOrganiza.$touched">
                                                <span class="help-block" ng-show="mainForm.entidadOrganiza.$error.required">Introduce una entidad organizadora.</span>
                                            </span>
				                        </div>
				                        
				                    </div>
                                </div>
                                <div class="col-sm-6">                                        
                                    <table class="table table-striped table-condensed table-bordered table-btn" ng-show="registro.organizer.length > 0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Nombre</th>
                                                <th>Operaciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="entidad in registro.organizer" ng-class="{warning : entidad.updated === false, danger : entidad.validation === false}">
                                                <td>{{entidad.id}}</td>
                                                <td>
                                                    {{entidad.title}}
                                                    <a ng-if="tienePermiso('AGENDA','ENTIDAD','MOD')" class="btn btn-xs" href="/sede/servicio/cultura/evento/admin/entidad/#/edit/{{entidad.id}}" target="_blank" title="Abrir en pestaña nueva"><span class="glyphicon glyphicon-export"></span></a>
                                                </td>
                                                <td><button type="button" class="btn btn-default btn-xs" ng-click="eliminarEntidadOrganiza($index);"><span class="glyphicon glyphicon-trash"></span> Eliminar</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <hr class="sm"/>

                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label" for="entidadImparte">
                                            Entidad que imparte:
                                        </label>
                                        <div class="col-sm-8">
                                            <autocompletado autocomplete="off" id="entidadImparte" modelo="entidadImparte" uri="/sede/servicio/cultura/evento/entidad" filtro="title" fiql="updated==true" check="selectEntidadImparte(entidadImparte);entidadImparte=''" placeholder="Buscar entidad organizadora..."></autocompletado>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <table class="table table-striped table-condensed table-bordered table-btn" ng-show="registro.performer.length > 0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Nombre</th>
                                                <th>Operaciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="entidad in registro.performer" ng-class="{warning : entidad.updated === false, danger : entidad.validation === false}">
                                                <td>{{entidad.id}}</td>
                                                <td>
                                                    {{entidad.title}}
                                                    <a ng-if="tienePermiso('AGENDA','ENTIDAD','MOD')" class="btn btn-xs" href="/sede/servicio/cultura/evento/admin/entidad/#/edit/{{entidad.id}}" target="_blank" title="Abrir en pestaña nueva"><span class="glyphicon glyphicon-export"></span></a>
                                                </td>
                                                <td><button type="button" class="btn btn-default btn-xs" ng-click="eliminarEntidadImparte($index);"><span class="glyphicon glyphicon-trash"></span> Eliminar</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

    					</uib-tab>

    					<uib-tab heading="Destacados e informes">
    						<div class="row">
	    						<div class="col-md-6 form-horizontal">

	    							<div class="well">
	    								<p class="lead"><strong>Fechas destacadas</strong></p>
                                        <!-- <div class="pull-right">
                                            <label for="actividadDestacada">
                                            <input type="checkbox" id="actividadDestacada" ng-click="destacadaToggle(registro.tipoActo);" ng-model="registro.destacada" />
                                            Actividad Destacada
                                            </label>
                                        </div> -->
                                        <div class="form-group" ng-show="permisos.ADMIN">
                                            <label for="selectPortal" class="col-sm-4 control-label">Seleccionar servicio:</label>
                                            <div class="col-sm-8">
                                                <select ng-disabled="permisos.MODRESTRICTED" name="selectPortal" id="selectPortal" ng-model="portalSelected" ng-options="p as p.portal.title for p in registro.portales" class="form-control"></select>
                                                <span class="help-block" ng-if="debug">
                                                    {{portalSelected}}
                                                </span>
                                            </div>
                                        </div>
	    								<hr/>
		    							<div class="form-group">
							                <label for="" class="col-sm-4 control-label">Fecha Inicio Destacado:</label>
							                <div class="col-sm-8">
							                    <div class="input-group">
							                        <input ng-disabled="permisos.MODRESTRICTED" type="text" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="portalSelected.featuredStartDate" is-open="datepickers.inicioDestacado" close-text="Cerrar" current-text="Hoy" clear-text="Borrar"/>
							                        <span class="input-group-btn">
							                            <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'inicioDestacado')">
							                                <span class="fas fa-calendar-alt" aria-hidden="true"></span>
							                            </button>
							                        </span>
							                    </div>
							                    <span class="help-block" ng-if="debug">
                                                    [{{portalSelected.featuredStartDate}}]
                                                </span>
							                </div>
							            </div>
		    							<div class="form-group">
							                <label for="" class="col-sm-4 control-label">Fecha Fin Destacado: </label>
							                <div class="col-sm-8">
							                    <div class="input-group">
							                        <input ng-disabled="permisos.MODRESTRICTED" type="text" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="portalSelected.featuredEndDate" is-open="datepickers.finDestacado" close-text="Cerrar" current-text="Hoy" clear-text="Borrar" datepicker-options="{minDate: registro.inicioDestacado}"/>
							                        <span class="input-group-btn">
							                            <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'finDestacado')">
							                                <span class="fas fa-calendar-alt" aria-hidden="true"></span>
							                            </button>
							                        </span>
							                    </div>
							                    <span class="help-block" ng-if="debug">[{{portalSelected.featuredEndDate}}]</span>
							                </div>
							            </div>
							            <div class="form-group">
								            <label class="col-sm-4 control-label" for="numOrden">Nº de orden destacado:</label>
								            <div class="col-sm-2">
												<input ng-disabled="permisos.MODRESTRICTED" class="form-control" type="number" id="numOrden" name="numOrden" ng-model="portalSelected.featuredOrder" style="width:4em"/>
											</div>
											<label for="informe" class="col-sm-4 control-label">
												Mostrar en calendario
											</label>	
											<div class="col-sm-2">
                                        		<input ng-disabled="permisos.MODRESTRICTED" class="form-control" type="checkbox" id="visibleEncalendario" name="visibleEncalendario" ng-true-value="'S'" ng-false-value="'N'" ng-model="portalSelected.visibleEncalendario"/>
                                    		</div>
										</div>
									</div>
				            	</div>
				            	<div class="col-md-6 form-horizontal">
				            		<table class="table table-striped table-condensed table-bordered table-btn" ng-if="registro.portales.length > 0">
                                        <thead>
                                            <tr>
                                                <th>Servicio/portal</th>
                                                <th>Fecha inicio destacado</th>
                                                <th>Fecha final destacado</th>
                                                <th>Nº orden destacado</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="p in registro.portales" ng-class="hoyEntreFechas(p);">
                                                <td>{{p.portal.title}}</td>
                                                <td>{{p.featuredStartDate | date:'dd-MM-yyyy'}}</td>
                                                <td>{{p.featuredEndDate | date:'dd-MM-yyyy'}}</td>
                                                <td>{{p.featuredOrder}} {{'N' === p.visible ? 'Descartado' : ''}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <hr class="sm"/>           
                                    <label for="descriptionAlt">Descripción Alternativa:</label>
                                    <!-- <textarea ck-editor-new id="descriptionAlt" name="descriptionAlt" ng-model="portalSelected.description">{{ portalSelected.description }}</textarea> -->
                                    <textarea ng-disabled="permisos.MODRESTRICTED" id="descriptionAlt" name="descriptionAlt" ng-model="portalSelected.description" class="form-control">{{ portalSelected.description }}</textarea>
				            	</div>
				            </div>
                            <div class="row margin-t1em">
                                <div class="col-md-6 form-horizontal">
                                    <label for="informe">
                                        <input ng-disabled="permisos.MODRESTRICTED" type="checkbox" id="informe" name="informe" ng-model="registro.informe"/>
                                        Mostrar en Informes <span ng-if="debug">{{[registro.informe]}}</span>
                                    </label>
                                    <div class="form-group">
                                        <label for="fechaAlternativa" class="col-sm-4 control-label">Fecha alternativa para informe: </label>
                                        <div class="col-sm-8">
                                            <div class="input-group">
                                                <input ng-disabled="permisos.MODRESTRICTED" type="text" id="fechaAlternativa" name="fechaAlternativa" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="registro.fechaAlternativa" is-open="datepickers.fechaAlternativa" close-text="Cerrar" current-text="Hoy" clear-text="Borrar"/>
                                                <span class="input-group-btn">
                                                    <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'fechaAlternativa')">
                                                        <span class="fas fa-calendar-alt" aria-hidden="true"></span>
                                                    </button>
                                                </span>
                                            </div>
                                            <span class="help-block" ng-if="debug">
                                                [{{registro.fechaAlternativa}}]
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 form-horizontal">
                                    <div class="form-group">
                                        <label for="feHoUser" class="col-sm-4 control-label">FeHo User (fecha): </label>
                                        <div class="col-sm-8">
                                            <div class="input-group">
                                                <input ng-disabled="permisos.MODRESTRICTED" type="text" id="feHoUser" name="feHoUser" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="registro.feHoUser" is-open="datepickers.feHoUser" close-text="Cerrar" current-text="Hoy" clear-text="Borrar" ng-disabled="registro.tipoActo.indexOf('1') === -1" />
                                                <span class="input-group-btn">
                                                    <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'feHoUser')" ng-disabled="registro.tipoActo.indexOf('1') === -1">
                                                        <span class="fas fa-calendar-alt" aria-hidden="true"></span>
                                                    </button>
                                                </span>
                                            </div>
                                            <span class="help-block" ng-if="debug">
                                                [{{registro.feHoUser}}]
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
				            <div class="row">
				            	<div class="col-md-6 form-horizontal">
	    							<div class="form-group">
	    								<label class="col-sm-4 control-label">Fecha para Histórico:</label>
	    								<div class="col-sm-8">
						                    <div class="input-group">
						                        <input ng-disabled="permisos.MODRESTRICTED" type="text" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="registro.fechaCaducidad" is-open="datepickers.dateCaducidad" close-text="Cerrar" current-text="Hoy" clear-text="Borrar" ng-disabled="registro.historico === 'N' || registro.permanent" />
						                        <span class="input-group-btn">
						                            <button type="button" class="btn btn-default" ng-click="toggleOpenDatePicker($event,'dateCaducidad')" ng-disabled="registro.historico === 'N'">
						                                <span class="fas fa-calendar-alt" aria-hidden="true"></span>
						                            </button>
						                        </span>
						                    </div>
						                    <span class="help-block" ng-if="debug">[{{registro.fechaCaducidad}}]</span>
						                </div>
	    							</div>
	    						</div>
	    						<div class="col-md-6 form-horizontal">
	    							<label for="historico" class="margin-l1em">
					                    <input ng-disabled="permisos.MODRESTRICTED" type="checkbox" id="historico" name="historico" ng-model="registro.historico" ng-true-value="'S'" ng-false-value="'N'" ng-click="limpiarFechaCaducidad();"/>
					                    Envíar a histórico al caducar <span ng-if="debug">{{[registro.historico]}}</span>
				                    </label>

                                    <label for="permanente" class="margin-l1em">
                                        <input ng-disabled="permisos.MODRESTRICTED" type="checkbox" id="permanente" name="permanente" ng-model="registro.permanent" ng-click="limpiarFechaCaducidad();"/>
                                        Actividad permanente <span ng-if="debug">{{[registro.permanent]}}</span>
                                    </label>
    							</div>
    						</div>
    					</uib-tab>
    					<uib-tab heading="Anexos">

<!--     						<div class="row">
    							<div class="col-md-12">
    								<button class="btn btn-default" ng-click="createAnexo()" ng-disable="registro.anexo.length > 0">
										<span class="glyphicon glyphicon-plus"></span> Crear anexo
									</button>
    							</div>
    						</div>
 -->
    						<!-- <div class="row">
	    						<div class="col-md-12 form-horizontal">
		    						<div class="form-group">
										<label class="col-sm-2 control-label" for="selecAnexo">Selecciona anexo:</label>
										<div class="col-sm-5">
											<div class="input-group">
		  										<select id="selecAnexo" class="form-control" ng-model="verAnexo" ng-options="anexo as anexo.codAnexo for anexo in registro.anexo" ng-disabled="verAnexo === undefined">
													<option value="false"> -- Elegir anexo -- </option>
												</select>
		  										<div class="input-group-btn">
		  											<button class="btn btn-default" ng-click="createAnexo(verAnexo)">
		  												<span class="glyphicon glyphicon-plus" aria-hidden="true" ></span><span class="hidden-xs"> Adjuntar anexos</span>
		  											</button>
		  											<button class="btn btn-default" ng-click="removeAnexo(verAnexo)" ng-disabled="verAnexo === undefined">
		  												<span class="glyphicon glyphicon-trash" aria-hidden="true" ></span><span class="hidden-xs"> Borrar anexos</span>
		  											</button>
		  										</div>
		  									</div>
										</div>
									</div>
									<span ng-show="debug">{{verAnexo}}</span>
								</div>
							</div>

							<hr/> -->

    						<!-- <div class="row" ng-repeat="anexo in registro.anexo | filter: verAnexo"> -->
    						<button type="button" class="btn btn-default" ng-click="removeAnexo(registro.attachment.id)" ng-disabled="registro.attachment === undefined">
								<span class="glyphicon glyphicon-trash" aria-hidden="true" ></span><span class="hidden-xs"> Borrar anexos</span>
							</button>
    						<div class="row">
	    						<div class="col-md-6 form-horizontal">

	    							<div class="form-group">
				                        <label class="col-sm-4 control-label" for="anexoPrograma">Programa Oficial
				                        <!-- <br/> (ppt, doc, pdf, txt): -->
				                        </label>
				                        <div class="col-sm-8">
				                        	<div class="input-group">
	      										<input ng-disabled="permisos.MODRESTRICTED" class="form-control" type="file" name="anexoPrograma" id="anexoPrograma" accept=".ppt,.doc,.txt,.pdf" file-upload/>
	      										<div class="input-group-btn" is-open="documentoAbierto">
	      											<a ng-href="{{registro.attachment.document}}" target="_blank" class="btn btn-default" ng-class="{'disabled' : registro.attachment.document === undefined}">
											        	<span class="glyphicon glyphicon-file"></span>
											    	</a>
	      										</div>
	      									</div>
                                            <em>{{registro.attachment.document.split('/').pop()}}</em>
				                        </div>
				                    </div>

				                    <div class="form-group">
				                    	<label class="col-sm-4 control-label" for="nombrePrograma">Nombre del programa</label>
				                        <div class="col-sm-8">
				                        	<input ng-disabled="permisos.MODRESTRICTED" class="form-control" id="nombrePrograma" type="text" ng-model="registro.attachment.documentTitle" value="{{registro.attachment.documentTitle}}" placeholder="Introduce un nombre para el programa oficial" />
				                        </div>
				                    </div>

	    							<div class="form-group">
				                        <label class="col-sm-4 control-label" for="anexoImagen">Imagen Vertical:</label>
				                        <div class="col-sm-8">
				                        	<!-- <div class="input-group"> -->
	      										<input ng-disabled="permisos.MODRESTRICTED" class="form-control" type="file" name="anexoImagen" id="anexoImagen" accept="image/*" img-cut img-cut-result-image="imagenVertical" img-cut-result-files="registro.attachment.file_array" img-cut-size="320x480" ng-model="registro.attachment.image"/>
	      										<!-- <div class="input-group-btn" dropdown is-open="imagenAbierta">
	      											<button type="button" class="btn btn-default dropdown-toggle" dropdown-toggle ng-disabled="(registro.anexo[0].imagen === undefined && imageCrop.originalImage.length <= 0)">
											        	<span class="glyphicon glyphicon-picture"></span>
											    	</button>
											    	<ul class="dropdown-menu">
											          <li ng-hide="imageCrop.croppedImage !== ''">
											        	<img ng-src="{{'//www.zaragoza.es/cont/paginas/actividades/' + registro.anexo[0].imagen}}" width="160" />
											          </li>
											          <li ng-show="imageCrop.croppedImage !== ''">
											        	<img ng-src="{{imageCrop.croppedImage}}" width="160" />
											          </li>
											        </ul>
	      										</div> -->
	      									<!-- </div> -->
                                            <em>{{registro.attachment.image.split('/').pop()}}</em>
				                        </div>
				                        <!-- <div class="col-sm-4">	
				                        	<input class="form-control" type="text" ng-model="anexo.imagen" value="{{anexo.imagen}}" />
				                        </div> -->
				                    </div>
	    							
	    							<div class="form-group">
                                        <label class="col-sm-4 control-label" for="anexoImagenAlt">Imagen Horizontal:</label>
                                        <div class="col-sm-8">
                                                <input ng-disabled="permisos.MODRESTRICTED" class="form-control" type="file" name="anexoImagenAlt" id="anexoImagenAlt" accept="image/*" img-cut img-cut-result-image="imagenHorizontal" img-cut-result-files="registro.attachment.file_array" img-cut-size="960x640" ng-model="registro.attachment.imageAlt"/>
                                            <em>{{registro.attachment.imageAlt.split('/').pop()}}</em>
                                        </div>
                                    </div>
	    							
	    							<div class="form-group">
				                        <label class="col-sm-4 control-label" for="anexoSonido">Sonido:</label>
				                        <div class="col-sm-8">
				                        	<div class="input-group">
	      										<input ng-disabled="permisos.MODRESTRICTED" class="form-control" type="file" name="anexoSonido" id="anexoSonido" accept="audio/*" file-upload/>
	      										<div class="input-group-btn" uib-dropdown is-open="sonidoAbierto">
	      											<button type="button" class="btn btn-default dropdown-toggle" uib-dropdown-toggle ng-disabled="{{registro.attachment.audio === undefined}}">
											        	<span class="glyphicon glyphicon-volume-up"></span>
											    	</button>
											    	<ul class="dropdown-menu">
											          <li>
											        	<audio controls ng-src="{{registro.attachment.audio | trusted}}"></audio>
											          </li>
											        </ul>
	      										</div>
	      									</div>
                                            <em>{{registro.attachment.audio.split('/').pop()}}</em>
				                        </div>
				                    </div>
	    							
	    							<div class="form-group">
				                        <label class="col-sm-4 control-label" for="anexoVideo">Video:</label>
				                        <div class="col-sm-8">
				                        	<!-- <div class="input-group"> -->
	      										<input ng-disabled="permisos.MODRESTRICTED" class="form-control" type="text" name="anexoVideo" id="anexoVideo" ng-model="registro.attachment.video" value="{{attachment.video}}" />
	      										<!-- <div class="input-group-btn" dropdown is-open="videoAbierto">
		      										<a ng-href="{{registro.anexo[0].video}}" target="_blank" class="btn btn-default" ng-class="{'disabled' : registro.anexo[0].video === undefined}">
											        	<span class="glyphicon glyphicon-facetime-video"></span>
											    	</a> -->
											    	<!-- <button type="button" class="btn btn-default dropdown-toggle" dropdown-toggle ng-disabled="{{registro.anexo[0].video === undefined}}">
											        	<span class="glyphicon glyphicon-facetime-video"></span>
											    	</button>
											    	<ul class="dropdown-menu">
											          <li>
											        	<span ng-bind-html="registro.anexo[0].video | trusted"></span>
											          </li>
											        </ul> -->
	      										<!-- </div> -->
	      									<!-- </div> -->
				                        </div>
				                    </div>
    							
    							</div>

    							<div class="col-md-6">
                                    <img ng-show="imagenVertical" ng-src="{{imagenVertical}}" width="160" />
                                    <img ng-show="imagenHorizontal" ng-src="{{imagenHorizontal}}" height="160" />
                                    <span ng-show="debug">
                                        <div><span class="badge">imagenVertical</span>{{imagenVertical}}</div>
                                        <div><span class="badge">imagenHorizontal</span>{{imagenHorizontal}}</div>
                                        <div><span class="badge">registro.attachment</span>{{registro.attachment}}</div>
                                    </span>
    								<!-- <div class="cropArea"> -->
    									<!-- <img-crop area-type="square" image="imagenNueva" result-image="imagenRecortada" result-image-format="image/jpeg"></img-crop> -->
    									<!-- <img-crop area-type="rectangle" image="imageCrop.originalImage" result-image="imageCrop.croppedImage" result-image-format="'image/png'" area-min-size="{w: 320,h: 480}" result-image-size="{w: 320,h: 480}"></img-crop> -->
    								<!-- </div> -->
    								<!-- <div>Imagen definitiva:</div> -->
  									<!-- <div><img ng-src="{{imageCrop.croppedImage}}" /></div> -->
    							</div>
    						</div>
    					</uib-tab>
 					</tabset>
				</div>
			</div>

        </fieldset>

    </div>

</div>
</form>