<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:sede="http://www.zaragoza.es" xmlns:th="http://www.thymeleaf.org" th:with="titulo=${registro.statusCode.value()} == 200 ? ${registro.body.title} : 'Página de error',description=${registro.statusCode.value()} == 200 ? ${registro.body.description} : '',image=${registro.statusCode.value()} == 200 ? (${registro.body.image} ? ${registro.body.image} : (${registro.body.tema} and ${registro.body.tema.image} ? ${registro.body.tema.image} : ''))" prefix="og: http://ogp.me/ns#">

<head>
    <meta charset="utf-8" />
    <sede:meta title=" ${titulo} + '. Propuesta. Presupuestos participativos'" description="${description}" summary_large_image="${image}" keywords="sede,web,publicación,municipal,presupuestos,participativos" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="//www.zaragoza.es/cont/plantillas/mapa/leaflet/leaflet.css" />
    <link rel="stylesheet" href="//www.zaragoza.es/cont/plantillas/mapa/leaflet/MarkerCluster.Default.css" />
    <script src="//www.zaragoza.es/cont/plantillas/mapa/leaflet/leaflet.js"></script>
    <script src="//www.zaragoza.es/cont/plantillas/mapa/leaflet/leaflet.ajax.min.js"></script>
    <script src="//www.zaragoza.es/cont/plantillas/mapa/leaflet/leaflet.markercluster.js"></script>

   

    <style class="text/css">
        .static-popover {
            display: block !important;
            max-width: 100%;
            margin: 0;
            z-index: 10;
        }

        .encabezado-propuesta {
            color: white;
            background-color: red;
            padding: .25em .5em;
            margin: .5em 0 !important;
            border-radius: 5px;
        }

        .card-form {
            background-color: #D8D8D8;
            border-radius: 5px
        }

        h2 {
            font-size: 1.5em;
            margin: .5em 0 !important;
        }

        h3 {
            font-size: 1.5em;
            margin: .5em 0 !important;
        }

        h4 {
            font-size: 1em;
            margin: .5em 0 !important;
        }

        .visible-panel {
            position: relative;
        }

        .visible-panel:hover .hidden-panel {
            display: block;
        }

        .hidden-panel {
            background: rgba(240, 240, 240, 0.9);
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            text-align: center;
            display: none;
            padding-top: 4em;
            line-height: 2em;
        }

        .line:before {
            background: #19BBC0 !important;
        }
        .line.fase-3:before {
            background: #8166C5 !important;
        }

        .line {
            list-style: none;
            padding: 20px 0 20px;
            position: relative;
        }

        .line-panel.fase-2 {
            border-left: 3px solid #19BBC0 !important;
        }
        .line-panel.fase-3{
            border-left: 3px solid #8166C5 !important;
        }

        .line:before {
            top: 0;
            bottom: 0;
            position: absolute;
            content: " ";
            /*width: 3px;*/
            width: 15px;
            background-color: #eeeeee;
            /*left: 50%;*/
            /*margin-left: -1.5px;*/
            margin-left: -7.5px;
        }

        .line>li>.line-panel {
            /*width: 46%;*/
            /*float: right;*/
            border: 1px solid #d4d4d4;
            border-radius: 2px;
            padding: 20px;
            margin-left: 25px;
            margin-bottom: 10px;
            position: relative;
            -webkit-box-shadow: 0 1px 6px rgba(0, 0, 0, 0.175);
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.175);
        }

        .line>li>.line-panel:before {
            position: absolute;
            top: 15px;
            right: -15px;
            display: inline-block;
            border-top: 15px solid transparent;
            border-left: 15px solid #ccc;
            border-right: 0 solid #ccc;
            border-bottom: 15px solid transparent;
            content: " ";
            border-left-width: 0;
            border-right-width: 15px;
            left: -15px;
            right: auto;
        }

        .line>li>.line-panel:after {
            position: absolute;
            top: 16px;
            right: -14px;
            display: inline-block;
            border-top: 14px solid transparent;
            border-left: 14px solid #fff;
            border-right: 0 solid #fff;
            border-bottom: 14px solid transparent;
            content: " ";
            border-left-width: 0;
            border-right-width: 14px;
            left: -14px;
            right: auto;
        }

        /*DISEÑO TRAZABILIDAD*/
        .line>li>.timeline-btn {
            color: #fff;
            width: 50px;
            height: 50px;
            line-height: 50px;
            font-size: 1.8em;
            text-align: center;
            position: absolute;
            top: 90px;
            left: -2.15%;
            
            z-index: 100;
            border-top-right-radius: 50%;
            border-top-left-radius: 50%;
            border-bottom-right-radius: 50%;
            border-bottom-left-radius: 50%;
        }

        .line>li>.timeline-btn.fase-2 {
            background-color: #19BBC0;
        }
        .line>li>.timeline-btn.fase-3 {
            background-color: #8166C5;
        }

        .timeline-btn.fase-2 {
            box-shadow: 0 0 0 1px #19BBC0, 0 0 0 3px white, 0 0 0 4px #19BBC0;
        }
        .timeline-btn.fase-3 {
            box-shadow: 0 0 0 1px #8166C5, 0 0 0 3px white, 0 0 0 4px #8166C5;
        }
        #fase2 .line:before, .fase-2-fnd {
            background: #99C74B !important;
        }

        .right-ribbon{
            position: relative;
            background: #EEE;
            border: 1px solid #CCC;
            box-shadow: 0px 1px 3px rgba(0,0,0,.2);
            padding: 10px 15px;
            clear: both;
            margin-right: -38px;
            float: right;
        }
         
        .right-ribbon::before{
            display: block;
            width: 10px;
            height: 0px;
            position: absolute;
            bottom: -10px;
            right: -1px;
            content: "";
            border-bottom: 10px solid transparent;
            border-left: 10px solid #757575;
        }
        </style>
</head>

<body>
    <sede:content>
        <th:block th:include="fragmentos/error" />
        <div th:if="${registro.statusCode.value()} == 200 and (${registro.body.visible} == 'S' or ${session.sess_risp})" th:object="${registro.body}" sede:rdf="*{voc()}" th:attr="about=*{uri}">
            <div>
                <a th:if="not *{#strings.contains(junta,'JV')}" th:href="'/sede/servicio/presupuestos-participativos/edicion/' + *{edicion} + '/obras/'" class="margin-b05em">
                    <span class="fa fa-angle-left"></span> Volver al listado
                </a>
                <a th:if="*{#strings.contains(junta,'JV')}" th:href="'/sede/portal/presupuestos-barrios-rurales/servicio/presupuestos-participativos/edicion/' + *{edicion}" class="margin-b05em">
                    <span class="fa fa-angle-left"></span> Volver al listado
                </a>
            </div>
            <div th:if="${#lists.contains(attr_peticion.permisosEnSeccion, 'MOD')} or (${session.sess_ciudadano} and ${registro.body.userId} == ${session.sess_ciudadano.id} and ${#utils.hasta('24-05-2018')})">
                <div class="fnd-gris-claro padding-a05em margin-b05em">
                    <p class="pull-left">Gestión de la propuesta</p>
                    <ul class="list-inline">
                        <li>
                            <a data-target="#form-edit" data-toggle="collapse" class="btn btn-sm btn-warning">
                                <span class="fa fa-edit"></span> Modificar
                            </a>
                        </li>
                        <li>
                            <a th:if="*{status != 'R'} and ${session.sess_ciudadano}" th:href="@{{id}/retirar(id=*{id})}" onclick="return confirm('¿Desea retirar del debate la propuesta?')" class="btn btn-sm btn-danger">
                                <span class="fas fa-trash-alt"></span> Retirar
                            </a>
                        </li>
                    </ul>
                </div>
                <div id="form-edit" class="collapse fnd-gris-claro padding-a2em">
                    <p class="lead">Modificación de la propuesta</p>
                    <form class="form-horizontal" method="post" th:action="@{/servicio/presupuestos-participativos/{id}{user}/save(id=*{id},user = ${session.sess_ciudadano} and ${session.sess_ciudadano.id} ? '/u':'')}" enctype="multipart/form-data">
                        <div class="fieldset col-md-12">
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="title">Título</label>
                                <div class="col-sm-10">
                                    <input class="form-control" type="text" id="title" name="title" th:value="*{title}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="representacion">Representando a</label>
                                <div class="col-sm-10">
                                    <input class="form-control" type="text" id="representacion" name="representacion" th:value="*{representacion}" />
                                </div>
                            </div>
                            <div class="form-group" th:if="${#lists.contains(attr_peticion.permisosEnSeccion, 'MOD')} and *{usuarioPub}">
                                <label class="col-sm-2 control-label" for="usuarioPub">Usuario/a</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" type="text" id="usuarioPub" name="usuarioPub" th:text="*{usuarioPub}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="description">Descripción</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" type="text" id="description" name="description" th:text="*{description}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="objetivos">Objetivos</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" type="text" id="objetivos" name="objetivos" th:text="*{objetivos}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="beneficiarios">Beneficiarios</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" type="text" id="beneficiarios" name="beneficiarios" th:text="*{beneficiarios}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="observaciones">Observaciones</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" type="text" id="observaciones" name="observaciones" th:text="*{observaciones}" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 col-md-2 control-label" for="img">Imagen</label>
                                <div class="col-sm-9 col-md-10">
                                    <input class="form-control" type="text" th:field="*{image}" size="100" />
                                    <input type="file" name="img" /> <span class="help-block">Formato admitido: jpg, png. Horizontal. Las imágenes se escalan automáticamente a 960x720</span>
                                </div>
                            </div>
                            <th:block th:if="${#lists.contains(attr_peticion.permisosEnSeccion, 'MOD')}">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="tema">Tema</label>
                                    <div class="col-sm-10">
                                        <select class="form-control" name="tema.id" id="tema.id">
                                            <option value=""></option>
                                            <option th:each="doc: ${tema}" th:value="${doc.id}" th:text="${doc.title}" th:selected="*{tema} and ${doc.id}==*{tema.id}" />
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="top">Visible</label>
                                    <div class="col-sm-4">
                                        <select class="form-control" id="visible" name="visible">
                                            <option value="S" th:selected="*{visible} == 'S'">Visible</option>
                                            <option value="N" th:selected="*{visible} == 'N'">Improcedente</option>
                                        </select>
                                    </div>
                                    <label class="col-sm-2 control-label" for="top">Estado</label>
                                    <div class="col-sm-4">
                                        <select class="form-control" id="status" name="status">
                                            <option value="">No valorado</option>
                                            <option value="R" th:selected="*{status} == 'R'">Retirada por el creador</option>
                                            <option value="N" th:selected="*{status} == 'N'">Retirada del debate</option>
                                            <!-- <option value="P" th:selected="*{status} == 'P'">Pendiente de reformulación</option> -->
                                            <option value="S" th:selected="*{status} == 'S'">Pasa a apoyos y priorización</option>
                                            <option value="F" th:selected="*{status} == 'F'">Priorizada por la mesa</option>
                                            <option value="U" th:selected="*{status} == 'U'">Priorizada por la ciudadanía</option>
                                            <option value="A" th:selected="*{status} == 'A'">En ratificación</option>
                                            <option value="V" th:selected="*{status} == 'V'">En votación</option>
                                            <!-- <option value="C" th:selected="*{status} == 'C'">Rechazada por la comisión</option> -->
                                            <option value="E" th:selected="*{status} == 'E'">Seleccionada para ejecutar</option>
                                            <!-- <option value="X" th:selected="*{status} == 'X'">En ejecución</option> -->
                                            <!-- <option value="T" th:selected="*{status} == 'T'">Terminada</option> -->
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="valoracionTecnica">Valoracion técnica</label>
                                    <div class="col-sm-10">
                                        <textarea class="form-control" type="text" id="valoracionTecnica" name="valoracionTecnica" th:text="*{valoracionTecnica}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="motivo">Viabilidad / Informes</label>
                                    <div class="col-sm-10">
                                        <textarea class="form-control" type="text" id="motivo" name="motivo" th:text="*{motivo}" />
                                    </div>
                                </div>
                                <th:block th:if="${userGroup}">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label" for="">Solicitar Valoraciones</label>
                                        <div class="col-sm-10">
                                            <select name="gczUsuarios" class="select-registros form-control" multiple="multiple" tabindex="-1" aria-hidden="true">
                                                <option th:each="doc, row: ${userGroup.gczUsuarios}" th:value="${doc.login}"> 
                                                    <th:block th:text="${doc.nombre} + ' ' + ${doc.apellido1}"/>
                                                    <th:block th:each="prop : ${doc.gczPropiedadUsuarios}">
                                                        <th:block th:if="${prop.id.etiqueta == 'cgcz_telefono'} or ${prop.id.etiqueta == 'usr_servicio'}" th:text="${prop.valor}"/>
                                                    </th:block>
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </th:block>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="motivoResumen">Resumen breve de viabilidad</label>
                                    <div class="col-sm-10">
                                        <textarea class="form-control" type="text" id="motivoResumen" name="motivoResumen" th:text="*{motivoResumen}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="coste">Coste</label>
                                    <div class="col-sm-10">
                                        <input class="form-control" type="text" id="coste" name="coste" th:value="*{coste}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="estadoObra">Estado obra</label>
                                    <div class="col-sm-10">
                                        <input class="form-control" type="text" id="estadoObra" name="estadoObra" th:value="*{estadoObra}" />
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="fechaObra">Fecha obra</label>
                                    <div class="col-sm-4">
                                        <input class="form-control" type="text" id="fechaObra" name="fechaObra" th:value="*{fechaObra}" />
                                    </div>
                                    <label class="col-sm-2 control-label" for="fechaObra">Fecha Fin obra</label>
                                    <div class="col-sm-4">
                                        <input class="form-control" type="text" id="fechaObra" name="fechaFinObra" th:value="*{fechaFinObra}" />
                                    </div>
                                </div>
                            </th:block>
                            <div class="row">
                                <div class="col-md-6 form-group">
                                    <label class="control-label" for="lugar">
                                        Selecciona la calle:
                                    </label>
                                    <input type="text" name="lugar" id="lugar" th:value="*{lugar}" autocomplete="off" placeholder="Buscar calle" class="form-control" />
                                    <label for="calle_id" class="control-label col-xs-12 col-md-2 oculto">Calle:</label>
                                    <input type="hidden" name="srsname" id="srsname" value="wgs84" />
                                    <input type="hidden" name="x" id="x" th:value="*{x}" />
                                    <input type="hidden" name="y" id="y" th:value="*{y}" />
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 form-group">
                                    <a class="margin-t2em" href="javascript:colocarMarker(41.65774642566255,-0.8830220349937529);">Coloque la ubicación manualmente si no ha sido encontrada</a>
                                    <br/>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 mapas">
                                    <th:block th:if="*{id} and *{geometry}" th:utext="*{geometry.getRdf()}"></th:block>
                                    <div id="mapa-leaflet" style="height: 30em"></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <input type="submit" name="submit" value="Guardar modificaciones" class="boton btn btn-primary" />
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-md-8">
                    <div class="card clearfix">
                        <h2 class="encabezado-propuesta"><strong><span class="fa fa-puzzle-piece" aria-hidden="true"> </span> PROPUESTA CIUDADANA</strong> <strong th:if="*{tema}" th:text="*{tema.title}"></strong></h2>
                        <div>
                            <h3 class="text-primary text-uppercase" sede:rdf="*{get('title')}"></h3>
                            <p>Realizada por <strong th:text="*{usuarioAlta}"></strong> el <span class="text-info"><th:block sede:rdf="*{get('creationDate','EEEE dd MMMM HH:mm')}"></th:block> h.</span>
                                <th:block th:if="*{representacion}">
                                    en representación de <strong sede:rdf="*{get('representacion')}"></strong>
                                </th:block>
                            </p>
                            <div class="right-ribbon margin-b05em" th:if="not *{#strings.contains(junta,'JV')}">
                                <h3 class="nomargin">
                                    <span class="fa fa-check-circle text-success" title="Apoyos Recibidos" aria-hidden="true"></span> Apoyos Recibidos: <span th:text="*{votosAFavor} == null ? '0' : *{votosAFavor}"></span>
                                <span class="sr-only">Apoyos Recibidos</span>
                                </h3>
                            </div>
                            <p>Propuesta para <strong th:text="*{soloNombreJunta}"></strong></p>
                        </div>
                        <hr/>
                        <div class="margin-l1em">
                            <th:block th:if="*{description}">
                                <h4 class="text-primary text-uppercase"><strong>Descripción</strong></h4>
                                <div sede:rdf="*{get('description')}"></div>
                            </th:block>
                            <br/>
                            <th:block th:if="*{objetivos}">
                                <h4 class="text-primary text-uppercase"><strong>Objetivos</strong> </h4>
                                <div sede:rdf="*{get('objetivos')}"></div>
                            </th:block>
                            <br/>
                            <th:block th:if="*{beneficiarios}">
                                <h4 class="text-primary text-uppercase"><strong>Beneficiarios/as</strong></h4>
                                <div sede:rdf="*{get('beneficiarios')}"></div>
                            </th:block>
                            <br/>
                            <th:block th:if="*{lugar}">
                                <h4 class="text-primary text-uppercase"><strong>Lugar</strong></h4>
                                <div sede:rdf="*{get('lugar')}"></div>
                            </th:block>
                            <br/>
                            <th:block th:if="*{observaciones}">
                                <h4 class="text-primary text-uppercase"><strong>Observaciones</strong></h4>
                                <div sede:rdf="*{get('observaciones')}"></div>
                            </th:block>
                        </div>
                        <hr class="sm clearfix"/>
                        <th:block th:include="/fragmentos/share-button(title='Compartir', uri=*{uri}, text='Presupuestos Participativos, propuesta ' + *{title})"></th:block>
                        <button class="btn btn-default btn-sm pull-right margin-r1em" type="button" id="printBtn"><span class="fas fa-print" aria-hidden="true"></span> Imprimir</button>
                    </div>
                </div>
                <div class="col-md-4 col-xs-12 text-center">
                    <img th:if="*{image}" th:src="*{image}" alt="" class="img-responsive img-rounded" />
                    <th:block th:if="!*{image}">
                        <img th:if="*{tema} and *{tema.image}" th:src="*{tema.image}" alt="" class="img-responsive img-rounded margin-b1em" />
                        <img th:if="!*{tema} or (*{tema} and !*{tema.image})" src="https://www.zaragoza.es/cont/vistas/portal/presupuestos-participativos/img/cabecera-600x600.jpg" alt="" class="img-responsive img-rounded margin-b1em" />
                    </th:block>
                    
                    <!--/* Botones de apoyos */-->
                    <div class="visible-panel popover static-popover" th:classappend="${currentDevice.isMobile()} ? 'bottom' : 'right'" th:if="${#utils.desde('12-03-2018', '20:00')}">
                        <div class="arrow"></div>

                        <!--/* status = 'S' - Pasa a apoyos y priorización */-->
                        <th:block th:if="*{status} == 'S' and ${#utils.hasta('26-03-2018')}">
                            <!--/* Se muestra título de popover si la sesión no está iniciada y la propuesta no está rechazada */-->
                            <div class="popover-title text-center" th:if="not ${session.sess_ciudadano} and *{status} == 'S'">
                                <h4><strong class="text-primary">APOYAR</strong> esta PROPUESTA</h4>
                            </div>
                            <!--/* Se muestra título de popover si la sesión está iniciada, la propuesta es de la junta del usuario/a o la propuesta es de Ciudad y la propuesta tiene estado 'Pasa a apoyos y priorización' (S) */-->
                            <div class="popover-title text-center" th:if="${session.sess_ciudadano} and (${session.sess_ciudadano.juntaActual} == null or ${session.sess_ciudadano.juntaActual} == *{junta} or *{junta} == 'Ciudad') and *{status} == 'S'">
                                <h4 th:if="${votadoPropuesta}==false"><strong class="text-primary">APOYAR</strong> esta PROPUESTA</h4>
                                <h4 th:if="${votadoPropuesta}==true"><strong class="text-primary">RETIRAR APOYO</strong> de esta PROPUESTA</h4>
                            </div>
                            <div class="popover-content text-center">
                                <!--/* Si la sesión está iniciada y la propuesta pertenece a la junta del usuario/a o la propuesta es de Ciudad, permite votar.
                                Si la junta del usuario/a es *null* aparece el botón de apoyo que te redirige al formulario de inserción de los datos de padrón */-->
                                <th:block th:if="${session.sess_ciudadano} and (${session.sess_ciudadano.juntaActual} == null or ${session.sess_ciudadano.juntaActual} == *{junta} or *{junta} == 'Ciudad')">
                                    <!--/* Realizar apoyo */-->
                                    <a th:href="@{{id}/a-favor(id=*{id})}"><span th:if="${votadoPropuesta}==false" class="fa fa-check-circle fa-5x text-success" title="Apoyar esta Propuesta" aria-hidden="true"></span> </a>
                                    <span th:if="${votadoPropuesta}==false" class="sr-only">Apoyar esta propuesta</span>
                                    <!--/* Retirar apoyo */-->
                                    <a th:href="@{{id}/en-contra(id=*{id})}"><span th:if="${votadoPropuesta}==true" class="fas fa-times fa-5x text-primary" title="Retirar apoyo de esta propuesta" aria-hidden="true"></span> </a>
                                    <span th:if="${votadoPropuesta}==true" class="sr-only">Retirar apoyo de esta propuesta</span>
                                    <span class="sr-only">apoyos recibidos</span>
                                </th:block>
                                <!--/* Si la sesión está iniciada y la propuesta NO pertenece a la junta del usuario/a o NO es propuesta de Ciudad, NO permite votar y muestra advertencia. En caso de tener estado distinto de 'Pasa a apoyos y priorización' (S), oculta este mensaje en favor del mensaje de estado
                                Este mensaje solo aparece si la junta del usuario/a es *null* */-->
                                <th:block th:if="${session.sess_ciudadano} and (${session.sess_ciudadano.juntaActual} != null and ${session.sess_ciudadano.juntaActual} != *{junta} and *{junta} != 'Ciudad') and *{status} == 'S'">
                                    <div role="alert" class="alert alert-danger margin-t05em">Sólo puede apoyar propuestas pertenecientes a su distrito o propuestas de Ciudad.</div>
                                </th:block>
                                <!--/* Si la sesión no está iniciada, al pasar el ratón por la zona muestra mensaje para loguear */-->
                                <th:block th:if="not ${session.sess_ciudadano} and *{status} == 'S'">
                                    <!--/* Si la propuesta está rechazada no mostramos el icono de apoyo */-->
                                    <span th:if="*{status} == 'S'" class="fa fa-check-circle fa-5x text-success" title="Apoyos Recibidos" aria-hidden="true"></span>
                                    <span th:if="*{status} == 'S'" class="sr-only">Apoyos recibidos</span>
                                    <!--/* Mensaje onHover en el popover para logearte o registrarte en la Plataforma de Gobierno Abierto */-->
                                    <div th:if="!${session.sess_ciudadano}" class="hidden-panel">
                                        <strong> Necesitas <a th:href="${#utils.getLinkLoginUsuario(#httpServletRequest)}" class="text-primary">iniciar sesión</a> o <a href="/sede/acceso/" class="text-primary">registrarte</a> para participar. </strong>
                                    </div>
                                </th:block>
                            </div>
                        </th:block>

                        <!--/* status != 'S' - Se muestra el estado de la propuesta (consultar Propuesta.java) */-->
                        <div class="popover-title text-center">
                            <h4><strong class="text-primary">ESTADO</strong> de la PROPUESTA</h4>
                        </div>
                        <div class="popover-content text-center">
                            <div th:if="*{status} == 'U'" role="alert" class="alert alert-success">
                                Esta propuesta ha sido priorizada por la ciudadanía.
                                <div th:if="*{motivoResumen}" th:utext="*{motivoResumen}"></div>
                            </div>
                            <div th:if="*{status} == 'F'" role="alert" class="alert alert-success">
                                Esta propuesta ha sido priorizada por la mesa.
                                <div th:if="*{motivoResumen}" th:utext="*{motivoResumen}"></div>
                            </div>
                            <div th:if="*{status} == 'S'" role="alert" class="alert alert-info">
                                Esta propuesta ha estado en debate. No ha sido seleccionada para valoración técnica.
                            </div>
                            <div th:if="*{status} == 'R'" role="alert" class="alert alert-danger">
                                Esta propuesta ha sido retirada por el creador.
                            </div>
                            <div th:if="*{status} == 'P'" role="alert" class="alert alert-warning">
                                Esta propuesta está pendiente de reformulación.
                            </div>
                            <div th:if="*{status} == 'N'" role="alert" class="alert alert-danger">
                                Esta propuesta ha sido retirada del debate.
                                <div th:if="*{motivoResumen}" th:utext="*{motivoResumen}"></div>
                            </div>
                            <div th:if="*{status} == 'A'" role="alert" class="alert alert-warning">
                                Esta propuesta se encuentra en ratificación.
                                <div th:if="*{motivoResumen}" th:utext="*{motivoResumen}"></div>
                            </div>
                            <div th:if="*{status} == 'V'" role="alert" class="alert alert-success">
                                Esta propuesta se encuentra en votación.
                                <div th:if="*{motivoResumen}" th:utext="*{motivoResumen}"></div>
                            </div>
                            <div th:if="*{status} == 'E'" role="alert" class="alert alert-success">
                                Esta propuesta ha sido seleccionada para su ejecución.
                                <br/>
                                <th:block th:if="*{estadoObra}">
                                    <strong>Estado de la obra: </strong>
                                    <th:block th:text="*{estadoObra}"></th:block>
                                    <br/>
                                    <strong th:if="*{fechaObra}">Fecha: </strong>
                                    <th:block th:text="*{fechaObra}"></th:block>
                                    <strong th:if="*{fechaFinObra}">Fecha fin: </strong>
                                    <th:block th:text="*{fechaFinObra}"></th:block>
                                </th:block>
                                <th:block th:if="*{motivoResumen}">
                                    <br/>
                                    <th:block th:utext="*{motivoResumen}"></th:block>
                                </th:block>
                            </div>
                            <!--/* Si no tiene estado y tiene resumen breve (unificadas y otros casos) */-->
                            <div th:if="not *{status} and *{motivoResumen}" role="alert" class="alert alert-info" th:utext="*{motivoResumen}"></div>
                            <th:block th:if="${not #lists.isEmpty(registro.body.valoraciones)}">
                                <div th:if="*{motivo} == 'pendiente'" role="alert" class="alert alert-info">Quedan valoraciones por realizar</div>
                                <div th:if="*{motivo} == 'viable'" role="alert" class="alert alert-success">Viable</div>
                                <div th:if="*{motivo} == 'no viable'" role="alert" class="alert alert-danger">NO Viable</div>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>

            <!--/* Anexos */-->
            <th:block th:include="servicio/presupuestos-participativos/anexo(anexos=${registro.body.anexo})" />
            <!--/* TRAZABILIDAD: Acciones y estados de la propuesta (publicados) */-->
            <div class="hidden-print" th:include="servicio/presupuestos-participativos/accion(acciones=${registro.body.acciones}, status=${registro.body.status})"></div>

            <!--/* Valoraciones */-->
            <th:block th:if="${visibleValoracion == true} or ${#lists.contains(attr_peticion.permisosEnSeccion, 'ADMIN')}">
                <th:block th:include="servicio/presupuestos-participativos/valoraciones(valoraciones=${registro.body.valoraciones})" />
            </th:block>
            <!--/* Si la sesión NO está iniciada se mostrará un aviso */-->
            <div role="alert" class="alert alert-info" th:if="not ${session.sess_ciudadano} and ${#utils.hasta('26-02-2018')}">
                Debe <a th:href="${#utils.getLinkLoginUsuario(#httpServletRequest)}">Acceder</a> para poder realizar aportaciones
            </div>
            <!--/* Si la sesión está iniciada pero el usuario no pertenece a la junta, se mostrará un aviso */-->
            <div role="alert" class="alert alert-danger" th:if="${session.sess_ciudadano} and (${session.sess_ciudadano.juntaActual} != ${registro.body.junta} and ${registro.body.junta != 'Ciudad'}) and ${#utils.hasta('26-02-2018')}">
                Solo se puede comentar sobre propuestas de su distrito <span th:text="${session.sess_ciudadano.soloNombreJunta}" class="badge"></span>
            </div>
            <!--/* Si la sesión está iniciada y el usuario pertenece a la junta se mostrará el formulario para enviar comentario */-->
            <div class="row" th:if="${session.sess_ciudadano} and (${session.sess_ciudadano.juntaActual} == ${registro.body.junta} or ${registro.body.junta == 'Ciudad'}) and ${#utils.hasta('26-02-2018')}">
                <div class="col-md-12">
                    <div class="card card-form clearfix">
                        <form th:action="@{/servicio/presupuestos-participativos/{id}/addcomentario(id=${registro.body.id})}" th:object="${dato}" method="post" class="form-horizontal">
                            <h4 class="text-primary"><strong>Realiza tus APORTACIONES a esta propuesta</strong></h4>
                            <textarea class="form-control" placeholder="   ..." required="required" name="comentario"></textarea>
                            <br/>
                            <button type="submit" class="btn btn-primary pull-right">Enviar comentario</button>
                        </form>
                    </div>
                </div>
            </div>
            <!--/* Lista de comentarios */-->
            <div class="row" th:if="${registro.statusCode.value()} == 200 and ${comentario}">
                <div class="col-md-12">
                    <div class="card card-form">
                        <div class="row">
                            <h3 class="text-primary nomargin margin-l1em">
                                <span class="far fa-comment-alt fa-2x"></span>
                                <strong>Últimas APORTACIONES REALIZADAS</strong>
                            </h3>
                            <div class="pull-right margin-b1em margin-r2em">Número de comentarios: <span th:text="${comentario.result.size()}"></span></div>
                        </div>
                        <div th:if="${#lists.isEmpty(comentario.result)}" role="alert" class="alert alert-info">
                            No existen comentarios
                        </div>
                        <div th:if="${not #lists.isEmpty(comentario.result)}">
                            <ul class="list-unstyled">
                                <li class="card margin-b1em" th:each="comment : ${comentario.result}">
                                    <div class="row">
                                        <div class="col-md-9 col-sm-12 margin-b1em">
                                            <span><span class="fa fa-user text-primary"></span> <strong th:text="${comment.name}" />, el <em th:text="${#calendars.format(comment.creationDate,'dd-MM-yyyy, HH:mm')}">h.</em>, hizo la siguiente aportación: </span>
                                            <hr/>
                                            <div th:utext="${comment.description}" />
                                        </div>
                                        <!--/*
                                        <div class="col-md-2 col-sm-12 col-xs-12 pull-right margin-r1em">
                                            <span class="col-md-12 col-sm-6 label label-default margin-a1em">
                                                Apoyos Recibidos:
                                                </span>
                                            <div class="row col-md-12 col-sm-6" th:if="${#utils.hasta('16-01-2017')}">
                                                <div class="col-md-6 col-sm-3 col-xs-3 col-md-push-3 col-sm-push-2 col-xs-push-2">
                                                    <strong th:text="${comment.votosAFavor} == null ? '0' : ${comment.votosAFavor}"></strong>
                                                    <a th:if="${session.sess_ciudadano} and ${session.sess_ciudadano.juntaActual} == ${registro.body.junta}" th:href="@{{comentario}/comentario/{id}/a-favor(id=${comment.id}, comentario=${comment.propuestaId})}">
                                                        <span class="fa fa-arrow-up text-success" alt="Apoyos a Favor" title="Apoyos a favor" aria-hidden="true"></span> <span class="sr-only">Apoyos a favor</span>
                                                    </a>
                                                    <th:block th:if="not ${session.sess_ciudadano} or ${session.sess_ciudadano.juntaActual} != ${registro.body.junta}">
                                                        <span class="fa fa-arrow-up text-success" alt="Apoyos a Favor" title="Apoyos a favor" aria-hidden="true"></span> <span class="sr-only">Apoyos a favor</span>
                                                        <th:block th:if="not ${session.sess_ciudadano}"></th:block>
                                                    </th:block>
                                                </div>
                                                <div class="col-md-6 col-sm-3 col-xs-3 col-md-push-2 col-sm-push-1 col-xs-push-1">
                                                    <strong th:text="${comment.votosEnContra} == null ? '0' : ${comment.votosEnContra}"></strong>
                                                    <a th:if="${session.sess_ciudadano} and ${session.sess_ciudadano.juntaActual} == ${registro.body.junta}" th:href="@{{comentario}/comentario/{id}/en-contra(id=${comment.id}, comentario=${comment.propuestaId})}">
                                                        <span class="fa fa-arrow-down text-primary" alt="Apoyos en contra" title="Apoyos en contra" aria-hidden="true"></span> <span class="sr-only">Apoyos en contra</span>
                                                    </a>
                                                    <th:block th:if="not ${session.sess_ciudadano} or ${session.sess_ciudadano.juntaActual} != ${registro.body.junta}">
                                                        <span class="fa fa-arrow-down text-primary" alt="Apoyos en contra" title="Apoyos en contra" aria-hidden="true"></span> <span class="sr-only">Apoyos en contra</span>
                                                        <th:block th:if="not ${session.sess_ciudadano}"></th:block>
                                                    </th:block>
                                                </div>
                                            </div>
                                            <span th:if="not ${session.sess_ciudadano} and ${#utils.hasta('16-01-2017')}" class="col-md-12 col-sm-6 col-xs-12 alert alert-info margin-a1em">
                                                    Identifíquese para poder votar al comentario
                                                </span>
                                            <div class="row col-md-12 col-sm-6" th:if="${#utils.desde('17-01-2017')}">
                                                <div class="col-md-6 col-sm-3 col-xs-3 col-md-push-3 col-sm-push-2 col-xs-push-2">
                                                    <strong th:text="${comment.votosAFavor} == null ? '0' : ${comment.votosAFavor}"></strong>
                                                    <span class="fa fa-arrow-up text-success" alt="Apoyos a Favor" title="Apoyos a favor" aria-hidden="true"></span> <span class="sr-only">Apoyos a favor</span>
                                                </div>
                                                <div class="col-md-6 col-sm-3 col-xs-3 col-md-push-3 col-sm-push-1 col-xs-push-1">
                                                    <strong th:text="${comment.votosEnContra} == null ? '0' : ${comment.votosEnContra}"></strong>
                                                    <span class="fa fa-arrow-down text-primary" alt="Apoyos en contra" title="Apoyos en contra" aria-hidden="true"></span> <span class="sr-only">Apoyos en contra</span>
                                                </div>
                                            </div>
                                        </div>
                                        */-->
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </sede:content>
    <script type="text/javascript" src="https://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/locales/bootstrap-datepicker.es.min.js"></script>
    <script src="//www.zaragoza.es/cont/plantillas/mapa/leaflet/proj4.js"></script>
    <script src="//www.zaragoza.es/cont/plantillas/mapa/leaflet/proj4leaflet.js"></script>
    <script src="//www.zaragoza.es/cont/plantillas/mapa/leaflet/gsl-BaseLayerSelector.js" type="text/javascript"></script>
    <script src="//www.zaragoza.es/cont/plantillas/mapa/leaflet/capas.js"></script>
    <script type="text/javascript">
    /*<![CDATA[*/

    //COLLAPSE TRAZABILIDAD
    var id = 0;
    $('.line>li').each(function( index ) {
        $( this ).attr('id',index);
        id = index;
    });
    //Solo se aplica si existen más de 2 item
    if (id > 1) {
        //Mostramos botón para plegar/desplegar collapse
        $('.timeline-btn').removeClass('hide');

        $('.line>li').addClass('hide');
        $('.line>#0').removeClass('hide');
        $('.line>#' + id).removeClass('hide');
        $('.line>#0').css('margin-bottom', '15px');
        $('.line>#0').append('<p class="text-center puntos" style="font-size:30px;margin-top:5px;"><strong>.  .  .</strong></p>');
        
        $('.timeline-btn').click(function() {
            if ($('.line>#1').hasClass('hide')){
                $('.line>li').removeClass('hide');
                $('.fa-angle-double-up').removeClass('hide');
                $('.fa-angle-double-down').addClass('hide');
                //$('.line>#0').css('margin-bottom', '0');
                $('.puntos').addClass('hide');
            } else {
                $(".line>li").addClass('hide');
                $('.line>#0').removeClass('hide');
                $('.line>#' + id).removeClass('hide');
                $('.fa-angle-double-down').removeClass('hide');
                $('.fa-angle-double-up').addClass('hide');
                //$('.line>#0').css('margin-bottom', '50px');
                $('.puntos').removeClass('hide');
            }
        });
    }
    //FIN Trazabilidad


    /*
    //MAPA
    var marker;
    var pois = [];
    var addressDataset = new Bloodhound({
        datumTokenizer: function(countries) {
            return Bloodhound.tokenizers.whitespace(result.value);
        },
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        remote: {
            url: '/sede/servicio/portalero/list',
            replace: function() {
                var consulta = $('#lugar').val();
                var q = '/sede/servicio/portalero/list?rows=10&fl=id,calle.title,numero,geometry&srsname=wgs84&calle.titleContains=';
                if (consulta.indexOf(',') > 0) {
                    var dat = consulta.split(',');
                    q = q + encodeURIComponent(dat[0]) + '&numero=' + encodeURIComponent(dat[1].trim());
                } else {
                    q = q + encodeURIComponent(consulta);
                }
                return q;
            },
            filter: function(response) {
                return response.result;
            },
            wildcard: '%QUERY'
        }
    });
    $('#lugar').typeahead(null, {
        name: 'address',
        // display: 'item.title',
        displayKey: function(results) {
            return results.calle.title.replace(',', ' ') + ', ' + results.numero;
        },
        source: addressDataset
    });
    $('#lugar').bind('typeahead:select', function(ev, item) {
        $('#x').val(item.geometry.coordinates[0]);
        $('#y').val(item.geometry.coordinates[1]);
        colocarMarker(item.geometry.coordinates[1], item.geometry.coordinates[0]);
    });

    function colocarMarker(latitude, longitude) {
        console.log(latitude + ':' + longitude)
        if (marker) {
            map.removeLayer(marker);
            pois = [];
        }
        marker = L.marker([latitude, longitude], { draggable: true });
        marker.on('dragend', function(e) {
            $('#x').val(marker.getLatLng().lng);
            $('#y').val(marker.getLatLng().lat);
        });
        pois.push(marker);
        group = L.featureGroup(pois).addTo(map);
        map.fitBounds(group.getBounds());
        $('#x').val(longitude);
        $('#y').val(latitude);
        console.log('Se ha colocado marker:' + marker.toGeoJSON());
    }
    mapa();

    function mapa() {
        console.log('Cargamos mapa al cargar página');
        latitude = $(document).find("[property='latitude']").attr("content");
        longitude = $(document).find("[property='longitude']").attr("content");
        if (latitude && longitude) {
            colocarMarker(latitude, longitude);
        }
    }*/

    $('#printBtn').bind('click',function() {
        window.print();
    });
    /*]]>*/
    </script>
</body>

</html>